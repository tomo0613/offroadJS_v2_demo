var Qe=Object.defineProperty;var ti=(e,t,i)=>t in e?Qe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var r=(e,t,i)=>(ti(e,typeof t!="symbol"?t+"":t,i),i);import{V as w,B as Vt,C as Se,S as ei,a as Me,b as ht,c as q,d as Jt,Q as se,R as ii,M as Pe,W as oi,e as ni,f as si}from"./vendor/cannon-fb08787c.js";import{G as ai,c as ri,I as hi,d as Ee,M as Mt,E as pi,a as _t,e as li,V as E,f as ci,O as di,B as Le,C as gi,S as mi,g as _i,h as ui,i as Lt,j as yi,k as ke,l as gt,R as xi,m as Te,T as fi,n as wi,H as bi,W as Ci,o as vi,D as zi,p as Si,q as Mi,r as Pi,s as Ei,t as Li}from"./vendor/three-c64a4383.js";import{j as g,r as u,a as ut}from"./vendor/react-6a63c5cb.js";import"./vendor/vendor-5e83183c.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();class st{constructor(){r(this,"listeners",new Map)}add(t,i){if(!i)throw new Error(`EventListener->add($listener) Invalid $listener: ${i}, with type ${t}`);if(this.listeners.has(t))this.listeners.get(t).add(i);else{const o=new Set([i]);this.listeners.set(t,o)}}remove(t,i){if(this.listeners.has(t)){const o=this.listeners.get(t);o.delete(i),o.size||this.listeners.delete(t)}}clear(){this.listeners.clear()}dispatch(t,...i){this.listeners.has(t)&&this.listeners.get(t).forEach(n=>n(...i))}}const Fe=["fullscreen","antialias","renderShadows","renderWireFrame","resolutionScale"],ki={fullscreen:!1,antialias:!1,renderShadows:!1,renderWireFrame:!1,resolutionScale:1,powerPreference:"high-performance",physicsFrameRate:120,world:{gravity:{x:0,y:-9.8,z:0}},camera:{fov:50,near:.1,far:1e3,initialPosition:{x:0,y:7,z:27},mountOffset_v3:[0,4,9],mountOffsetReverse_v3:[5,4,-9],lookOffset_v3:[0,1,-5]},vehicle:{mass:30,steeringSpeed:.02,maxSteeringAngle:.7,maxBrakeForce:22,maxEngineForce:220,torqueSplitRatio:[50,50],cameraMountPosition:{x:0,y:4,z:10},wheelRadius:.4,wheelSuspensionRestLength:.3,wheelSuspensionStiffness:25,wheelMaxSuspensionTravel:.3,wheelMaxSuspensionForce:Number.MAX_VALUE,wheelDampingCompression:2,wheelDampingRelaxation:2,wheelFrictionSlip:1.1,wheelForwardAcceleration:1/2,wheelSidedAcceleration:1,wheelRollInfluence:.6}},Ie=new st,Dt=Fe.reduce((e,t)=>{try{const i=window.localStorage.getItem(t);i&&(e[t]=JSON.parse(i))}catch(i){console.error(i)}return e},{}),f=new Proxy(ki,{get(e,t){return Dt.hasOwnProperty(t)?Dt[t]:e[t]},set(e,t,i){if(Fe.includes(t)){Dt[t]=i,Ie.dispatch(t,i);try{window.localStorage.setItem(t,String(i))}catch(o){console.error(o)}}return!0}});class Ae{constructor(t,i){r(this,"items");r(this,"activeCount",0);r(this,"itemProvider");r(this,"itemActivator");r(this,"itemDeactivator");r(this,"itemActiveCheck");r(this,"obtain",()=>{this.activeCount>=this.items.length&&this.items.push(this.itemProvider(this.items.length));const t=this.items[this.activeCount++];return this.itemActivator(t),t});r(this,"release",t=>{if(!this.itemActiveCheck(t))throw new Error(`ObjectPool->release($item) Not active $item: ${JSON.stringify(t)}`);if(this.activeCount--,this.itemDeactivator(t),!this.activeCount)return;const i=this.items.indexOf(t),o=this.items[this.activeCount];if(i<0)throw new Error(`ObjectPool->release($item) Not valid $item: ${JSON.stringify(t)}`);t!==o&&(this.items[this.activeCount]=this.items[i],this.items[i]=o)});r(this,"releaseAll",()=>{this.forActive(this.release)});r(this,"forActive",t=>{for(let i=this.activeCount-1;i>=0;i--)t.call(this,this.items[i])});this.itemProvider=i.itemProvider,this.itemActivator=i.itemActivator,this.itemDeactivator=i.itemDeactivator,this.itemActiveCheck=i.itemActiveCheck,this.items=Array.from({length:t}).map(this.itemProvider)}}const Ti=function({label:e,id:t,children:i}){return e?g.jsxs("div",{className:"inputContainer",children:[g.jsx("label",{htmlFor:t,children:e}),i]}):g.jsx(g.Fragment,{children:i})};function N(){}function bt(e,t="?"){const i=e.split(".").pop(),o=ao(`Loading resource: ${e}`);let n;switch(i){case"jpg":n=new hi;break;case"svg":n=new ri;break;case"glb":case"gltf":n=new ai;break;default:return Promise.reject(new Error(`unknown resource type [${i}]`))}return new Promise((a,h)=>{const l=p=>{a(p),We(o)},d=p=>{console.error(`Failed to load resource: ${e}`),h(p)};n.load(e,l,s,d)});function s({loaded:a,total:h,lengthComputable:l}){const d=l?`${ae(h,"k")} kB`:t;o.setContent(`Loading resource: ${e} (${ae(a,"k")} / ${d})`)}}function ae(e,t){let i=e;const o=["k","M","G","T"].indexOf(t)+1;for(let n=0;n<o;n++)i/=1024;return i.toFixed(2)}function Fi({paths:e},t={}){const i=new Ee,o={bevelEnabled:!1,depth:1};for(let c=0;c<e.length;c++){const _=e[c],x=new Mt({color:_.color}),F=_.toShapes(!1);for(let v=0;v<F.length;v++){const P=F[v],O=new pi(P,o),Y=new _t(O,x);i.add(Y)}}const{x:n,y:s,z:a}=new li().setFromObject(i).getSize(new E),{x:h=0,y:l=0,z:d=0,scale:p=1}=t;return i.traverse(c=>{c.translateX(-n/2+h),c.translateY(-s/2+l),c.translateZ(-a/2+d)}),i.rotateY(Math.PI),i.rotateZ(Math.PI),i.scale.set(p,p,p),i}function Ii(e,t=1024){return[{x:2,y:1},{x:0,y:1},{x:1,y:0},{x:1,y:2},{x:1,y:1},{x:3,y:1}].map(o);function o({x:n,y:s}){const a=document.createElement("canvas");return a.width=t,a.height=t,a.getContext("2d").drawImage(e,-n*t,-s*t),a}}function Re(e,t=200,i=!1){let o;return(...n)=>{i&&!o&&e(...n),clearTimeout(o),o=window.setTimeout(()=>{i?o=void 0:e(...n)},t)}}function Ai(e,t=200){let i,o,n,s;return(...a)=>{s=o+t,n=performance.now(),!o||n>s?(e(...a),o=n):(window.clearTimeout(i),i=window.setTimeout(()=>{e(...a),o=n},t-(n-o)))}}const Ri=/Android|iPhone|iPad/i;function Bi(){return Ri.test(window.navigator.userAgent)}function Qt(e){const t=Math.floor(e%1e3),i=Math.floor(e/1e3%60),o=Math.floor(e/6e4%60);return`${re(o)}:${re(i)}.${t}`}function re(e){const t=e.toString();return t.length<2?`0${e}`:t}function Oi(e){return`#${e.toString(16).toUpperCase()}`}function ss(e){return parseInt(e.replace("#",""),16)}function Q(e){return Math.round((e+Number.EPSILON)*100)/100}function ji(e,t,i){return Math.max(t,Math.min(e,i))}function Di(e,...t){return Object.keys(e).reduce((i,o)=>(t.includes(o)||(i[o]=e[o]),i),{})}function Wi(e,...t){return t.reduce((i,o)=>(e.hasOwnProperty(o)&&(i[o]=e[o]),i),{})}Object.defineProperties(Object,{omit:{value:Di},pick:{value:Wi}});const kt=document.createElement("datalist");kt.id="colorValueList";document.documentElement.appendChild(kt);function Hi(e){const t=document.createElement("option");t.textContent=Oi(e),kt.appendChild(t)}class qt extends u.Component{constructor(i){super(i);r(this,"inputRef",u.createRef());r(this,"onInputFieldChange",({currentTarget:i})=>{this.props.onInput&&this.props.onInput(i.value),this.setState({value:i.value})});r(this,"onInputFieldKeyUp",({key:i})=>{(i==="Enter"||i==="Escape")&&this.inputElement.blur()});r(this,"onInputFieldBlur",()=>{this.state.value!==this.props.value.toLowerCase()&&this.props.onChange(this.state.value,this.props.id)});this.state={value:i.value.toLowerCase()}}render(){const{id:i,label:o}=this.props,{value:n}=this.state;return g.jsx(Ti,{label:o,id:i,children:g.jsx("input",{type:"color",list:kt.id,value:n,id:i,name:i,onChange:this.onInputFieldChange,onBlur:this.onInputFieldBlur,onKeyUp:this.onInputFieldKeyUp,ref:this.inputRef})})}componentDidUpdate(i){this.props.value!==i.value&&this.setState({value:this.props.value})}get inputElement(){return this.inputRef.current}}r(qt,"defaultProps",{id:"",label:"",value:"",onChange:N}),r(qt,"addColorValues",(...i)=>{i.forEach(Hi)});const Ni=new Set(["Space","PageUp","PageDown","End","Home","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Escape","Tab"]),$i=new Set(["KeyF","KeyH","KeyJ","KeyO","KeyP","KeyS"]),G=new Set;let nt;const Tt=new Set,Ft=new st,R={addKeyPressListener:qi,removeKeyPressListener:Ui,addKeyDownChangeListener:Ki,removeKeyDownChangeListener:Vi,clearKeysDown:Gi};function Ki(e){Tt.add(e)}function Vi(e){Tt.delete(e)}function qi(e,t){Ft.add(e,t)}function Ui(e,t){Ft.remove(e,t)}function Gi(){G.clear(),Tt.forEach(Oe)}window.onkeydown=window.onkeyup=e=>{e.target.tagName==="INPUT"||e.target.tabIndex>-1||((Ni.has(e.code)||e.ctrlKey&&$i.has(e.code))&&e.preventDefault(),!(e.type==="keydown"&&e.repeat)&&(nt=e.code,e.type==="keyup"?(G.delete(nt),Ft.dispatch(nt,e)):G.add(nt),Ut()))};window.onbeforeunload=e=>{if(G.has("ControlLeft"))return e.preventDefault(),G.clear(),""};Pt("topLeftPanel","Tab","⋮");Bi()&&(Ct("bottomLeftPanel","ArrowUp","▲"),Ct("bottomLeftPanel","ArrowDown","▼"),Ct("bottomRightPanel","ArrowLeft","◄"),Ct("bottomRightPanel","ArrowRight","►"),Pt("topRightPanel","KeyP","p"),Pt("topRightPanel","KeyC","c"),Pt("topRightPanel","KeyR","⟲"));function Be(e,t,i){const o=document.createElement("button");o.addEventListener("mousedown",t),o.addEventListener("touchstart",t),o.addEventListener("mouseup",i),o.addEventListener("mouseleave",i),o.addEventListener("touchcancel",i),o.addEventListener("touchend",i);const n=document.getElementById(e);return n.classList.remove("hidden"),n.appendChild(o)}function Pt(e,t,i){const o=Re(s=>{nt=t,Ft.dispatch(nt,s)},200,!0),n=Be(e,o,N);n.textContent=i,n.id=t,n.classList.add("screenButton")}function Ct(e,t,i){const s=Be(e,()=>{G.add(t),Ut()},()=>{G.delete(t),Ut()});s.textContent=i,s.id=t,s.classList.add("screenKey")}function Ut(){Tt.forEach(Oe)}function Oe(e){e(G)}const Zi=`
    input:not([disabled]),
    textarea:not([disabled]),
    button:not([disabled]),
    select,
    [tabindex]
`,Yi="⨯",I=document.createElement("aside");I.classList.add("hidden");I.id="modal__root";I.tabIndex=-1;document.body.appendChild(I);const Xi=function({onClose:e,children:t}){return g.jsxs("div",{className:"modal__container",children:[e&&g.jsx("span",{className:"modal__closeButton",onClick:e,children:Yi}),t]})},je=function({onClose:e,children:t}){const i=document.activeElement;return u.useEffect(()=>(R.clearKeysDown(),I.classList.remove("hidden"),I.addEventListener("keydown",o),I.addEventListener("keyup",n),I.focus(),()=>{I.removeEventListener("keydown",o),I.removeEventListener("keyup",n),I.classList.add("hidden"),i.focus()}),[]),ut.createPortal(g.jsx(Xi,{onClose:e,children:t}),I);function o(a){a.stopPropagation(),a.key==="Tab"&&a.preventDefault()}function n(a){a.stopPropagation(),a.preventDefault(),e&&a.key==="Escape"?e():a.key==="Tab"&&s(a.shiftKey?-1:1)}function s(a){const h=Ji(I);if(!h.length)return;const l=document.activeElement,d=h.indexOf(l),p=h.length-1;let c=d+a;c<0?c=p:c>p&&(c=0),h[c].focus()}};function Ji(e){return[...e.querySelectorAll(Zi)].filter(Qi)}function Qi(e){return e.tabIndex!==-1&&window.getComputedStyle(e).visibility!=="hidden"}const to={okButtonLabel:"Ok",cancelButtonLabel:"Cancel",importButtonLabel:"Import",exportButtonLabel:"Export",mapElementListLabel:"Map elements:",translatePanelLabel:"Translate",positionLabel:"position",rotationLabel:"rotation",transformPanelLabel:"Transform",widthLabel:"width:",heightLabel:"height:",lengthLabel:"length:",radiusTopLabel:"radiusTop:",radiusBottomLabel:"radiusBottom:",sidesLabel:"sides:",segmentWidthLabel:"segmentWidth:",segmentHeightLabel:"segmentHeight:",segmentLengthLabel:"segmentLength:",segmentCountLabel:"segmentCount:",offsetLabel:"offset:",radiusLabel:"radius:",angleLabel:"angle:",cloneButtonLabel:"clone",removeButtonLabel:"remove",createButtonLabel:"create",fullscreenSwitchLabel:"Fullscreen:",renderWireFrameSwitchLabel:"Render wireFrame:",resolutionScaleSliderLabel:"Resolution scale:",antialiasCheckboxLabel:"Antialias:",renderShadowsCheckboxLabel:"Render shadows:",applySettingsButtonLabel:"Apply settings"},he=new Proxy(to,{get(e,t){return e[t]}});var W=(e=>(e.open="open",e.confirm="confirm",e.didMount="didMount",e.willUnmount="willUnmount",e))(W||{});const A=new st,It=document.createElement("aside");It.id="menuModalControllerRoot";It.classList.add("hidden");document.body.appendChild(It);function eo(){ut.render(g.jsx(u.StrictMode,{children:g.jsx(io,{})}),It)}function io(){const[e,t]=u.useState(!0),i=u.useRef("");return u.useEffect(()=>(A.add("open",n),A.dispatch("didMount"),()=>{A.dispatch("willUnmount"),A.remove("open",n)}),[]),e?null:g.jsx(oo,{message:i.current,closeModal:o});function o(){t(!0)}function n(s=""){i.current=s,t(!1)}}function oo({message:e,closeModal:t}){const i=u.useRef();return u.useEffect(()=>{i.current.focus()},[]),g.jsxs(je,{children:[g.jsx("span",{className:"modal__body dialog__message",children:e}),g.jsxs("div",{className:"modal__footer dialog__buttonBar",children:[g.jsx("button",{className:"dialog__button",onClick:o,"data-confirm":"false",children:he.cancelButtonLabel}),g.jsx("button",{className:"dialog__button",onClick:o,"data-confirm":"true",ref:i,children:he.okButtonLabel})]})]});function o(n){const s=JSON.parse(n.currentTarget.dataset.confirm);A.dispatch("confirm",s),t()}}class no{constructor(){r(this,"notificationElement",document.createElement("div"));r(this,"notificationElementBody",document.createElement("span"));this.notificationElement.classList.add("notificationElement","hidden"),this.notificationElement.appendChild(this.notificationElementBody)}get hidden(){return this.notificationElement.classList.contains("hidden")}show(){this.notificationElement.classList.remove("hidden")}fadeOut(){this.notificationElement.classList.add("fade-out")}hide(){this.notificationElement.classList.remove("fade-out"),this.notificationElement.classList.add("hidden")}setContent(t){this.notificationElementBody.textContent=t}}const so=1500,De=1e3,te=document.createElement("div");te.id="notificationElementContainer";document.body.appendChild(te);document.documentElement.style.setProperty("--fade-out-duration",`${De/1e3}s`);const ee=new Ae(1,{itemProvider(){return new no},itemActiveCheck(e){return!e.hidden},itemActivator(e){e.show(),te.appendChild(e.notificationElement)},itemDeactivator(e){e.hide()}});function ao(e){const t=ee.obtain();return t.setContent(e),t}function We(e){e.fadeOut(),window.setTimeout(()=>{ee.release(e)},De)}function mt(e){const t=ee.obtain();t.setContent(e),window.setTimeout(()=>{We(t)},so)}let ie=!1;A.add(W.didMount,()=>{ie=!0});A.add(W.willUnmount,()=>{ie=!1});eo();function ro(e){if(ie)A.dispatch(W.open,e);else{const t=()=>{A.remove(W.didMount,t),A.dispatch(W.open,e)};A.add(W.didMount,t)}return new Promise(t=>{A.add(W.confirm,i);function i(o){A.remove(W.confirm,i),t(o)}})}var He=(e=>(e.cinematic="cinematic",e.free="free",e.chase="chase",e.hood="hood",e))(He||{});const Wt=["cinematic","free","chase","hood"],ho=new E(0,1,0),pe=.2,po=new E(...f.camera.mountOffset_v3),lo=new E(...f.camera.mountOffsetReverse_v3),co=new E(...f.camera.lookOffset_v3);class go{constructor(t){r(this,"domElement");r(this,"camera");r(this,"orbitControls");r(this,"cameraTarget");r(this,"cameraPosition",new E);r(this,"currentCameraMode");r(this,"idealChaseCameraLookPosition",new E);r(this,"idealChaseCameraMountPosition",new E);r(this,"actualChaseCameraLookPosition",new E);r(this,"update",N);this.domElement=t,this.camera=new ci(f.camera.fov,window.aspectRatio,f.camera.near,f.camera.far),this.camera.position.set(f.camera.initialPosition.x,f.camera.initialPosition.y,f.camera.initialPosition.z),this.cameraPosition.copy(this.camera.position),this.orbitControls=new di(this.camera,t),this.orbitControls.minDistance=1,this.orbitControls.enabled=!1}set cameraMode(t){if(this.currentCameraMode!==t){switch(this.currentCameraMode){case"cinematic":case"chase":this.update=N;break;case"hood":this.cameraTarget.chassisMesh.remove(this.camera),this.camera.position.copy(this.cameraTargetPosition),this.camera.position.y+=5,this.camera.fov=f.camera.fov,this.camera.updateProjectionMatrix();break;case"free":this.orbitControls.enabled=!1;break}switch(t){case"cinematic":this.update=this.updateDynamicCamera,mt('Camera mode is set to: "cinematic"');break;case"chase":this.update=this.updateChaseCamera,mt('Camera mode is set to: "chase"');break;case"hood":this.cameraTarget.chassisMesh.add(this.camera),this.camera.position.set(0,1.1,-.47),this.camera.rotation.set(0,0,0),this.camera.fov=60,this.camera.updateProjectionMatrix(),this.update=N,mt('Camera mode is set to: "hood"');break;case"free":this.orbitControls.enabled=!0,this.orbitControls.target.copy(this.cameraTargetPosition),mt('Camera mode is set to: "free" (use mouse to look around)');break}this.currentCameraMode=t}}get cameraTargetPosition(){return this.cameraTarget.chassisMesh.position}rotate(t){this.camera.rotateOnAxis(ho,t)}setIdealChaseCameraMountPosition(t){t?this.idealChaseCameraMountPosition.copy(lo):this.idealChaseCameraMountPosition.copy(po),this.idealChaseCameraMountPosition.applyQuaternion(this.cameraTarget.chassisMesh.quaternion),this.idealChaseCameraMountPosition.add(this.cameraTargetPosition),this.idealChaseCameraMountPosition.y<this.cameraTargetPosition.y&&this.idealChaseCameraMountPosition.setY(this.cameraTargetPosition.y)}setIdealChaseCameraLookPosition(t){this.idealChaseCameraLookPosition.copy(co),t&&(this.idealChaseCameraLookPosition.z*=-1),this.idealChaseCameraLookPosition.applyQuaternion(this.cameraTarget.chassisMesh.quaternion),this.idealChaseCameraLookPosition.add(this.cameraTargetPosition)}updateDynamicCamera(t){if(this.camera.position.manhattanDistanceTo(this.cameraPosition)>Number.EPSILON){const i=1-pe**t;this.camera.position.lerp(this.cameraPosition,i)}this.camera.lookAt(this.cameraTargetPosition)}updateChaseCamera(t){const{currentVehicleSpeedKmHour:i}=this.cameraTarget.base,o=Math.round(-i)<-1,n=1-pe**t;this.setIdealChaseCameraMountPosition(o),this.setIdealChaseCameraLookPosition(o),this.camera.position.lerp(this.idealChaseCameraMountPosition,n),this.actualChaseCameraLookPosition.lerp(this.idealChaseCameraLookPosition,n),this.camera.lookAt(this.actualChaseCameraLookPosition)}switchMode(){const t=Wt.indexOf(this.currentCameraMode),i=t<Wt.length-1?t+1:0,o=Wt[i];this.cameraMode=o}setCameraTarget(t){t!==this.cameraTarget&&(this.cameraTarget=t)}}const mo="modulepreload",_o=function(e,t){return new URL(e,t).href},le={},Ne=function(t,i,o){if(!i||i.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(i.map(s=>{if(s=_o(s,o),s in le)return;le[s]=!0;const a=s.endsWith(".css"),h=a?'[rel="stylesheet"]':"";if(!!o)for(let p=n.length-1;p>=0;p--){const c=n[p];if(c.href===s&&(!a||c.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${h}`))return;const d=document.createElement("link");if(d.rel=a?"stylesheet":mo,a||(d.as="script",d.crossOrigin=""),d.href=s,document.head.appendChild(d),a)return new Promise((p,c)=>{d.addEventListener("load",p),d.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t())};function $e(){return g.jsx("div",{children:"Loading..."})}const at=document.createElement("aside");at.id="editorPanel";at.classList.add("floatingPanel","hidden");document.body.appendChild(at);const uo={mapBuilder:void 0,mapElementProps:void 0,editorPanelVisible:!1},Ke=u.createContext(uo);function yo(e){ut.render(g.jsx(xo,{mapBuilder:e}),at)}function xo({mapBuilder:e}){const[t,i]=u.useState(e.editMode),[o,n]=u.useState(e.selectedMapElementId),[s,a]=u.useState();u.useEffect(()=>(e.listeners.add(V.mapElementSelect,n),e.listeners.add(V.mapElementChange,a),e.listeners.add(V.editModeChange,i),()=>{e.listeners.remove(V.mapElementSelect,n),e.listeners.remove(V.mapElementChange,a),e.listeners.remove(V.editModeChange,i)}),[]),u.useEffect(()=>{a({...e.getPropsFromStore(o)})},[o]),u.useEffect(()=>{t?at.classList.remove("hidden"):at.classList.add("hidden")},[t]);const h={mapBuilder:e,mapElementProps:s,editorPanelVisible:t};return g.jsx(Ke.Provider,{value:h,children:g.jsx(fo,{})})}function fo(){const{editorPanelVisible:e}=u.useContext(Ke),t=u.lazy(()=>Ne(()=>import("./modules/EditorPanel-ca1d8cf8.js"),["./modules\\EditorPanel-ca1d8cf8.js","./vendor\\react-6a63c5cb.js","./vendor\\vendor-5e83183c.js","./modules\\Switch-bf490e0b.js","./vendor\\cannon-fb08787c.js","./vendor\\three-c64a4383.js"],import.meta.url));return u.useMemo(()=>e?g.jsx(u.Suspense,{fallback:g.jsx($e,{}),children:g.jsx(t,{})}):null,[e])}const pt=new w;function wo(e,t){const i=new w,o=new w,n=new w,s=new w,{movement:{x:a=0,y:h=0,z:l=0},speed:d=1,triggerStart:p=!0,alternate:c=!0,alternateDelay:_=0}=JSON.parse(t),x=d*.05;return n.copy(e.position),s.set(a,h,l),s.vadd(e.position,s),s.vsub(n,pt),pt.normalize(),pt.scale(d,i),i.negate(o),{triggerStart:p,movementHandler:F,velocity_x:i.x,velocity_y:i.y,velocity_z:i.z};function F(){e.position.almostEquals(s,x)&&O(s)?(c?_?(e.velocity.setZero(),window.setTimeout(v,_*1e3)):v():e.velocity.setZero(),e.position.copy(s)):e.position.almostEquals(n,x)&&O(n)&&(_?(e.velocity.setZero(),window.setTimeout(P,_*1e3)):P(),e.position.copy(n))}function v(){e.velocity.copy(o)}function P(){e.velocity.copy(i)}function O(Y){return Y.vsub(e.position,pt),pt.dot(e.velocity)>0}}function vt(e){const{width:t,height:i,length:o,radius:n,radiusTop:s,radiusBottom:a,sides:h,offset:l}=e;let d,p;switch(e.shape){case T.box:d=Co(t,i,o),p=bo(t,i,o);break;case T.cylinder:d=zo(s,a,i,h),p=vo(s,a,i,h);break;case T.sphere:d=Mo(n),p=So(n);break;case T.tetrahedron:d=Po(t,i,o),p=ce(d);break;case T.triangularPrism:d=Eo(t,i,o,l),p=ce(d);break;default:return[]}return[d,p]}function bo(e=2,t=2,i=2){return new Le(e,t,i)}function Co(e=2,t=2,i=2){return new Vt(new w(e/2,t/2,i/2))}function vo(e=1,t=1,i=2,o=6){return new gi(e,t,i,Math.max(3,o))}function zo(e=1,t=1,i=2,o=6){return new Se(e,t,i,Math.max(3,o))}function So(e=1){return new mi(e)}function Mo(e=1){return new ei(e)}function ce(e){return new _i(e.vertices.map(({x:t,y:i,z:o})=>new E(t,i,o)))}function Po(e=1,t=1,i=1){const o=[new w(0,0,0),new w(e*2,0,0),new w(0,t*2,0),new w(0,0,i*2)],n=[[0,2,1],[1,2,3],[0,1,3],[3,2,0]];return new Me({vertices:o,faces:n})}function Eo(e=2,t=2,i=2,o=0){const n=e/2,s=t/2,a=i/2,h=[new w(n,s,o),new w(n,-s,-a),new w(n,-s,a),new w(-n,s,o),new w(-n,-s,-a),new w(-n,-s,a)],l=[[2,1,0],[4,5,3],[4,1,2,5],[3,0,1,4],[5,2,0,3]],d=ko(h,l);return new Me({vertices:h,faces:l,normals:d})}const de=new w,Lo=new w,tt=new w;new E;new E(0,0,1);function ko(e,t){return To(e),t.map(i=>{const o=e[i[0]],n=de.copy(e[i[1]]),s=Lo.copy(e[i[2]]);n.vsub(o,n),s.vsub(o,s);const a=new w().copy(n);a.cross(s,a).normalize();const h=de.copy(o);return o.vsub(tt,h),a.dot(h)<0&&a.negate(),a})}function To(e){const{length:t}=e;tt.set(0,0,0);for(let i=0;i<t;i++)tt.vadd(e[i],tt);tt.scale(1/t,tt)}const{degToRad:Fo,radToDeg:H}=Lt,Io={segmentCount:13,segmentWidth:4,segmentHeight:.1,segmentLength:4,segmentPositionOffset:.4,radius:8},Ao={segmentCount:2,segmentWidth:2,segmentHeight:.4,segmentLength:4,angle:30},Ro={segmentCount:10,segmentWidth:4,segmentHeight:.1,segmentLength:2,angle:30,radius:8},Bo=["loop","slopeTransition","cantedCurve"],Ve=new E,U=new E,Oo=new E,ge=new E,y=new ui;function me(e){switch(e.shape){case T.loop:return jo(e);case T.slopeTransition:return Wo(e);case T.cantedCurve:return Do(e);default:return[]}}function jo(e){const{segmentCount:t,segmentWidth:i,segmentHeight:o,segmentLength:n,segmentPositionOffset:s,radius:a}=oe(e,Io),h=[],l=Math.atan(a/(n/2)),d=Math.PI-2*l,p=Ve.set(1,0,0);for(let c=0;c<t;c++)U.set(s*c,-a,0).applyAxisAngle(p,d*c),h.push({shape:T.box,width:i,height:o,length:n,position_x:U.x,position_y:U.y,position_z:U.z,rotation_x:H(d*c)});return h}function Do(e){const{segmentCount:t,segmentWidth:i,segmentHeight:o,segmentLength:n,angle:s,radius:a}=oe(e,Ro),h=[],l=Ve;l.set(0,1,0);const d=Fo(s),p=i/2,c=p*Math.cos(d),_=Math.sqrt(p**2-c**2),x=n/2,F=Math.atan((a-c)/x),v=Math.PI-2*F,P=Math.sqrt(n**2+i**2),O=Oo.set(x,_,-a+-c),yt=ge.copy(O).applyAxisAngle(l,v).sub(O).length(),z=(i+P+yt)/2,b=2*Math.sqrt(z*(z-i)*(z-P)*(z-yt))/i,X=i/2-(i-Math.sqrt(P**2-b**2)),j=X*Math.cos(d),Ot=Math.sqrt(X**2-j**2),xt=ge.set(x+b,Ot,-a+-j);xt.applyAxisAngle(l,v);const ft=xt.sub(O).length(),wt=Math.acos((b**2+b**2-ft**2)/(2*b*b)),jt=b/2*Math.sin(wt);for(let m=0;m<t+1;m++)l.set(0,1,0),U.set(0,0,-a).applyAxisAngle(l,v*m),y.position.copy(U),y.rotation.set(0,v*m,Math.PI/2),y.rotateOnAxis(l,-d),y.translateZ(o/2),m<t&&h.push({shape:T.triangularPrism,width:o,height:n,length:i,offset:i/2,position_x:y.position.x,position_y:y.position.y,position_z:y.position.z,rotation_x:H(y.rotation.x),rotation_y:H(y.rotation.y),rotation_z:H(y.rotation.z)}),m&&(l.set(1,0,0),y.rotateOnAxis(l,Math.PI),y.translateY(n/2+b/2),l.set(0,0,1),y.rotateOnAxis(l,-wt),y.translateX(jt),y.translateY(0),h.push({shape:T.triangularPrism,width:o,height:b,length:i,offset:X,position_x:y.position.x,position_y:y.position.y,position_z:y.position.z,rotation_x:H(y.rotation.x),rotation_y:H(y.rotation.y),rotation_z:H(y.rotation.z)}));return h}function Wo(e){const{segmentCount:t,segmentWidth:i,segmentHeight:o,segmentLength:n}=oe(e,Ao),s=[],a=.1,h=Math.atan(o/i);y.position.set(0,a,0),y.rotation.set(0,0,0);for(let l=0;l<t;l++)l&&(y.translateY(o),y.translateZ(-n)),y.rotation.set(0,0,-h*l),s.push({shape:T.tetrahedron,width:i/2,height:o/2,length:n/2,position_x:y.position.x,position_y:y.position.y,position_z:y.position.z,rotation_z:H(y.rotation.z)}),U.copy(y.position),y.translateX(i/2),y.translateY(-a/2),y.translateZ(n/2),s.push({shape:T.box,width:i,height:a,length:n,position_x:y.position.x,position_y:y.position.y,position_z:y.position.z,rotation_z:H(y.rotation.z)}),y.position.copy(U);return s}function oe(e,t){return{...t,...e}}const{degToRad:k}=Lt;var V=(e=>(e.mapElementChange="mapElementChange",e.mapElementSelect="mapElementSelect",e.editModeChange="editModeChange",e))(V||{}),Z=(e=>(e.checkpoint="checkpoint",e.finish="finish",e.reset="reset",e.setCameraMode="setCameraMode",e.setCameraPosition="setCameraPosition",e.startAnimation="startAnimation",e))(Z||{}),Ho=(e=>(e.default="default",e.compound="compound",e.animated="animated",e.trigger="trigger",e.vehicle="vehicle",e))(Ho||{}),T=(e=>(e.box="box",e.cylinder="cylinder",e.sphere="sphere",e.tetrahedron="tetrahedron",e.triangularPrism="triangularPrism",e.loop="loop",e.slopeTransition="slopeTransition",e.cantedCurve="cantedCurve",e))(T||{});const et="vehicle_0",ne=12303291,qe=9814245,Ue=10463419,Ge=13464275,zt=new yi;let _e,ue,ye=0;qt.addColorValues(ne,qe,Ue);class No{constructor(t,i){r(this,"scene");r(this,"world");r(this,"selectedMapElementId");r(this,"perviousSelectedMapElementId");r(this,"mapElementComponentStore",new Map);r(this,"mapElementIdStore",new Set);r(this,"listeners",new st);r(this,"eventTriggerListeners",new st);r(this,"editMode",!1);r(this,"onPlaceVehicle",N);r(this,"destroy",t=>{if(t===et)return;const i=this.getBodyFromStore(t),o=this.getMeshFromStore(t),{type:n}=this.getPropsFromStore(t);if(this.scene.remove(o),this.world.removeBody(i),this.world.removeEventListener("postStep",this.getUpdateMethodFromStore(t)),Gt(o)?o.children.forEach(xe):xe(o),n==="trigger"){const s=this.mapElementComponentStore.get(`${t}_listener`);i.removeEventListener(q.COLLIDE_EVENT_NAME,s),this.mapElementComponentStore.delete(`${t}_listener`)}if(n==="animated"){const s=this.getAnimationPropsFromStore(t);this.world.removeEventListener("preStep",s.movementHandler),this.mapElementComponentStore.delete(`${t}_animationProps`)}this.mapElementIdStore.delete(t),this.mapElementComponentStore.delete(`${t}_mesh`),this.mapElementComponentStore.delete(`${t}_body`),this.mapElementComponentStore.delete(`${t}_updateMethod`),this.mapElementComponentStore.delete(`${t}_props`),this.selectedMapElementId===t&&(this.selectedMapElementId=void 0,this.listeners.dispatch("mapElementSelect",void 0)),this.perviousSelectedMapElementId===t&&(this.perviousSelectedMapElementId=void 0)});r(this,"selectMapElement",t=>{this.selectedMapElementId&&(this.perviousSelectedMapElementId=this.selectedMapElementId),this.selectedMapElementId=t,this.listeners.dispatch("mapElementSelect",this.selectedMapElementId)});r(this,"resetElementIfDynamic",t=>{const{type:i,mass:o,position_x:n=0,position_y:s=0,position_z:a=0,rotation_x:h=0,rotation_y:l=0,rotation_z:d=0}=this.getPropsFromStore(t);if(i==="vehicle"){this.onPlaceVehicle(n,s,a,h,l,d);return}if(!o&&i!=="animated")return;const p=this.getBodyFromStore(t);if(i==="animated"){const{triggerStart:c,velocity_x:_,velocity_y:x,velocity_z:F}=this.getAnimationPropsFromStore(t);c?p.velocity.setZero():p.velocity.set(_,x,F)}else p.velocity.setZero(),p.angularVelocity.setZero();p.position.set(n,s,a),p.quaternion.setFromEuler(k(h),k(l),k(d))});r(this,"importMap",t=>{this.mapElementIdStore.forEach(this.destroy),ye=0,t.forEach(i=>{i.type==="vehicle"?this.placeVehicle({...i}):this.build({...i})})});r(this,"exportMap",()=>Array.from(this.mapElementComponentStore.entries()).filter(([t])=>t.endsWith("props")).map(([,t])=>t));this.scene=t,this.world=i;const n=Object.values(i.contactMaterialTable.data).filter(Ko).reduce((s,a)=>{const[h,l]=a.materials;return s.set(h.name,h),s.set(l.name,l),s},new Map);ue=n.get("general"),_e=n.get("lowFriction"),yo(this)}get mapElementIdList(){return Array.from(this.mapElementIdStore)}getBodyFromStore(t){return this.mapElementComponentStore.get(`${t}_body`)}getMeshFromStore(t){return this.mapElementComponentStore.get(`${t}_mesh`)}getPropsFromStore(t){return this.mapElementComponentStore.get(`${t}_props`)}getUpdateMethodFromStore(t){return this.mapElementComponentStore.get(`${t}_updateMethod`)}getAnimationPropsFromStore(t){return this.mapElementComponentStore.get(`${t}_animationProps`)}addToWorld(t,i,o){const n=`${o.type||o.shape}_${ye++}`,{type:s,mass:a=0,position_x:h=0,position_y:l=0,position_z:d=0,rotation_x:p=0,rotation_y:c=0,rotation_z:_=0,fixedRotation:x=!1}=o,F=()=>{i.position.copy(t.position),i.quaternion.copy(t.quaternion)};if(t.position.set(h,l,d),i.position.copy(t.position),i.name=n,(p||c||_)&&(t.quaternion.setFromEuler(k(p),k(c),k(_)),i.quaternion.copy(t.quaternion)),x&&(t.fixedRotation=!0,t.updateMassProperties()),this.world.addBody(t),this.scene.add(i),s==="animated"){const v=wo(t,o.dataSet);t.type=ht.KINEMATIC,v.triggerStart||t.velocity.set(v.velocity_x,v.velocity_y,v.velocity_z),this.mapElementComponentStore.set(`${n}_animationProps`,v),this.world.addEventListener("preStep",v.movementHandler)}return(a||s==="animated")&&this.world.addEventListener("postStep",F),t.aabbNeedsUpdate=!0,this.mapElementIdStore.add(n),this.mapElementComponentStore.set(`${n}_mesh`,i),this.mapElementComponentStore.set(`${n}_body`,t),this.mapElementComponentStore.set(`${n}_props`,o),this.mapElementComponentStore.set(`${n}_updateMethod`,F),this.editMode&&this.selectMapElement(n),n}toggleEditMode(){this.editMode=!this.editMode,this.editMode?this.mapElementIdList.forEach(t=>{this.setEventTriggerVisibility(t,!0)}):this.mapElementIdList.forEach(t=>{this.setEventTriggerVisibility(t,!1)}),this.listeners.dispatch("editModeChange",this.editMode)}clone(t){return this.build({...this.getPropsFromStore(t)})}build(t){const i=new ke({color:$o(t)}),o=t.lowFriction?_e:ue,n=new q({mass:t.mass,material:o});let s;if(Bo.includes(t.shape)&&!t.type&&(t.type="compound"),t.type==="compound")s=new Ee,me(t).forEach(h=>{const[l,d]=vt(h),p=new _t(d,i);f.renderShadows&&(p.castShadow=!0,p.receiveShadow=!0),zt.set(k(h.rotation_x||0),k(h.rotation_y||0),k(h.rotation_z||0)),p.quaternion.setFromEuler(zt),p.position.set(h.position_x,h.position_y,h.position_z),s.add(p),n.addShape(l,p.position,p.quaternion)});else{const[h,l]=vt(t);n.addShape(h),s=new _t(l,i),f.renderShadows&&(s.castShadow=!0,s.receiveShadow=!0)}const a=this.addToWorld(n,s,t);return t.type==="trigger"&&this.setUpEventTrigger(a,t),a}setUpEventTrigger(t,i){const{event:o="setCameraPosition",dataSet:n="0,0,0"}=i,s=this.getBodyFromStore(t),a=this.getMeshFromStore(t),h=this.mapElementComponentStore.get(`${t}_listener`),l=({target:d,body:p})=>{this.eventTriggerListeners.dispatch(o,{target:d,dataSet:n,relatedTarget:p})};h&&s.removeEventListener(q.COLLIDE_EVENT_NAME,h),this.mapElementComponentStore.set(`${t}_listener`,l),s.collisionResponse=!1,s.addEventListener(q.COLLIDE_EVENT_NAME,l),Ht(a,Ge,.3),this.editMode||(a.visible=!1)}convertEventTriggerToDefaultElement(t){const i=this.getBodyFromStore(t),o=this.getMeshFromStore(t),n=this.mapElementComponentStore.get(`${t}_listener`);i.removeEventListener(q.COLLIDE_EVENT_NAME,n),this.mapElementComponentStore.delete(`${t}_listener`),i.collisionResponse=!0,Ht(o,ne,1)}placeVehicle(t){const{position_x:i,position_y:o,position_z:n,rotation_x:s,rotation_y:a,rotation_z:h}=t;this.mapElementIdStore.add(et),this.mapElementComponentStore.set(`${et}_props`,{...t}),this.mapElementComponentStore.set(`${et}_updateMethod`,()=>{const{position_x:l,position_y:d,position_z:p,rotation_x:c,rotation_y:_,rotation_z:x}=this.getPropsFromStore(et);this.onPlaceVehicle(l,d,p,c,_,x)}),this.onPlaceVehicle(i,o,n,s,a,h)}setEventTriggerVisibility(t,i=!1){if(t.startsWith("trigger")){const o=this.getMeshFromStore(t);o.visible=i}}resetDynamicMapElements(){this.mapElementIdList.forEach(this.resetElementIfDynamic)}translate(t,i){const o=this.getBodyFromStore(t),n=this.getPropsFromStore(t),s=this.getUpdateMethodFromStore(t);if(Object.assign(n,{...i}),o){const{position_x:a=0,position_y:h=0,position_z:l=0,rotation_x:d=0,rotation_y:p=0,rotation_z:c=0}=n;o.position.set(a,h,l),o.quaternion.setFromEuler(k(d),k(p),k(c)),o.aabbNeedsUpdate=!0}s(),this.listeners.dispatch("mapElementChange",{...n})}transform(t,i){const o=this.getMeshFromStore(t),n=this.getBodyFromStore(t),s=this.getPropsFromStore(t);if(Object.assign(s,{...i}),n.shapes.length=0,n.shapeOffsets.length=0,n.shapeOrientations.length=0,Gt(o)){const a=me(s),h=a.length,l=Math.max(0,o.children.length-h);for(let d=0;d<l;d++){const p=o.children.length-1,c=o.children[p];c.geometry.dispose(),o.remove(c)}for(let d=0;d<h;d++){const p=a[d],[c,_]=vt(p);let x=o.children[d];x?x.geometry.dispose():(x=new _t,x.material=o.children[0].material,o.add(x)),zt.set(k(p.rotation_x||0),k(p.rotation_y||0),k(p.rotation_z||0)),x.quaternion.setFromEuler(zt),x.position.set(p.position_x,p.position_y,p.position_z),x.geometry=_,n.addShape(c,x.position,x.quaternion)}}else{const[a,h]=vt(s);n.addShape(a),o.geometry.dispose(),o.geometry=h}this.listeners.dispatch("mapElementChange",{...s})}setAttribute(t,i){const o=this.getPropsFromStore(t),n=this.getBodyFromStore(t),s=o.type;if(Object.assign(o,{...i}),"color"in i&&Ht(this.getMeshFromStore(t),i.color),s==="trigger"&&i.type==="default"?this.convertEventTriggerToDefaultElement(t):("type"in i||"event"in i||"dataSet"in i)&&(this.setUpEventTrigger(t,o),o.mass&&(i.mass=0)),"mass"in i){const a=this.getUpdateMethodFromStore(t);n.mass=i.mass,n.updateMassProperties(),n.velocity.set(0,0,0),n.angularVelocity.set(0,0,0),i.mass>0&&n.type===ht.STATIC?(n.type=ht.DYNAMIC,this.world.addEventListener("postStep",a)):!i.mass&&n.type===ht.DYNAMIC&&(n.type=ht.STATIC,this.world.removeEventListener("postStep",a))}this.listeners.dispatch("mapElementChange",{...o})}}function xe(e){e.geometry.dispose(),e.material.dispose()}function Ht(e,t,i){const o=Gt(e)?e.children[0].material:e.material;t&&o.color.set(t),i&&(o.transparent=i<1,o.opacity=i)}function $o(e){return e.type==="trigger"?Ge:e.type==="animated"?Ue:e.color?e.color:e.mass?qe:ne}function Gt(e){return!!e.children.length}function Ko(e){return e instanceof Jt}const Vo=/checkpointCount:\w*(\d+)/i,qo=Math.PI*2,Uo=.02;let Ze=0,Ye=0;class Go{constructor(t,i){r(this,"activeCheckpoints",new Set);r(this,"checkpointIconToElementLinks",new Map);r(this,"checkpointIcon3dPool");r(this,"finishIcon3d");r(this,"gameProgress");r(this,"scene");r(this,"checkpointEventHandler",({target:t,relatedTarget:i})=>{if(i===this.gameProgress.vehicle.chassisBody&&this.activeCheckpoints.has(t)){this.gameProgress.checkpointReached(t);const o=this.checkpointIconToElementLinks.get(t);this.checkpointIcon3dPool.release(o),this.activeCheckpoints.delete(t)}});r(this,"finishEventHandler",({target:t,relatedTarget:i,dataSet:o})=>{i===this.gameProgress.vehicle.chassisBody&&Yo(o)===this.gameProgress.checkpointsReached&&(this.gameProgress.stop(),this.gameProgress.openModal())});this.scene=t,this.finishIcon3d=i.finish,this.checkpointIcon3dPool=new Ae(1,{itemProvider(){return i.checkpoint.clone()},itemActiveCheck(o){return o.visible},itemActivator(o){o.visible=!0},itemDeactivator(o){o.visible=!1}}),this.scene.add(this.finishIcon3d)}init(t,i){this.gameProgress=i,t.eventTriggerListeners.add(Z.checkpoint,this.checkpointEventHandler),t.eventTriggerListeners.add(Z.finish,this.finishEventHandler),this.checkpointIcon3dPool.activeCount&&this.checkpointIcon3dPool.releaseAll(),this.activeCheckpoints.size&&this.activeCheckpoints.clear(),t.mapElementIdList.forEach(o=>{if(o.startsWith("trigger")){const{event:n}=t.getPropsFromStore(o);n==="checkpoint"?this.setActiveCheckpoint(t.getBodyFromStore(o)):n==="finish"&&this.setFinish(t.getBodyFromStore(o))}})}setActiveCheckpoint(t){const i=this.checkpointIcon3dPool.obtain();i.position.copy(t.position),this.activeCheckpoints.add(t),this.checkpointIconToElementLinks.set(t,i),this.scene.add(i)}setFinish(t){this.finishIcon3d.position.copy(t.position)}updateVisuals(t){Ze=Math.sin(t/1e3)/500,Ye=.5*Math.sin(t/500)*.005,this.checkpointIcon3dPool.forActive(fe),fe(this.finishIcon3d)}}function Zo(){const e=new _t(new Le(.8,.8,.8),new gt({color:0,specular:6710886,emissive:43520,shininess:10,transparent:!0,opacity:.6}));return e.rotation.set(Math.PI/4,0,Math.PI/4),e}function fe(e){const t=e.rotation.y+Uo;e.rotation.y=t>=qo?0:t,e.position.y+=Ze,e.material&&e.material.emissive.offsetHSL(0,0,Ye)}function Yo(e){const[,t]=e.match(Vo)||[];return t?Number(t):0}class Xo{constructor(){r(this,"started",!1);r(this,"stopped",!1);r(this,"startTime",0);r(this,"stopTime",0);r(this,"relativeStopTime",0)}get time(){return this.stopped?this.relativeStopTime:performance.now()-this.startTime}start(){this.started=!0,this.stopped?this.startTime+=performance.now()-this.stopTime:this.startTime=performance.now(),this.stopped=!1}stop(){this.relativeStopTime=this.time,this.stopTime=performance.now(),this.stopped=!0}reset(){this.started=!1,this.stopped=!1,this.startTime=0}add(t){this.startTime-=t}}const Jo={meta:{author:""},elements:[{type:"vehicle",position_y:1},{shape:"box",width:5,length:5,height:.2,position_y:-.1},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_x:3,position_y:1}]},Qo={meta:{author:"",goals:{time:11e3,respawnCount:0},next:"o01"},elements:[{type:"vehicle",position_y:1},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"chase",radius:3,position_y:1},{shape:"box",width:10,length:10,height:.2,position_y:-.1},{type:"trigger",shape:"sphere",event:"finish",dataSet:"checkpointCount:1",radius:1,position_x:30,position_y:1},{shape:"box",width:10,length:20,height:.2,position_y:-.1,position_z:-15},{shape:"box",width:20,length:10,height:.2,position_y:-.1,position_x:15},{shape:"box",width:20,length:10,height:.2,position_y:-.1,position_z:-30},{shape:"box",width:10,length:20,height:.2,position_y:-.1,position_x:30},{shape:"box",width:4,length:10,height:.2,position_y:-.1,position_x:37},{shape:"box",width:10,length:4,height:.2,position_y:-.1,position_z:-37},{type:"trigger",shape:"sphere",event:"checkpoint",dataSet:"",radius:1,position_y:1,position_z:-30,rotation_y:180}]},tn={meta:{author:"",goals:{time:4e4,respawnCount:0},next:"o02"},elements:[{type:"vehicle",position_x:10,position_y:1,position_z:10,rotation_y:90},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"cinematic,25,11,25",radius:3,position_x:10,position_y:1,position_z:10},{shape:"box",width:30,height:.2,length:34,position_x:6,position_z:2},{shape:"triangularPrism",position_x:-3,position_y:1.1,position_z:-3,rotation_x:0,rotation_y:0,rotation_z:0,length:4,width:4,offset:-2},{shape:"triangularPrism",position_x:-3,position_y:4.1,position_z:-7,rotation_x:0,rotation_y:0,rotation_z:0,length:4,width:4,offset:-2,height:4},{shape:"box",width:4,height:.2,length:6,position_x:-3,position_y:10,position_z:-18},{shape:"box",width:4,height:.2,length:30,position_x:-3,position_y:5,position_z:-25,rotation_x:15},{shape:"box",width:4,height:5.4,length:2,position_x:-7,position_y:2.6,position_z:-9},{shape:"box",width:4,height:11.8,length:2,position_x:1,position_y:5.9,position_z:-9},{shape:"box",mass:40,position_x:11,position_y:3.1,position_z:-6,width:4,height:4,length:4},{shape:"cylinder",sides:4,radiusBottom:13,height:1,position_x:9,position_y:.6,position_z:-4,rotation_y:45,radiusTop:10},{shape:"cylinder",radiusTop:2,radiusBottom:2,height:4,mass:20,sides:20,position_x:-3,position_y:15,position_z:-27,rotation_z:90},{shape:"box",width:.2,height:1,length:10,position_x:-5.1,position_y:11.3,position_z:-33,lowFriction:!0},{shape:"box",width:.2,height:1,length:14,position_x:-.9,position_y:11.3,position_z:-31,lowFriction:!0},{shape:"box",width:.2,height:1,length:30,position_x:-.9,position_y:5.5,position_z:-25,rotation_x:15,lowFriction:!0},{shape:"box",width:.2,height:1,length:30,position_x:-5.1,position_y:5.5,position_z:-25,rotation_x:15,lowFriction:!0},{shape:"box",width:8.2,height:.2,length:4,position_x:-8.92,position_y:9.65,position_z:-26,rotation_z:14.8},{shape:"box",width:4,height:.2,length:2.4,position_x:-7,position_y:5.2,position_z:-11.2},{shape:"triangularPrism",position_x:-7,position_y:8.6,position_z:-9,rotation_x:-90,rotation_y:-90,rotation_z:0,length:4,width:6.6,offset:-2,height:2},{shape:"box",width:4,height:.2,length:4.4,position_x:-10.95,position_y:5.55,position_z:-10.2,rotation_z:-10},{shape:"box",width:4,height:.2,length:4,position_x:-14.9,position_y:5.9,position_z:-10},{shape:"box",width:4,height:.2,length:12.4,position_x:-14.9,position_y:7.25,position_z:-17.98,rotation_x:12.55},{shape:"box",width:4.1,height:.2,length:4,position_x:-14.85,position_y:8.6,position_z:-26},{shape:"box",width:4,height:.2,length:2.4,position_x:1,position_y:5.2,position_z:-11.2},{shape:"box",width:4,height:.2,length:3.3,position_x:-3,position_y:10.35,position_z:-22.33,rotation_x:12.5},{shape:"box",width:4,height:.2,length:5,position_x:-3,position_y:10.7,position_z:-26.4},{shape:"box",width:.2,height:2,length:14,position_x:-.9,position_y:10.8,position_z:-17},{shape:"box",width:4,height:.2,length:4.4,position_x:5,position_y:5.2,position_z:-10.2},{shape:"box",width:4,height:4,length:3.8,position_x:5,position_y:3.1,position_z:-1.9},{shape:"box",width:4,height:.2,length:.2,position_x:9,position_z:-3.9,position_y:1.2,lowFriction:!0},{shape:"box",width:4,height:4,length:.2,position_x:5,position_z:-3.9,position_y:3.1,lowFriction:!0},{shape:"box",width:8,height:.2,length:.2,position_x:7,position_z:-8.1,position_y:1.2,lowFriction:!0},{shape:"box",width:.2,height:.2,length:4,position_x:2.9,position_z:-6,position_y:1.2},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"34,11,4.5",radius:7,position_x:14,position_y:1},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-3,9,29",radius:7,position_x:-2,position_y:1,position_z:8},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-30,16,-3",radius:3,position_x:-3,position_y:12,position_z:-21},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-30,22,-29",radius:3,position_x:-15,position_y:9,position_z:-22,rotation_x:0,rotation_y:0,rotation_z:0},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-27,14,-13",radius:2,position_x:-9,position_y:6,position_z:-10},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"9.5,10,-25",radius:2,position_x:1,position_y:6,position_z:-11},{type:"trigger",shape:"sphere",event:"checkpoint",dataSet:"-30,22,-29",radius:1,position_x:-15,position_y:9.7,position_z:-26.19,rotation_x:0,rotation_y:180,rotation_z:0},{type:"trigger",shape:"sphere",event:"finish",dataSet:"checkpointCount:1",radius:1,position_x:5,position_y:6,position_z:-2}]},en={meta:{author:"",goals:{time:35e3,respawnCount:0},next:"o03"},elements:[{type:"vehicle",position_x:10,position_y:1,position_z:10,rotation_y:90},{shape:"box",width:12,height:.2,length:10,position_x:8,position_z:10},{shape:"triangularPrism",width:4,length:4,offset:-2,position_x:8,position_y:1,position_z:7},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"39,13,-6",radius:3,position_x:13,position_y:1,position_z:10},{type:"animated",shape:"box",width:6,height:.2,length:6,position_x:-1,position_z:10,dataSet:'{ "movement": { "y": -17 }, "alternateDelay": 3, "triggerStart": true }'},{shape:"box",width:1,height:18,length:.2,position_x:-3,position_y:-8.1,position_z:6.9},{shape:"box",width:1,height:18,length:.2,position_x:1,position_y:-8.1,position_z:6.9},{shape:"box",width:1,height:18,length:.2,position_x:1,position_y:-8.1,position_z:13.1},{shape:"box",width:1,height:18,length:.2,position_x:-3,position_y:-8.1,position_z:13.1},{shape:"box",width:.2,height:18,length:.6,position_x:-4.1,position_y:-8.1,position_z:12},{shape:"box",width:.2,height:18,length:.6,position_x:-4.1,position_y:-8.1,position_z:8},{shape:"box",width:12,height:.2,length:10,position_x:8,position_z:10,position_y:-17},{shape:"box",width:.2,height:14,length:6,position_x:2.1,position_y:-7.1,position_z:10,color:12895428},{shape:"box",width:12,height:.2,length:10,position_x:8,position_z:21},{shape:"box",width:4,height:10,length:.6,position_x:8,position_z:15.5,position_y:-1,mass:40,lowFriction:!0,fixedRotation:!0},{shape:"box",width:4,height:14,length:1,position_x:4,position_z:15.5,position_y:-3},{shape:"box",width:4,height:14,length:1,position_x:12,position_z:15.5,position_y:-3},{shape:"box",width:1,height:1,length:2,position_x:8,position_z:15.5,position_y:-6.5,mass:10,lowFriction:!0,fixedRotation:!0},{shape:"box",width:2,height:1,length:3,position_x:8,position_z:13.5,position_y:-7.5},{shape:"box",width:2,height:1,length:2,position_x:8,position_z:17,position_y:-7.5},{shape:"box",width:2,height:1,length:2,position_x:8,position_z:17,position_y:-5.5},{shape:"box",width:.5,height:1,length:2,position_x:7.25,position_z:17,position_y:-6.5},{shape:"box",width:.5,height:1,length:2,position_x:8.75,position_z:17,position_y:-6.5},{shape:"box",width:10,height:.2,length:8,position_x:9,position_z:9,position_y:-8},{shape:"box",width:4,height:6,length:.2,position_x:8,position_z:15.1,position_y:-3},{shape:"box",width:4,height:6,length:.2,position_x:8,position_z:15.9,position_y:-3},{shape:"box",width:.5,height:1,length:3,position_x:8.75,position_z:13.5,position_y:-6.5},{shape:"box",width:.5,height:1,length:3,position_x:7.25,position_z:13.5,position_y:-6.5},{shape:"box",width:5,height:2,length:1,position_x:4.5,position_z:15.5,position_y:-11},{shape:"box",width:5,height:2,length:1,position_x:11.5,position_z:15.5,position_y:-11},{shape:"box",width:12,height:5,length:1,position_x:8,position_z:15.5,position_y:-14.5},{shape:"sphere",radius:.5,position_x:8,position_z:14,position_y:-6.5,mass:1},{shape:"box",width:2,height:1,length:3,position_x:8,position_y:-5.5,position_z:13.5},{shape:"box",width:1,height:1,length:3,position_x:8,position_z:11.75,position_y:-6.5,mass:10,fixedRotation:!0},{shape:"box",width:4,height:.2,length:4,position_x:16,position_z:7,position_y:-17},{shape:"box",width:8,height:.2,length:4,position_x:18,position_z:7,position_y:-8},{shape:"box",width:4,height:.2,length:26,position_x:20,position_z:21.75,position_y:-10.25,rotation_x:10},{shape:"box",width:4,height:.2,length:26,position_x:16,position_z:21.6,position_y:-14.75,rotation_x:-10},{shape:"box",width:8,height:.2,length:4,position_x:18,position_z:36.35,position_y:-12.5},{shape:"box",width:4,height:.2,length:26,position_x:16,position_z:21.6,position_y:-5.76,rotation_x:-10},{shape:"box",width:4,height:.2,length:4,position_x:16,position_z:36.35,position_y:-3.5},{shape:"box",width:2,height:3,length:1,position_x:8,position_y:-6.5,position_z:18.5},{shape:"box",width:4,height:.2,length:4,position_x:4,position_z:36.35,position_y:-2},{shape:"box",width:4,height:.2,length:8.8,position_x:4,position_z:30.2,position_y:-1,rotation_x:13.4},{shape:"box",width:8.2,height:.2,length:4,position_x:10,position_z:36.35,position_y:-2.75,rotation_z:-10.5},{shape:"box",width:.2,height:4,length:.2,position_x:6.1,position_z:15.1,position_y:2},{shape:"box",width:.2,height:4,length:.2,position_x:9.9,position_z:15.1,position_y:2},{shape:"box",width:.2,height:4,length:.2,position_x:9.9,position_z:15.9,position_y:2},{shape:"box",width:.2,height:4,length:.2,position_x:6.1,position_z:15.9,position_y:2},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-13,4,1",radius:3,position_x:-1,position_y:1,position_z:10},{shape:"box",width:4,height:.2,length:12,position_x:8,position_z:-17,position_y:2},{type:"trigger",shape:"sphere",event:"finish",dataSet:"checkpointCount:1",position_x:8,position_y:3,position_z:-21},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-21,-9,8",radius:3,position_x:-1,position_y:-9,position_z:10},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"19,-10,-11",radius:3,position_x:6,position_y:-16,position_z:10},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"30,-3,52",radius:3,position_x:16,position_y:-13,position_z:23},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"43,2,0",radius:3,position_x:16,position_y:-14,position_z:17},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"32,8,-11",radius:3,position_x:20,position_y:-9,position_z:20},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"27,7,43",radius:3,position_x:16,position_y:-4,position_z:26},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"8,12,52",radius:3,position_x:9,position_y:-2,position_z:36},{shape:"box",width:.2,height:.4,length:1.9,position_y:1.1,position_z:11.35,position_x:-4.1},{shape:"box",width:.8,height:.2,length:.8,position_y:1.4,position_z:10,position_x:-4.4},{shape:"box",width:.6,height:.4,length:.2,position_y:1.1,position_z:10.3,position_x:-4.3},{shape:"box",width:.6,height:.4,length:.2,position_y:1.1,position_z:9.7,position_x:-4.3},{shape:"box",width:.8,height:.2,length:.8,position_y:.8,position_z:10,position_x:-4.4},{shape:"box",width:.2,height:.4,length:.8,position_y:1.1,position_z:10,position_x:-4.7},{shape:"box",width:.6,height:.4,length:.4,position_y:1.1,position_z:10,position_x:-4.1,mass:10},{shape:"box",width:.2,height:.4,length:.4,position_y:1.1,position_z:10,position_x:-3.9,type:"trigger",event:"startAnimation",dataSet:"animated_3"},{type:"trigger",shape:"sphere",event:"checkpoint",position_x:10.75,position_y:-7,position_z:7.5,rotation_y:-90},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"32,8,-11",radius:3,position_x:14.09,position_y:-7,position_z:10.04},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"38,15,11",radius:3,position_x:8,position_y:3,position_z:1}]},on={meta:{author:"",goals:{time:22e3},next:"o04"},elements:[{type:"vehicle",position_y:1,rotation_y:-1},{shape:"box",width:3*2,height:.1*2,length:20.01*2,position_z:-.02,position_y:.07},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-6,10,26",radius:3,position_y:1},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_x:-31.5,position_y:17.5,position_z:-13.5},{shape:"slopeTransition",type:"compound",segmentWidth:6,position_y:0,position_z:-20.6,position_x:-3,segmentCount:43,segmentHeight:.22,segmentLength:.6,rotation_x:-6},{shape:"loop",type:"compound",segmentCount:23,segmentWidth:12,segmentHeight:.2,radius:10,segmentPositionOffset:-1.19,position_x:11.85,position_z:-41.48,position_y:.5,rotation_y:-30,rotation_z:-90},{shape:"box",height:6*2,length:15*2,width:.1*2,position_y:26.7,position_x:22.01,position_z:-27},{shape:"loop",type:"compound",segmentCount:7,segmentWidth:12,segmentHeight:.2,segmentLength:2,segmentPositionOffset:0,position_x:13.95,position_z:-18,position_y:20.4,rotation_y:-90},{shape:"box",height:.1*2,length:6*2,width:15*2,position_y:12.4,position_x:-2,position_z:-18},{shape:"loop",type:"compound",segmentCount:8,segmentWidth:8,segmentHeight:.2,radius:10,segmentPositionOffset:-1,position_x:-19,position_y:22.4,position_z:-16,rotation_y:90},{shape:"loop",type:"compound",segmentCount:7,segmentWidth:8,segmentHeight:.2,segmentPositionOffset:-1,radius:8,position_x:-20.59,position_y:24.16,position_z:-2,rotation_y:-90},{shape:"box",height:.1*2,length:3*2,width:6*2,position_y:16.16,position_x:-28.6,position_z:-2},{shape:"box",height:.1*2,length:6*2,width:3*2,position_y:16.16,position_x:-31.6,position_z:-11},{type:"trigger",shape:"sphere",event:"setCameraMode",dataSet:"chase",radius:3,position_y:1,position_z:-11.4},{shape:"box",type:"trigger",position_y:15.5,position_z:-18,width:1*2,length:6*2,height:3*2,event:"setCameraMode",dataSet:"hood"},{shape:"box",type:"trigger",position_y:18.26,position_z:-2,width:1*2,length:3*2,height:2*2,position_x:-26.8,event:"setCameraMode",dataSet:"cinematic,-16,21,-2"},{shape:"box",height:2*2,length:1*2,width:3*2,position_y:18.26,position_x:-31.6,position_z:-6,type:"trigger",dataSet:"-26,26,13"}]},nn={meta:{author:"",goals:{time:55e3,respawnCount:0},next:"o05"},elements:[{type:"vehicle",position_y:11,rotation_y:-90,position_x:-5,position_z:8},{shape:"box",position_y:12,width:4,height:.2,length:4,position_x:4},{shape:"box",position_y:11.01,width:4,height:.2,length:4,position_x:.32,rotation_z:30},{shape:"box",position_y:9.67,width:4.2,height:.2,length:4,position_x:-7.41,rotation_z:-10},{shape:"box",position_y:9.67,width:4.2,height:.2,length:4,position_x:-3.38,rotation_z:10},{shape:"box",position_y:11.01,width:4,height:.2,length:4,position_x:-11.1,rotation_z:-30},{shape:"box",position_y:13.51,width:4,height:.2,length:4,position_x:-14.1,rotation_z:-50},{shape:"box",position_y:18.47,width:8,height:.2,length:4,position_x:-17.36,rotation_z:-60},{shape:"box",position_y:23.44,width:4,height:.2,length:4,position_x:-20.63,rotation_z:-50},{shape:"box",position_y:26.24,width:4,height:.2,length:4,position_x:-23.43,rotation_z:-40},{shape:"box",position_y:28.19,width:4,height:.2,length:4,position_x:-26.81,rotation_z:-20},{shape:"box",position_y:28.87,width:10,height:.2,length:10,position_x:-33.65},{shape:"box",position_y:19,width:8,height:.2,length:4,position_x:36.53,rotation_z:10,position_z:0},{shape:"box",position_y:16.31,width:8,height:.2,length:4,position_x:29.16,rotation_z:30},{shape:"box",position_y:8.576,width:12,height:.2,length:12,position_x:10.858,position_z:4,rotation_z:-35},{shape:"box",position_y:10,width:8,height:8,length:4,position_x:4,position_z:4},{shape:"box",position_y:12,width:4,height:.2,length:4,position_x:4,position_z:8},{shape:"box",position_y:11.013,width:4,height:.2,length:4,position_x:.318,rotation_z:30,position_z:8},{shape:"box",position_y:10,width:6,height:.2,length:4,position_x:-4.35,position_z:8},{shape:"box",position_y:21.06,width:8,height:.2,length:4,position_x:44.18,position_z:0,rotation_z:20},{shape:"box",position_y:23.9,width:6,height:.2,length:12,position_x:50.48,position_z:4,rotation_z:30},{shape:"sphere",type:"trigger",event:"checkpoint",position_x:-34.15,position_y:30.14,rotation_y:-90},{shape:"sphere",type:"trigger",event:"finish",dataSet:"checkpointCount:1",position_x:50.18,position_y:24.88,position_z:8.54},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"cinematic,26,20,43",position_x:-5,position_y:11,position_z:8,radius:2},{shape:"sphere",type:"trigger",dataSet:"25,22,18",position_x:4,position_y:13,position_z:8,radius:2},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"chase",position_x:10.01,position_y:9.92,position_z:1.67,radius:3}]},sn={meta:{author:"",goals:{time:45e3,respawnCount:0},next:"o06"},elements:[{type:"vehicle",position_y:1},{shape:"box",width:7,height:.1,length:30,position_z:-11.5},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"chase",position_y:1},{shape:"box",position_x:-1.5,position_y:.6,position_z:-8,width:3,height:1},{shape:"box",position_x:1.5,position_y:.6,position_z:-18,width:3,height:1},{shape:"box",position_y:-2.62,position_z:-38.18,rotation_x:-10,width:7,length:6,height:.1},{shape:"box",position_x:0,position_y:-6,position_z:-57,width:6,length:10,height:.1},{shape:"slopeTransition",type:"compound",position_x:-3,position_y:-6.05,position_z:-65.66,angle:30,segmentHeight:.84,segmentLength:3.69,segmentCount:5,segmentWidth:6},{shape:"cantedCurve",type:"compound",position_x:20.33,position_y:-3.94,position_z:-78.94,rotation_y:-90,segmentCount:36,radius:20,segmentWidth:6,segmentLength:1.53,angle:40},{shape:"box",position_x:41.83,position_y:-2.69,position_z:-75.18,rotation_z:40,width:10,length:6,height:.1},{shape:"box",position_x:48.63,position_y:.51,position_z:-63.18,width:6,length:30,height:.1},{shape:"sphere",type:"trigger",event:"checkpoint",position_x:48.5,position_y:1.74,position_z:-74.9,rotation_y:180},{shape:"loop",type:"compound",position_x:52.63,position_y:8.5,position_z:-42,rotation_y:-90,segmentPositionOffset:0,segmentCount:7,segmentLength:2,segmentWidth:30},{shape:"loop",type:"compound",position_x:30.68,position_y:11.8,position_z:-25.54,rotation_x:180,rotation_z:90,segmentCount:16,segmentPositionOffset:0,radius:30,segmentWidth:8,segmentLength:3},{shape:"box",position_x:60.68,position_y:12.3,position_z:-34,rotation_z:90,width:7,length:14,height:.1},{shape:"box",position_x:23.17,position_y:11.77,position_z:4.49,width:17,length:.1,height:8},{shape:"loop",type:"compound",position_x:-14.87,position_y:8.5,position_z:-3.5,rotation_x:-180,rotation_y:0,rotation_z:-180,segmentPositionOffset:-1.2,segmentCount:32,segmentLength:2,segmentWidth:18},{shape:"box",position_x:-67,position_y:4.47,position_z:-73,rotation_y:-60,width:40,height:.1,length:20},{shape:"loop",type:"compound",position_x:-16,position_y:12.49,position_z:-5.46,segmentCount:4,radius:12,segmentLength:2,segmentWidth:18,segmentPositionOffset:0},{shape:"box",position_x:-79,position_y:5.33,position_z:-94,rotation_y:-60,rotation_z:-10,width:10,height:.1,length:20},{shape:"box",type:"trigger",event:"finish",dataSet:"checkpointCount:1",length:5,position_x:-79,position_y:6.75,position_z:-93,rotation_y:-60}]},an={meta:{author:"",goals:{time:45e3,respawnCount:0},next:"o07"},elements:[{type:"vehicle",position_y:11.5},{shape:"box",width:5,length:5,height:1,position_y:10},{shape:"box",width:8,length:6,height:1,position_y:-8,position_z:2},{shape:"box",position_y:-18,position_z:-1,height:1,width:10,length:10},{shape:"box",position_y:-22,position_z:17,height:1,width:10,length:10},{shape:"sphere",type:"trigger",event:"checkpoint",position_y:-6.5,position_z:2},{shape:"box",color:10853513,height:.2,width:16,length:12,position_x:3,position_y:-12,position_z:17,rotation_x:-30},{shape:"box",position_x:8,position_y:-23,position_z:17,height:1,width:6,length:4},{shape:"box",position_x:14,position_y:-24,position_z:17,height:1,width:6,length:4},{shape:"sphere",type:"trigger",event:"checkpoint",position_x:8,position_y:-21,position_z:17,rotation_y:-90},{shape:"box",position_x:18,position_y:-25,position_z:13,height:1,width:4,length:6},{shape:"box",position_x:18,position_y:-26,position_z:7,height:1,width:4,length:6},{shape:"box",position_x:14,position_y:-27,position_z:3,height:1,width:6,length:4},{shape:"box",position_x:8,position_y:-28,position_z:3,height:1,width:6,length:4},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"32,-13,25",position_x:10,position_y:-21,position_z:17},{shape:"box",type:"trigger",dataSet:"-24,-13,20",height:2,length:1,width:6,position_x:0,position_y:-20,position_z:14},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"32,-13,-8",position_x:18,position_y:-24,position_z:9,rotation_y:-90},{shape:"box",position_x:-2,position_y:-31,position_z:4,height:1,width:6,length:6},{shape:"sphere",type:"trigger",event:"checkpoint",position_x:8,position_y:-26,position_z:3,rotation_y:90},{shape:"box",position_x:-2,position_y:-35,position_z:16,height:1,width:6,length:6},{shape:"box",position_x:-2,position_y:-39,position_z:27,height:1,width:6,length:6},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"cinematic,-24,25,0",position_y:12},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"-2,-20,-10",position_x:-2,position_y:-29,position_z:4},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"-35,-3,1",position_x:0,position_y:-6.5,position_z:2},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"6,-21,-20",position_x:10,position_y:-26,position_z:3},{type:"trigger",shape:"sphere",event:"finish",dataSet:"checkpointCount:3",radius:1,position_x:-2,position_y:-37,position_z:27}]},rn={meta:{author:"",goals:{time:2e4},next:"o08"},elements:[{type:"vehicle",position_y:1.4},{shape:"box",width:8,length:16,height:.2,position_y:-.6},{shape:"cylinder",sides:4,radiusTop:3,radiusBottom:5.7,height:1,rotation_y:45},{shape:"box",width:8,length:16,height:.2,position_z:20,position_x:0,position_y:0,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"box",width:8,length:16,height:.2,position_z:-20},{shape:"box",width:16,length:10,height:.2,position_y:-.6,position_x:-12,position_z:-3,rotation_x:0,rotation_y:0,rotation_z:0},{type:"compound",shape:"loop",position_x:-20.89,position_y:9.9,position_z:-3,rotation_y:90,segmentPositionOffset:0,segmentCount:7,segmentLength:2.64,segmentWidth:10,segmentHeight:.2,radius:10.5},{type:"compound",shape:"loop",position_x:-20.89,position_y:10.5,position_z:20,rotation_y:90,segmentPositionOffset:0,segmentCount:7,segmentLength:2.64,segmentWidth:16,segmentHeight:.2,radius:10.5},{shape:"box",width:16,length:16,height:.2,position_z:20,position_x:-12},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_y:1,position_z:-25},{type:"trigger",shape:"box",position_x:-5,position_y:1,position_z:-3,width:1,length:8,dataSet:"-8,27,-33"},{type:"trigger",shape:"box",dataSet:"-27, 29, 47",position_x:-19,position_y:1,position_z:20,width:1,length:14},{type:"trigger",shape:"box",dataSet:"0,10,40",position_x:-10,position_y:1,position_z:20,width:1,length:14},{type:"trigger",shape:"box",event:"setCameraMode",dataSet:"cinematic,24,8,0",width:1,height:1,length:1,position_y:.5},{shape:"box",position_x:-29,position_y:9,position_z:6,type:"trigger",width:5,height:10,length:1,dataSet:"-34,23,3"},{shape:"box",position_y:1,position_z:10,type:"trigger",event:"setCameraMode",dataSet:"chase",width:5,height:2,length:1}]},hn={meta:{author:"",goals:{time:3e4,respawnCount:0},next:"o09"},elements:[{type:"vehicle",position_y:1,position_z:16},{shape:"box",width:6,length:38,height:.2,position_y:-.1,position_x:0,position_z:1,rotation_x:0,rotation_y:0,rotation_z:0},{type:"animated",shape:"box",width:6,height:4,length:6,position_y:2,position_z:7,dataSet:'{ "movement": { "x": 10 }, "speed": 10, "triggerStart": false }'},{type:"animated",shape:"box",width:6,height:4,length:6,position_y:2,position_z:-9,dataSet:'{ "movement": { "x": 10 }, "speed": 10, "triggerStart": false }'},{shape:"box",height:.2,width:6,length:10,position_x:10,position_y:3.9,position_z:-1},{shape:"box",height:.2,width:6,length:6,position_x:10,position_y:3.9,position_z:-15},{shape:"box",height:.2,width:6,length:10,position_x:10,position_y:3.033,position_z:-22.9,rotation_x:-10},{shape:"box",height:.2,width:6,length:10,position_y:.764,position_z:-22.92,rotation_x:10},{shape:"box",height:.2,width:6,length:6,position_y:1.63,position_z:-30.82},{shape:"box",height:.2,width:6,length:6,position_x:10,position_y:2.16,position_z:-30.82},{shape:"box",height:.2,width:4.05,length:6,position_x:5.01,position_y:1.895,position_z:-30.82,rotation_z:7.47},{shape:"box",height:.2,width:6,length:9,position_x:10,position_y:3.9,position_z:14.5,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"sphere",position_x:10,position_y:3.45,position_z:-30.82,rotation_y:180,type:"trigger",event:"checkpoint"},{type:"trigger",shape:"sphere",event:"finish",radius:2,dataSet:"checkpointCount:1",position_x:10,position_y:5,position_z:16,rotation_x:0,rotation_y:0,rotation_z:0},{type:"trigger",shape:"sphere",event:"setCameraMode",dataSet:"cinematic,-23.677403301734017 , 18.14983153689501 , 19.110973303515554",radius:3,position_y:1,position_z:16},{type:"trigger",shape:"sphere",radius:3,dataSet:"-30.215800024784016, 22.38223498976879, 8.370897885782714",position_y:1,position_z:2},{type:"trigger",shape:"sphere",radius:3,dataSet:"-13.569674761319714, 16.522559296321283, -50.07904465318648",position_y:1,position_z:-15},{shape:"sphere",position_x:10,position_y:3.45,position_z:-30.82,rotation_y:180,type:"trigger",event:"setCameraPosition",radius:3,dataSet:"18.770735429093357, 20.96953167533059, -46.35856186137107"}]},pn={meta:{author:"",goals:{time:2e4},next:"o10"},elements:[{type:"vehicle",position_y:11.4,position_x:1.5},{shape:"box",width:10,length:6,height:1,position_y:9.95,position_z:.3},{shape:"box",position_y:2.51,position_z:-15.44,rotation_x:-30,height:1,width:10,length:30},{shape:"box",position_x:-8,position_y:-25,position_z:-65,rotation_x:-30,height:1,width:10,length:60},{shape:"box",position_y:-56,position_z:-130,rotation_x:-20,height:1,width:10,length:60},{shape:"box",width:10,height:1,position_y:-5.18,position_z:-29.26,rotation_x:-15},{shape:"box",width:10,height:1,position_x:-8,position_y:-40.17,position_z:-91.78,rotation_x:-15},{shape:"box",position_y:-66.31,position_z:-159,rotation_x:-5,width:10,height:1},{shape:"box",position_x:8,position_y:-76,position_z:-200,rotation_x:-10,height:1,width:10,length:60},{shape:"box",position_y:-83,position_z:-271,height:1,width:10,length:60},{shape:"box",position_x:8,position_y:-81.08,position_z:-230.38,rotation_x:5,width:10,height:1},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:2,position_y:-81,position_z:-297},{type:"trigger",shape:"box",event:"setCameraMode",dataSet:"cinematic,-5,24,19",position_y:12},{type:"trigger",shape:"box",event:"setCameraMode",dataSet:"chase",height:2,width:8,length:1,position_y:11,position_x:0,position_z:-4}]},ln={meta:{author:"",goals:{time:45e3}},elements:[{type:"vehicle",position_x:0,position_y:1.6,position_z:-4},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_x:-16,position_y:5.5,position_z:-10},{shape:"box",color:11194623,fixedRotation:!0,width:5,height:3.79,length:5,position_x:-10,position_y:-1,position_z:-10,mass:90},{shape:"box",color:11194623,fixedRotation:!0,width:5,height:.17,length:5,position_x:10,position_y:0,position_z:-10,mass:30},{shape:"box",position_x:-.4,position_y:-1.76,position_z:-10.07,height:.2,length:1,width:24.9,color:9805311,mass:30},{shape:"triangularPrism",position_x:0,position_y:-2.6,position_z:-10,rotation_y:90,height:1,width:1,length:1},{shape:"box",lowFriction:!0,position_x:-7.45,position_y:0,position_z:-10,height:1,length:5,width:.1},{shape:"box",lowFriction:!0,position_x:7.45,position_y:0,position_z:-10,height:1,length:5,width:.1},{shape:"box",lowFriction:!0,position_x:12.55,position_y:-2,position_z:-10,height:5,length:5,width:.1},{shape:"box",lowFriction:!0,position_x:-12.55,position_y:-2,position_z:-10,height:5,length:5,width:.1},{shape:"box",lowFriction:!0,position_x:10,position_y:-2,position_z:-7.45,height:5,length:.1,width:5.2},{shape:"box",lowFriction:!0,position_x:10,position_y:-2,position_z:-12.55,height:5,length:.1,width:5.2},{shape:"box",lowFriction:!0,position_x:-10,position_y:-2,position_z:-12.55,height:5,length:.1,width:5.2},{shape:"box",lowFriction:!0,position_x:-10,position_y:-2,position_z:-7.45,height:5,length:.1,width:5.2},{shape:"box",height:.2,position_x:0,position_y:.4,position_z:-10,width:14.8,length:5.2},{shape:"box",lowFriction:!0,position_x:-7.45,position_y:-2.5,position_z:-8.5,height:4,length:2,width:.1},{shape:"box",lowFriction:!0,position_x:-7.45,position_y:-2.5,position_z:-11.5,height:4,length:2,width:.1},{shape:"box",lowFriction:!0,position_x:7.45,position_y:-2.5,position_z:-11.5,height:4,length:2,width:.1},{shape:"box",lowFriction:!0,position_x:7.45,position_y:-2.5,position_z:-8.5,height:4,length:2,width:.1},{shape:"box",height:.2,position_x:0,position_y:.4,position_z:-4,width:25.2,length:6.8},{shape:"box",position_x:-15.08,position_y:4.04,position_z:-10,length:5,width:5,height:.2},{shape:"triangularPrism",height:.1,length:.2,width:5.5,position_x:10.25,position_y:.55,position_z:-7.5},{shape:"triangularPrism",height:.1,length:.2,width:5.5,position_x:7.5,position_y:.55,position_z:-10.25,rotation_y:90},{shape:"triangularPrism",height:.24,length:1,width:12,position_x:13,position_y:.62,position_z:-7,rotation_y:90},{shape:"triangularPrism",height:.24,length:1,width:27,position_x:0,position_y:.62,position_z:-13.01},{shape:"triangularPrism",height:.24,length:1,width:12,position_x:-13.01,position_y:.62,position_z:-7,rotation_y:90},{shape:"box",lowFriction:!0,position_x:-12.55,position_y:4.04,position_z:-10,height:.2,length:5,width:.1},{shape:"triangularPrism",height:.24,length:1,width:27,position_x:0,position_y:.62,position_z:-1},{shape:"box",width:27,position_x:0,position_y:-1,position_z:-1,length:1,height:3},{shape:"box",height:.2,position_x:-16,position_y:.4,position_z:-7,width:5,length:13},{shape:"sphere",color:7841791,position_x:6.25,position_y:1.5,position_z:-10,mass:60},{shape:"sphere",color:7841791,position_x:-5.36,position_y:1.5,position_z:-10,mass:60},{shape:"box",type:"trigger",event:"setCameraMode",dataSet:"cinematic,0, 13, 17",width:1,length:10,height:1,position_x:0,position_y:2,position_z:-7},{shape:"box",type:"trigger",dataSet:"-22, 10, 5",width:1,length:10,height:1,position_x:-5,position_y:2,position_z:-7},{shape:"box",type:"trigger",dataSet:"8, 14, 6",width:1,length:10,height:1,position_x:5,position_y:2,position_z:-7}]},Et={i01:Qo,o01:tn,o02:en,o03:on,o04:nn,o05:sn,o06:an,o07:rn,o08:hn,o09:pn,o10:ln,empty:Jo,test:{meta:{},elements:[{type:"vehicle",position_y:2,position_z:15},{shape:"box",width:24,height:.2,length:40,position_x:14,position_z:22},{shape:"triangularPrism",width:2,length:2,offset:-2,position_y:1},{shape:"box",width:24,height:.2,length:120,position_x:-10,position_z:-18},{shape:"box",size:2,position_x:15,position_y:2,position_z:10,mass:40,fixedRotation:!0,rotation_x:45,rotation_y:45},{shape:"box",size:2,position_x:20,position_y:5,position_z:10,rotation_x:45,rotation_y:45},{type:"compound",shape:"loop",segmentPositionOffset:.6,position_x:5,position_y:8.2,position_z:4,rotation_x:12},{type:"compound",shape:"slopeTransition",segmentWidth:6,segmentHeight:.6,segmentLength:12,segmentCount:10,position_x:-25.8,position_z:30},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-6,10,26",radius:3,position_x:10,position_y:1,position_z:15},{type:"trigger",shape:"sphere",event:"finish",radius:1,position_x:12,position_y:3,position_z:5},{type:"trigger",shape:"sphere",event:"setCameraMode",dataSet:"hood",radius:3,position_x:6,position_y:1.9,position_z:-.4},{shape:"box",position_y:12,width:4*2,height:.1*2,length:2*2,position_x:-20,position_z:8},{shape:"box",position_y:11.8,width:9*2,height:.1*2,length:.2*2,position_x:-7,position_z:6.2,lowFriction:!0},{shape:"box",position_y:11.8,width:9*2,height:.1*2,length:.2*2,position_x:-7,position_z:9.8,lowFriction:!0},{shape:"box",position_y:12,width:9*2,height:.1*2,length:.1*2,position_x:-7,position_z:9.9,lowFriction:!0},{shape:"box",position_y:12,width:9*2,height:.1*2,length:.1*2,position_x:-7,position_z:6.1,lowFriction:!0},{shape:"box",position_y:12,width:2*2,height:.1*2,length:1.8*2,position_x:-14,position_z:8,mass:10},{shape:"box",position_x:9.11,position_y:7.09,position_z:-15,rotation_z:45,height:.1*2,length:10*2,width:10*2},{shape:"box",position_x:10.21,position_y:5.74,position_z:-35,rotation_z:35,height:.1*2,length:10*2,width:10*2},{type:"compound",shape:"cantedCurve",position_x:8.94,position_y:-3.61,position_z:53.91,radius:11.65,rotation_x:0,rotation_y:-83.16,rotation_z:0,angle:60,segmentWidth:6,segmentCount:32,segmentLength:2},{type:"compound",shape:"cantedCurve",position_x:8.94,position_y:-7.71,position_z:53.91,radius:7.675,rotation_x:0,rotation_y:4.18,rotation_z:0,angle:30,segmentWidth:6,segmentCount:32,segmentLength:1},{shape:"box",position_x:9,position_y:-9.2,position_z:53.81,rotation_x:0,rotation_y:0,rotation_z:0,width:10,length:10,height:.1}]}},cn="Finished!",dn="Retry",gn="Next",mn="Select map";function _n(){const{goals:e,time:t}=u.useContext(Rt);return e.time?g.jsxs(g.Fragment,{children:[g.jsx("h4",{children:"Goals"}),!!e.time&&g.jsxs("p",{children:["Finis under: ",g.jsx("span",{className:"textHighlight_2",children:Qt(e.time)}),g.jsx("span",{className:"end_adornment",children:t<=e.time?"✅":"🟧"})]})]}):null}function un({closeModal:e}){const t=u.useContext(Rt),i=u.useRef();return u.useEffect(()=>{i.current&&i.current.focus()},[i.current]),g.jsxs(je,{children:[g.jsx("span",{className:"modal__header",children:cn}),g.jsxs("span",{className:"modal__body",children:[g.jsxs("p",{children:["Your time: ",g.jsx("span",{className:"textHighlight_1",children:Qt(t.time)}),g.jsx("span",{className:"end_adornment",children:"⏱"})]}),!!t.respawnCount&&g.jsxs("p",{children:["Respawn count: ",g.jsx("span",{className:"textHighlight_1",children:t.respawnCount})]}),g.jsx(_n,{})]}),g.jsxs("div",{className:"modal__footer",children:[g.jsx("button",{onClick:n,children:dn}),g.jsx("button",{onClick:s,children:mn}),g.jsx("button",{onClick:o,ref:i,children:gn})]})]});function o(){e(),t.loadNextMap()}function n(){e(),t.reset()}function s(){e(),t.listeners.dispatch(rt.openMapSelectorPanel)}}const At=document.createElement("aside");At.id="gameProgressModalControllerRoot";At.classList.add("hidden");document.body.appendChild(At);const Rt=u.createContext(void 0);function yn(e){ut.render(g.jsx(Rt.Provider,{value:e,children:g.jsx(xn,{})}),At)}function xn(){const e=u.useContext(Rt),[t,i]=u.useState(!0);return u.useEffect(()=>(e.listeners.add(rt.openModal,o),()=>{e.listeners.remove(rt.openModal,o)}),[]),t?null:g.jsx(un,{closeModal:n});function o(){i(!1)}function n(){i(!0)}}var rt=(e=>(e.openModal="openModal",e.openMapSelectorPanel="openMapSelectorPanel",e))(rt||{});let lt;const fn=5e3,Zt=document.createElement("aside"),St=document.createElement("span"),we="00:00.000";Zt.id="hud";const[wn]=Object.entries(Et)[0];class bn{constructor(t,i){r(this,"timer",new Xo);r(this,"listeners",new st);r(this,"started",!1);r(this,"checkpointsReached",0);r(this,"respawnCount",0);r(this,"time");r(this,"goals");r(this,"_mapBuilder");r(this,"checkpointHandler");r(this,"vehicle");r(this,"currentMapId",wn);r(this,"checkpointReached",t=>{lt=t,this.checkpointsReached++});St.textContent=we,Zt.appendChild(St),document.getElementById("topLeftPanel").appendChild(Zt),this._mapBuilder=t,this.vehicle=i,yn(this)}initCheckpointHandler(t,i){this.checkpointHandler=new Go(t,i)}respawnAtLastCheckpoint(){lt?(this.vehicle.chassisBody.velocity.setZero(),this.vehicle.chassisBody.angularVelocity.setZero(),this.vehicle.chassisBody.position.copy(lt.position),this.vehicle.chassisBody.quaternion.copy(lt.quaternion),this.respawnCount++,this.timer.add(fn)):this.reset()}start(){this.started=!0,this.timer.start()}stop(){this.timer.stop(),this.time=this.timer.time}reset(){this.started=!1,this.checkpointsReached=0,this.respawnCount=0,this.time=void 0,St.textContent=we,this.timer.reset(),this._mapBuilder.resetDynamicMapElements(),this.checkpointHandler.init(this._mapBuilder,this),lt=void 0}loadMap(t=this.currentMapId){if(!Et.hasOwnProperty(t)){console.warn(`invalid map name ${t}`);return}const{meta:i,elements:o}=Et[t],n=this._mapBuilder.selectedMapElementId;this.goals=i.goals||{},this._mapBuilder.importMap(o),t===this.currentMapId&&this._mapBuilder.editMode&&n&&this._mapBuilder.selectMapElement(n),this.currentMapId=t,this.reset()}loadNextMap(){const{meta:t}=Et[this.currentMapId];t.next?this.loadMap(t.next):this.reset()}updateHUD(){!this.timer.started||this.timer.stopped||(St.textContent=Qt(this.timer.time))}openModal(){this.listeners.dispatch("openModal")}}class Cn{constructor(t,i,o,n){r(this,"_enabled",!1);r(this,"scene");r(this,"camera");r(this,"domElement");r(this,"mapBuilder");r(this,"raycaster",new xi);r(this,"mousePosition",new Te);r(this,"raycastResult",[]);r(this,"hoveredObject");r(this,"onSelect");r(this,"onClick",t=>{if(t.type==="click"&&!t.altKey)return;this.mousePosition.x=t.clientX/window.innerWidth*2-1,this.mousePosition.y=-(t.clientY/window.innerHeight)*2+1,this.raycaster.setFromCamera(this.mousePosition,this.camera),this.raycastResult.length=0,this.raycaster.intersectObjects(this.scene.children,!0,this.raycastResult);const{mapElementIdList:i}=this.mapBuilder;let o;for(let n=0;n<this.raycastResult.length;n++){const s=this.raycastResult[n].object;if(i.includes(s.name)){o=s;break}else if(i.includes(s.parent.name)){o=s.parent;break}}o&&this.mapBuilder.selectMapElement(o.name)});this.camera=i,this.scene=t,this.domElement=o,this.mapBuilder=n}get enabled(){return this._enabled}set enabled(t){this._enabled!==t&&(t?(this.domElement.addEventListener("click",this.onClick),this.domElement.addEventListener("dblclick",this.onClick)):(this.domElement.removeEventListener("click",this.onClick),this.domElement.removeEventListener("dblclick",this.onClick),this.hoveredObject=void 0),this._enabled=t)}}const{radToDeg:Nt}=Lt;function vn(e,t){const i=new fi(e.camera,e.domElement);let o=!1,n=!1;function s(){const a=i.object,h=a.name;t.translate(h,{position_x:Q(a.position.x),position_y:Q(a.position.y),position_z:Q(a.position.z),rotation_x:Q(Nt(a.rotation.x)),rotation_y:Q(Nt(a.rotation.y)),rotation_z:Q(Nt(a.rotation.z))})}return i.addEventListener("objectChange",Ai(s,100)),i.addEventListener("dragging-changed",a=>{o?e.orbitControls.enabled=n:(n=e.orbitControls.enabled,e.orbitControls.enabled=!1),o=a.value}),R.addKeyPressListener("KeyG",()=>{i.mode==="translate"?i.setMode("rotate"):i.setMode("translate")}),R.addKeyDownChangeListener(a=>{a.has("ShiftLeft")?i.setTranslationSnap(1):i.setTranslationSnap(null)}),i}const Bt=document.createElement("aside");Bt.id="menuModalControllerRoot";Bt.classList.add("hidden");document.body.appendChild(Bt);const zn={gameProgressManager:void 0,renderer:void 0,menuOpen:!1,openMenu:N,closeMenu:N,selectedTabIndex:0,setSelectedTabIndex:N},Xe=u.createContext(zn);function Sn(e,t){ut.render(g.jsx(Mn,{gameProgressManager:e,renderer:t}),Bt)}function Mn({gameProgressManager:e,renderer:t}){const[i,o]=u.useState(!1),[n,s]=u.useState(0),a=u.useCallback(()=>{o(!0)},[]),h=u.useCallback(()=>{o(!1)},[]),l={gameProgressManager:e,renderer:t,menuOpen:i,openMenu:a,closeMenu:h,selectedTabIndex:n,setSelectedTabIndex:s};return g.jsx(Xe.Provider,{value:l,children:g.jsx(Pn,{})})}function Pn(){const{menuOpen:e,openMenu:t,setSelectedTabIndex:i,gameProgressManager:o}=u.useContext(Xe),n=u.useCallback(()=>{t()},[]),s=u.useCallback(()=>{i(0),t()},[]);u.useEffect(()=>(R.addKeyPressListener("Tab",n),o.listeners.add(rt.openMapSelectorPanel,s),()=>{R.removeKeyPressListener("Tab",n),o.listeners.remove(rt.openMapSelectorPanel,s)}),[]);const a=u.lazy(()=>Ne(()=>import("./modules/MenuModal-5aee0521.js"),["./modules\\MenuModal-5aee0521.js","./vendor\\react-6a63c5cb.js","./vendor\\vendor-5e83183c.js","./modules\\Switch-bf490e0b.js","./vendor\\cannon-fb08787c.js","./vendor\\three-c64a4383.js"],import.meta.url));return u.useMemo(()=>e?g.jsx(u.Suspense,{fallback:g.jsx($e,{}),children:g.jsx(a,{})}):null,[e])}function En(e,t){const i={baseMaterial:new ke({color:7829367}),fenderMaterial:new Mt({color:328965}),grillMaterial:new Mt({color:2236962}),chromeMaterial:new gt({color:13421772}),glassMaterial:new gt({color:11324631}),tailLightMaterial:new gt({color:5570560}),headLightMaterial:new gt({color:16777147}),wheelMaterial:new Mt({alphaTest:.5})};return e.traverse(n=>{n.material&&(i.wheelMaterial.map=n.material.map,n.material=i.wheelMaterial,n.material.needsUpdate=!0),f.renderShadows&&(n.castShadow=!0)}),t.traverse(n=>{n.material&&(n.material=o(n.name)),f.renderShadows&&(n.castShadow=!0,n.receiveShadow=!0)}),i;function o(n){switch(n){case"front_bumper":case"rear_bumper":case"front_fender":case"rear_fender":return i.fenderMaterial;case"grill":return i.grillMaterial;case"brushGuard":return i.chromeMaterial;case"glass":return i.glassMaterial;case"tail_lights":return i.tailLightMaterial;case"head_lights":return i.headLightMaterial;default:return i.baseMaterial}}}const be={engineForceMin:-f.vehicle.maxEngineForce,engineForceMax:f.vehicle.maxEngineForce,brakeForceMin:0,brakeForceMax:f.vehicle.maxBrakeForce,steeringAngleMin:-f.vehicle.maxSteeringAngle,steeringAngleMax:f.vehicle.maxSteeringAngle},Ln={engineForce:0,brakeForce:0,steeringAngle:0};function kn(e){return new Proxy(Ln,{set(t,i,o){const n=t[i],s=ji(o,be[`${i}Min`],be[`${i}Max`]);return n!==s&&(t[i]=s),!0}})}const Tn=new E(0,0,1);let ct,dt;const{renderWireFrame:$t}=f,{torqueSplitRatio:Fn,maxEngineForce:In,maxBrakeForce:An,maxSteeringAngle:Rn,steeringSpeed:Ce,wheelRadius:Bn,wheelSuspensionRestLength:On,wheelSuspensionStiffness:jn,wheelMaxSuspensionTravel:Dn,wheelMaxSuspensionForce:Wn,wheelDampingCompression:Hn,wheelDampingRelaxation:Nn,wheelFrictionSlip:$n,wheelForwardAcceleration:Kn,wheelSidedAcceleration:Vn,wheelRollInfluence:qn}=f.vehicle,Un=.3,$=0,K=1,it=2,ot=3,Gn=new Set([it,ot]),[ve,ze]=Fn,Yt=[ve/2,ve/2,ze/2,ze/2],M=[...Yt];class Zn{constructor(t,i){r(this,"base");r(this,"chassisBody");r(this,"chassisMesh");r(this,"wheelBodies");r(this,"wheelMeshes");r(this,"state");r(this,"initialPosition",new w);r(this,"initialRotation",new se);r(this,"currentSteeringAngle",0);r(this,"trackWidth",0);r(this,"wheelBase",0);r(this,"materials");r(this,"update",()=>{this.steerWheels(),this.applyWheelSlipReduction();for(let t=0;t<this.base.wheelInfos.length;t++)this.base.applyEngineForce(this.state.engineForce*M[t]*.01,t),this.base.updateWheelTransform(t),ct=this.base.wheelInfos[t].worldTransform,this.wheelMeshes[t].position.copy(ct.position),this.wheelMeshes[t].quaternion.copy(ct.quaternion),$t&&(dt=this.wheelBodies[t],dt.position.copy(ct.position),dt.quaternion.copy(ct.quaternion),this.wheelMeshes[t].position.copy(dt.position),this.wheelMeshes[t].quaternion.copy(dt.quaternion));this.chassisMesh.position.copy(this.chassisBody.position),this.chassisMesh.quaternion.copy(this.chassisBody.quaternion),this.chassisMesh.translateOnAxis(Tn,.6)});r(this,"applyWheelSlipReduction",()=>{const t=this.wheelHasGrip(K),i=this.wheelHasGrip($),o=this.wheelHasGrip(ot),n=this.wheelHasGrip(it);if(t&&!o&&M[ot]>1)M[K]+=1,M[ot]-=1;else if(!t&&o&&M[K]>1)M[K]-=1,M[ot]+=1;else{const s=Math.sign(M[K]-Yt[K]);s&&(M[K]-=s*1,M[ot]+=s*1)}if(i&&!n&&M[it]>1)M[$]+=1,M[it]-=1;else if(!i&&n&&M[$]>1)M[$]-=1,M[it]+=1;else{const s=Math.sign(M[$]-Yt[$]);s&&(M[$]-=s*1,M[it]+=s*1)}});r(this,"brakeWheel",t=>{this.base.setBrake(this.state.brakeForce,t)});r(this,"steerWheels",()=>{const{currentSteeringAngle:t}=this,{steeringAngle:i}=this.state;let o=0;if(t<i)o=Math.min(i,t+Ce);else if(t>i)o=Math.max(i,t-Ce);else return;const{wheelBase:n,trackWidth:s}=this,a=n*2,h=Math.sin(o),l=Math.cos(o),d=Math.atan(a*h/(a*l-s*h)),p=Math.atan(a*h/(a*l+s*h));this.base.setSteeringValue(d,K),this.base.setSteeringValue(p,$),this.currentSteeringAngle=o});r(this,"wheelHasGrip",t=>this.base.wheelInfos[t].isInContact&&!this.base.wheelInfos[t].sliding);const o=new Vt(new w(.9,.4,2.1)),n=new Vt(new w(.9,.4,1.2));this.chassisBody=new q({mass:f.vehicle.mass}),this.chassisBody.addShape(o,new w(0,0,.1)).addShape(n,new w(0,.8,.8)),this.base=new ii({chassisBody:this.chassisBody,indexForwardAxis:2,indexRightAxis:0,indexUpAxis:1});const s={radius:Bn,suspensionRestLength:On,suspensionStiffness:jn,maxSuspensionTravel:Dn,maxSuspensionForce:Wn,dampingCompression:Hn,dampingRelaxation:Nn,frictionSlip:$n,forwardAcceleration:Kn,sideAcceleration:Vn,rollInfluence:qn,axleLocal:new w(-1,0,0),directionLocal:new w(0,-1,0),chassisConnectionPointLocal:new w,customSlidingRotationalSpeed:-30,useCustomSlidingRotationalSpeed:!0},a=.3,h=.85;if(this.trackWidth=h*2,this.wheelBase=1.2+1.4,s.chassisConnectionPointLocal.set(h,-a,-1.2),this.base.addWheel(s),s.chassisConnectionPointLocal.set(-h,-a,-1.2),this.base.addWheel(s),s.chassisConnectionPointLocal.set(h,-a,1.4),this.base.addWheel(s),s.chassisConnectionPointLocal.set(-h,-a,1.4),this.base.addWheel(s),$t){const p=new se;p.setFromAxisAngle(w.UNIT_Z,Math.PI/2),this.wheelBodies=this.base.wheelInfos.map(c=>{const _=new Se(c.radius,c.radius,c.radius/2,8),x=new q({type:q.KINEMATIC,collisionFilterGroup:0});return x.addShape(_,w.ZERO,p),x})}this.materials=En(i,t);const l={front_r:i,front_l:i.clone(),rear_r:i.clone(),rear_l:i.clone()},d=["x","y","z"];Object.keys(l).forEach(p=>{p.endsWith("_r")&&d.forEach(c=>{l[p].scale[c]*=-1})}),this.wheelMeshes=[l.front_l,l.front_r,l.rear_l,l.rear_r],this.chassisMesh=t,this.state=kn()}addToWorld(t){return this.base.addToWorld(t),$t&&this.wheelBodies.forEach(t.addBody,t),t.addEventListener("postStep",this.update),this}addToScene(t){return this.wheelMeshes.forEach(i=>{t.add(i)}),t.add(this.chassisMesh),this}setEngineForceDirection(t){this.state.engineForce=In*t,t===-1?(this.state.engineForce*=.9,this.materials.tailLightMaterial.emissive.setHSL(0,0,Un)):this.materials.tailLightMaterial.emissive.setHSL(0,0,0)}setBrakeForce(t){this.state.brakeForce=An*t,Gn.forEach(this.brakeWheel)}setSteeringDirection(t){this.state.steeringAngle=Rn*t}resetPosition(){this.chassisBody.position.copy(this.initialPosition),this.chassisBody.quaternion.copy(this.initialRotation),this.chassisBody.velocity.setZero(),this.chassisBody.angularVelocity.setZero()}}const{degToRad:Kt}=Lt,Yn=1/f.physicsFrameRate,Xt=new Pe("general"),Xn=new Pe("lowFriction"),Jn=new Jt(Xt,Xt,{friction:.001}),Qn=new Jt(Xt,Xn,{friction:0,contactEquationStiffness:1e8});f.fullscreen&&ro("Allow fullscreen?").then(e=>{e?document.documentElement.requestFullscreen():f.fullscreen=!1});(async function(){let t=!1,i;const o=new Li,n=new wi,s=new bi(16777215,16777215,1);s.color.setHSL(.6,.2,.7),s.groundColor.setHSL(.095,1,.75),n.add(s);const a=new oi,{x:h,y:l,z:d}=f.world.gravity;a.gravity.set(h,l,d),a.broadphase=new ni(a),a.defaultContactMaterial.friction=.001,a.addContactMaterial(Jn),a.addContactMaterial(Qn);const p=si(n,a,{onInit(m,S){Ie.add("renderWireFrame",L=>{S.visible=L})}}),c=new Ci({antialias:f.antialias,powerPreference:f.powerPreference});c.setPixelRatio(window.devicePixelRatio),c.setSize(window.innerWidth,window.innerHeight),c.shadowMap.enabled=f.renderShadows;const _=new go(c.domElement);if(c.domElement.tabIndex=-1,c.domElement.focus(),f.renderShadows)i=new vi({parent:n,camera:_.camera,cascades:3,maxFar:500,mode:"logarithmic",shadowMapSize:4096*2,lightIntensity:.25});else{const m=new zi(16118995,.5);m.position.set(-30,50,-30).normalize(),n.add(m)}const x=new Si(c),F=new Mi(n,_.camera),v=new Te(window.innerWidth,window.innerHeight),P=new Pi(v,n,_.camera);P.edgeStrength=2,P.visibleEdgeColor.setHex(15102720),P.hiddenEdgeColor.setHex(6697728),x.addPass(F),document.body.appendChild(c.domElement),window.onresize=Re(wt,500);const[O,Y,yt]=await jt(),z=new Zn(O,Y);z.addToWorld(a).addToScene(n),_.setCameraTarget(z),_.cameraMode=He.cinematic,_.camera.aspect=window.aspectRatio,_.camera.updateProjectionMatrix();const C=new No(n,a),b=new bn(C,z);b.initCheckpointHandler(n,{checkpoint:Zo(),finish:yt});const X=new Cn(n,_.camera,c.domElement,C),j=vn(_,C);n.add(j),Sn(b,c),C.onPlaceVehicle=(m=0,S=0,L=0,D=0,B=0,J=0)=>{z.initialPosition.set(m,S,L),z.initialRotation.setFromEuler(Kt(D),Kt(B),Kt(J)),z.resetPosition()},C.eventTriggerListeners.add(Z.setCameraPosition,({relatedTarget:m,dataSet:S})=>{if(m===z.chassisBody){const[L,D,B]=S.split(",");_.cameraPosition.set(Number(L),Number(D),Number(B))}}),C.eventTriggerListeners.add(Z.setCameraMode,({relatedTarget:m,dataSet:S})=>{if(m===z.chassisBody){const[L,D,B,J]=S.split(",");_.cameraMode=L,(D||B||J)&&_.cameraPosition.set(Number(D),Number(B),Number(J))}}),C.eventTriggerListeners.add(Z.startAnimation,({relatedTarget:m,dataSet:S})=>{if(m===z.chassisBody){const L=S,D=C.getBodyFromStore(L),{velocity_x:B,velocity_y:J,velocity_z:Je}=C.getAnimationPropsFromStore(L);D.velocity.set(B,J,Je)}}),C.eventTriggerListeners.add(Z.reset,({relatedTarget:m})=>{m===z.chassisBody&&b.reset()}),C.listeners.add(V.mapElementSelect,m=>{if(P.selectedObjects.length=0,j.detach(),m===et)P.selectedObjects.push(z.chassisMesh,...z.wheelMeshes);else if(m){const S=C.getMeshFromStore(m);P.selectedObjects.push(S),j.attach(S)}}),R.addKeyPressListener("KeyP",()=>{xt()}),R.addKeyPressListener("KeyO",()=>{console.log(_.camera.position.x,",",_.camera.position.y,",",_.camera.position.z)}),R.addKeyPressListener("KeyR",m=>{m.altKey?b.loadMap():b.respawnAtLastCheckpoint()}),R.addKeyPressListener("KeyC",()=>{_.switchMode()}),R.addKeyPressListener("KeyM",()=>{Ot()}),R.addKeyPressListener("Delete",()=>{C.editMode&&C.selectedMapElementId&&C.destroy(C.selectedMapElementId)}),R.addKeyDownChangeListener(m=>{let S=0,L=0;m.has("KeyW")||m.has("ArrowUp")?S=1:(m.has("KeyS")||m.has("ArrowDown"))&&(S=-1),m.has("KeyA")||m.has("ArrowLeft")?L=1:(m.has("KeyD")||m.has("ArrowRight"))&&(L=-1),!b.started&&S&&b.start(),z.setEngineForceDirection(S),z.setSteeringDirection(L),z.setBrakeForce(Number(m.has("Space")))}),b.loadMap();function Ot(){C.toggleEditMode(),C.editMode?(x.addPass(P),j.enabled=!0,X.enabled=!0,C.selectedMapElementId&&j.attach(C.getMeshFromStore(C.selectedMapElementId))):(x.passes.splice(1,1),j.detach(),j.enabled=!1,X.enabled=!1)}function xt(){t=!t,t?(o.stop(),c.setAnimationLoop(null),mt("paused"),b.started&&b.stop()):(o.start(),c.setAnimationLoop(ft),b.started&&b.start())}c.setAnimationLoop(ft);function ft(){const m=o.getDelta();_.update(m),b.updateHUD(),b.checkpointHandler.updateVisuals(m),i&&i.update(),x.render(),a.step(Yn,m),f.renderWireFrame&&p.update()}function wt(){_.camera.aspect=window.aspectRatio,_.camera.updateProjectionMatrix(),c.setSize(window.innerWidth,window.innerHeight),x.setSize(window.innerWidth,window.innerHeight),P.setSize(window.innerWidth,window.innerHeight)}async function jt(){const[m,S,L,D]=await Promise.all([bt("img/skybox.jpg","398 kB"),bt("3D_objects/lowPoly_car_wheel.gltf","205 kB"),bt("3D_objects/mg.glb","98 kB"),bt("img/pin.svg","0.9 kB")]),B=new Ei(Ii(m));return B.needsUpdate=!0,n.background=B,[L.scene,S.scene,Fi(D,{x:-6,y:-3,scale:.07})]}})();Object.defineProperty(window,"aspectRatio",{get(){return window.innerWidth/window.innerHeight}});export{qt as C,Ke as E,Ti as I,Xe as M,Z as T,je as a,T as b,f as c,Ho as d,Oi as e,Ro as f,$o as g,ss as h,Ao as i,et as j,Io as l,Et as m,N as n,Q as r,Ht as s,Ai as t,he as u,ji as v};
