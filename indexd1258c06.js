var ni=Object.defineProperty;var si=(e,t,i)=>t in e?ni(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var r=(e,t,i)=>(si(e,typeof t!="symbol"?t+"":t,i),i);import{V as w,t as ai,S as ri,B as qt,C as Ee,a as hi,b as Le,c as dt,d as Z,e as te,Q as he,R as pi,M as ke,W as li,f as ci,g as di}from"./vendor/cannon-f72e7d54.js";import{G as gi,g as _i,I as mi,h as Fe,M as Pt,E as ui,a as pt,d as xi,V as b,i as yi,O as fi,B as Te,C as wi,S as bi,j as Ae,k as zi,e as kt,l as Ci,m as Ie,n as xt,R as vi,o as Re,p as Si,q as Mi,H as Pi,W as Ei,r as Li,D as ki,s as Fi,t as Ti,u as Ai,v as Ii,w as Ri,A as Bi,x as Oi,y as ji,z as Di,J as Wi,K as Hi}from"./vendor/three-cf704d0e.js";import{j as g,r as m,a as ft}from"./vendor/react-6a63c5cb.js";import"./vendor/vendor-5e83183c.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();class lt{constructor(){r(this,"listeners",new Map)}add(t,i){if(!i)throw new Error(`EventListener->add($listener) Invalid $listener: ${i}, with type ${t}`);if(this.listeners.has(t))this.listeners.get(t).add(i);else{const o=new Set([i]);this.listeners.set(t,o)}}remove(t,i){if(this.listeners.has(t)){const o=this.listeners.get(t);o.delete(i),o.size||this.listeners.delete(t)}}clear(){this.listeners.clear()}dispatch(t,...i){this.listeners.has(t)&&this.listeners.get(t).forEach(n=>n(...i))}}const Be=["fullscreen","antialias","renderShadows","renderWireFrame","resolutionScale","audioVolume"],Ni={fullscreen:!1,antialias:!1,renderShadows:!1,renderWireFrame:!1,resolutionScale:1,audioVolume:.5,powerPreference:"high-performance",physicsFrameRate:120,world:{gravity:{x:0,y:-9.8,z:0}},camera:{fov:50,near:.1,far:1e3,initialPosition:{x:0,y:7,z:27},mountOffset_v3:[0,4,9],mountOffsetReverse_v3:[5,4,-9],lookOffset_v3:[0,1,-5]},vehicle:{mass:30,steeringSpeed:.02,maxSteeringAngle:.7,maxBrakeForce:22,maxEngineForce:220,torqueSplitRatio:[50,50],cameraMountPosition:{x:0,y:4,z:10},wheelRadius:.4,wheelSuspensionRestLength:.3,wheelSuspensionStiffness:25,wheelMaxSuspensionTravel:.3,wheelMaxSuspensionForce:Number.MAX_VALUE,wheelDampingCompression:2,wheelDampingRelaxation:2,wheelFrictionSlip:1.1,wheelForwardAcceleration:1/2,wheelSidedAcceleration:1,wheelRollInfluence:.6}},Ut=new lt,Wt=Be.reduce((e,t)=>{try{const i=window.localStorage.getItem(t);i&&(e[t]=JSON.parse(i))}catch(i){console.error(i)}return e},{}),f=new Proxy(Ni,{get(e,t){return Wt.hasOwnProperty(t)?Wt[t]:e[t]},set(e,t,i){if(Be.includes(t)){Wt[t]=i,Ut.dispatch(t,i);try{window.localStorage.setItem(t,String(i))}catch(o){console.error(o)}}return!0}});class Oe{constructor(t,i){r(this,"items");r(this,"activeCount",0);r(this,"itemProvider");r(this,"itemActivator");r(this,"itemDeactivator");r(this,"itemActiveCheck");r(this,"obtain",()=>{this.activeCount>=this.items.length&&this.items.push(this.itemProvider(this.items.length));const t=this.items[this.activeCount++];return this.itemActivator(t),t});r(this,"release",t=>{if(!this.itemActiveCheck(t))throw new Error(`ObjectPool->release($item) Not active $item: ${JSON.stringify(t)}`);if(this.activeCount--,this.itemDeactivator(t),!this.activeCount)return;const i=this.items.indexOf(t),o=this.items[this.activeCount];if(i<0)throw new Error(`ObjectPool->release($item) Not valid $item: ${JSON.stringify(t)}`);t!==o&&(this.items[this.activeCount]=this.items[i],this.items[i]=o)});r(this,"releaseAll",()=>{this.forActive(this.release)});r(this,"forActive",t=>{for(let i=this.activeCount-1;i>=0;i--)t.call(this,this.items[i])});this.itemProvider=i.itemProvider,this.itemActivator=i.itemActivator,this.itemDeactivator=i.itemDeactivator,this.itemActiveCheck=i.itemActiveCheck,this.items=Array.from({length:t}).map(this.itemProvider)}}const $i=function({label:e,id:t,children:i}){return e?g.jsxs("div",{className:"inputContainer",children:[g.jsx("label",{htmlFor:t,children:e}),i]}):g.jsx(g.Fragment,{children:i})};function V(){}function zt(e,t="?"){const i=e.split(".").pop(),o=fo(`Loading resource: ${e}`);let n;switch(i){case"jpg":n=new mi;break;case"svg":n=new _i;break;case"glb":case"gltf":n=new gi;break;default:return Promise.reject(new Error(`unknown resource type [${i}]`))}return new Promise((a,h)=>{const l=c=>{a(c),$e(o)},d=c=>{console.error(`Failed to load resource: ${e}`),h(c)};n.load(e,l,s,d)});function s({loaded:a,total:h,lengthComputable:l}){const d=l?`${pe(h,"k")} kB`:t;o.setContent(`Loading resource: ${e} (${pe(a,"k")} / ${d})`)}}function pe(e,t){let i=e;const o=["k","M","G","T"].indexOf(t)+1;for(let n=0;n<o;n++)i/=1024;return i.toFixed(2)}function Vi({paths:e},t={}){const i=new Fe,o={bevelEnabled:!1,depth:1};for(let p=0;p<e.length;p++){const _=e[p],y=new Pt({color:_.color}),k=_.toShapes(!1);for(let C=0;C<k.length;C++){const v=k[C],A=new ui(v,o),tt=new pt(A,y);i.add(tt)}}const{x:n,y:s,z:a}=new xi().setFromObject(i).getSize(new b),{x:h=0,y:l=0,z:d=0,scale:c=1}=t;return i.traverse(p=>{p.translateX(-n/2+h),p.translateY(-s/2+l),p.translateZ(-a/2+d)}),i.rotateY(Math.PI),i.rotateZ(Math.PI),i.scale.set(c,c,c),i}function Ki(e,t=1024){return[{x:2,y:1},{x:0,y:1},{x:1,y:0},{x:1,y:2},{x:1,y:1},{x:3,y:1}].map(o);function o({x:n,y:s}){const a=document.createElement("canvas");return a.width=t,a.height=t,a.getContext("2d").drawImage(e,-n*t,-s*t),a}}function je(e,t=200,i=!1){let o;return(...n)=>{i&&!o&&e(...n),clearTimeout(o),o=window.setTimeout(()=>{i?o=void 0:e(...n)},t)}}function qi(e,t=200){let i,o,n,s;return(...a)=>{s=o+t,n=performance.now(),!o||n>s?(e(...a),o=n):(window.clearTimeout(i),i=window.setTimeout(()=>{e(...a),o=n},t-(n-o)))}}const Ui=/Android|iPhone|iPad/i;function Gi(){return Ui.test(window.navigator.userAgent)}function ee(e){const t=Math.floor(e%1e3),i=Math.floor(e/1e3%60),o=Math.floor(e/6e4%60);return`${le(o)}:${le(i)}.${t}`}function le(e){const t=e.toString();return t.length<2?`0${e}`:t}function Zi(e){return`#${e.toString(16).toUpperCase()}`}function ws(e){return parseInt(e.replace("#",""),16)}function ot(e){return Math.round((e+Number.EPSILON)*100)/100}function Yi(e,t,i){return Math.max(t,Math.min(e,i))}function Xi(e,...t){return Object.keys(e).reduce((i,o)=>(t.includes(o)||(i[o]=e[o]),i),{})}function Ji(e,...t){return t.reduce((i,o)=>(e.hasOwnProperty(o)&&(i[o]=e[o]),i),{})}Object.defineProperties(Object,{omit:{value:Xi},pick:{value:Ji}});const Ft=document.createElement("datalist");Ft.id="colorValueList";document.documentElement.appendChild(Ft);function Qi(e){const t=document.createElement("option");t.textContent=Zi(e),Ft.appendChild(t)}class Gt extends m.Component{constructor(i){super(i);r(this,"inputRef",m.createRef());r(this,"onInputFieldChange",({currentTarget:i})=>{this.props.onInput&&this.props.onInput(i.value),this.setState({value:i.value})});r(this,"onInputFieldKeyUp",({key:i})=>{(i==="Enter"||i==="Escape")&&this.inputElement.blur()});r(this,"onInputFieldBlur",()=>{this.state.value!==this.props.value.toLowerCase()&&this.props.onChange(this.state.value,this.props.id)});this.state={value:i.value.toLowerCase()}}render(){const{id:i,label:o}=this.props,{value:n}=this.state;return g.jsx($i,{label:o,id:i,children:g.jsx("input",{type:"color",list:Ft.id,value:n,id:i,name:i,onChange:this.onInputFieldChange,onBlur:this.onInputFieldBlur,onKeyUp:this.onInputFieldKeyUp,ref:this.inputRef})})}componentDidUpdate(i){this.props.value!==i.value&&this.setState({value:this.props.value})}get inputElement(){return this.inputRef.current}}r(Gt,"defaultProps",{id:"",label:"",value:"",onChange:V}),r(Gt,"addColorValues",(...i)=>{i.forEach(Qi)});const to=new Set(["Space","PageUp","PageDown","End","Home","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Escape","Tab"]),eo=new Set(["KeyF","KeyH","KeyJ","KeyO","KeyP","KeyS"]),X=new Set;let ht;const Tt=new Set,At=new lt,j={addKeyPressListener:no,removeKeyPressListener:so,addKeyDownChangeListener:io,removeKeyDownChangeListener:oo,clearKeysDown:ao};function io(e){Tt.add(e)}function oo(e){Tt.delete(e)}function no(e,t){At.add(e,t)}function so(e,t){At.remove(e,t)}function ao(){X.clear(),Tt.forEach(We)}window.onkeydown=window.onkeyup=e=>{e.target.tagName==="INPUT"||e.target.tabIndex>-1||((to.has(e.code)||e.ctrlKey&&eo.has(e.code))&&e.preventDefault(),!(e.type==="keydown"&&e.repeat)&&(ht=e.code,e.type==="keyup"?(X.delete(ht),At.dispatch(ht,e)):X.add(ht),Zt()))};window.onbeforeunload=e=>{if(X.has("ControlLeft"))return e.preventDefault(),X.clear(),""};Et("topLeftPanel","Tab","⋮");Gi()&&(Ct("bottomLeftPanel","ArrowUp","▲"),Ct("bottomLeftPanel","ArrowDown","▼"),Ct("bottomRightPanel","ArrowLeft","◄"),Ct("bottomRightPanel","ArrowRight","►"),Et("topRightPanel","KeyP","p"),Et("topRightPanel","KeyC","c"),Et("topRightPanel","KeyR","⟲"));function De(e,t,i){const o=document.createElement("button");o.addEventListener("mousedown",t),o.addEventListener("touchstart",t),o.addEventListener("mouseup",i),o.addEventListener("mouseleave",i),o.addEventListener("touchcancel",i),o.addEventListener("touchend",i);const n=document.getElementById(e);return n.classList.remove("hidden"),n.appendChild(o)}function Et(e,t,i){const o=je(s=>{ht=t,At.dispatch(ht,s)},200,!0),n=De(e,o,V);n.textContent=i,n.id=t,n.classList.add("screenButton")}function Ct(e,t,i){const s=De(e,()=>{X.add(t),Zt()},()=>{X.delete(t),Zt()});s.textContent=i,s.id=t,s.classList.add("screenKey")}function Zt(){Tt.forEach(We)}function We(e){e(X)}const ro=`
    input:not([disabled]),
    textarea:not([disabled]),
    button:not([disabled]),
    select,
    [tabindex]
`,ho="⨯",I=document.createElement("aside");I.classList.add("hidden");I.id="modal__root";I.tabIndex=-1;document.body.appendChild(I);const po=function({onClose:e,children:t}){return g.jsxs("div",{className:"modal__container",children:[e&&g.jsx("span",{className:"modal__closeButton",onClick:e,children:ho}),t]})},He=function({onClose:e,children:t}){const i=document.activeElement;return m.useEffect(()=>(j.clearKeysDown(),I.classList.remove("hidden"),I.addEventListener("keydown",o),I.addEventListener("keyup",n),I.focus(),()=>{I.removeEventListener("keydown",o),I.removeEventListener("keyup",n),I.classList.add("hidden"),i.focus()}),[]),ft.createPortal(g.jsx(po,{onClose:e,children:t}),I);function o(a){a.stopPropagation(),a.key==="Tab"&&a.preventDefault()}function n(a){a.stopPropagation(),a.preventDefault(),e&&a.key==="Escape"?e():a.key==="Tab"&&s(a.shiftKey?-1:1)}function s(a){const h=lo(I);if(!h.length)return;const l=document.activeElement,d=h.indexOf(l),c=h.length-1;let p=d+a;p<0?p=c:p>c&&(p=0),h[p].focus()}};function lo(e){return[...e.querySelectorAll(ro)].filter(co)}function co(e){return e.tabIndex!==-1&&window.getComputedStyle(e).visibility!=="hidden"}const go={okButtonLabel:"Ok",cancelButtonLabel:"Cancel",importButtonLabel:"Import",exportButtonLabel:"Export",mapElementListLabel:"Map elements:",translatePanelLabel:"Translate",positionLabel:"position",rotationLabel:"rotation",transformPanelLabel:"Transform",widthLabel:"width:",heightLabel:"height:",lengthLabel:"length:",lengthTopLabel:"length top:",radiusLabel:"radius:",radiusTopLabel:"radius top:",radiusBottomLabel:"radius bottom:",sidesLabel:"sides:",segmentWidthLabel:"segment width:",segmentHeightLabel:"segment height:",segmentLengthLabel:"segment length:",segmentCountLabel:"segment count:",offsetLabel:"offset:",skewLabel:"skew:",angleLabel:"angle:",cloneButtonLabel:"clone",removeButtonLabel:"remove",createButtonLabel:"create",fullscreenSwitchLabel:"Fullscreen:",renderWireFrameSwitchLabel:"Render wireFrame:",resolutionScaleSliderLabel:"Resolution scale:",audioEnabled:"Audio enabled:",audioVolume:"Audio volume:",antialiasCheckboxLabel:"Antialias:",renderShadowsCheckboxLabel:"Render shadows:",applySettingsButtonLabel:"Apply settings"},ce=new Proxy(go,{get(e,t){return e[t]}});var N=(e=>(e.open="open",e.confirm="confirm",e.didMount="didMount",e.willUnmount="willUnmount",e))(N||{});const R=new lt,It=document.createElement("aside");It.id="menuModalControllerRoot";It.classList.add("hidden");document.body.appendChild(It);function _o(){ft.render(g.jsx(m.StrictMode,{children:g.jsx(mo,{})}),It)}function mo(){const[e,t]=m.useState(!0),i=m.useRef("");return m.useEffect(()=>(R.add("open",n),R.dispatch("didMount"),()=>{R.dispatch("willUnmount"),R.remove("open",n)}),[]),e?null:g.jsx(uo,{message:i.current,closeModal:o});function o(){t(!0)}function n(s=""){i.current=s,t(!1)}}function uo({message:e,closeModal:t}){const i=m.useRef();return m.useEffect(()=>{i.current.focus()},[]),g.jsxs(He,{children:[g.jsx("span",{className:"modal__body dialog__message",children:e}),g.jsxs("div",{className:"modal__footer dialog__buttonBar",children:[g.jsx("button",{className:"dialog__button",onClick:o,"data-confirm":"false",children:ce.cancelButtonLabel}),g.jsx("button",{className:"dialog__button",onClick:o,"data-confirm":"true",ref:i,children:ce.okButtonLabel})]})]});function o(n){const s=JSON.parse(n.currentTarget.dataset.confirm);R.dispatch("confirm",s),t()}}class xo{constructor(){r(this,"notificationElement",document.createElement("div"));r(this,"notificationElementBody",document.createElement("span"));this.notificationElement.classList.add("notificationElement","hidden"),this.notificationElement.appendChild(this.notificationElementBody)}get hidden(){return this.notificationElement.classList.contains("hidden")}show(){this.notificationElement.classList.remove("hidden")}fadeOut(){this.notificationElement.classList.add("fade-out")}hide(){this.notificationElement.classList.remove("fade-out"),this.notificationElement.classList.add("hidden")}setContent(t){this.notificationElementBody.textContent=t}}const yo=1500,Ne=1e3,ie=document.createElement("div");ie.id="notificationElementContainer";document.body.appendChild(ie);document.documentElement.style.setProperty("--fade-out-duration",`${Ne/1e3}s`);const oe=new Oe(1,{itemProvider(){return new xo},itemActiveCheck(e){return!e.hidden},itemActivator(e){e.show(),ie.appendChild(e.notificationElement)},itemDeactivator(e){e.hide()}});function fo(e){const t=oe.obtain();return t.setContent(e),t}function $e(e){e.fadeOut(),window.setTimeout(()=>{oe.release(e)},Ne)}function yt(e){const t=oe.obtain();t.setContent(e),window.setTimeout(()=>{$e(t)},yo)}let ne=!1;R.add(N.didMount,()=>{ne=!0});R.add(N.willUnmount,()=>{ne=!1});_o();function wo(e){if(ne)R.dispatch(N.open,e);else{const t=()=>{R.remove(N.didMount,t),R.dispatch(N.open,e)};R.add(N.didMount,t)}return new Promise(t=>{R.add(N.confirm,i);function i(o){R.remove(N.confirm,i),t(o)}})}var Ve=(e=>(e.cinematic="cinematic",e.free="free",e.chase="chase",e.hood="hood",e))(Ve||{});const Ht=["cinematic","free","chase","hood"],bo=new b(0,1,0),de=.2,zo=new b(...f.camera.mountOffset_v3),Co=new b(...f.camera.mountOffsetReverse_v3),vo=new b(...f.camera.lookOffset_v3);class So{constructor(t){r(this,"domElement");r(this,"camera");r(this,"orbitControls");r(this,"cameraTarget");r(this,"cameraPosition",new b);r(this,"currentCameraMode");r(this,"idealChaseCameraLookPosition",new b);r(this,"idealChaseCameraMountPosition",new b);r(this,"actualChaseCameraLookPosition",new b);r(this,"update",V);this.domElement=t,this.camera=new yi(f.camera.fov,window.aspectRatio,f.camera.near,f.camera.far),this.camera.position.set(f.camera.initialPosition.x,f.camera.initialPosition.y,f.camera.initialPosition.z),this.cameraPosition.copy(this.camera.position),this.orbitControls=new fi(this.camera,t),this.orbitControls.minDistance=1,this.orbitControls.enabled=!1}set cameraMode(t){if(this.currentCameraMode!==t){switch(this.currentCameraMode){case"cinematic":case"chase":this.update=V;break;case"hood":this.cameraTarget.chassisMesh.remove(this.camera),this.camera.position.copy(this.cameraTargetPosition),this.camera.position.y+=5,this.camera.fov=f.camera.fov,this.camera.updateProjectionMatrix();break;case"free":this.orbitControls.enabled=!1;break}switch(t){case"cinematic":this.update=this.updateDynamicCamera,yt('Camera mode is set to: "cinematic"');break;case"chase":this.update=this.updateChaseCamera,yt('Camera mode is set to: "chase"');break;case"hood":this.cameraTarget.chassisMesh.add(this.camera),this.camera.position.set(0,1.1,-.47),this.camera.rotation.set(0,0,0),this.camera.fov=60,this.camera.updateProjectionMatrix(),this.update=V,yt('Camera mode is set to: "hood"');break;case"free":this.orbitControls.enabled=!0,this.orbitControls.target.copy(this.cameraTargetPosition),yt('Camera mode is set to: "free" (use mouse to look around)');break}this.currentCameraMode=t}}get cameraTargetPosition(){return this.cameraTarget.chassisMesh.position}rotate(t){this.camera.rotateOnAxis(bo,t)}setIdealChaseCameraMountPosition(t){t?this.idealChaseCameraMountPosition.copy(Co):this.idealChaseCameraMountPosition.copy(zo),this.idealChaseCameraMountPosition.applyQuaternion(this.cameraTarget.chassisMesh.quaternion),this.idealChaseCameraMountPosition.add(this.cameraTargetPosition),this.idealChaseCameraMountPosition.y<this.cameraTargetPosition.y&&this.idealChaseCameraMountPosition.setY(this.cameraTargetPosition.y)}setIdealChaseCameraLookPosition(t){this.idealChaseCameraLookPosition.copy(vo),t&&(this.idealChaseCameraLookPosition.z*=-1),this.idealChaseCameraLookPosition.applyQuaternion(this.cameraTarget.chassisMesh.quaternion),this.idealChaseCameraLookPosition.add(this.cameraTargetPosition)}updateDynamicCamera(t){if(this.camera.position.manhattanDistanceTo(this.cameraPosition)>Number.EPSILON){const i=1-de**t;this.camera.position.lerp(this.cameraPosition,i)}this.camera.lookAt(this.cameraTargetPosition)}updateChaseCamera(t){const{currentVehicleSpeedKmHour:i}=this.cameraTarget.base,o=Math.round(-i)<-1,n=1-de**t;this.setIdealChaseCameraMountPosition(o),this.setIdealChaseCameraLookPosition(o),this.camera.position.lerp(this.idealChaseCameraMountPosition,n),this.actualChaseCameraLookPosition.lerp(this.idealChaseCameraLookPosition,n),this.camera.lookAt(this.actualChaseCameraLookPosition)}switchMode(){const t=Ht.indexOf(this.currentCameraMode),i=t<Ht.length-1?t+1:0,o=Ht[i];this.cameraMode=o}setCameraTarget(t){t!==this.cameraTarget&&(this.cameraTarget=t)}}const Mo="modulepreload",Po=function(e,t){return new URL(e,t).href},ge={},Ke=function(t,i,o){if(!i||i.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(i.map(s=>{if(s=Po(s,o),s in ge)return;ge[s]=!0;const a=s.endsWith(".css"),h=a?'[rel="stylesheet"]':"";if(!!o)for(let c=n.length-1;c>=0;c--){const p=n[c];if(p.href===s&&(!a||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${h}`))return;const d=document.createElement("link");if(d.rel=a?"stylesheet":Mo,a||(d.as="script",d.crossOrigin=""),d.href=s,document.head.appendChild(d),a)return new Promise((c,p)=>{d.addEventListener("load",c),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t())};function qe(){return g.jsx("div",{children:"Loading..."})}const ct=document.createElement("aside");ct.id="editorPanel";ct.classList.add("floatingPanel","hidden");document.body.appendChild(ct);const Eo={mapBuilder:void 0,mapElementProps:void 0,editorPanelVisible:!1},Ue=m.createContext(Eo);function Lo(e){ft.render(g.jsx(ko,{mapBuilder:e}),ct)}function ko({mapBuilder:e}){const[t,i]=m.useState(e.editMode),[o,n]=m.useState(e.selectedMapElementId),[s,a]=m.useState();m.useEffect(()=>(e.listeners.add(G.mapElementSelect,n),e.listeners.add(G.mapElementChange,a),e.listeners.add(G.editModeChange,i),()=>{e.listeners.remove(G.mapElementSelect,n),e.listeners.remove(G.mapElementChange,a),e.listeners.remove(G.editModeChange,i)}),[]),m.useEffect(()=>{a({...e.getPropsFromStore(o)})},[o]),m.useEffect(()=>{t?ct.classList.remove("hidden"):ct.classList.add("hidden")},[t]);const h={mapBuilder:e,mapElementProps:s,editorPanelVisible:t};return g.jsx(Ue.Provider,{value:h,children:g.jsx(Fo,{})})}function Fo(){const{editorPanelVisible:e}=m.useContext(Ue),t=m.lazy(()=>Ke(()=>import("./modules/EditorPanel-697be499.js"),["./modules\\EditorPanel-697be499.js","./vendor\\react-6a63c5cb.js","./vendor\\vendor-5e83183c.js","./modules\\Switch-67dd5044.js","./vendor\\cannon-f72e7d54.js","./vendor\\three-cf704d0e.js"],import.meta.url));return m.useMemo(()=>e?g.jsx(m.Suspense,{fallback:g.jsx(qe,{}),children:g.jsx(t,{})}):null,[e])}const gt=new w;function To(e,t){const i=new w,o=new w,n=new w,s=new w,{movement:{x:a=0,y:h=0,z:l=0},speed:d=1,triggerStart:c=!0,alternate:p=!0,alternateDelay:_=0}=JSON.parse(t),y=d*.05;return n.copy(e.position),s.set(a,h,l),s.vadd(e.position,s),s.vsub(n,gt),gt.normalize(),gt.scale(d,i),i.negate(o),{triggerStart:c,movementHandler:k,velocity_x:i.x,velocity_y:i.y,velocity_z:i.z};function k(){e.position.almostEquals(s,y)&&A(s)?(p?_?(e.velocity.setZero(),window.setTimeout(C,_*1e3)):C():e.velocity.setZero(),e.position.copy(s)):e.position.almostEquals(n,y)&&A(n)&&(_?(e.velocity.setZero(),window.setTimeout(v,_*1e3)):v(),e.position.copy(n))}function C(){e.velocity.copy(o)}function v(){e.velocity.copy(i)}function A(tt){return tt.vsub(e.position,gt),gt.dot(e.velocity)>0}}function vt({shape:e,width:t,height:i,length:o,lengthTop:n,radius:s,radiusTop:a,radiusBottom:h,sides:l,offset:d,skew:c}){switch(e){case T.box:return[Io(t,i,o),Ao(t,i,o)];case T.cylinder:return[Bo(a,h,i,l),Ro(a,h,i,l)];case T.sphere:return[jo(s),Oo(s)];case T.tetrahedron:{const p=Wo(t,i,o);return[p,_e(p)]}case T.triangularPrism:{const p=Ho(t,i,o,d);return[p,_e(p)]}case T.trapezoidalPrism:{const p=Do(t,i,n,o,c),_=new pt(p);return[ai(_,{type:ri.HULL}).shape,p]}default:return[]}}function Ao(e=2,t=2,i=2){return new Te(e,t,i)}function Io(e=2,t=2,i=2){return new qt(new w(e/2,t/2,i/2))}function Ro(e=1,t=1,i=2,o=6){return new wi(e,t,i,Math.max(3,o))}function Bo(e=1,t=1,i=2,o=6){return new Ee(e,t,i,Math.max(3,o))}function Oo(e=1){return new bi(e)}function jo(e=1){return new hi(e)}function Do(e=2,t=2,i=4,o=2,n=0){const s=e/2,a=t/2,h=i/2,l=o/2,d=new b(-l,-a,-s+n),c=new b(l,-a,-s-n),p=new b(h,a,-s-n),_=new b(-h,a,-s+n),y=new b(-l,-a,s+n),k=new b(l,-a,s-n),C=new b(h,a,s-n),v=new b(-h,a,s+n);return new Ae([d,c,p,_,y,k,C,v])}function _e(e){return new Ae(e.vertices.map(({x:t,y:i,z:o})=>new b(t,i,o)))}function Wo(e=1,t=1,i=1){const o=[new w(0,0,0),new w(e*2,0,0),new w(0,t*2,0),new w(0,0,i*2)],n=[[0,2,1],[1,2,3],[0,1,3],[3,2,0]];return new Le({vertices:o,faces:n})}function Ho(e=2,t=2,i=2,o=0){const n=e/2,s=t/2,a=i/2,h=[new w(n,s,o),new w(n,-s,-a),new w(n,-s,a),new w(-n,s,o),new w(-n,-s,-a),new w(-n,-s,a)],l=[[2,1,0],[4,5,3],[4,1,2,5],[3,0,1,4],[5,2,0,3]],d=$o(h,l);return new Le({vertices:h,faces:l,normals:d})}const me=new w,No=new w,nt=new w;new b;new b(0,0,1);function $o(e,t){return Vo(e),t.map(i=>{const o=e[i[0]],n=me.copy(e[i[1]]),s=No.copy(e[i[2]]);n.vsub(o,n),s.vsub(o,s);const a=new w().copy(n);a.cross(s,a).normalize();const h=me.copy(o);return o.vsub(nt,h),a.dot(h)<0&&a.negate(),a})}function Vo(e){const{length:t}=e;nt.set(0,0,0);for(let i=0;i<t;i++)nt.vadd(e[i],nt);nt.scale(1/t,nt)}const{degToRad:Ko,radToDeg:$}=kt,qo={segmentCount:13,segmentWidth:4,segmentHeight:.1,segmentLength:4,segmentPositionOffset:.4,radius:8},Uo={segmentCount:2,segmentWidth:2,segmentHeight:.4,segmentLength:4,angle:30},Go={segmentCount:10,segmentWidth:4,segmentHeight:.1,segmentLength:2,angle:30,radius:8},Zo=["loop","slopeTransition","cantedCurve"],Ge=new b,Y=new b,Yo=new b,ue=new b,x=new zi;function xe(e){switch(e.shape){case T.loop:return Xo(e);case T.slopeTransition:return Qo(e);case T.cantedCurve:return Jo(e);default:return[]}}function Xo(e){const{segmentCount:t,segmentWidth:i,segmentHeight:o,segmentLength:n,segmentPositionOffset:s,radius:a}=se(e,qo),h=[],l=Math.atan(a/(n/2)),d=Math.PI-2*l,c=Ge.set(1,0,0);for(let p=0;p<t;p++)Y.set(s*p,-a,0).applyAxisAngle(c,d*p),h.push({shape:T.box,width:i,height:o,length:n,position_x:Y.x,position_y:Y.y,position_z:Y.z,rotation_x:$(d*p)});return h}function Jo(e){const{segmentCount:t,segmentWidth:i,segmentHeight:o,segmentLength:n,angle:s,radius:a}=se(e,Go),h=[],l=Ge;l.set(0,1,0);const d=Ko(s),c=i/2,p=c*Math.cos(d),_=Math.sqrt(c**2-p**2),y=n/2,k=Math.atan((a-p)/y),C=Math.PI-2*k,v=Math.sqrt(n**2+i**2),A=Yo.set(y,_,-a+-p),wt=ue.copy(A).applyAxisAngle(l,C).sub(A).length(),et=(i+v+wt)/2,B=2*Math.sqrt(et*(et-i)*(et-v)*(et-wt))/i,H=i/2-(i-Math.sqrt(v**2-B**2)),jt=H*Math.cos(d),z=Math.sqrt(H**2-jt**2),P=ue.set(y+B,z,-a+-jt);P.applyAxisAngle(l,C);const bt=P.sub(A).length(),D=Math.acos((B**2+B**2-bt**2)/(2*B*B)),Dt=B/2*Math.sin(D);for(let K=0;K<t+1;K++)l.set(0,1,0),Y.set(0,0,-a).applyAxisAngle(l,C*K),x.position.copy(Y),x.rotation.set(0,C*K,Math.PI/2),x.rotateOnAxis(l,-d),x.translateZ(o/2),K<t&&h.push({shape:T.triangularPrism,width:o,height:n,length:i,offset:i/2,position_x:x.position.x,position_y:x.position.y,position_z:x.position.z,rotation_x:$(x.rotation.x),rotation_y:$(x.rotation.y),rotation_z:$(x.rotation.z)}),K&&(l.set(1,0,0),x.rotateOnAxis(l,Math.PI),x.translateY(n/2+B/2),l.set(0,0,1),x.rotateOnAxis(l,-D),x.translateX(Dt),x.translateY(0),h.push({shape:T.triangularPrism,width:o,height:B,length:i,offset:H,position_x:x.position.x,position_y:x.position.y,position_z:x.position.z,rotation_x:$(x.rotation.x),rotation_y:$(x.rotation.y),rotation_z:$(x.rotation.z)}));return h}function Qo(e){const{segmentCount:t,segmentWidth:i,segmentHeight:o,segmentLength:n}=se(e,Uo),s=[],a=.1,h=Math.atan(o/i);x.position.set(0,a,0),x.rotation.set(0,0,0);for(let l=0;l<t;l++)l&&(x.translateY(o),x.translateZ(-n)),x.rotation.set(0,0,-h*l),s.push({shape:T.tetrahedron,width:i/2,height:o/2,length:n/2,position_x:x.position.x,position_y:x.position.y,position_z:x.position.z,rotation_z:$(x.rotation.z)}),Y.copy(x.position),x.translateX(i/2),x.translateY(-a/2),x.translateZ(n/2),s.push({shape:T.box,width:i,height:a,length:n,position_x:x.position.x,position_y:x.position.y,position_z:x.position.z,rotation_z:$(x.rotation.z)}),x.position.copy(Y);return s}function se(e,t){return{...t,...e}}const{degToRad:F}=kt;var G=(e=>(e.mapElementChange="mapElementChange",e.mapElementSelect="mapElementSelect",e.editModeChange="editModeChange",e))(G||{}),J=(e=>(e.checkpoint="checkpoint",e.finish="finish",e.reset="reset",e.setCameraMode="setCameraMode",e.setCameraPosition="setCameraPosition",e.startAnimation="startAnimation",e))(J||{}),tn=(e=>(e.default="default",e.compound="compound",e.animated="animated",e.trigger="trigger",e.vehicle="vehicle",e))(tn||{}),T=(e=>(e.box="box",e.cylinder="cylinder",e.sphere="sphere",e.tetrahedron="tetrahedron",e.triangularPrism="triangularPrism",e.trapezoidalPrism="trapezoidalPrism",e.loop="loop",e.slopeTransition="slopeTransition",e.cantedCurve="cantedCurve",e))(T||{});const st="vehicle_0",ae=12303291,Ze=9814245,Ye=10463419,Xe=13464275,St=new Ci;let ye,fe,we=0;Gt.addColorValues(ae,Ze,Ye);class en{constructor(t,i){r(this,"scene");r(this,"world");r(this,"selectedMapElementId");r(this,"perviousSelectedMapElementId");r(this,"mapElementComponentStore",new Map);r(this,"mapElementIdStore",new Set);r(this,"listeners",new lt);r(this,"eventTriggerListeners",new lt);r(this,"editMode",!1);r(this,"onPlaceVehicle",V);r(this,"destroy",t=>{if(t===st)return;const i=this.getBodyFromStore(t),o=this.getMeshFromStore(t),{type:n}=this.getPropsFromStore(t);if(this.scene.remove(o),this.world.removeBody(i),this.world.removeEventListener("postStep",this.getUpdateMethodFromStore(t)),Yt(o)?o.children.forEach(be):be(o),n==="trigger"){const s=this.mapElementComponentStore.get(`${t}_listener`);i.removeEventListener(Z.COLLIDE_EVENT_NAME,s),this.mapElementComponentStore.delete(`${t}_listener`)}if(n==="animated"){const s=this.getAnimationPropsFromStore(t);this.world.removeEventListener("preStep",s.movementHandler),this.mapElementComponentStore.delete(`${t}_animationProps`)}this.mapElementIdStore.delete(t),this.mapElementComponentStore.delete(`${t}_mesh`),this.mapElementComponentStore.delete(`${t}_body`),this.mapElementComponentStore.delete(`${t}_updateMethod`),this.mapElementComponentStore.delete(`${t}_props`),this.selectedMapElementId===t&&(this.selectedMapElementId=void 0,this.listeners.dispatch("mapElementSelect",void 0)),this.perviousSelectedMapElementId===t&&(this.perviousSelectedMapElementId=void 0)});r(this,"selectMapElement",t=>{this.selectedMapElementId&&(this.perviousSelectedMapElementId=this.selectedMapElementId),this.selectedMapElementId=t,this.listeners.dispatch("mapElementSelect",this.selectedMapElementId)});r(this,"resetElementIfDynamic",t=>{const{type:i,mass:o,position_x:n=0,position_y:s=0,position_z:a=0,rotation_x:h=0,rotation_y:l=0,rotation_z:d=0}=this.getPropsFromStore(t);if(i==="vehicle"){this.onPlaceVehicle(n,s,a,h,l,d);return}if(!o&&i!=="animated")return;const c=this.getBodyFromStore(t);if(i==="animated"){const{triggerStart:p,velocity_x:_,velocity_y:y,velocity_z:k}=this.getAnimationPropsFromStore(t);p?c.velocity.setZero():c.velocity.set(_,y,k)}else c.velocity.setZero(),c.angularVelocity.setZero();c.position.set(n,s,a),c.quaternion.setFromEuler(F(h),F(l),F(d))});r(this,"importMap",t=>{this.mapElementIdStore.forEach(this.destroy),we=0,t.forEach(i=>{i.type==="vehicle"?this.placeVehicle({...i}):this.build({...i})})});r(this,"exportMap",()=>({meta:{},elements:Array.from(this.mapElementComponentStore.entries()).filter(([t])=>t.endsWith("props")).map(([,t])=>t)}));this.scene=t,this.world=i;const n=Object.values(i.contactMaterialTable.data).filter(nn).reduce((s,a)=>{const[h,l]=a.materials;return s.set(h.name,h),s.set(l.name,l),s},new Map);fe=n.get("general"),ye=n.get("lowFriction"),Lo(this)}get mapElementIdList(){return Array.from(this.mapElementIdStore)}getBodyFromStore(t){return this.mapElementComponentStore.get(`${t}_body`)}getMeshFromStore(t){return this.mapElementComponentStore.get(`${t}_mesh`)}getPropsFromStore(t){return this.mapElementComponentStore.get(`${t}_props`)}getUpdateMethodFromStore(t){return this.mapElementComponentStore.get(`${t}_updateMethod`)}getAnimationPropsFromStore(t){return this.mapElementComponentStore.get(`${t}_animationProps`)}addToWorld(t,i,o){const n=`${o.type||o.shape}_${we++}`,{type:s,mass:a=0,position_x:h=0,position_y:l=0,position_z:d=0,rotation_x:c=0,rotation_y:p=0,rotation_z:_=0,fixedRotation:y=!1}=o,k=()=>{i.position.copy(t.position),i.quaternion.copy(t.quaternion)};if(t.position.set(h,l,d),i.position.copy(t.position),i.name=n,(c||p||_)&&(t.quaternion.setFromEuler(F(c),F(p),F(_)),i.quaternion.copy(t.quaternion)),y&&(t.fixedRotation=!0,t.updateMassProperties()),this.world.addBody(t),this.scene.add(i),s==="animated"){const C=To(t,o.dataSet);t.type=dt.KINEMATIC,C.triggerStart||t.velocity.set(C.velocity_x,C.velocity_y,C.velocity_z),this.mapElementComponentStore.set(`${n}_animationProps`,C),this.world.addEventListener("preStep",C.movementHandler)}return(a||s==="animated")&&this.world.addEventListener("postStep",k),t.aabbNeedsUpdate=!0,this.mapElementIdStore.add(n),this.mapElementComponentStore.set(`${n}_mesh`,i),this.mapElementComponentStore.set(`${n}_body`,t),this.mapElementComponentStore.set(`${n}_props`,o),this.mapElementComponentStore.set(`${n}_updateMethod`,k),this.editMode&&this.selectMapElement(n),n}toggleEditMode(){this.editMode=!this.editMode,this.editMode?this.mapElementIdList.forEach(t=>{this.setEventTriggerVisibility(t,!0)}):this.mapElementIdList.forEach(t=>{this.setEventTriggerVisibility(t,!1)}),this.listeners.dispatch("editModeChange",this.editMode)}clone(t){return this.build({...this.getPropsFromStore(t)})}build(t){const i=new Ie({color:on(t)}),o=t.lowFriction?ye:fe,n=new Z({mass:t.mass,material:o});let s;if(Zo.includes(t.shape)&&!t.type&&(t.type="compound"),t.type==="compound")s=new Fe,xe(t).forEach(h=>{const[l,d]=vt(h),c=new pt(d,i);f.renderShadows&&(c.castShadow=!0,c.receiveShadow=!0),St.set(F(h.rotation_x||0),F(h.rotation_y||0),F(h.rotation_z||0)),c.quaternion.setFromEuler(St),c.position.set(h.position_x,h.position_y,h.position_z),s.add(c),n.addShape(l,c.position,c.quaternion)});else{const[h,l]=vt(t);n.addShape(h),s=new pt(l,i),f.renderShadows&&(s.castShadow=!0,s.receiveShadow=!0)}const a=this.addToWorld(n,s,t);return t.type==="trigger"&&this.setUpEventTrigger(a,t),a}setUpEventTrigger(t,i){const{event:o="setCameraPosition",dataSet:n="0,0,0"}=i,s=this.getBodyFromStore(t),a=this.getMeshFromStore(t),h=this.mapElementComponentStore.get(`${t}_listener`),l=({target:d,body:c})=>{this.eventTriggerListeners.dispatch(o,{target:d,dataSet:n,relatedTarget:c})};h&&s.removeEventListener(Z.COLLIDE_EVENT_NAME,h),this.mapElementComponentStore.set(`${t}_listener`,l),s.collisionResponse=!1,s.addEventListener(Z.COLLIDE_EVENT_NAME,l),Nt(a,Xe,.3),a.castShadow=!1,a.receiveShadow=!1,this.editMode||(a.visible=!1)}convertEventTriggerToDefaultElement(t){const i=this.getBodyFromStore(t),o=this.getMeshFromStore(t),n=this.mapElementComponentStore.get(`${t}_listener`);i.removeEventListener(Z.COLLIDE_EVENT_NAME,n),this.mapElementComponentStore.delete(`${t}_listener`),i.collisionResponse=!0,Nt(o,ae,1)}placeVehicle(t){const{position_x:i,position_y:o,position_z:n,rotation_x:s,rotation_y:a,rotation_z:h}=t;this.mapElementIdStore.add(st),this.mapElementComponentStore.set(`${st}_props`,{...t}),this.mapElementComponentStore.set(`${st}_updateMethod`,()=>{const{position_x:l,position_y:d,position_z:c,rotation_x:p,rotation_y:_,rotation_z:y}=this.getPropsFromStore(st);this.onPlaceVehicle(l,d,c,p,_,y)}),this.onPlaceVehicle(i,o,n,s,a,h)}setEventTriggerVisibility(t,i=!1){if(t.startsWith("trigger")){const o=this.getMeshFromStore(t);o.visible=i}}resetDynamicMapElements(){this.mapElementIdList.forEach(this.resetElementIfDynamic)}translate(t,i){const o=this.getBodyFromStore(t),n=this.getPropsFromStore(t),s=this.getUpdateMethodFromStore(t);if(Object.assign(n,{...i}),o){const{position_x:a=0,position_y:h=0,position_z:l=0,rotation_x:d=0,rotation_y:c=0,rotation_z:p=0}=n;o.position.set(a,h,l),o.quaternion.setFromEuler(F(d),F(c),F(p)),o.aabbNeedsUpdate=!0}s(),this.listeners.dispatch("mapElementChange",{...n})}transform(t,i){const o=this.getMeshFromStore(t),n=this.getBodyFromStore(t),s=this.getPropsFromStore(t);if(Object.assign(s,{...i}),n.shapes.length=0,n.shapeOffsets.length=0,n.shapeOrientations.length=0,Yt(o)){const a=xe(s),h=a.length,l=Math.max(0,o.children.length-h);for(let d=0;d<l;d++){const c=o.children.length-1,p=o.children[c];p.geometry.dispose(),o.remove(p)}for(let d=0;d<h;d++){const c=a[d],[p,_]=vt(c);let y=o.children[d];y?y.geometry.dispose():(y=new pt,y.material=o.children[0].material,o.add(y)),St.set(F(c.rotation_x||0),F(c.rotation_y||0),F(c.rotation_z||0)),y.quaternion.setFromEuler(St),y.position.set(c.position_x,c.position_y,c.position_z),y.geometry=_,n.addShape(p,y.position,y.quaternion)}}else{const[a,h]=vt(s);n.addShape(a),o.geometry.dispose(),o.geometry=h}this.listeners.dispatch("mapElementChange",{...s})}setAttribute(t,i){const o=this.getPropsFromStore(t),n=this.getBodyFromStore(t),s=o.type;if(Object.assign(o,{...i}),"color"in i&&Nt(this.getMeshFromStore(t),i.color),s==="trigger"&&i.type==="default"?this.convertEventTriggerToDefaultElement(t):("type"in i||"event"in i||"dataSet"in i)&&(this.setUpEventTrigger(t,o),o.mass&&(i.mass=0)),"mass"in i){const a=this.getUpdateMethodFromStore(t);n.mass=i.mass,n.updateMassProperties(),n.velocity.set(0,0,0),n.angularVelocity.set(0,0,0),i.mass>0&&n.type===dt.STATIC?(n.type=dt.DYNAMIC,this.world.addEventListener("postStep",a)):!i.mass&&n.type===dt.DYNAMIC&&(n.type=dt.STATIC,this.world.removeEventListener("postStep",a))}this.listeners.dispatch("mapElementChange",{...o})}}function be(e){e.geometry.dispose(),e.material.dispose()}function Nt(e,t,i){const o=Yt(e)?e.children[0].material:e.material;t&&o.color.set(t),i&&(o.transparent=i<1,o.opacity=i)}function on(e){return e.type==="trigger"?Xe:e.type==="animated"?Ye:e.color?e.color:e.mass?Ze:ae}function Yt(e){return!!e.children.length}function nn(e){return e instanceof te}const sn=/checkpointCount:\w*(\d+)/i,an=Math.PI*2,rn=.02;let Je=0,Qe=0;class hn{constructor(t,i){r(this,"activeCheckpoints",new Set);r(this,"checkpointIconToElementLinks",new Map);r(this,"checkpointIcon3dPool");r(this,"finishIcon3d");r(this,"gameProgress");r(this,"scene");r(this,"checkpointEventHandler",({target:t,relatedTarget:i})=>{if(i===this.gameProgress.vehicle.chassisBody&&this.activeCheckpoints.has(t)){this.gameProgress.checkpointReached(t);const o=this.checkpointIconToElementLinks.get(t);this.checkpointIcon3dPool.release(o),this.activeCheckpoints.delete(t)}});r(this,"finishEventHandler",({target:t,relatedTarget:i,dataSet:o})=>{i===this.gameProgress.vehicle.chassisBody&&ln(o)===this.gameProgress.checkpointsReached&&(this.gameProgress.stop(),this.gameProgress.openModal())});this.scene=t,this.finishIcon3d=i.finish,this.checkpointIcon3dPool=new Oe(1,{itemProvider(){return i.checkpoint.clone()},itemActiveCheck(o){return o.visible},itemActivator(o){o.visible=!0},itemDeactivator(o){o.visible=!1}}),this.scene.add(this.finishIcon3d)}init(t,i){this.gameProgress=i,t.eventTriggerListeners.add(J.checkpoint,this.checkpointEventHandler),t.eventTriggerListeners.add(J.finish,this.finishEventHandler),this.checkpointIcon3dPool.activeCount&&this.checkpointIcon3dPool.releaseAll(),this.activeCheckpoints.size&&this.activeCheckpoints.clear(),t.mapElementIdList.forEach(o=>{if(o.startsWith("trigger")){const{event:n}=t.getPropsFromStore(o);n==="checkpoint"?this.setActiveCheckpoint(t.getBodyFromStore(o)):n==="finish"&&this.setFinish(t.getBodyFromStore(o))}})}setActiveCheckpoint(t){const i=this.checkpointIcon3dPool.obtain();i.position.copy(t.position),this.activeCheckpoints.add(t),this.checkpointIconToElementLinks.set(t,i),this.scene.add(i)}setFinish(t){this.finishIcon3d.position.copy(t.position)}updateVisuals(t){Je=Math.sin(t/1e3)/500,Qe=.5*Math.sin(t/500)*.005,this.checkpointIcon3dPool.forActive(ze),ze(this.finishIcon3d)}}function pn(){const e=new pt(new Te(.8,.8,.8),new xt({color:0,specular:6710886,emissive:43520,shininess:10,transparent:!0,opacity:.6}));return e.rotation.set(Math.PI/4,0,Math.PI/4),e}function ze(e){const t=e.rotation.y+rn;e.rotation.y=t>=an?0:t,e.position.y+=Je,e.material&&e.material.emissive.offsetHSL(0,0,Qe)}function ln(e){const[,t]=e.match(sn)||[];return t?Number(t):0}class cn{constructor(){r(this,"started",!1);r(this,"stopped",!1);r(this,"startTime",0);r(this,"stopTime",0);r(this,"relativeStopTime",0)}get time(){return this.stopped?this.relativeStopTime:performance.now()-this.startTime}start(){this.started=!0,this.stopped?this.startTime+=performance.now()-this.stopTime:this.startTime=performance.now(),this.stopped=!1}stop(){this.relativeStopTime=this.time,this.stopTime=performance.now(),this.stopped=!0}reset(){this.started=!1,this.stopped=!1,this.startTime=0}add(t){this.startTime-=t}}const dn={meta:{author:""},elements:[{type:"vehicle",position_y:1},{shape:"box",width:5,length:5,height:.2,position_y:-.1},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_x:3,position_y:1}]},gn={meta:{author:"",goals:{time:11e3,respawnCount:0},next:"i02"},elements:[{type:"vehicle",position_y:1},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"chase",radius:3,position_y:1},{shape:"box",width:10,length:10,height:.2,position_y:-.1},{type:"trigger",shape:"sphere",event:"finish",dataSet:"checkpointCount:1",radius:1,position_x:30,position_y:1},{shape:"box",width:10,length:20,height:.2,position_y:-.1,position_z:-15},{shape:"box",width:20,length:10,height:.2,position_y:-.1,position_x:15},{shape:"box",width:20,length:10,height:.2,position_y:-.1,position_z:-30},{shape:"box",width:10,length:20,height:.2,position_y:-.1,position_x:30},{shape:"box",width:4,length:10,height:.2,position_y:-.1,position_x:37},{shape:"box",width:10,length:4,height:.2,position_y:-.1,position_z:-37},{type:"trigger",shape:"sphere",event:"checkpoint",dataSet:"",radius:1,position_y:1,position_z:-30,rotation_y:180}]},_n={meta:{author:"",goals:{time:11e3,respawnCount:0},next:"i03"},elements:[{type:"vehicle",position_y:1},{shape:"box",width:10,length:20,height:.2,position_y:-.1,position_x:0,position_z:-5,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"chase",radius:3,position_y:1},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_x:-26,position_y:4.66,position_z:0,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"box",width:10,length:10,height:.2,position_y:-.54,position_x:0,position_z:-19.96,rotation_x:-5,rotation_y:0,rotation_z:0},{shape:"box",width:10,length:10,height:.2,position_y:-1.85,position_x:0,position_z:-29.85,rotation_x:-10,rotation_y:0,rotation_z:0},{shape:"box",width:10,length:10,height:.2,position_y:-3.15,position_x:0,position_z:-39.74,rotation_x:-5,rotation_y:0,rotation_z:0},{shape:"box",width:10,length:10.3,height:.2,position_y:-3.59,position_x:0,position_z:-49.86,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"box",width:14,length:14,height:.2,position_y:-3.59,position_x:-3,position_z:-62,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"box",width:20,length:4,height:.2,position_y:-3.59,position_x:-13,position_z:-71,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"box",width:14,length:14,height:.2,position_y:-3.59,position_x:-23,position_z:-62,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"box",width:6,length:10,height:.2,position_y:-3.59,position_x:-13,position_z:-64,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"box",width:10,length:20,height:.2,position_y:-3.59,position_x:-26,position_z:-45,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"box",width:10,length:10,height:.2,position_y:-2.72,position_x:-26,position_z:-30.09,rotation_x:-10,rotation_y:0,rotation_z:0},{shape:"box",width:10,length:10,height:.2,position_y:-.15,position_x:-26,position_z:-20.49,rotation_x:-20,rotation_y:0,rotation_z:0},{shape:"box",width:10,length:10,height:.2,position_y:2.42,position_x:-26,position_z:-10.89,rotation_x:-10,rotation_y:0,rotation_z:0},{shape:"box",width:10,length:10,height:.2,position_y:3.28,position_x:-26,position_z:-.99,rotation_x:0,rotation_y:0,rotation_z:0}]},mn={meta:{author:"",goals:{time:3e4,respawnCount:0},next:"o01"},elements:[{type:"vehicle",position_y:1,position_z:8},{shape:"box",width:22,length:32,height:.2,position_y:-.1},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_x:-8,position_y:5,position_z:0},{shape:"box",width:6,height:4,length:5,position_x:0,position_y:2,position_z:.5,color:"#95c0e5",fixedRotation:!0,mass:20},{shape:"box",width:8,height:4,length:5,position_x:-7,position_y:2,position_z:.5,lowFriction:!0},{shape:"box",width:8,height:4,length:5,position_x:7,position_y:2,position_z:.5,lowFriction:!0},{shape:"box",width:5,height:2,length:14,position_x:8.5,position_y:1,position_z:-9},{shape:"triangularPrism",position_x:8.5,position_y:3,position_z:-5,offset:3,height:2,width:5,length:6},{shape:"triangularPrism",position_x:4,position_y:1,position_z:-13.5,rotation_y:90,offset:2,height:2,width:5,length:4},{shape:"box",position_x:3.1,position_y:3.9,position_z:-6.5,length:9,width:.2,height:.2,color:"#757575",lowFriction:!0},{shape:"box",position_x:-3.1,position_y:3.9,position_z:-6.5,length:9,width:.2,height:.2,color:"#757575",lowFriction:!0},{shape:"box",position_x:0,position_y:3.9,position_z:-10.9,length:.2,width:6,height:.2,color:"#757575",lowFriction:!0}]},un={meta:{author:"",goals:{time:4e4,respawnCount:0},next:"o02"},elements:[{type:"vehicle",position_x:10,position_y:1,position_z:10,rotation_y:90},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"cinematic,25,11,25",radius:3,position_x:10,position_y:1,position_z:10},{shape:"box",width:30,height:.2,length:34,position_x:6,position_z:2},{shape:"triangularPrism",position_x:-3,position_y:1.1,position_z:-3,rotation_x:0,rotation_y:0,rotation_z:0,length:4,width:4,offset:-2},{shape:"triangularPrism",position_x:-3,position_y:4.1,position_z:-7,rotation_x:0,rotation_y:0,rotation_z:0,length:4,width:4,offset:-2,height:4},{shape:"box",width:4,height:.2,length:6,position_x:-3,position_y:10,position_z:-18},{shape:"box",width:4,height:.2,length:30,position_x:-3,position_y:5,position_z:-25,rotation_x:15},{shape:"box",width:4,height:5.4,length:2,position_x:-7,position_y:2.6,position_z:-9},{shape:"box",width:4,height:11.8,length:2,position_x:1,position_y:5.9,position_z:-9},{shape:"box",mass:40,position_x:11,position_y:3.1,position_z:-6,width:4,height:4,length:4},{shape:"cylinder",sides:4,radiusBottom:13,height:1,position_x:9,position_y:.6,position_z:-4,rotation_y:45,radiusTop:10},{shape:"cylinder",radiusTop:2,radiusBottom:2,height:4,mass:20,sides:20,position_x:-3,position_y:15,position_z:-27,rotation_z:90},{shape:"box",width:.2,height:1,length:10,position_x:-5.1,position_y:11.3,position_z:-33,lowFriction:!0},{shape:"box",width:.2,height:1,length:14,position_x:-.9,position_y:11.3,position_z:-31,lowFriction:!0},{shape:"box",width:.2,height:1,length:30,position_x:-.9,position_y:5.5,position_z:-25,rotation_x:15,lowFriction:!0},{shape:"box",width:.2,height:1,length:30,position_x:-5.1,position_y:5.5,position_z:-25,rotation_x:15,lowFriction:!0},{shape:"box",width:8.2,height:.2,length:4,position_x:-8.92,position_y:9.65,position_z:-26,rotation_z:14.8},{shape:"box",width:4,height:.2,length:2.4,position_x:-7,position_y:5.2,position_z:-11.2},{shape:"triangularPrism",position_x:-7,position_y:8.6,position_z:-9,rotation_x:-90,rotation_y:-90,rotation_z:0,length:4,width:6.6,offset:-2,height:2},{shape:"box",width:4,height:.2,length:4.4,position_x:-10.95,position_y:5.55,position_z:-10.2,rotation_z:-10},{shape:"box",width:4,height:.2,length:4,position_x:-14.9,position_y:5.9,position_z:-10},{shape:"box",width:4,height:.2,length:12.4,position_x:-14.9,position_y:7.25,position_z:-17.98,rotation_x:12.55},{shape:"box",width:4.1,height:.2,length:4,position_x:-14.85,position_y:8.6,position_z:-26},{shape:"box",width:4,height:.2,length:2.4,position_x:1,position_y:5.2,position_z:-11.2},{shape:"box",width:4,height:.2,length:3.3,position_x:-3,position_y:10.35,position_z:-22.33,rotation_x:12.5},{shape:"box",width:4,height:.2,length:5,position_x:-3,position_y:10.7,position_z:-26.4},{shape:"box",width:.2,height:2,length:14,position_x:-.9,position_y:10.8,position_z:-17},{shape:"box",width:4,height:.2,length:4.4,position_x:5,position_y:5.2,position_z:-10.2},{shape:"box",width:4,height:4,length:3.8,position_x:5,position_y:3.1,position_z:-1.9},{shape:"box",width:4,height:.2,length:.2,position_x:9,position_z:-3.9,position_y:1.2,lowFriction:!0},{shape:"box",width:4,height:4,length:.2,position_x:5,position_z:-3.9,position_y:3.1,lowFriction:!0},{shape:"box",width:8,height:.2,length:.2,position_x:7,position_z:-8.1,position_y:1.2,lowFriction:!0},{shape:"box",width:.2,height:.2,length:4,position_x:2.9,position_z:-6,position_y:1.2},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"34,11,4.5",radius:7,position_x:14,position_y:1},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-3,9,29",radius:7,position_x:-2,position_y:1,position_z:8},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-30,16,-3",radius:3,position_x:-3,position_y:12,position_z:-21},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-30,22,-29",radius:3,position_x:-15,position_y:9,position_z:-22,rotation_x:0,rotation_y:0,rotation_z:0},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-27,14,-13",radius:2,position_x:-9,position_y:6,position_z:-10},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"9.5,10,-25",radius:2,position_x:1,position_y:6,position_z:-11},{type:"trigger",shape:"sphere",event:"checkpoint",dataSet:"-30,22,-29",radius:1,position_x:-15,position_y:9.7,position_z:-26.19,rotation_x:0,rotation_y:180,rotation_z:0},{type:"trigger",shape:"sphere",event:"finish",dataSet:"checkpointCount:1",radius:1,position_x:5,position_y:6,position_z:-2}]},xn={meta:{author:"",goals:{time:35e3,respawnCount:0},next:"o03"},elements:[{type:"vehicle",position_x:10,position_y:1,position_z:10,rotation_y:90},{shape:"box",width:12,height:.2,length:10,position_x:8,position_z:10},{shape:"triangularPrism",width:4,length:4,offset:-2,position_x:8,position_y:1,position_z:7},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"39,13,-6",radius:3,position_x:13,position_y:1,position_z:10},{type:"animated",shape:"box",width:6,height:.2,length:6,position_x:-1,position_z:10,dataSet:'{ "movement": { "y": -17 }, "alternateDelay": 3, "triggerStart": true }'},{shape:"box",width:1,height:18,length:.2,position_x:-3,position_y:-8.1,position_z:6.9},{shape:"box",width:1,height:18,length:.2,position_x:1,position_y:-8.1,position_z:6.9},{shape:"box",width:1,height:18,length:.2,position_x:1,position_y:-8.1,position_z:13.1},{shape:"box",width:1,height:18,length:.2,position_x:-3,position_y:-8.1,position_z:13.1},{shape:"box",width:.2,height:18,length:.6,position_x:-4.1,position_y:-8.1,position_z:12},{shape:"box",width:.2,height:18,length:.6,position_x:-4.1,position_y:-8.1,position_z:8},{shape:"box",width:12,height:.2,length:10,position_x:8,position_z:10,position_y:-17},{shape:"box",width:.2,height:14,length:6,position_x:2.1,position_y:-7.1,position_z:10,color:12895428},{shape:"box",width:12,height:.2,length:10,position_x:8,position_z:21},{shape:"box",width:4,height:10,length:.6,position_x:8,position_z:15.5,position_y:-1,mass:40,lowFriction:!0,fixedRotation:!0},{shape:"box",width:4,height:14,length:1,position_x:4,position_z:15.5,position_y:-3},{shape:"box",width:4,height:14,length:1,position_x:12,position_z:15.5,position_y:-3},{shape:"box",width:1,height:1,length:2,position_x:8,position_z:15.5,position_y:-6.5,mass:10,lowFriction:!0,fixedRotation:!0},{shape:"box",width:2,height:1,length:3,position_x:8,position_z:13.5,position_y:-7.5},{shape:"box",width:2,height:1,length:2,position_x:8,position_z:17,position_y:-7.5},{shape:"box",width:2,height:1,length:2,position_x:8,position_z:17,position_y:-5.5},{shape:"box",width:.5,height:1,length:2,position_x:7.25,position_z:17,position_y:-6.5},{shape:"box",width:.5,height:1,length:2,position_x:8.75,position_z:17,position_y:-6.5},{shape:"box",width:10,height:.2,length:8,position_x:9,position_z:9,position_y:-8},{shape:"box",width:4,height:6,length:.2,position_x:8,position_z:15.1,position_y:-3},{shape:"box",width:4,height:6,length:.2,position_x:8,position_z:15.9,position_y:-3},{shape:"box",width:.5,height:1,length:3,position_x:8.75,position_z:13.5,position_y:-6.5},{shape:"box",width:.5,height:1,length:3,position_x:7.25,position_z:13.5,position_y:-6.5},{shape:"box",width:5,height:2,length:1,position_x:4.5,position_z:15.5,position_y:-11},{shape:"box",width:5,height:2,length:1,position_x:11.5,position_z:15.5,position_y:-11},{shape:"box",width:12,height:5,length:1,position_x:8,position_z:15.5,position_y:-14.5},{shape:"sphere",radius:.5,position_x:8,position_z:14,position_y:-6.5,mass:1},{shape:"box",width:2,height:1,length:3,position_x:8,position_y:-5.5,position_z:13.5},{shape:"box",width:1,height:1,length:3,position_x:8,position_z:11.75,position_y:-6.5,mass:10,fixedRotation:!0},{shape:"box",width:4,height:.2,length:4,position_x:16,position_z:7,position_y:-17},{shape:"box",width:8,height:.2,length:4,position_x:18,position_z:7,position_y:-8},{shape:"box",width:4,height:.2,length:26,position_x:20,position_z:21.75,position_y:-10.25,rotation_x:10},{shape:"box",width:4,height:.2,length:26,position_x:16,position_z:21.6,position_y:-14.75,rotation_x:-10},{shape:"box",width:8,height:.2,length:4,position_x:18,position_z:36.35,position_y:-12.5},{shape:"box",width:4,height:.2,length:26,position_x:16,position_z:21.6,position_y:-5.76,rotation_x:-10},{shape:"box",width:4,height:.2,length:4,position_x:16,position_z:36.35,position_y:-3.5},{shape:"box",width:2,height:3,length:1,position_x:8,position_y:-6.5,position_z:18.5},{shape:"box",width:4,height:.2,length:4,position_x:4,position_z:36.35,position_y:-2},{shape:"box",width:4,height:.2,length:8.8,position_x:4,position_z:30.2,position_y:-1,rotation_x:13.4},{shape:"box",width:8.2,height:.2,length:4,position_x:10,position_z:36.35,position_y:-2.75,rotation_z:-10.5},{shape:"box",width:.2,height:4,length:.2,position_x:6.1,position_z:15.1,position_y:2},{shape:"box",width:.2,height:4,length:.2,position_x:9.9,position_z:15.1,position_y:2},{shape:"box",width:.2,height:4,length:.2,position_x:9.9,position_z:15.9,position_y:2},{shape:"box",width:.2,height:4,length:.2,position_x:6.1,position_z:15.9,position_y:2},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-13,4,1",radius:3,position_x:-1,position_y:1,position_z:10},{shape:"box",width:4,height:.2,length:12,position_x:8,position_z:-17,position_y:2},{type:"trigger",shape:"sphere",event:"finish",dataSet:"checkpointCount:1",position_x:8,position_y:3,position_z:-21},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-21,-9,8",radius:3,position_x:-1,position_y:-9,position_z:10},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"19,-10,-11",radius:3,position_x:6,position_y:-16,position_z:10},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"30,-3,52",radius:3,position_x:16,position_y:-13,position_z:23},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"43,2,0",radius:3,position_x:16,position_y:-14,position_z:17},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"32,8,-11",radius:3,position_x:20,position_y:-9,position_z:20},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"27,7,43",radius:3,position_x:16,position_y:-4,position_z:26},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"8,12,52",radius:3,position_x:9,position_y:-2,position_z:36},{shape:"box",width:.2,height:.4,length:1.9,position_y:1.1,position_z:11.35,position_x:-4.1},{shape:"box",width:.8,height:.2,length:.8,position_y:1.4,position_z:10,position_x:-4.4},{shape:"box",width:.6,height:.4,length:.2,position_y:1.1,position_z:10.3,position_x:-4.3},{shape:"box",width:.6,height:.4,length:.2,position_y:1.1,position_z:9.7,position_x:-4.3},{shape:"box",width:.8,height:.2,length:.8,position_y:.8,position_z:10,position_x:-4.4},{shape:"box",width:.2,height:.4,length:.8,position_y:1.1,position_z:10,position_x:-4.7},{shape:"box",width:.6,height:.4,length:.4,position_y:1.1,position_z:10,position_x:-4.1,mass:10},{shape:"box",width:.2,height:.4,length:.4,position_y:1.1,position_z:10,position_x:-3.9,type:"trigger",event:"startAnimation",dataSet:"animated_3"},{type:"trigger",shape:"sphere",event:"checkpoint",position_x:10.75,position_y:-7,position_z:7.5,rotation_y:-90},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"32,8,-11",radius:3,position_x:14.09,position_y:-7,position_z:10.04},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"38,15,11",radius:3,position_x:8,position_y:3,position_z:1}]},yn={meta:{author:"",goals:{time:22e3},next:"o04"},elements:[{type:"vehicle",position_y:1,rotation_y:-1},{shape:"box",width:3*2,height:.1*2,length:20.01*2,position_z:-.02,position_y:.07},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-6,10,26",radius:3,position_y:1},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_x:-31.5,position_y:17.5,position_z:-13.5},{shape:"slopeTransition",type:"compound",segmentWidth:6,position_y:0,position_z:-20.6,position_x:-3,segmentCount:43,segmentHeight:.22,segmentLength:.6,rotation_x:-6},{shape:"loop",type:"compound",segmentCount:23,segmentWidth:12,segmentHeight:.2,radius:10,segmentPositionOffset:-1.19,position_x:11.85,position_z:-41.48,position_y:.5,rotation_y:-30,rotation_z:-90},{shape:"box",height:6*2,length:15*2,width:.1*2,position_y:26.7,position_x:22.01,position_z:-27},{shape:"loop",type:"compound",segmentCount:7,segmentWidth:12,segmentHeight:.2,segmentLength:2,segmentPositionOffset:0,position_x:13.95,position_z:-18,position_y:20.4,rotation_y:-90},{shape:"box",height:.1*2,length:6*2,width:15*2,position_y:12.4,position_x:-2,position_z:-18},{shape:"loop",type:"compound",segmentCount:8,segmentWidth:8,segmentHeight:.2,radius:10,segmentPositionOffset:-1,position_x:-19,position_y:22.4,position_z:-16,rotation_y:90},{shape:"loop",type:"compound",segmentCount:7,segmentWidth:8,segmentHeight:.2,segmentPositionOffset:-1,radius:8,position_x:-20.59,position_y:24.16,position_z:-2,rotation_y:-90},{shape:"box",height:.1*2,length:3*2,width:6*2,position_y:16.16,position_x:-28.6,position_z:-2},{shape:"box",height:.1*2,length:6*2,width:3*2,position_y:16.16,position_x:-31.6,position_z:-11},{type:"trigger",shape:"sphere",event:"setCameraMode",dataSet:"chase",radius:3,position_y:1,position_z:-11.4},{shape:"box",type:"trigger",position_y:15.5,position_z:-18,width:1*2,length:6*2,height:3*2,event:"setCameraMode",dataSet:"hood"},{shape:"box",type:"trigger",position_y:18.26,position_z:-2,width:1*2,length:3*2,height:2*2,position_x:-26.8,event:"setCameraMode",dataSet:"cinematic,-16,21,-2"},{shape:"box",height:2*2,length:1*2,width:3*2,position_y:18.26,position_x:-31.6,position_z:-6,type:"trigger",dataSet:"-26,26,13"}]},fn={meta:{author:"",goals:{time:55e3,respawnCount:0},next:"o05"},elements:[{type:"vehicle",position_y:11,rotation_y:-90,position_x:-5,position_z:8},{shape:"box",position_y:12,width:4,height:.2,length:4,position_x:4},{shape:"box",position_y:11.01,width:4,height:.2,length:4,position_x:.32,rotation_z:30},{shape:"box",position_y:9.67,width:4.2,height:.2,length:4,position_x:-7.41,rotation_z:-10},{shape:"box",position_y:9.67,width:4.2,height:.2,length:4,position_x:-3.38,rotation_z:10},{shape:"box",position_y:11.01,width:4,height:.2,length:4,position_x:-11.1,rotation_z:-30},{shape:"box",position_y:13.51,width:4,height:.2,length:4,position_x:-14.1,rotation_z:-50},{shape:"box",position_y:18.47,width:8,height:.2,length:4,position_x:-17.36,rotation_z:-60},{shape:"box",position_y:23.44,width:4,height:.2,length:4,position_x:-20.63,rotation_z:-50},{shape:"box",position_y:26.24,width:4,height:.2,length:4,position_x:-23.43,rotation_z:-40},{shape:"box",position_y:28.19,width:4,height:.2,length:4,position_x:-26.81,rotation_z:-20},{shape:"box",position_y:28.87,width:10,height:.2,length:10,position_x:-33.65},{shape:"box",position_y:19,width:8,height:.2,length:4,position_x:36.53,rotation_z:10,position_z:0},{shape:"box",position_y:16.31,width:8,height:.2,length:4,position_x:29.16,rotation_z:30},{shape:"box",position_y:8.576,width:12,height:.2,length:12,position_x:10.858,position_z:4,rotation_z:-35},{shape:"box",position_y:10,width:8,height:8,length:4,position_x:4,position_z:4},{shape:"box",position_y:12,width:4,height:.2,length:4,position_x:4,position_z:8},{shape:"box",position_y:11.013,width:4,height:.2,length:4,position_x:.318,rotation_z:30,position_z:8},{shape:"box",position_y:10,width:6,height:.2,length:4,position_x:-4.35,position_z:8},{shape:"box",position_y:21.06,width:8,height:.2,length:4,position_x:44.18,position_z:0,rotation_z:20},{shape:"box",position_y:23.9,width:6,height:.2,length:12,position_x:50.48,position_z:4,rotation_z:30},{shape:"sphere",type:"trigger",event:"checkpoint",position_x:-34.15,position_y:30.14,rotation_y:-90},{shape:"sphere",type:"trigger",event:"finish",dataSet:"checkpointCount:1",position_x:50.18,position_y:24.88,position_z:8.54},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"cinematic,26,20,43",position_x:-5,position_y:11,position_z:8,radius:2},{shape:"sphere",type:"trigger",dataSet:"25,22,18",position_x:4,position_y:13,position_z:8,radius:2},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"chase",position_x:10.01,position_y:9.92,position_z:1.67,radius:3}]},wn={meta:{author:"",goals:{time:45e3,respawnCount:0},next:"o06"},elements:[{type:"vehicle",position_y:1},{shape:"box",width:7,height:.1,length:30,position_z:-11.5},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"chase",position_y:1},{shape:"box",position_x:-1.5,position_y:.6,position_z:-8,width:3,height:1},{shape:"box",position_x:1.5,position_y:.6,position_z:-18,width:3,height:1},{shape:"box",position_y:-2.62,position_z:-38.18,rotation_x:-10,width:7,length:6,height:.1},{shape:"box",position_x:0,position_y:-6,position_z:-57,width:6,length:10,height:.1},{shape:"slopeTransition",type:"compound",position_x:-3,position_y:-6.05,position_z:-65.66,angle:30,segmentHeight:.84,segmentLength:3.69,segmentCount:5,segmentWidth:6},{shape:"cantedCurve",type:"compound",position_x:20.33,position_y:-3.94,position_z:-78.94,rotation_y:-90,segmentCount:36,radius:20,segmentWidth:6,segmentLength:1.53,angle:40},{shape:"box",position_x:41.83,position_y:-2.69,position_z:-75.18,rotation_z:40,width:10,length:6,height:.1},{shape:"box",position_x:48.63,position_y:.51,position_z:-63.18,width:6,length:30,height:.1},{shape:"sphere",type:"trigger",event:"checkpoint",position_x:48.5,position_y:1.74,position_z:-74.9,rotation_y:180},{shape:"loop",type:"compound",position_x:52.63,position_y:8.5,position_z:-42,rotation_y:-90,segmentPositionOffset:0,segmentCount:7,segmentLength:2,segmentWidth:30},{shape:"loop",type:"compound",position_x:30.68,position_y:11.8,position_z:-25.54,rotation_x:180,rotation_z:90,segmentCount:16,segmentPositionOffset:0,radius:30,segmentWidth:8,segmentLength:3},{shape:"box",position_x:60.68,position_y:12.3,position_z:-34,rotation_z:90,width:7,length:14,height:.1},{shape:"box",position_x:23.17,position_y:11.77,position_z:4.49,width:17,length:.1,height:8},{shape:"loop",type:"compound",position_x:-14.87,position_y:8.5,position_z:-3.5,rotation_x:-180,rotation_y:0,rotation_z:-180,segmentPositionOffset:-1.2,segmentCount:32,segmentLength:2,segmentWidth:18},{shape:"box",position_x:-67,position_y:4.47,position_z:-73,rotation_y:-60,width:40,height:.1,length:20},{shape:"loop",type:"compound",position_x:-16,position_y:12.49,position_z:-5.46,segmentCount:4,radius:12,segmentLength:2,segmentWidth:18,segmentPositionOffset:0},{shape:"box",position_x:-79,position_y:5.33,position_z:-94,rotation_y:-60,rotation_z:-10,width:10,height:.1,length:20},{shape:"box",type:"trigger",event:"finish",dataSet:"checkpointCount:1",length:5,position_x:-79,position_y:6.75,position_z:-93,rotation_y:-60}]},bn={meta:{author:"",goals:{time:45e3,respawnCount:0},next:"o07"},elements:[{type:"vehicle",position_y:11.5},{shape:"box",width:5,length:5,height:1,position_y:10},{shape:"box",width:8,length:6,height:1,position_y:-8,position_z:2},{shape:"box",position_y:-18,position_z:-1,height:1,width:10,length:10},{shape:"box",position_y:-22,position_z:17,height:1,width:10,length:10},{shape:"sphere",type:"trigger",event:"checkpoint",position_y:-6.5,position_z:2},{shape:"box",color:10853513,height:.2,width:16,length:12,position_x:3,position_y:-12,position_z:17,rotation_x:-30},{shape:"box",position_x:8,position_y:-23,position_z:17,height:1,width:6,length:4},{shape:"box",position_x:14,position_y:-24,position_z:17,height:1,width:6,length:4},{shape:"sphere",type:"trigger",event:"checkpoint",position_x:8,position_y:-21,position_z:17,rotation_y:-90},{shape:"box",position_x:18,position_y:-25,position_z:13,height:1,width:4,length:6},{shape:"box",position_x:18,position_y:-26,position_z:7,height:1,width:4,length:6},{shape:"box",position_x:14,position_y:-27,position_z:3,height:1,width:6,length:4},{shape:"box",position_x:8,position_y:-28,position_z:3,height:1,width:6,length:4},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"32,-13,25",position_x:10,position_y:-21,position_z:17},{shape:"box",type:"trigger",dataSet:"-24,-13,20",height:2,length:1,width:6,position_x:0,position_y:-20,position_z:14},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"32,-13,-8",position_x:18,position_y:-24,position_z:9,rotation_y:-90},{shape:"box",position_x:-2,position_y:-31,position_z:4,height:1,width:6,length:6},{shape:"sphere",type:"trigger",event:"checkpoint",position_x:8,position_y:-26,position_z:3,rotation_y:90},{shape:"box",position_x:-2,position_y:-35,position_z:16,height:1,width:6,length:6},{shape:"box",position_x:-2,position_y:-39,position_z:27,height:1,width:6,length:6},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"cinematic,-24,25,0",position_y:12},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"-2,-20,-10",position_x:-2,position_y:-29,position_z:4},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"-35,-3,1",position_x:0,position_y:-6.5,position_z:2},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"6,-21,-20",position_x:10,position_y:-26,position_z:3},{type:"trigger",shape:"sphere",event:"finish",dataSet:"checkpointCount:3",radius:1,position_x:-2,position_y:-37,position_z:27}]},zn={meta:{author:"",goals:{time:2e4},next:"o08"},elements:[{type:"vehicle",position_y:1.4},{shape:"box",width:8,length:16,height:.2,position_y:-.6},{shape:"cylinder",sides:4,radiusTop:3,radiusBottom:5.7,height:1,rotation_y:45},{shape:"box",width:8,length:16,height:.2,position_z:20,position_x:0,position_y:0,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"box",width:8,length:16,height:.2,position_z:-20},{shape:"box",width:16,length:10,height:.2,position_y:-.6,position_x:-12,position_z:-3,rotation_x:0,rotation_y:0,rotation_z:0},{type:"compound",shape:"loop",position_x:-20.89,position_y:9.9,position_z:-3,rotation_y:90,segmentPositionOffset:0,segmentCount:7,segmentLength:2.64,segmentWidth:10,segmentHeight:.2,radius:10.5},{type:"compound",shape:"loop",position_x:-20.89,position_y:10.5,position_z:20,rotation_y:90,segmentPositionOffset:0,segmentCount:7,segmentLength:2.64,segmentWidth:16,segmentHeight:.2,radius:10.5},{shape:"box",width:16,length:16,height:.2,position_z:20,position_x:-12},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_y:1,position_z:-25},{type:"trigger",shape:"box",position_x:-5,position_y:1,position_z:-3,width:1,length:8,dataSet:"-8,27,-33"},{type:"trigger",shape:"box",dataSet:"-27, 29, 47",position_x:-19,position_y:1,position_z:20,width:1,length:14},{type:"trigger",shape:"box",dataSet:"0,10,40",position_x:-10,position_y:1,position_z:20,width:1,length:14},{type:"trigger",shape:"box",event:"setCameraMode",dataSet:"cinematic,24,8,0",width:1,height:1,length:1,position_y:.5},{shape:"box",position_x:-29,position_y:9,position_z:6,type:"trigger",width:5,height:10,length:1,dataSet:"-34,23,3"},{shape:"box",position_y:1,position_z:10,type:"trigger",event:"setCameraMode",dataSet:"chase",width:5,height:2,length:1}]},Cn={meta:{author:"",goals:{time:3e4,respawnCount:0},next:"o09"},elements:[{type:"vehicle",position_y:1,position_z:16},{shape:"box",width:6,length:38,height:.2,position_y:-.1,position_x:0,position_z:1,rotation_x:0,rotation_y:0,rotation_z:0},{type:"animated",shape:"box",width:6,height:4,length:6,position_y:2,position_z:7,dataSet:'{ "movement": { "x": 10 }, "speed": 10, "triggerStart": false }'},{type:"animated",shape:"box",width:6,height:4,length:6,position_y:2,position_z:-9,dataSet:'{ "movement": { "x": 10 }, "speed": 10, "triggerStart": false }'},{shape:"box",height:.2,width:6,length:10,position_x:10,position_y:3.9,position_z:-1},{shape:"box",height:.2,width:6,length:6,position_x:10,position_y:3.9,position_z:-15},{shape:"box",height:.2,width:6,length:10,position_x:10,position_y:3.033,position_z:-22.9,rotation_x:-10},{shape:"box",height:.2,width:6,length:10,position_y:.764,position_z:-22.92,rotation_x:10},{shape:"box",height:.2,width:6,length:6,position_y:1.63,position_z:-30.82},{shape:"box",height:.2,width:6,length:6,position_x:10,position_y:2.16,position_z:-30.82},{shape:"box",height:.2,width:4.05,length:6,position_x:5.01,position_y:1.895,position_z:-30.82,rotation_z:7.47},{shape:"box",height:.2,width:6,length:9,position_x:10,position_y:3.9,position_z:14.5,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"sphere",position_x:10,position_y:3.45,position_z:-30.82,rotation_y:180,type:"trigger",event:"checkpoint"},{type:"trigger",shape:"sphere",event:"finish",radius:2,dataSet:"checkpointCount:1",position_x:10,position_y:5,position_z:16,rotation_x:0,rotation_y:0,rotation_z:0},{type:"trigger",shape:"sphere",event:"setCameraMode",dataSet:"cinematic,-23.677403301734017 , 18.14983153689501 , 19.110973303515554",radius:3,position_y:1,position_z:16},{type:"trigger",shape:"sphere",radius:3,dataSet:"-30.215800024784016, 22.38223498976879, 8.370897885782714",position_y:1,position_z:2},{type:"trigger",shape:"sphere",radius:3,dataSet:"-13.569674761319714, 16.522559296321283, -50.07904465318648",position_y:1,position_z:-15},{shape:"sphere",position_x:10,position_y:3.45,position_z:-30.82,rotation_y:180,type:"trigger",event:"setCameraPosition",radius:3,dataSet:"18.770735429093357, 20.96953167533059, -46.35856186137107"}]},vn={meta:{author:"",goals:{time:2e4},next:"o10"},elements:[{type:"vehicle",position_y:11.4,position_x:1.5},{shape:"box",width:10,length:6,height:1,position_y:9.95,position_z:.3},{shape:"box",position_y:2.51,position_z:-15.44,rotation_x:-30,height:1,width:10,length:30},{shape:"box",position_x:-8,position_y:-25,position_z:-65,rotation_x:-30,height:1,width:10,length:60},{shape:"box",position_y:-56,position_z:-130,rotation_x:-20,height:1,width:10,length:60},{shape:"box",width:10,height:1,position_y:-5.18,position_z:-29.26,rotation_x:-15},{shape:"box",width:10,height:1,position_x:-8,position_y:-40.17,position_z:-91.78,rotation_x:-15},{shape:"box",position_y:-66.31,position_z:-159,rotation_x:-5,width:10,height:1},{shape:"box",position_x:8,position_y:-76,position_z:-200,rotation_x:-10,height:1,width:10,length:60},{shape:"box",position_y:-83,position_z:-271,height:1,width:10,length:60},{shape:"box",position_x:8,position_y:-81.08,position_z:-230.38,rotation_x:5,width:10,height:1},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:2,position_y:-81,position_z:-297},{type:"trigger",shape:"box",event:"setCameraMode",dataSet:"cinematic,-5,24,19",position_y:12},{type:"trigger",shape:"box",event:"setCameraMode",dataSet:"chase",height:2,width:8,length:1,position_y:11,position_x:0,position_z:-4}]},Sn={meta:{author:"",goals:{time:45e3}},elements:[{type:"vehicle",position_x:0,position_y:1.6,position_z:-4},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_x:-16,position_y:5.5,position_z:-10},{shape:"box",color:11194623,fixedRotation:!0,width:5,height:3.79,length:5,position_x:-10,position_y:-1,position_z:-10,mass:90},{shape:"box",color:11194623,fixedRotation:!0,width:5,height:.17,length:5,position_x:10,position_y:0,position_z:-10,mass:30},{shape:"box",position_x:-.4,position_y:-1.76,position_z:-10.07,height:.2,length:1,width:24.9,color:9805311,mass:30},{shape:"triangularPrism",position_x:0,position_y:-2.6,position_z:-10,rotation_y:90,height:1,width:1,length:1},{shape:"box",lowFriction:!0,position_x:-7.45,position_y:0,position_z:-10,height:1,length:5,width:.1},{shape:"box",lowFriction:!0,position_x:7.45,position_y:0,position_z:-10,height:1,length:5,width:.1},{shape:"box",lowFriction:!0,position_x:12.55,position_y:-2,position_z:-10,height:5,length:5,width:.1},{shape:"box",lowFriction:!0,position_x:-12.55,position_y:-2,position_z:-10,height:5,length:5,width:.1},{shape:"box",lowFriction:!0,position_x:10,position_y:-2,position_z:-7.45,height:5,length:.1,width:5.2},{shape:"box",lowFriction:!0,position_x:10,position_y:-2,position_z:-12.55,height:5,length:.1,width:5.2},{shape:"box",lowFriction:!0,position_x:-10,position_y:-2,position_z:-12.55,height:5,length:.1,width:5.2},{shape:"box",lowFriction:!0,position_x:-10,position_y:-2,position_z:-7.45,height:5,length:.1,width:5.2},{shape:"box",height:.2,position_x:0,position_y:.4,position_z:-10,width:14.8,length:5.2},{shape:"box",lowFriction:!0,position_x:-7.45,position_y:-2.5,position_z:-8.5,height:4,length:2,width:.1},{shape:"box",lowFriction:!0,position_x:-7.45,position_y:-2.5,position_z:-11.5,height:4,length:2,width:.1},{shape:"box",lowFriction:!0,position_x:7.45,position_y:-2.5,position_z:-11.5,height:4,length:2,width:.1},{shape:"box",lowFriction:!0,position_x:7.45,position_y:-2.5,position_z:-8.5,height:4,length:2,width:.1},{shape:"box",height:.2,position_x:0,position_y:.4,position_z:-4,width:25.2,length:6.8},{shape:"box",position_x:-15.08,position_y:4.04,position_z:-10,length:5,width:5,height:.2},{shape:"triangularPrism",height:.1,length:.2,width:5.5,position_x:10.25,position_y:.55,position_z:-7.5},{shape:"triangularPrism",height:.1,length:.2,width:5.5,position_x:7.5,position_y:.55,position_z:-10.25,rotation_y:90},{shape:"triangularPrism",height:.24,length:1,width:12,position_x:13,position_y:.62,position_z:-7,rotation_y:90},{shape:"triangularPrism",height:.24,length:1,width:27,position_x:0,position_y:.62,position_z:-13.01},{shape:"triangularPrism",height:.24,length:1,width:12,position_x:-13.01,position_y:.62,position_z:-7,rotation_y:90},{shape:"box",lowFriction:!0,position_x:-12.55,position_y:4.04,position_z:-10,height:.2,length:5,width:.1},{shape:"triangularPrism",height:.24,length:1,width:27,position_x:0,position_y:.62,position_z:-1},{shape:"box",width:27,position_x:0,position_y:-1,position_z:-1,length:1,height:3},{shape:"box",height:.2,position_x:-16,position_y:.4,position_z:-7,width:5,length:13},{shape:"sphere",color:7841791,position_x:6.25,position_y:1.5,position_z:-10,mass:60},{shape:"sphere",color:7841791,position_x:-5.36,position_y:1.5,position_z:-10,mass:60},{shape:"box",type:"trigger",event:"setCameraMode",dataSet:"cinematic,0, 13, 17",width:1,length:10,height:1,position_x:0,position_y:2,position_z:-7},{shape:"box",type:"trigger",dataSet:"-22, 10, 5",width:1,length:10,height:1,position_x:-5,position_y:2,position_z:-7},{shape:"box",type:"trigger",dataSet:"8, 14, 6",width:1,length:10,height:1,position_x:5,position_y:2,position_z:-7}]},Lt={i01:gn,i02:_n,i03:mn,o01:un,o02:xn,o03:yn,o04:fn,o05:wn,o06:bn,o07:zn,o08:Cn,o09:vn,o10:Sn,empty:dn,test:{meta:{},elements:[{type:"vehicle",position_y:2,position_z:15},{shape:"box",width:24,height:.2,length:40,position_x:14,position_z:22},{shape:"triangularPrism",width:2,length:2,offset:-2,position_y:1},{shape:"box",width:24,height:.2,length:120,position_x:-10,position_z:-18},{shape:"box",size:2,position_x:15,position_y:2,position_z:10,mass:40,fixedRotation:!0,rotation_x:45,rotation_y:45},{shape:"box",size:2,position_x:20,position_y:5,position_z:10,rotation_x:45,rotation_y:45},{type:"compound",shape:"loop",segmentPositionOffset:.6,position_x:5,position_y:8.2,position_z:4,rotation_x:12},{type:"compound",shape:"slopeTransition",segmentWidth:6,segmentHeight:.6,segmentLength:12,segmentCount:10,position_x:-25.8,position_z:30},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-6,10,26",radius:3,position_x:10,position_y:1,position_z:15},{type:"trigger",shape:"sphere",event:"finish",radius:1,position_x:12,position_y:3,position_z:5},{type:"trigger",shape:"sphere",event:"setCameraMode",dataSet:"hood",radius:3,position_x:6,position_y:1.9,position_z:-.4},{shape:"box",position_y:12,width:4*2,height:.1*2,length:2*2,position_x:-20,position_z:8},{shape:"box",position_y:11.8,width:9*2,height:.1*2,length:.2*2,position_x:-7,position_z:6.2,lowFriction:!0},{shape:"box",position_y:11.8,width:9*2,height:.1*2,length:.2*2,position_x:-7,position_z:9.8,lowFriction:!0},{shape:"box",position_y:12,width:9*2,height:.1*2,length:.1*2,position_x:-7,position_z:9.9,lowFriction:!0},{shape:"box",position_y:12,width:9*2,height:.1*2,length:.1*2,position_x:-7,position_z:6.1,lowFriction:!0},{shape:"box",position_y:12,width:2*2,height:.1*2,length:1.8*2,position_x:-14,position_z:8,mass:10},{shape:"box",position_x:9.11,position_y:7.09,position_z:-15,rotation_z:45,height:.1*2,length:10*2,width:10*2},{shape:"box",position_x:10.21,position_y:5.74,position_z:-35,rotation_z:35,height:.1*2,length:10*2,width:10*2},{type:"compound",shape:"cantedCurve",position_x:8.94,position_y:-3.61,position_z:53.91,radius:11.65,rotation_x:0,rotation_y:-83.16,rotation_z:0,angle:60,segmentWidth:6,segmentCount:32,segmentLength:2},{type:"compound",shape:"cantedCurve",position_x:8.94,position_y:-7.71,position_z:53.91,radius:7.675,rotation_x:0,rotation_y:4.18,rotation_z:0,angle:30,segmentWidth:6,segmentCount:32,segmentLength:1},{shape:"box",position_x:9,position_y:-9.2,position_z:53.81,rotation_x:0,rotation_y:0,rotation_z:0,width:10,length:10,height:.1}]}},Mn="Finished!",Pn="Retry",En="Next",Ln="Select map";function kn(){const{goals:e,time:t}=m.useContext(Bt);return e.time?g.jsxs(g.Fragment,{children:[g.jsx("h4",{children:"Goals"}),!!e.time&&g.jsxs("p",{children:["Finis under: ",g.jsx("span",{className:"textHighlight_2",children:ee(e.time)}),g.jsx("span",{className:"end_adornment",children:t<=e.time?"✅":"🟧"})]})]}):null}function Fn({closeModal:e}){const t=m.useContext(Bt),i=m.useRef();return m.useEffect(()=>{i.current&&i.current.focus()},[i.current]),g.jsxs(He,{children:[g.jsx("span",{className:"modal__header",children:Mn}),g.jsxs("span",{className:"modal__body",children:[g.jsxs("p",{children:["Your time: ",g.jsx("span",{className:"textHighlight_1",children:ee(t.time)}),g.jsx("span",{className:"end_adornment",children:"⏱"})]}),!!t.respawnCount&&g.jsxs("p",{children:["Respawn count: ",g.jsx("span",{className:"textHighlight_1",children:t.respawnCount})]}),g.jsx(kn,{})]}),g.jsxs("div",{className:"modal__footer",children:[g.jsx("button",{onClick:n,children:Pn}),g.jsx("button",{onClick:s,children:Ln}),g.jsx("button",{onClick:o,ref:i,children:En})]})]});function o(){e(),t.loadNextMap()}function n(){e(),t.reset()}function s(){e(),t.listeners.dispatch(Q.openMapSelectorPanel)}}const Rt=document.createElement("aside");Rt.id="gameProgressModalControllerRoot";Rt.classList.add("hidden");document.body.appendChild(Rt);const Bt=m.createContext(void 0);function Tn(e){ft.render(g.jsx(Bt.Provider,{value:e,children:g.jsx(An,{})}),Rt)}function An(){const e=m.useContext(Bt),[t,i]=m.useState(!0);return m.useEffect(()=>(e.listeners.add(Q.openModal,o),()=>{e.listeners.remove(Q.openModal,o)}),[]),t?null:g.jsx(Fn,{closeModal:n});function o(){i(!1)}function n(){i(!0)}}var Q=(e=>(e.start="start",e.openModal="openModal",e.openMapSelectorPanel="openMapSelectorPanel",e))(Q||{});let _t;const In=5e3,Xt=document.createElement("aside"),Mt=document.createElement("span"),Ce="00:00.000";Xt.id="hud";const[Rn]=Object.entries(Lt)[0];class Bn{constructor(t,i){r(this,"timer",new cn);r(this,"listeners",new lt);r(this,"started",!1);r(this,"checkpointsReached",0);r(this,"respawnCount",0);r(this,"time");r(this,"goals");r(this,"_mapBuilder");r(this,"checkpointHandler");r(this,"vehicle");r(this,"currentMapId",Rn);r(this,"checkpointReached",t=>{_t=t,this.checkpointsReached++});Mt.textContent=Ce,Xt.appendChild(Mt),document.getElementById("topLeftPanel").appendChild(Xt),this._mapBuilder=t,this.vehicle=i,Tn(this)}initCheckpointHandler(t,i){this.checkpointHandler=new hn(t,i)}respawnAtLastCheckpoint(){_t?(this.vehicle.chassisBody.velocity.setZero(),this.vehicle.chassisBody.angularVelocity.setZero(),this.vehicle.chassisBody.position.copy(_t.position),this.vehicle.chassisBody.quaternion.copy(_t.quaternion),this.respawnCount++,this.timer.add(In)):this.reset()}start(){this.started=!0,this.timer.start(),this.listeners.dispatch("start")}stop(){this.timer.stop(),this.time=this.timer.time}reset(){this.started=!1,this.checkpointsReached=0,this.respawnCount=0,this.time=void 0,Mt.textContent=Ce,this.timer.reset(),this._mapBuilder.resetDynamicMapElements(),this.checkpointHandler.init(this._mapBuilder,this),_t=void 0}loadMap(t=this.currentMapId){if(!Lt.hasOwnProperty(t)){console.warn(`invalid map name ${t}`);return}const{meta:i,elements:o}=Lt[t],n=this._mapBuilder.selectedMapElementId;this.goals=i.goals||{},this._mapBuilder.importMap(o),t===this.currentMapId&&this._mapBuilder.editMode&&n&&this._mapBuilder.selectMapElement(n),this.currentMapId=t,this.reset()}loadNextMap(){const{meta:t}=Lt[this.currentMapId];t.next?this.loadMap(t.next):this.reset()}updateHUD(){!this.timer.started||this.timer.stopped||(Mt.textContent=ee(this.timer.time))}openModal(){this.listeners.dispatch("openModal")}}class On{constructor(t,i,o,n){r(this,"_enabled",!1);r(this,"scene");r(this,"camera");r(this,"domElement");r(this,"mapBuilder");r(this,"raycaster",new vi);r(this,"mousePosition",new Re);r(this,"raycastResult",[]);r(this,"hoveredObject");r(this,"onSelect");r(this,"onClick",t=>{if(t.type==="click"&&!t.altKey)return;this.mousePosition.x=t.clientX/window.innerWidth*2-1,this.mousePosition.y=-(t.clientY/window.innerHeight)*2+1,this.raycaster.setFromCamera(this.mousePosition,this.camera),this.raycastResult.length=0,this.raycaster.intersectObjects(this.scene.children,!0,this.raycastResult);const{mapElementIdList:i}=this.mapBuilder;let o;for(let n=0;n<this.raycastResult.length;n++){const s=this.raycastResult[n].object;if(i.includes(s.name)){o=s;break}else if(i.includes(s.parent.name)){o=s.parent;break}}o&&this.mapBuilder.selectMapElement(o.name)});this.camera=i,this.scene=t,this.domElement=o,this.mapBuilder=n}get enabled(){return this._enabled}set enabled(t){this._enabled!==t&&(t?(this.domElement.addEventListener("click",this.onClick),this.domElement.addEventListener("dblclick",this.onClick)):(this.domElement.removeEventListener("click",this.onClick),this.domElement.removeEventListener("dblclick",this.onClick),this.hoveredObject=void 0),this._enabled=t)}}const{radToDeg:$t}=kt;function jn(e,t){const i=new Si(e.camera,e.domElement);let o=!1,n=!1;function s(){const a=i.object,h=a.name;t.translate(h,{position_x:ot(a.position.x),position_y:ot(a.position.y),position_z:ot(a.position.z),rotation_x:ot($t(a.rotation.x)),rotation_y:ot($t(a.rotation.y)),rotation_z:ot($t(a.rotation.z))})}return i.addEventListener("objectChange",qi(s,100)),i.addEventListener("dragging-changed",a=>{o?e.orbitControls.enabled=n:(n=e.orbitControls.enabled,e.orbitControls.enabled=!1),o=!!a.value}),j.addKeyPressListener("KeyG",()=>{i.mode==="translate"?i.setMode("rotate"):i.setMode("translate")}),j.addKeyDownChangeListener(a=>{a.has("ShiftLeft")?i.setTranslationSnap(1):i.setTranslationSnap(null)}),i}const Ot=document.createElement("aside");Ot.id="menuModalControllerRoot";Ot.classList.add("hidden");document.body.appendChild(Ot);const Dn={gameProgressManager:void 0,renderer:void 0,menuOpen:!1,openMenu:V,closeMenu:V,selectedTabIndex:0,setSelectedTabIndex:V},ti=m.createContext(Dn);function Wn(e,t){ft.render(g.jsx(Hn,{gameProgressManager:e,renderer:t}),Ot)}function Hn({gameProgressManager:e,renderer:t}){const[i,o]=m.useState(!1),[n,s]=m.useState(0),a=m.useCallback(()=>{o(!0)},[]),h=m.useCallback(()=>{o(!1)},[]),l={gameProgressManager:e,renderer:t,menuOpen:i,openMenu:a,closeMenu:h,selectedTabIndex:n,setSelectedTabIndex:s};return g.jsx(ti.Provider,{value:l,children:g.jsx(Nn,{})})}function Nn(){const{menuOpen:e,openMenu:t,setSelectedTabIndex:i,gameProgressManager:o}=m.useContext(ti),n=m.useCallback(()=>{t()},[]),s=m.useCallback(()=>{i(0),t()},[]);m.useEffect(()=>(j.addKeyPressListener("Tab",n),o.listeners.add(Q.openMapSelectorPanel,s),()=>{j.removeKeyPressListener("Tab",n),o.listeners.remove(Q.openMapSelectorPanel,s)}),[]);const a=m.lazy(()=>Ke(()=>import("./modules/MenuModal-66706413.js"),["./modules\\MenuModal-66706413.js","./vendor\\react-6a63c5cb.js","./vendor\\vendor-5e83183c.js","./modules\\Switch-67dd5044.js","./vendor\\cannon-f72e7d54.js","./vendor\\three-cf704d0e.js"],import.meta.url));return m.useMemo(()=>e?g.jsx(m.Suspense,{fallback:g.jsx(qe,{}),children:g.jsx(a,{})}):null,[e])}function $n(e,t){const i={baseMaterial:new Ie({color:7829367}),fenderMaterial:new Pt({color:328965}),grillMaterial:new Pt({color:2236962}),chromeMaterial:new xt({color:13421772}),glassMaterial:new xt({color:11324631}),tailLightMaterial:new xt({color:5570560}),headLightMaterial:new xt({color:16777147}),wheelMaterial:new Pt};return e.traverse(n=>{n.material&&(i.wheelMaterial.map=n.material.map,n.material=i.wheelMaterial,n.material.needsUpdate=!0),f.renderShadows&&(n.castShadow=!0)}),t.traverse(n=>{n.material&&(n.material=o(n.name)),f.renderShadows&&(n.castShadow=!0,n.receiveShadow=!0)}),i;function o(n){switch(n){case"front_bumper":case"rear_bumper":case"front_fender":case"rear_fender":return i.fenderMaterial;case"grill":return i.grillMaterial;case"brushGuard":return i.chromeMaterial;case"glass":return i.glassMaterial;case"tail_lights":return i.tailLightMaterial;case"head_lights":return i.headLightMaterial;default:return i.baseMaterial}}}const ve={engineForceMin:-f.vehicle.maxEngineForce,engineForceMax:f.vehicle.maxEngineForce,brakeForceMin:0,brakeForceMax:f.vehicle.maxBrakeForce,steeringAngleMin:-f.vehicle.maxSteeringAngle,steeringAngleMax:f.vehicle.maxSteeringAngle},Vn={engineForce:0,brakeForce:0,steeringAngle:0};function Kn(e){return new Proxy(Vn,{set(t,i,o){const n=t[i],s=Yi(o,ve[`${i}Min`],ve[`${i}Max`]);return n!==s&&(t[i]=s),!0}})}const qn=new b(0,0,1);let mt,ut;const{renderWireFrame:Vt}=f,{torqueSplitRatio:Un,maxEngineForce:Gn,maxBrakeForce:Zn,maxSteeringAngle:Yn,steeringSpeed:Se,wheelRadius:Xn,wheelSuspensionRestLength:Jn,wheelSuspensionStiffness:Qn,wheelMaxSuspensionTravel:ts,wheelMaxSuspensionForce:es,wheelDampingCompression:is,wheelDampingRelaxation:os,wheelFrictionSlip:ns,wheelForwardAcceleration:ss,wheelSidedAcceleration:as,wheelRollInfluence:rs}=f.vehicle,hs=.1,q=0,U=1,at=2,rt=3,ps=new Set([at,rt]),[Me,Pe]=Un,Jt=[Me/2,Me/2,Pe/2,Pe/2],M=[...Jt];class ls{constructor(t,i){r(this,"base");r(this,"chassisBody");r(this,"chassisMesh");r(this,"wheelBodies");r(this,"wheelMeshes");r(this,"state");r(this,"initialPosition",new w);r(this,"initialRotation",new he);r(this,"currentSteeringAngle",0);r(this,"trackWidth",0);r(this,"wheelBase",0);r(this,"materials");r(this,"update",()=>{this.steerWheels(),this.applyWheelSlipReduction();for(let t=0;t<this.base.wheelInfos.length;t++)this.base.applyEngineForce(this.state.engineForce*M[t]*.01,t),this.base.updateWheelTransform(t),mt=this.base.wheelInfos[t].worldTransform,this.wheelMeshes[t].position.copy(mt.position),this.wheelMeshes[t].quaternion.copy(mt.quaternion),Vt&&(ut=this.wheelBodies[t],ut.position.copy(mt.position),ut.quaternion.copy(mt.quaternion),this.wheelMeshes[t].position.copy(ut.position),this.wheelMeshes[t].quaternion.copy(ut.quaternion));this.chassisMesh.position.copy(this.chassisBody.position),this.chassisMesh.quaternion.copy(this.chassisBody.quaternion),this.chassisMesh.translateOnAxis(qn,.6)});r(this,"applyWheelSlipReduction",()=>{const t=this.wheelHasGrip(U),i=this.wheelHasGrip(q),o=this.wheelHasGrip(rt),n=this.wheelHasGrip(at);if(t&&!o&&M[rt]>1)M[U]+=1,M[rt]-=1;else if(!t&&o&&M[U]>1)M[U]-=1,M[rt]+=1;else{const s=Math.sign(M[U]-Jt[U]);s&&(M[U]-=s*1,M[rt]+=s*1)}if(i&&!n&&M[at]>1)M[q]+=1,M[at]-=1;else if(!i&&n&&M[q]>1)M[q]-=1,M[at]+=1;else{const s=Math.sign(M[q]-Jt[q]);s&&(M[q]-=s*1,M[at]+=s*1)}});r(this,"brakeWheel",t=>{this.base.setBrake(this.state.brakeForce,t)});r(this,"steerWheels",()=>{const{currentSteeringAngle:t}=this,{steeringAngle:i}=this.state;let o=0;if(t<i)o=Math.min(i,t+Se);else if(t>i)o=Math.max(i,t-Se);else return;const{wheelBase:n,trackWidth:s}=this,a=n*2,h=Math.sin(o),l=Math.cos(o),d=Math.atan(a*h/(a*l-s*h)),c=Math.atan(a*h/(a*l+s*h));this.base.setSteeringValue(d,U),this.base.setSteeringValue(c,q),this.currentSteeringAngle=o});r(this,"wheelHasGrip",t=>this.base.wheelInfos[t].isInContact&&!this.base.wheelInfos[t].sliding);const o=new qt(new w(.9,.4,2.1)),n=new qt(new w(.9,.4,1.2));this.chassisBody=new Z({mass:f.vehicle.mass}),this.chassisBody.addShape(o,new w(0,0,.1)).addShape(n,new w(0,.8,.8)),this.base=new pi({chassisBody:this.chassisBody,indexForwardAxis:2,indexRightAxis:0,indexUpAxis:1});const s={radius:Xn,suspensionRestLength:Jn,suspensionStiffness:Qn,maxSuspensionTravel:ts,maxSuspensionForce:es,dampingCompression:is,dampingRelaxation:os,frictionSlip:ns,forwardAcceleration:ss,sideAcceleration:as,rollInfluence:rs,axleLocal:new w(-1,0,0),directionLocal:new w(0,-1,0),chassisConnectionPointLocal:new w,customSlidingRotationalSpeed:-30,useCustomSlidingRotationalSpeed:!0},a=.3,h=.85;if(this.trackWidth=h*2,this.wheelBase=1.2+1.4,s.chassisConnectionPointLocal.set(h,-a,-1.2),this.base.addWheel(s),s.chassisConnectionPointLocal.set(-h,-a,-1.2),this.base.addWheel(s),s.chassisConnectionPointLocal.set(h,-a,1.4),this.base.addWheel(s),s.chassisConnectionPointLocal.set(-h,-a,1.4),this.base.addWheel(s),Vt){const c=new he;c.setFromAxisAngle(w.UNIT_Z,Math.PI/2),this.wheelBodies=this.base.wheelInfos.map(p=>{const _=new Ee(p.radius,p.radius,p.radius/2,8),y=new Z({type:Z.KINEMATIC,collisionFilterGroup:0});return y.addShape(_,w.ZERO,c),y})}this.materials=$n(i,t);const l={front_r:i,front_l:i.clone(),rear_r:i.clone(),rear_l:i.clone()},d=["x","y","z"];Object.keys(l).forEach(c=>{c.endsWith("_r")&&d.forEach(p=>{l[c].scale[p]*=-1})}),this.wheelMeshes=[l.front_l,l.front_r,l.rear_l,l.rear_r],this.chassisMesh=t,this.state=Kn()}addToWorld(t){return this.base.addToWorld(t),Vt&&this.wheelBodies.forEach(t.addBody,t),t.addEventListener("postStep",this.update),this}addToScene(t){return this.wheelMeshes.forEach(i=>{t.add(i)}),t.add(this.chassisMesh),this}setEngineForceDirection(t){this.state.engineForce=Gn*t,t===-1?(this.state.engineForce*=.9,this.materials.tailLightMaterial.emissive.setHSL(0,0,hs)):this.materials.tailLightMaterial.emissive.setHSL(0,0,0)}setBrakeForce(t){this.state.brakeForce=Zn*t,ps.forEach(this.brakeWheel)}setSteeringDirection(t){this.state.steeringAngle=Yn*t}resetPosition(){this.chassisBody.position.copy(this.initialPosition),this.chassisBody.quaternion.copy(this.initialRotation),this.chassisBody.velocity.setZero(),this.chassisBody.angularVelocity.setZero()}}const{degToRad:Kt}=kt,cs=1/f.physicsFrameRate,Qt=new ke("general"),ds=new ke("lowFriction"),gs=new te(Qt,Qt,{friction:.001}),_s=new te(Qt,ds,{friction:0,contactEquationStiffness:1e8});f.fullscreen&&wo("Allow fullscreen?").then(e=>{e?document.documentElement.requestFullscreen():f.fullscreen=!1});(async function(){let t=!1,i;const o=new Hi,n=new Mi,s=new Pi(9151409,12298359,4);n.add(s);const a=new li,{x:h,y:l,z:d}=f.world.gravity;a.gravity.set(h,l,d),a.broadphase=new ci(a),a.defaultContactMaterial.friction=.001,a.addContactMaterial(gs),a.addContactMaterial(_s);const c=di(n,a,{onInit(u,S){Ut.add("renderWireFrame",L=>{S.visible=L})}}),p=new Ei({antialias:f.antialias,powerPreference:f.powerPreference});p.setPixelRatio(window.devicePixelRatio),p.setSize(window.innerWidth,window.innerHeight),p.shadowMap.enabled=f.renderShadows;const _=new So(p.domElement);if(p.domElement.tabIndex=-1,p.domElement.focus(),f.renderShadows)i=new Li({parent:n,camera:_.camera,cascades:3,maxFar:500,mode:"logarithmic",shadowMapSize:4096*2,lightIntensity:1});else{const u=new ki(16121343,3);u.position.set(-30,50,-30).normalize(),n.add(u)}const y=new Fi(p),k=new Ti(n,_.camera),C=new Re(window.innerWidth,window.innerHeight),v=new Ai(C,n,_.camera),A=new Ii(Ri);v.edgeStrength=2,v.visibleEdgeColor.setHex(15102720),v.hiddenEdgeColor.setHex(6697728),v.enabled=!1,A.enabled=!1,y.addPass(k),y.addPass(v),y.addPass(A),document.body.appendChild(p.domElement),window.onresize=je(ei,500);const[tt,wt,et]=await ii(),E=new ls(tt,wt);E.addToWorld(a).addToScene(n),_.setCameraTarget(E),_.cameraMode=Ve.cinematic,_.camera.aspect=window.aspectRatio,_.camera.updateProjectionMatrix();const B=new Bi;_.camera.add(B);const H=new Oi(B);new ji().load("music/A Himitsu - Cease.ogg",u=>{H.setBuffer(u),H.setLoop(!0)});const z=new en(n,a),P=new Bn(z,E);P.initCheckpointHandler(n,{checkpoint:pn(),finish:et}),P.listeners.add(Q.start,()=>{H.isPlaying||H.play()}),Ut.add("audioVolume",u=>{H.setVolume(u)});const bt=new On(n,_.camera,p.domElement,z),D=jn(_,z);n.add(D),Wn(P,p),z.onPlaceVehicle=(u=0,S=0,L=0,W=0,O=0,it=0)=>{E.initialPosition.set(u,S,L),E.initialRotation.setFromEuler(Kt(W),Kt(O),Kt(it)),E.resetPosition()},z.eventTriggerListeners.add(J.setCameraPosition,({relatedTarget:u,dataSet:S})=>{if(u===E.chassisBody){const[L,W,O]=S.split(",");_.cameraPosition.set(Number(L),Number(W),Number(O))}}),z.eventTriggerListeners.add(J.setCameraMode,({relatedTarget:u,dataSet:S})=>{if(u===E.chassisBody){const[L,W,O,it]=S.split(",");_.cameraMode=L,(W||O||it)&&_.cameraPosition.set(Number(W),Number(O),Number(it))}}),z.eventTriggerListeners.add(J.startAnimation,({relatedTarget:u,dataSet:S})=>{if(u===E.chassisBody){const L=S,W=z.getBodyFromStore(L),{velocity_x:O,velocity_y:it,velocity_z:oi}=z.getAnimationPropsFromStore(L);W.velocity.set(O,it,oi)}}),z.eventTriggerListeners.add(J.reset,({relatedTarget:u})=>{u===E.chassisBody&&P.reset()}),z.listeners.add(G.mapElementSelect,u=>{if(v.selectedObjects.length=0,D.detach(),u===st)v.selectedObjects.push(E.chassisMesh,...E.wheelMeshes);else if(u){const S=z.getMeshFromStore(u);v.selectedObjects.push(S),D.attach(S)}}),j.addKeyPressListener("KeyP",()=>{K()}),j.addKeyPressListener("KeyO",()=>{console.log(_.camera.position.x,",",_.camera.position.y,",",_.camera.position.z)}),j.addKeyPressListener("KeyR",u=>{u.altKey?P.loadMap():P.respawnAtLastCheckpoint()}),j.addKeyPressListener("KeyC",()=>{_.switchMode()}),j.addKeyPressListener("KeyM",()=>{Dt()}),j.addKeyPressListener("Delete",()=>{z.editMode&&z.selectedMapElementId&&z.destroy(z.selectedMapElementId)}),j.addKeyDownChangeListener(u=>{let S=0,L=0;u.has("KeyW")||u.has("ArrowUp")?S=1:(u.has("KeyS")||u.has("ArrowDown"))&&(S=-1),u.has("KeyA")||u.has("ArrowLeft")?L=1:(u.has("KeyD")||u.has("ArrowRight"))&&(L=-1),!P.started&&S&&P.start(),E.setEngineForceDirection(S),E.setSteeringDirection(L),E.setBrakeForce(Number(u.has("Space")))}),P.loadMap();function Dt(){z.toggleEditMode(),z.editMode?(v.enabled=!0,A.enabled=!0,D.enabled=!0,bt.enabled=!0,z.selectedMapElementId&&D.attach(z.getMeshFromStore(z.selectedMapElementId))):(v.enabled=!1,A.enabled=!1,D.detach(),D.enabled=!1,bt.enabled=!1)}function K(){t=!t,t?(o.stop(),p.setAnimationLoop(null),yt("paused"),P.started&&P.stop()):(o.start(),p.setAnimationLoop(re),P.started&&P.start())}p.setAnimationLoop(re);function re(){const u=o.getDelta();_.update(u),P.updateHUD(),P.checkpointHandler.updateVisuals(u),i&&i.update(),y.render(),a.step(cs,u),f.renderWireFrame&&c.update()}function ei(){_.camera.aspect=window.aspectRatio,_.camera.updateProjectionMatrix(),p.setSize(window.innerWidth,window.innerHeight),y.setSize(window.innerWidth,window.innerHeight),v.setSize(window.innerWidth,window.innerHeight)}async function ii(){const[u,S,L,W]=await Promise.all([zt("img/skybox.jpg","398 kB"),zt("3D_objects/lowPoly_car_wheel.gltf","205 kB"),zt("3D_objects/mg.glb","98 kB"),zt("img/pin.svg","0.9 kB")]),O=new Di(Ki(u));return O.needsUpdate=!0,O.colorSpace=Wi,n.background=O,[L.scene,S.scene,Vi(W,{x:-6,y:-3,scale:.07})]}})();Object.defineProperty(window,"aspectRatio",{get(){return window.innerWidth/window.innerHeight}});export{Gt as C,Ue as E,$i as I,ti as M,J as T,He as a,T as b,f as c,tn as d,Zi as e,Go as f,on as g,ws as h,Uo as i,st as j,qo as l,Lt as m,V as n,ot as r,Nt as s,qi as t,ce as u,Yi as v};
