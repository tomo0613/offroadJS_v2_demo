var ti=Object.defineProperty;var ei=(i,t,e)=>t in i?ti(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var r=(i,t,e)=>(ei(i,typeof t!="symbol"?t+"":t,e),e);import{V as w,B as Vt,C as Me,S as ii,a as Pe,b as ht,c as q,d as Jt,Q as se,R as oi,M as Ee,W as ni,e as si,f as ai}from"./vendor/cannon-a7a89bfa.js";import{G as ri,c as hi,I as pi,d as Le,M as Pt,E as li,a as _t,e as ci,V as E,f as di,O as gi,B as ke,C as mi,S as _i,g as ui,h as yi,i as Lt,j as xi,k as Te,l as gt,R as fi,m as Fe,T as wi,n as bi,D as Ci,H as vi,W as zi,o as Si,p as Mi,q as Pi,r as Ei,s as Li}from"./vendor/three-30fa292b.js";import{j as g,r as _,a as ut}from"./vendor/react-6a63c5cb.js";import"./vendor/vendor-5e83183c.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();class st{constructor(){r(this,"listeners",new Map)}add(t,e){if(!e)throw new Error(`EventListener->add($listener) Invalid $listener: ${e}, with type ${t}`);if(this.listeners.has(t))this.listeners.get(t).add(e);else{const o=new Set([e]);this.listeners.set(t,o)}}remove(t,e){if(this.listeners.has(t)){const o=this.listeners.get(t);o.delete(e),o.size||this.listeners.delete(t)}}clear(){this.listeners.clear()}dispatch(t,...e){this.listeners.has(t)&&this.listeners.get(t).forEach(n=>n(...e))}}const Ae=["fullscreen","antialias","renderShadows","renderWireFrame","resolutionScale"],ki={fullscreen:!1,antialias:!1,renderShadows:!1,renderWireFrame:!1,resolutionScale:1,powerPreference:"high-performance",physicsFrameRate:120,world:{gravity:{x:0,y:-9.8,z:0}},camera:{fov:50,near:.1,far:1e3,initialPosition:{x:0,y:7,z:27},mountOffset_v3:[0,4,9],mountOffsetReverse_v3:[5,4,-9],lookOffset_v3:[0,1,-5]},vehicle:{mass:30,steeringSpeed:.02,maxSteeringAngle:.7,maxBrakeForce:22,maxEngineForce:220,torqueSplitRatio:[50,50],cameraMountPosition:{x:0,y:4,z:10},wheelRadius:.4,wheelSuspensionRestLength:.3,wheelSuspensionStiffness:25,wheelMaxSuspensionTravel:.3,wheelMaxSuspensionForce:Number.MAX_VALUE,wheelDampingCompression:2,wheelDampingRelaxation:2,wheelFrictionSlip:1.1,wheelForwardAcceleration:1/2,wheelSidedAcceleration:1,wheelRollInfluence:.6}},Ie=new st,Dt=Ae.reduce((i,t)=>{try{const e=window.localStorage.getItem(t);e&&(i[t]=JSON.parse(e))}catch(e){console.error(e)}return i},{}),f=new Proxy(ki,{get(i,t){return Dt.hasOwnProperty(t)?Dt[t]:i[t]},set(i,t,e){if(Ae.includes(t)){Dt[t]=e,Ie.dispatch(t,e);try{window.localStorage.setItem(t,String(e))}catch(o){console.error(o)}}return!0}});class Re{constructor(t,e){r(this,"items");r(this,"activeCount",0);r(this,"itemProvider");r(this,"itemActivator");r(this,"itemDeactivator");r(this,"itemActiveCheck");r(this,"obtain",()=>{this.activeCount>=this.items.length&&this.items.push(this.itemProvider(this.items.length));const t=this.items[this.activeCount++];return this.itemActivator(t),t});r(this,"release",t=>{if(!this.itemActiveCheck(t))throw new Error(`ObjectPool->release($item) Not active $item: ${JSON.stringify(t)}`);if(this.activeCount--,this.itemDeactivator(t),!this.activeCount)return;const e=this.items.indexOf(t),o=this.items[this.activeCount];if(e<0)throw new Error(`ObjectPool->release($item) Not valid $item: ${JSON.stringify(t)}`);t!==o&&(this.items[this.activeCount]=this.items[e],this.items[e]=o)});r(this,"releaseAll",()=>{this.forActive(this.release)});r(this,"forActive",t=>{for(let e=this.activeCount-1;e>=0;e--)t.call(this,this.items[e])});this.itemProvider=e.itemProvider,this.itemActivator=e.itemActivator,this.itemDeactivator=e.itemDeactivator,this.itemActiveCheck=e.itemActiveCheck,this.items=Array.from({length:t}).map(this.itemProvider)}}const Ti=function({label:i,id:t,children:e}){return i?g.jsxs("div",{className:"inputContainer",children:[g.jsx("label",{htmlFor:t,children:i}),e]}):g.jsx(g.Fragment,{children:e})};function N(){}function bt(i,t="?"){const e=i.split(".").pop(),o=ao(`Loading resource: ${i}`);let n;switch(e){case"jpg":n=new pi;break;case"svg":n=new hi;break;case"glb":case"gltf":n=new ri;break;default:return Promise.reject(new Error(`unknown resource type [${e}]`))}return new Promise((a,h)=>{const l=p=>{a(p),He(o)},d=p=>{console.error(`Failed to load resource: ${i}`),h(p)};n.load(i,l,s,d)});function s({loaded:a,total:h,lengthComputable:l}){const d=l?`${ae(h,"k")} kB`:t;o.setContent(`Loading resource: ${i} (${ae(a,"k")} / ${d})`)}}function ae(i,t){let e=i;const o=["k","M","G","T"].indexOf(t)+1;for(let n=0;n<o;n++)e/=1024;return e.toFixed(2)}function Fi({paths:i},t={}){const e=new Le,o={bevelEnabled:!1,depth:1};for(let c=0;c<i.length;c++){const u=i[c],x=new Pt({color:u.color}),F=u.toShapes(!1);for(let v=0;v<F.length;v++){const P=F[v],O=new li(P,o),Y=new _t(O,x);e.add(Y)}}const{x:n,y:s,z:a}=new ci().setFromObject(e).getSize(new E),{x:h=0,y:l=0,z:d=0,scale:p=1}=t;return e.traverse(c=>{c.translateX(-n/2+h),c.translateY(-s/2+l),c.translateZ(-a/2+d)}),e.rotateY(Math.PI),e.rotateZ(Math.PI),e.scale.set(p,p,p),e}function Ai(i,t=1024){return[{x:2,y:1},{x:0,y:1},{x:1,y:0},{x:1,y:2},{x:1,y:1},{x:3,y:1}].map(o);function o({x:n,y:s}){const a=document.createElement("canvas");return a.width=t,a.height=t,a.getContext("2d").drawImage(i,-n*t,-s*t),a}}function Be(i,t=200,e=!1){let o;return(...n)=>{e&&!o&&i(...n),clearTimeout(o),o=window.setTimeout(()=>{e?o=void 0:i(...n)},t)}}function Ii(i,t=200){let e,o,n,s;return(...a)=>{s=o+t,n=performance.now(),!o||n>s?(i(...a),o=n):(window.clearTimeout(e),e=window.setTimeout(()=>{i(...a),o=n},t-(n-o)))}}const Ri=/Android|iPhone|iPad/i;function Bi(){return Ri.test(window.navigator.userAgent)}function Qt(i){const t=Math.floor(i%1e3),e=Math.floor(i/1e3%60),o=Math.floor(i/6e4%60);return`${re(o)}:${re(e)}.${t}`}function re(i){const t=i.toString();return t.length<2?`0${i}`:t}function Oi(i){return`#${i.toString(16).toUpperCase()}`}function ns(i){return parseInt(i.replace("#",""),16)}function Q(i){return Math.round((i+Number.EPSILON)*100)/100}function ji(i,t,e){return Math.max(t,Math.min(i,e))}function Di(i,...t){return Object.keys(i).reduce((e,o)=>(t.includes(o)||(e[o]=i[o]),e),{})}function Wi(i,...t){return t.reduce((e,o)=>(i.hasOwnProperty(o)&&(e[o]=i[o]),e),{})}Object.defineProperties(Object,{omit:{value:Di},pick:{value:Wi}});const kt=document.createElement("datalist");kt.id="colorValueList";document.documentElement.appendChild(kt);function Hi(i){const t=document.createElement("option");t.textContent=Oi(i),kt.appendChild(t)}class qt extends _.Component{constructor(e){super(e);r(this,"inputRef",_.createRef());r(this,"onInputFieldChange",({currentTarget:e})=>{this.props.onInput&&this.props.onInput(e.value),this.setState({value:e.value})});r(this,"onInputFieldKeyUp",({key:e})=>{(e==="Enter"||e==="Escape")&&this.inputElement.blur()});r(this,"onInputFieldBlur",()=>{this.state.value!==this.props.value.toLowerCase()&&this.props.onChange(this.state.value,this.props.id)});this.state={value:e.value.toLowerCase()}}render(){const{id:e,label:o}=this.props,{value:n}=this.state;return g.jsx(Ti,{label:o,id:e,children:g.jsx("input",{type:"color",list:kt.id,value:n,id:e,name:e,onChange:this.onInputFieldChange,onBlur:this.onInputFieldBlur,onKeyUp:this.onInputFieldKeyUp,ref:this.inputRef})})}componentDidUpdate(e){this.props.value!==e.value&&this.setState({value:this.props.value})}get inputElement(){return this.inputRef.current}}r(qt,"defaultProps",{id:"",label:"",value:"",onChange:N}),r(qt,"addColorValues",(...e)=>{e.forEach(Hi)});const Ni=new Set(["Space","PageUp","PageDown","End","Home","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Escape","Tab"]),$i=new Set(["KeyF","KeyH","KeyJ","KeyO","KeyP","KeyS"]),G=new Set;let nt;const Tt=new Set,Ft=new st,R={addKeyPressListener:qi,removeKeyPressListener:Ui,addKeyDownChangeListener:Ki,removeKeyDownChangeListener:Vi,clearKeysDown:Gi};function Ki(i){Tt.add(i)}function Vi(i){Tt.delete(i)}function qi(i,t){Ft.add(i,t)}function Ui(i,t){Ft.remove(i,t)}function Gi(){G.clear(),Tt.forEach(je)}window.onkeydown=window.onkeyup=i=>{i.target.tagName==="INPUT"||i.target.tabIndex>-1||((Ni.has(i.code)||i.ctrlKey&&$i.has(i.code))&&i.preventDefault(),!(i.type==="keydown"&&i.repeat)&&(nt=i.code,i.type==="keyup"?(G.delete(nt),Ft.dispatch(nt,i)):G.add(nt),Ut()))};window.onbeforeunload=i=>{if(G.has("ControlLeft"))return i.preventDefault(),G.clear(),""};Et("topLeftPanel","Tab","⋮");Bi()&&(Ct("bottomLeftPanel","ArrowUp","▲"),Ct("bottomLeftPanel","ArrowDown","▼"),Ct("bottomRightPanel","ArrowLeft","◄"),Ct("bottomRightPanel","ArrowRight","►"),Et("topRightPanel","KeyP","p"),Et("topRightPanel","KeyC","c"),Et("topRightPanel","KeyR","⟲"));function Oe(i,t,e){const o=document.createElement("button");o.addEventListener("mousedown",t),o.addEventListener("touchstart",t),o.addEventListener("mouseup",e),o.addEventListener("mouseleave",e),o.addEventListener("touchcancel",e),o.addEventListener("touchend",e);const n=document.getElementById(i);return n.classList.remove("hidden"),n.appendChild(o)}function Et(i,t,e){const o=Be(s=>{nt=t,Ft.dispatch(nt,s)},200,!0),n=Oe(i,o,N);n.textContent=e,n.id=t,n.classList.add("screenButton")}function Ct(i,t,e){const s=Oe(i,()=>{G.add(t),Ut()},()=>{G.delete(t),Ut()});s.textContent=e,s.id=t,s.classList.add("screenKey")}function Ut(){Tt.forEach(je)}function je(i){i(G)}const Zi=`
    input:not([disabled]),
    textarea:not([disabled]),
    button:not([disabled]),
    select,
    [tabindex]
`,Yi="⨯",A=document.createElement("aside");A.classList.add("hidden");A.id="modal__root";A.tabIndex=-1;document.body.appendChild(A);const Xi=function({onClose:i,children:t}){return g.jsxs("div",{className:"modal__container",children:[i&&g.jsx("span",{className:"modal__closeButton",onClick:i,children:Yi}),t]})},De=function({onClose:i,children:t}){const e=document.activeElement;return _.useEffect(()=>(R.clearKeysDown(),A.classList.remove("hidden"),A.addEventListener("keydown",o),A.addEventListener("keyup",n),A.focus(),()=>{A.removeEventListener("keydown",o),A.removeEventListener("keyup",n),A.classList.add("hidden"),e.focus()}),[]),ut.createPortal(g.jsx(Xi,{onClose:i,children:t}),A);function o(a){a.stopPropagation(),a.key==="Tab"&&a.preventDefault()}function n(a){a.stopPropagation(),a.preventDefault(),i&&a.key==="Escape"?i():a.key==="Tab"&&s(a.shiftKey?-1:1)}function s(a){const h=Ji(A);if(!h.length)return;const l=document.activeElement,d=h.indexOf(l),p=h.length-1;let c=d+a;c<0?c=p:c>p&&(c=0),h[c].focus()}};function Ji(i){return[...i.querySelectorAll(Zi)].filter(Qi)}function Qi(i){return i.tabIndex!==-1&&window.getComputedStyle(i).visibility!=="hidden"}const to={okButtonLabel:"Ok",cancelButtonLabel:"Cancel",importButtonLabel:"Import",exportButtonLabel:"Export",mapElementListLabel:"Map elements:",translatePanelLabel:"Translate",positionLabel:"position",rotationLabel:"rotation",transformPanelLabel:"Transform",widthLabel:"width:",heightLabel:"height:",lengthLabel:"length:",radiusTopLabel:"radiusTop:",radiusBottomLabel:"radiusBottom:",sidesLabel:"sides:",segmentWidthLabel:"segmentWidth:",segmentHeightLabel:"segmentHeight:",segmentLengthLabel:"segmentLength:",segmentCountLabel:"segmentCount:",offsetLabel:"offset:",radiusLabel:"radius:",angleLabel:"angle:",cloneButtonLabel:"clone",removeButtonLabel:"remove",createButtonLabel:"create",fullscreenSwitchLabel:"Fullscreen:",renderWireFrameSwitchLabel:"Render wireFrame:",resolutionScaleSliderLabel:"Resolution scale:",antialiasCheckboxLabel:"Antialias:",renderShadowsCheckboxLabel:"Render shadows:",applySettingsButtonLabel:"Apply settings"},he=new Proxy(to,{get(i,t){return i[t]}});var W=(i=>(i.open="open",i.confirm="confirm",i.didMount="didMount",i.willUnmount="willUnmount",i))(W||{});const I=new st,At=document.createElement("aside");At.id="menuModalControllerRoot";At.classList.add("hidden");document.body.appendChild(At);function eo(){ut.render(g.jsx(_.StrictMode,{children:g.jsx(io,{})}),At)}function io(){const[i,t]=_.useState(!0),e=_.useRef("");return _.useEffect(()=>(I.add("open",n),I.dispatch("didMount"),()=>{I.dispatch("willUnmount"),I.remove("open",n)}),[]),i?null:g.jsx(oo,{message:e.current,closeModal:o});function o(){t(!0)}function n(s=""){e.current=s,t(!1)}}function oo({message:i,closeModal:t}){const e=_.useRef();return _.useEffect(()=>{e.current.focus()},[]),g.jsxs(De,{children:[g.jsx("span",{className:"modal__body dialog__message",children:i}),g.jsxs("div",{className:"modal__footer dialog__buttonBar",children:[g.jsx("button",{className:"dialog__button",onClick:o,"data-confirm":"false",children:he.cancelButtonLabel}),g.jsx("button",{className:"dialog__button",onClick:o,"data-confirm":"true",ref:e,children:he.okButtonLabel})]})]});function o(n){const s=JSON.parse(n.currentTarget.dataset.confirm);I.dispatch("confirm",s),t()}}class no{constructor(){r(this,"notificationElement",document.createElement("div"));r(this,"notificationElementBody",document.createElement("span"));this.notificationElement.classList.add("notificationElement","hidden"),this.notificationElement.appendChild(this.notificationElementBody)}get hidden(){return this.notificationElement.classList.contains("hidden")}show(){this.notificationElement.classList.remove("hidden")}fadeOut(){this.notificationElement.classList.add("fade-out")}hide(){this.notificationElement.classList.remove("fade-out"),this.notificationElement.classList.add("hidden")}setContent(t){this.notificationElementBody.textContent=t}}const so=1500,We=1e3,te=document.createElement("div");te.id="notificationElementContainer";document.body.appendChild(te);document.documentElement.style.setProperty("--fade-out-duration",`${We/1e3}s`);const ee=new Re(1,{itemProvider(){return new no},itemActiveCheck(i){return!i.hidden},itemActivator(i){i.show(),te.appendChild(i.notificationElement)},itemDeactivator(i){i.hide()}});function ao(i){const t=ee.obtain();return t.setContent(i),t}function He(i){i.fadeOut(),window.setTimeout(()=>{ee.release(i)},We)}function mt(i){const t=ee.obtain();t.setContent(i),window.setTimeout(()=>{He(t)},so)}let ie=!1;I.add(W.didMount,()=>{ie=!0});I.add(W.willUnmount,()=>{ie=!1});eo();function ro(i){if(ie)I.dispatch(W.open,i);else{const t=()=>{I.remove(W.didMount,t),I.dispatch(W.open,i)};I.add(W.didMount,t)}return new Promise(t=>{I.add(W.confirm,e);function e(o){I.remove(W.confirm,e),t(o)}})}var Ne=(i=>(i.cinematic="cinematic",i.free="free",i.chase="chase",i.hood="hood",i))(Ne||{});const Wt=["cinematic","free","chase","hood"],ho=new E(0,1,0),pe=.2,po=new E(...f.camera.mountOffset_v3),lo=new E(...f.camera.mountOffsetReverse_v3),co=new E(...f.camera.lookOffset_v3);class go{constructor(t){r(this,"domElement");r(this,"camera");r(this,"orbitControls");r(this,"cameraTarget");r(this,"cameraPosition",new E);r(this,"currentCameraMode");r(this,"idealChaseCameraLookPosition",new E);r(this,"idealChaseCameraMountPosition",new E);r(this,"actualChaseCameraLookPosition",new E);r(this,"update",N);this.domElement=t,this.camera=new di(f.camera.fov,window.aspectRatio,f.camera.near,f.camera.far),this.camera.position.set(f.camera.initialPosition.x,f.camera.initialPosition.y,f.camera.initialPosition.z),this.cameraPosition.copy(this.camera.position),this.orbitControls=new gi(this.camera,t),this.orbitControls.minDistance=1,this.orbitControls.enabled=!1}set cameraMode(t){if(this.currentCameraMode!==t){switch(this.currentCameraMode){case"cinematic":case"chase":this.update=N;break;case"hood":this.cameraTarget.chassisMesh.remove(this.camera),this.camera.position.copy(this.cameraTargetPosition),this.camera.position.y+=5,this.camera.fov=f.camera.fov,this.camera.updateProjectionMatrix();break;case"free":this.orbitControls.enabled=!1;break}switch(t){case"cinematic":this.update=this.updateDynamicCamera,mt('Camera mode is set to: "cinematic"');break;case"chase":this.update=this.updateChaseCamera,mt('Camera mode is set to: "chase"');break;case"hood":this.cameraTarget.chassisMesh.add(this.camera),this.camera.position.set(0,1.1,-.47),this.camera.rotation.set(0,0,0),this.camera.fov=60,this.camera.updateProjectionMatrix(),this.update=N,mt('Camera mode is set to: "hood"');break;case"free":this.orbitControls.enabled=!0,this.orbitControls.target.copy(this.cameraTargetPosition),mt('Camera mode is set to: "free" (use mouse to look around)');break}this.currentCameraMode=t}}get cameraTargetPosition(){return this.cameraTarget.chassisMesh.position}rotate(t){this.camera.rotateOnAxis(ho,t)}setIdealChaseCameraMountPosition(t){t?this.idealChaseCameraMountPosition.copy(lo):this.idealChaseCameraMountPosition.copy(po),this.idealChaseCameraMountPosition.applyQuaternion(this.cameraTarget.chassisMesh.quaternion),this.idealChaseCameraMountPosition.add(this.cameraTargetPosition),this.idealChaseCameraMountPosition.y<this.cameraTargetPosition.y&&this.idealChaseCameraMountPosition.setY(this.cameraTargetPosition.y)}setIdealChaseCameraLookPosition(t){this.idealChaseCameraLookPosition.copy(co),t&&(this.idealChaseCameraLookPosition.z*=-1),this.idealChaseCameraLookPosition.applyQuaternion(this.cameraTarget.chassisMesh.quaternion),this.idealChaseCameraLookPosition.add(this.cameraTargetPosition)}updateDynamicCamera(t){if(this.camera.position.manhattanDistanceTo(this.cameraPosition)>Number.EPSILON){const e=1-pe**t;this.camera.position.lerp(this.cameraPosition,e)}this.camera.lookAt(this.cameraTargetPosition)}updateChaseCamera(t){const{currentVehicleSpeedKmHour:e}=this.cameraTarget.base,o=Math.round(-e)<-1,n=1-pe**t;this.setIdealChaseCameraMountPosition(o),this.setIdealChaseCameraLookPosition(o),this.camera.position.lerp(this.idealChaseCameraMountPosition,n),this.actualChaseCameraLookPosition.lerp(this.idealChaseCameraLookPosition,n),this.camera.lookAt(this.actualChaseCameraLookPosition)}switchMode(){const t=Wt.indexOf(this.currentCameraMode),e=t<Wt.length-1?t+1:0,o=Wt[e];this.cameraMode=o}setCameraTarget(t){t!==this.cameraTarget&&(this.cameraTarget=t)}}const mo="modulepreload",_o=function(i,t){return new URL(i,t).href},le={},$e=function(t,e,o){if(!e||e.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(e.map(s=>{if(s=_o(s,o),s in le)return;le[s]=!0;const a=s.endsWith(".css"),h=a?'[rel="stylesheet"]':"";if(!!o)for(let p=n.length-1;p>=0;p--){const c=n[p];if(c.href===s&&(!a||c.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${h}`))return;const d=document.createElement("link");if(d.rel=a?"stylesheet":mo,a||(d.as="script",d.crossOrigin=""),d.href=s,document.head.appendChild(d),a)return new Promise((p,c)=>{d.addEventListener("load",p),d.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t())};function Ke(){return g.jsx("div",{children:"Loading..."})}const at=document.createElement("aside");at.id="editorPanel";at.classList.add("floatingPanel","hidden");document.body.appendChild(at);const uo={mapBuilder:void 0,mapElementProps:void 0,editorPanelVisible:!1},Ve=_.createContext(uo);function yo(i){ut.render(g.jsx(xo,{mapBuilder:i}),at)}function xo({mapBuilder:i}){const[t,e]=_.useState(i.editMode),[o,n]=_.useState(i.selectedMapElementId),[s,a]=_.useState();_.useEffect(()=>(i.listeners.add(V.mapElementSelect,n),i.listeners.add(V.mapElementChange,a),i.listeners.add(V.editModeChange,e),()=>{i.listeners.remove(V.mapElementSelect,n),i.listeners.remove(V.mapElementChange,a),i.listeners.remove(V.editModeChange,e)}),[]),_.useEffect(()=>{a({...i.getPropsFromStore(o)})},[o]),_.useEffect(()=>{t?at.classList.remove("hidden"):at.classList.add("hidden")},[t]);const h={mapBuilder:i,mapElementProps:s,editorPanelVisible:t};return g.jsx(Ve.Provider,{value:h,children:g.jsx(fo,{})})}function fo(){const{editorPanelVisible:i}=_.useContext(Ve),t=_.lazy(()=>$e(()=>import("./modules/EditorPanel-67f6f788.js"),["./modules\\EditorPanel-67f6f788.js","./vendor\\react-6a63c5cb.js","./vendor\\vendor-5e83183c.js","./modules\\Switch-0a92a31b.js","./vendor\\cannon-a7a89bfa.js","./vendor\\three-30fa292b.js"],import.meta.url));return _.useMemo(()=>i?g.jsx(_.Suspense,{fallback:g.jsx(Ke,{}),children:g.jsx(t,{})}):null,[i])}const pt=new w;function wo(i,t){const e=new w,o=new w,n=new w,s=new w,{movement:{x:a=0,y:h=0,z:l=0},speed:d=1,triggerStart:p=!0,alternate:c=!0,alternateDelay:u=0}=JSON.parse(t),x=d*.05;return n.copy(i.position),s.set(a,h,l),s.vadd(i.position,s),s.vsub(n,pt),pt.normalize(),pt.scale(d,e),e.negate(o),{triggerStart:p,movementHandler:F,velocity_x:e.x,velocity_y:e.y,velocity_z:e.z};function F(){i.position.almostEquals(s,x)&&O(s)?(c?u?(i.velocity.setZero(),window.setTimeout(v,u*1e3)):v():i.velocity.setZero(),i.position.copy(s)):i.position.almostEquals(n,x)&&O(n)&&(u?(i.velocity.setZero(),window.setTimeout(P,u*1e3)):P(),i.position.copy(n))}function v(){i.velocity.copy(o)}function P(){i.velocity.copy(e)}function O(Y){return Y.vsub(i.position,pt),pt.dot(i.velocity)>0}}function vt(i){const{width:t,height:e,length:o,radius:n,radiusTop:s,radiusBottom:a,sides:h,offset:l}=i;let d,p;switch(i.shape){case T.box:d=Co(t,e,o),p=bo(t,e,o);break;case T.cylinder:d=zo(s,a,e,h),p=vo(s,a,e,h);break;case T.sphere:d=Mo(n),p=So(n);break;case T.tetrahedron:d=Po(t,e,o),p=ce(d);break;case T.triangularPrism:d=Eo(t,e,o,l),p=ce(d);break;default:return[]}return[d,p]}function bo(i=2,t=2,e=2){return new ke(i,t,e)}function Co(i=2,t=2,e=2){return new Vt(new w(i/2,t/2,e/2))}function vo(i=1,t=1,e=2,o=6){return new mi(i,t,e,Math.max(3,o))}function zo(i=1,t=1,e=2,o=6){return new Me(i,t,e,Math.max(3,o))}function So(i=1){return new _i(i)}function Mo(i=1){return new ii(i)}function ce(i){return new ui(i.vertices.map(({x:t,y:e,z:o})=>new E(t,e,o)))}function Po(i=1,t=1,e=1){const o=[new w(0,0,0),new w(i*2,0,0),new w(0,t*2,0),new w(0,0,e*2)],n=[[0,2,1],[1,2,3],[0,1,3],[3,2,0]];return new Pe({vertices:o,faces:n})}function Eo(i=2,t=2,e=2,o=0){const n=i/2,s=t/2,a=e/2,h=[new w(n,s,o),new w(n,-s,-a),new w(n,-s,a),new w(-n,s,o),new w(-n,-s,-a),new w(-n,-s,a)],l=[[2,1,0],[4,5,3],[4,1,2,5],[3,0,1,4],[5,2,0,3]],d=ko(h,l);return new Pe({vertices:h,faces:l,normals:d})}const de=new w,Lo=new w,tt=new w;new E;new E(0,0,1);function ko(i,t){return To(i),t.map(e=>{const o=i[e[0]],n=de.copy(i[e[1]]),s=Lo.copy(i[e[2]]);n.vsub(o,n),s.vsub(o,s);const a=new w().copy(n);a.cross(s,a).normalize();const h=de.copy(o);return o.vsub(tt,h),a.dot(h)<0&&a.negate(),a})}function To(i){const{length:t}=i;tt.set(0,0,0);for(let e=0;e<t;e++)tt.vadd(i[e],tt);tt.scale(1/t,tt)}const{degToRad:Fo,radToDeg:H}=Lt,Ao={segmentCount:13,segmentWidth:4,segmentHeight:.1,segmentLength:4,segmentPositionOffset:.4,radius:8},Io={segmentCount:2,segmentWidth:2,segmentHeight:.4,segmentLength:4,angle:30},Ro={segmentCount:10,segmentWidth:4,segmentHeight:.1,segmentLength:2,angle:30,radius:8},Bo=["loop","slopeTransition","cantedCurve"],qe=new E,U=new E,Oo=new E,ge=new E,y=new yi;function me(i){switch(i.shape){case T.loop:return jo(i);case T.slopeTransition:return Wo(i);case T.cantedCurve:return Do(i);default:return[]}}function jo(i){const{segmentCount:t,segmentWidth:e,segmentHeight:o,segmentLength:n,segmentPositionOffset:s,radius:a}=oe(i,Ao),h=[],l=Math.atan(a/(n/2)),d=Math.PI-2*l,p=qe.set(1,0,0);for(let c=0;c<t;c++)U.set(s*c,-a,0).applyAxisAngle(p,d*c),h.push({shape:T.box,width:e,height:o,length:n,position_x:U.x,position_y:U.y,position_z:U.z,rotation_x:H(d*c)});return h}function Do(i){const{segmentCount:t,segmentWidth:e,segmentHeight:o,segmentLength:n,angle:s,radius:a}=oe(i,Ro),h=[],l=qe;l.set(0,1,0);const d=Fo(s),p=e/2,c=p*Math.cos(d),u=Math.sqrt(p**2-c**2),x=n/2,F=Math.atan((a-c)/x),v=Math.PI-2*F,P=Math.sqrt(n**2+e**2),O=Oo.set(x,u,-a+-c),yt=ge.copy(O).applyAxisAngle(l,v).sub(O).length(),z=(e+P+yt)/2,b=2*Math.sqrt(z*(z-e)*(z-P)*(z-yt))/e,X=e/2-(e-Math.sqrt(P**2-b**2)),j=X*Math.cos(d),Ot=Math.sqrt(X**2-j**2),xt=ge.set(x+b,Ot,-a+-j);xt.applyAxisAngle(l,v);const ft=xt.sub(O).length(),wt=Math.acos((b**2+b**2-ft**2)/(2*b*b)),jt=b/2*Math.sin(wt);for(let m=0;m<t+1;m++)l.set(0,1,0),U.set(0,0,-a).applyAxisAngle(l,v*m),y.position.copy(U),y.rotation.set(0,v*m,Math.PI/2),y.rotateOnAxis(l,-d),y.translateZ(o/2),m<t&&h.push({shape:T.triangularPrism,width:o,height:n,length:e,offset:e/2,position_x:y.position.x,position_y:y.position.y,position_z:y.position.z,rotation_x:H(y.rotation.x),rotation_y:H(y.rotation.y),rotation_z:H(y.rotation.z)}),m&&(l.set(1,0,0),y.rotateOnAxis(l,Math.PI),y.translateY(n/2+b/2),l.set(0,0,1),y.rotateOnAxis(l,-wt),y.translateX(jt),y.translateY(0),h.push({shape:T.triangularPrism,width:o,height:b,length:e,offset:X,position_x:y.position.x,position_y:y.position.y,position_z:y.position.z,rotation_x:H(y.rotation.x),rotation_y:H(y.rotation.y),rotation_z:H(y.rotation.z)}));return h}function Wo(i){const{segmentCount:t,segmentWidth:e,segmentHeight:o,segmentLength:n}=oe(i,Io),s=[],a=.1,h=Math.atan(o/e);y.position.set(0,a,0),y.rotation.set(0,0,0);for(let l=0;l<t;l++)l&&(y.translateY(o),y.translateZ(-n)),y.rotation.set(0,0,-h*l),s.push({shape:T.tetrahedron,width:e/2,height:o/2,length:n/2,position_x:y.position.x,position_y:y.position.y,position_z:y.position.z,rotation_z:H(y.rotation.z)}),U.copy(y.position),y.translateX(e/2),y.translateY(-a/2),y.translateZ(n/2),s.push({shape:T.box,width:e,height:a,length:n,position_x:y.position.x,position_y:y.position.y,position_z:y.position.z,rotation_z:H(y.rotation.z)}),y.position.copy(U);return s}function oe(i,t){return{...t,...i}}const{degToRad:k}=Lt;var V=(i=>(i.mapElementChange="mapElementChange",i.mapElementSelect="mapElementSelect",i.editModeChange="editModeChange",i))(V||{}),Z=(i=>(i.checkpoint="checkpoint",i.finish="finish",i.reset="reset",i.setCameraMode="setCameraMode",i.setCameraPosition="setCameraPosition",i.startAnimation="startAnimation",i))(Z||{}),Ho=(i=>(i.default="default",i.compound="compound",i.animated="animated",i.trigger="trigger",i.vehicle="vehicle",i))(Ho||{}),T=(i=>(i.box="box",i.cylinder="cylinder",i.sphere="sphere",i.tetrahedron="tetrahedron",i.triangularPrism="triangularPrism",i.loop="loop",i.slopeTransition="slopeTransition",i.cantedCurve="cantedCurve",i))(T||{});const et="vehicle_0",ne=12303291,Ue=9814245,Ge=10463419,Ze=13464275,zt=new xi;let _e,ue,ye=0;qt.addColorValues(ne,Ue,Ge);class No{constructor(t,e){r(this,"scene");r(this,"world");r(this,"selectedMapElementId");r(this,"perviousSelectedMapElementId");r(this,"mapElementComponentStore",new Map);r(this,"mapElementIdStore",new Set);r(this,"listeners",new st);r(this,"eventTriggerListeners",new st);r(this,"editMode",!1);r(this,"onPlaceVehicle",N);r(this,"destroy",t=>{if(t===et)return;const e=this.getBodyFromStore(t),o=this.getMeshFromStore(t),{type:n}=this.getPropsFromStore(t);if(this.scene.remove(o),this.world.removeBody(e),this.world.removeEventListener("postStep",this.getUpdateMethodFromStore(t)),Gt(o)?o.children.forEach(xe):xe(o),n==="trigger"){const s=this.mapElementComponentStore.get(`${t}_listener`);e.removeEventListener(q.COLLIDE_EVENT_NAME,s),this.mapElementComponentStore.delete(`${t}_listener`)}if(n==="animated"){const s=this.getAnimationPropsFromStore(t);this.world.removeEventListener("preStep",s.movementHandler),this.mapElementComponentStore.delete(`${t}_animationProps`)}this.mapElementIdStore.delete(t),this.mapElementComponentStore.delete(`${t}_mesh`),this.mapElementComponentStore.delete(`${t}_body`),this.mapElementComponentStore.delete(`${t}_updateMethod`),this.mapElementComponentStore.delete(`${t}_props`),this.selectedMapElementId===t&&(this.selectedMapElementId=void 0,this.listeners.dispatch("mapElementSelect",void 0)),this.perviousSelectedMapElementId===t&&(this.perviousSelectedMapElementId=void 0)});r(this,"selectMapElement",t=>{this.selectedMapElementId&&(this.perviousSelectedMapElementId=this.selectedMapElementId),this.selectedMapElementId=t,this.listeners.dispatch("mapElementSelect",this.selectedMapElementId)});r(this,"resetElementIfDynamic",t=>{const{type:e,mass:o,position_x:n=0,position_y:s=0,position_z:a=0,rotation_x:h=0,rotation_y:l=0,rotation_z:d=0}=this.getPropsFromStore(t);if(e==="vehicle"){this.onPlaceVehicle(n,s,a,h,l,d);return}if(!o&&e!=="animated")return;const p=this.getBodyFromStore(t);if(e==="animated"){const{triggerStart:c,velocity_x:u,velocity_y:x,velocity_z:F}=this.getAnimationPropsFromStore(t);c?p.velocity.setZero():p.velocity.set(u,x,F)}else p.velocity.setZero(),p.angularVelocity.setZero();p.position.set(n,s,a),p.quaternion.setFromEuler(k(h),k(l),k(d))});r(this,"importMap",t=>{this.mapElementIdStore.forEach(this.destroy),ye=0,t.forEach(e=>{e.type==="vehicle"?this.placeVehicle({...e}):this.build({...e})})});r(this,"exportMap",()=>Array.from(this.mapElementComponentStore.entries()).filter(([t])=>t.endsWith("props")).map(([,t])=>t));this.scene=t,this.world=e;const n=Object.values(e.contactMaterialTable.data).filter(Ko).reduce((s,a)=>{const[h,l]=a.materials;return s.set(h.name,h),s.set(l.name,l),s},new Map);ue=n.get("general"),_e=n.get("lowFriction"),yo(this)}get mapElementIdList(){return Array.from(this.mapElementIdStore)}getBodyFromStore(t){return this.mapElementComponentStore.get(`${t}_body`)}getMeshFromStore(t){return this.mapElementComponentStore.get(`${t}_mesh`)}getPropsFromStore(t){return this.mapElementComponentStore.get(`${t}_props`)}getUpdateMethodFromStore(t){return this.mapElementComponentStore.get(`${t}_updateMethod`)}getAnimationPropsFromStore(t){return this.mapElementComponentStore.get(`${t}_animationProps`)}addToWorld(t,e,o){const n=`${o.type||o.shape}_${ye++}`,{type:s,mass:a=0,position_x:h=0,position_y:l=0,position_z:d=0,rotation_x:p=0,rotation_y:c=0,rotation_z:u=0,fixedRotation:x=!1}=o,F=()=>{e.position.copy(t.position),e.quaternion.copy(t.quaternion)};if(t.position.set(h,l,d),e.position.copy(t.position),e.name=n,(p||c||u)&&(t.quaternion.setFromEuler(k(p),k(c),k(u)),e.quaternion.copy(t.quaternion)),x&&(t.fixedRotation=!0,t.updateMassProperties()),f.renderShadows&&(e.castShadow=!0,e.receiveShadow=!0),this.world.addBody(t),this.scene.add(e),s==="animated"){const v=wo(t,o.dataSet);t.type=ht.KINEMATIC,v.triggerStart||t.velocity.set(v.velocity_x,v.velocity_y,v.velocity_z),this.mapElementComponentStore.set(`${n}_animationProps`,v),this.world.addEventListener("preStep",v.movementHandler)}return(a||s==="animated")&&this.world.addEventListener("postStep",F),t.aabbNeedsUpdate=!0,this.mapElementIdStore.add(n),this.mapElementComponentStore.set(`${n}_mesh`,e),this.mapElementComponentStore.set(`${n}_body`,t),this.mapElementComponentStore.set(`${n}_props`,o),this.mapElementComponentStore.set(`${n}_updateMethod`,F),this.editMode&&this.selectMapElement(n),n}toggleEditMode(){this.editMode=!this.editMode,this.editMode?this.mapElementIdList.forEach(t=>{this.setEventTriggerVisibility(t,!0)}):this.mapElementIdList.forEach(t=>{this.setEventTriggerVisibility(t,!1)}),this.listeners.dispatch("editModeChange",this.editMode)}clone(t){return this.build({...this.getPropsFromStore(t)})}build(t){const e=new Te({color:$o(t)}),o=t.lowFriction?_e:ue,n=new q({mass:t.mass,material:o});let s;if(Bo.includes(t.shape)&&!t.type&&(t.type="compound"),t.type==="compound")s=new Le,me(t).forEach(h=>{const[l,d]=vt(h),p=new _t(d,e);zt.set(k(h.rotation_x||0),k(h.rotation_y||0),k(h.rotation_z||0)),p.quaternion.setFromEuler(zt),p.position.set(h.position_x,h.position_y,h.position_z),s.add(p),n.addShape(l,p.position,p.quaternion)});else{const[h,l]=vt(t);n.addShape(h),s=new _t(l,e)}const a=this.addToWorld(n,s,t);return t.type==="trigger"&&this.setUpEventTrigger(a,t),a}setUpEventTrigger(t,e){const{event:o="setCameraPosition",dataSet:n="0,0,0"}=e,s=this.getBodyFromStore(t),a=this.getMeshFromStore(t),h=this.mapElementComponentStore.get(`${t}_listener`),l=({target:d,body:p})=>{this.eventTriggerListeners.dispatch(o,{target:d,dataSet:n,relatedTarget:p})};h&&s.removeEventListener(q.COLLIDE_EVENT_NAME,h),this.mapElementComponentStore.set(`${t}_listener`,l),s.collisionResponse=!1,s.addEventListener(q.COLLIDE_EVENT_NAME,l),Ht(a,Ze,.3),this.editMode||(a.visible=!1)}convertEventTriggerToDefaultElement(t){const e=this.getBodyFromStore(t),o=this.getMeshFromStore(t),n=this.mapElementComponentStore.get(`${t}_listener`);e.removeEventListener(q.COLLIDE_EVENT_NAME,n),this.mapElementComponentStore.delete(`${t}_listener`),e.collisionResponse=!0,Ht(o,ne,1)}placeVehicle(t){const{position_x:e,position_y:o,position_z:n,rotation_x:s,rotation_y:a,rotation_z:h}=t;this.mapElementIdStore.add(et),this.mapElementComponentStore.set(`${et}_props`,{...t}),this.mapElementComponentStore.set(`${et}_updateMethod`,()=>{const{position_x:l,position_y:d,position_z:p,rotation_x:c,rotation_y:u,rotation_z:x}=this.getPropsFromStore(et);this.onPlaceVehicle(l,d,p,c,u,x)}),this.onPlaceVehicle(e,o,n,s,a,h)}setEventTriggerVisibility(t,e=!1){if(t.startsWith("trigger")){const o=this.getMeshFromStore(t);o.visible=e}}resetDynamicMapElements(){this.mapElementIdList.forEach(this.resetElementIfDynamic)}translate(t,e){const o=this.getBodyFromStore(t),n=this.getPropsFromStore(t),s=this.getUpdateMethodFromStore(t);if(Object.assign(n,{...e}),o){const{position_x:a=0,position_y:h=0,position_z:l=0,rotation_x:d=0,rotation_y:p=0,rotation_z:c=0}=n;o.position.set(a,h,l),o.quaternion.setFromEuler(k(d),k(p),k(c)),o.aabbNeedsUpdate=!0}s(),this.listeners.dispatch("mapElementChange",{...n})}transform(t,e){const o=this.getMeshFromStore(t),n=this.getBodyFromStore(t),s=this.getPropsFromStore(t);if(Object.assign(s,{...e}),n.shapes.length=0,n.shapeOffsets.length=0,n.shapeOrientations.length=0,Gt(o)){const a=me(s),h=a.length,l=Math.max(0,o.children.length-h);for(let d=0;d<l;d++){const p=o.children.length-1,c=o.children[p];c.geometry.dispose(),o.remove(c)}for(let d=0;d<h;d++){const p=a[d],[c,u]=vt(p);let x=o.children[d];x?x.geometry.dispose():(x=new _t,x.material=o.children[0].material,o.add(x)),zt.set(k(p.rotation_x||0),k(p.rotation_y||0),k(p.rotation_z||0)),x.quaternion.setFromEuler(zt),x.position.set(p.position_x,p.position_y,p.position_z),x.geometry=u,n.addShape(c,x.position,x.quaternion)}}else{const[a,h]=vt(s);n.addShape(a),o.geometry.dispose(),o.geometry=h}this.listeners.dispatch("mapElementChange",{...s})}setAttribute(t,e){const o=this.getPropsFromStore(t),n=this.getBodyFromStore(t),s=o.type;if(Object.assign(o,{...e}),"color"in e&&Ht(this.getMeshFromStore(t),e.color),s==="trigger"&&e.type==="default"?this.convertEventTriggerToDefaultElement(t):("type"in e||"event"in e||"dataSet"in e)&&(this.setUpEventTrigger(t,o),o.mass&&(e.mass=0)),"mass"in e){const a=this.getUpdateMethodFromStore(t);n.mass=e.mass,n.updateMassProperties(),n.velocity.set(0,0,0),n.angularVelocity.set(0,0,0),e.mass>0&&n.type===ht.STATIC?(n.type=ht.DYNAMIC,this.world.addEventListener("postStep",a)):!e.mass&&n.type===ht.DYNAMIC&&(n.type=ht.STATIC,this.world.removeEventListener("postStep",a))}this.listeners.dispatch("mapElementChange",{...o})}}function xe(i){i.geometry.dispose(),i.material.dispose()}function Ht(i,t,e){const o=Gt(i)?i.children[0].material:i.material;t&&o.color.set(t),e&&(o.transparent=e<1,o.opacity=e)}function $o(i){return i.type==="trigger"?Ze:i.type==="animated"?Ge:i.color?i.color:i.mass?Ue:ne}function Gt(i){return!!i.children.length}function Ko(i){return i instanceof Jt}const Vo=/checkpointCount:\w*(\d+)/i,qo=Math.PI*2,Uo=.02;let Ye=0,Xe=0;class Go{constructor(t,e){r(this,"activeCheckpoints",new Set);r(this,"checkpointIconToElementLinks",new Map);r(this,"checkpointIcon3dPool");r(this,"finishIcon3d");r(this,"gameProgress");r(this,"scene");r(this,"checkpointEventHandler",({target:t,relatedTarget:e})=>{if(e===this.gameProgress.vehicle.chassisBody&&this.activeCheckpoints.has(t)){this.gameProgress.checkpointReached(t);const o=this.checkpointIconToElementLinks.get(t);this.checkpointIcon3dPool.release(o),this.activeCheckpoints.delete(t)}});r(this,"finishEventHandler",({target:t,relatedTarget:e,dataSet:o})=>{e===this.gameProgress.vehicle.chassisBody&&Yo(o)===this.gameProgress.checkpointsReached&&(this.gameProgress.stop(),this.gameProgress.openModal())});this.scene=t,this.finishIcon3d=e.finish,this.checkpointIcon3dPool=new Re(1,{itemProvider(){return e.checkpoint.clone()},itemActiveCheck(o){return o.visible},itemActivator(o){o.visible=!0},itemDeactivator(o){o.visible=!1}}),this.scene.add(this.finishIcon3d)}init(t,e){this.gameProgress=e,t.eventTriggerListeners.add(Z.checkpoint,this.checkpointEventHandler),t.eventTriggerListeners.add(Z.finish,this.finishEventHandler),this.checkpointIcon3dPool.activeCount&&this.checkpointIcon3dPool.releaseAll(),this.activeCheckpoints.size&&this.activeCheckpoints.clear(),t.mapElementIdList.forEach(o=>{if(o.startsWith("trigger")){const{event:n}=t.getPropsFromStore(o);n==="checkpoint"?this.setActiveCheckpoint(t.getBodyFromStore(o)):n==="finish"&&this.setFinish(t.getBodyFromStore(o))}})}setActiveCheckpoint(t){const e=this.checkpointIcon3dPool.obtain();e.position.copy(t.position),this.activeCheckpoints.add(t),this.checkpointIconToElementLinks.set(t,e),this.scene.add(e)}setFinish(t){this.finishIcon3d.position.copy(t.position)}updateVisuals(t){Ye=Math.sin(t/1e3)/500,Xe=.5*Math.sin(t/500)*.005,this.checkpointIcon3dPool.forActive(fe),fe(this.finishIcon3d)}}function Zo(){const i=new _t(new ke(.8,.8,.8),new gt({color:0,specular:6710886,emissive:43520,shininess:10,transparent:!0,opacity:.6}));return i.rotation.set(Math.PI/4,0,Math.PI/4),i}function fe(i){const t=i.rotation.y+Uo;i.rotation.y=t>=qo?0:t,i.position.y+=Ye,i.material&&i.material.emissive.offsetHSL(0,0,Xe)}function Yo(i){const[,t]=i.match(Vo)||[];return t?Number(t):0}class Xo{constructor(){r(this,"started",!1);r(this,"stopped",!1);r(this,"startTime",0);r(this,"stopTime",0);r(this,"relativeStopTime",0)}get time(){return this.stopped?this.relativeStopTime:performance.now()-this.startTime}start(){this.started=!0,this.stopped?this.startTime+=performance.now()-this.stopTime:this.startTime=performance.now(),this.stopped=!1}stop(){this.relativeStopTime=this.time,this.stopTime=performance.now(),this.stopped=!0}reset(){this.started=!1,this.stopped=!1,this.startTime=0}add(t){this.startTime-=t}}const Jo={meta:{author:""},elements:[{type:"vehicle",position_y:1},{shape:"box",width:5,length:5,height:.2,position_y:-.1},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_x:3,position_y:1}]},Qo={meta:{author:"",goals:{time:4e4,respawnCount:0}},elements:[{type:"vehicle",position_x:10,position_y:1,position_z:10,rotation_y:90},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"cinematic,25,11,25",radius:3,position_x:10,position_y:1,position_z:10},{shape:"box",width:30,height:.2,length:34,position_x:6,position_z:2},{shape:"triangularPrism",position_x:-3,position_y:1.1,position_z:-3,rotation_x:0,rotation_y:0,rotation_z:0,length:4,width:4,offset:-2},{shape:"triangularPrism",position_x:-3,position_y:4.1,position_z:-7,rotation_x:0,rotation_y:0,rotation_z:0,length:4,width:4,offset:-2,height:4},{shape:"box",width:4,height:.2,length:6,position_x:-3,position_y:10,position_z:-18},{shape:"box",width:4,height:.2,length:30,position_x:-3,position_y:5,position_z:-25,rotation_x:15},{shape:"box",width:4,height:5.4,length:2,position_x:-7,position_y:2.6,position_z:-9},{shape:"box",width:4,height:11.8,length:2,position_x:1,position_y:5.9,position_z:-9},{shape:"box",mass:40,position_x:11,position_y:3.1,position_z:-6,width:4,height:4,length:4},{shape:"cylinder",sides:4,radiusBottom:13,height:1,position_x:9,position_y:.6,position_z:-4,rotation_y:45,radiusTop:10},{shape:"cylinder",radiusTop:2,radiusBottom:2,height:4,mass:20,sides:20,position_x:-3,position_y:15,position_z:-27,rotation_z:90},{shape:"box",width:.2,height:1,length:10,position_x:-5.1,position_y:11.3,position_z:-33,lowFriction:!0},{shape:"box",width:.2,height:1,length:14,position_x:-.9,position_y:11.3,position_z:-31,lowFriction:!0},{shape:"box",width:.2,height:1,length:30,position_x:-.9,position_y:5.5,position_z:-25,rotation_x:15,lowFriction:!0},{shape:"box",width:.2,height:1,length:30,position_x:-5.1,position_y:5.5,position_z:-25,rotation_x:15,lowFriction:!0},{shape:"box",width:8.2,height:.2,length:4,position_x:-8.92,position_y:9.65,position_z:-26,rotation_z:14.8},{shape:"box",width:4,height:.2,length:2.4,position_x:-7,position_y:5.2,position_z:-11.2},{shape:"triangularPrism",position_x:-7,position_y:8.6,position_z:-9,rotation_x:-90,rotation_y:-90,rotation_z:0,length:4,width:6.6,offset:-2,height:2},{shape:"box",width:4,height:.2,length:4.4,position_x:-10.95,position_y:5.55,position_z:-10.2,rotation_z:-10},{shape:"box",width:4,height:.2,length:4,position_x:-14.9,position_y:5.9,position_z:-10},{shape:"box",width:4,height:.2,length:12.4,position_x:-14.9,position_y:7.25,position_z:-17.98,rotation_x:12.55},{shape:"box",width:4.1,height:.2,length:4,position_x:-14.85,position_y:8.6,position_z:-26},{shape:"box",width:4,height:.2,length:2.4,position_x:1,position_y:5.2,position_z:-11.2},{shape:"box",width:4,height:.2,length:3.3,position_x:-3,position_y:10.35,position_z:-22.33,rotation_x:12.5},{shape:"box",width:4,height:.2,length:5,position_x:-3,position_y:10.7,position_z:-26.4},{shape:"box",width:.2,height:2,length:14,position_x:-.9,position_y:10.8,position_z:-17},{shape:"box",width:4,height:.2,length:4.4,position_x:5,position_y:5.2,position_z:-10.2},{shape:"box",width:4,height:4,length:3.8,position_x:5,position_y:3.1,position_z:-1.9},{shape:"box",width:4,height:.2,length:.2,position_x:9,position_z:-3.9,position_y:1.2,lowFriction:!0},{shape:"box",width:4,height:4,length:.2,position_x:5,position_z:-3.9,position_y:3.1,lowFriction:!0},{shape:"box",width:8,height:.2,length:.2,position_x:7,position_z:-8.1,position_y:1.2,lowFriction:!0},{shape:"box",width:.2,height:.2,length:4,position_x:2.9,position_z:-6,position_y:1.2},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"34,11,4.5",radius:7,position_x:14,position_y:1},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-3,9,29",radius:7,position_x:-2,position_y:1,position_z:8},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-30,16,-3",radius:3,position_x:-3,position_y:12,position_z:-21},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-30,22,-29",radius:3,position_x:-15,position_y:9,position_z:-22,rotation_x:0,rotation_y:0,rotation_z:0},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-27,14,-13",radius:2,position_x:-9,position_y:6,position_z:-10},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"9.5,10,-25",radius:2,position_x:1,position_y:6,position_z:-11},{type:"trigger",shape:"sphere",event:"checkpoint",dataSet:"-30,22,-29",radius:1,position_x:-15,position_y:9.7,position_z:-26.19,rotation_x:0,rotation_y:180,rotation_z:0},{type:"trigger",shape:"sphere",event:"finish",dataSet:"checkpointCount:1",radius:1,position_x:5,position_y:6,position_z:-2}]},tn={meta:{author:"",goals:{time:35e3,respawnCount:0}},elements:[{type:"vehicle",position_x:10,position_y:1,position_z:10,rotation_y:90},{shape:"box",width:12,height:.2,length:10,position_x:8,position_z:10},{shape:"triangularPrism",width:4,length:4,offset:-2,position_x:8,position_y:1,position_z:7},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"39,13,-6",radius:3,position_x:13,position_y:1,position_z:10},{type:"animated",shape:"box",width:6,height:.2,length:6,position_x:-1,position_z:10,dataSet:'{ "movement": { "y": -17 }, "alternateDelay": 3, "triggerStart": true }'},{shape:"box",width:1,height:18,length:.2,position_x:-3,position_y:-8.1,position_z:6.9},{shape:"box",width:1,height:18,length:.2,position_x:1,position_y:-8.1,position_z:6.9},{shape:"box",width:1,height:18,length:.2,position_x:1,position_y:-8.1,position_z:13.1},{shape:"box",width:1,height:18,length:.2,position_x:-3,position_y:-8.1,position_z:13.1},{shape:"box",width:.2,height:18,length:.6,position_x:-4.1,position_y:-8.1,position_z:12},{shape:"box",width:.2,height:18,length:.6,position_x:-4.1,position_y:-8.1,position_z:8},{shape:"box",width:12,height:.2,length:10,position_x:8,position_z:10,position_y:-17},{shape:"box",width:.2,height:14,length:6,position_x:2.1,position_y:-7.1,position_z:10,color:12895428},{shape:"box",width:12,height:.2,length:10,position_x:8,position_z:21},{shape:"box",width:4,height:10,length:.6,position_x:8,position_z:15.5,position_y:-1,mass:40,lowFriction:!0,fixedRotation:!0},{shape:"box",width:4,height:14,length:1,position_x:4,position_z:15.5,position_y:-3},{shape:"box",width:4,height:14,length:1,position_x:12,position_z:15.5,position_y:-3},{shape:"box",width:1,height:1,length:2,position_x:8,position_z:15.5,position_y:-6.5,mass:10,lowFriction:!0,fixedRotation:!0},{shape:"box",width:2,height:1,length:3,position_x:8,position_z:13.5,position_y:-7.5},{shape:"box",width:2,height:1,length:2,position_x:8,position_z:17,position_y:-7.5},{shape:"box",width:2,height:1,length:2,position_x:8,position_z:17,position_y:-5.5},{shape:"box",width:.5,height:1,length:2,position_x:7.25,position_z:17,position_y:-6.5},{shape:"box",width:.5,height:1,length:2,position_x:8.75,position_z:17,position_y:-6.5},{shape:"box",width:10,height:.2,length:8,position_x:9,position_z:9,position_y:-8},{shape:"box",width:4,height:6,length:.2,position_x:8,position_z:15.1,position_y:-3},{shape:"box",width:4,height:6,length:.2,position_x:8,position_z:15.9,position_y:-3},{shape:"box",width:.5,height:1,length:3,position_x:8.75,position_z:13.5,position_y:-6.5},{shape:"box",width:.5,height:1,length:3,position_x:7.25,position_z:13.5,position_y:-6.5},{shape:"box",width:5,height:2,length:1,position_x:4.5,position_z:15.5,position_y:-11},{shape:"box",width:5,height:2,length:1,position_x:11.5,position_z:15.5,position_y:-11},{shape:"box",width:12,height:5,length:1,position_x:8,position_z:15.5,position_y:-14.5},{shape:"sphere",radius:.5,position_x:8,position_z:14,position_y:-6.5,mass:1},{shape:"box",width:2,height:1,length:3,position_x:8,position_y:-5.5,position_z:13.5},{shape:"box",width:1,height:1,length:3,position_x:8,position_z:11.75,position_y:-6.5,mass:10,fixedRotation:!0},{shape:"box",width:4,height:.2,length:4,position_x:16,position_z:7,position_y:-17},{shape:"box",width:8,height:.2,length:4,position_x:18,position_z:7,position_y:-8},{shape:"box",width:4,height:.2,length:26,position_x:20,position_z:21.75,position_y:-10.25,rotation_x:10},{shape:"box",width:4,height:.2,length:26,position_x:16,position_z:21.6,position_y:-14.75,rotation_x:-10},{shape:"box",width:8,height:.2,length:4,position_x:18,position_z:36.35,position_y:-12.5},{shape:"box",width:4,height:.2,length:26,position_x:16,position_z:21.6,position_y:-5.76,rotation_x:-10},{shape:"box",width:4,height:.2,length:4,position_x:16,position_z:36.35,position_y:-3.5},{shape:"box",width:2,height:3,length:1,position_x:8,position_y:-6.5,position_z:18.5},{shape:"box",width:4,height:.2,length:4,position_x:4,position_z:36.35,position_y:-2},{shape:"box",width:4,height:.2,length:8.8,position_x:4,position_z:30.2,position_y:-1,rotation_x:13.4},{shape:"box",width:8.2,height:.2,length:4,position_x:10,position_z:36.35,position_y:-2.75,rotation_z:-10.5},{shape:"box",width:.2,height:4,length:.2,position_x:6.1,position_z:15.1,position_y:2},{shape:"box",width:.2,height:4,length:.2,position_x:9.9,position_z:15.1,position_y:2},{shape:"box",width:.2,height:4,length:.2,position_x:9.9,position_z:15.9,position_y:2},{shape:"box",width:.2,height:4,length:.2,position_x:6.1,position_z:15.9,position_y:2},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-13,4,1",radius:3,position_x:-1,position_y:1,position_z:10},{shape:"box",width:4,height:.2,length:12,position_x:8,position_z:-17,position_y:2},{type:"trigger",shape:"sphere",event:"finish",dataSet:"checkpointCount:1",position_x:8,position_y:3,position_z:-21},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-21,-9,8",radius:3,position_x:-1,position_y:-9,position_z:10},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"19,-10,-11",radius:3,position_x:6,position_y:-16,position_z:10},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"30,-3,52",radius:3,position_x:16,position_y:-13,position_z:23},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"43,2,0",radius:3,position_x:16,position_y:-14,position_z:17},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"32,8,-11",radius:3,position_x:20,position_y:-9,position_z:20},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"27,7,43",radius:3,position_x:16,position_y:-4,position_z:26},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"8,12,52",radius:3,position_x:9,position_y:-2,position_z:36},{shape:"box",width:.2,height:.4,length:1.9,position_y:1.1,position_z:11.35,position_x:-4.1},{shape:"box",width:.8,height:.2,length:.8,position_y:1.4,position_z:10,position_x:-4.4},{shape:"box",width:.6,height:.4,length:.2,position_y:1.1,position_z:10.3,position_x:-4.3},{shape:"box",width:.6,height:.4,length:.2,position_y:1.1,position_z:9.7,position_x:-4.3},{shape:"box",width:.8,height:.2,length:.8,position_y:.8,position_z:10,position_x:-4.4},{shape:"box",width:.2,height:.4,length:.8,position_y:1.1,position_z:10,position_x:-4.7},{shape:"box",width:.6,height:.4,length:.4,position_y:1.1,position_z:10,position_x:-4.1,mass:10},{shape:"box",width:.2,height:.4,length:.4,position_y:1.1,position_z:10,position_x:-3.9,type:"trigger",event:"startAnimation",dataSet:"animated_3"},{type:"trigger",shape:"sphere",event:"checkpoint",position_x:10.75,position_y:-7,position_z:7.5,rotation_y:-90},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"32,8,-11",radius:3,position_x:14.09,position_y:-7,position_z:10.04},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"38,15,11",radius:3,position_x:8,position_y:3,position_z:1}]},en={meta:{author:"",goals:{time:22e3}},elements:[{type:"vehicle",position_y:1,rotation_y:-1},{shape:"box",width:3*2,height:.1*2,length:20.01*2,position_z:-.02,position_y:.07},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-6,10,26",radius:3,position_y:1},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_x:-31.5,position_y:17.5,position_z:-13.5},{shape:"slopeTransition",type:"compound",segmentWidth:6,position_y:0,position_z:-20.6,position_x:-3,segmentCount:43,segmentHeight:.22,segmentLength:.6,rotation_x:-6},{shape:"loop",type:"compound",segmentCount:23,segmentWidth:12,segmentHeight:.2,radius:10,segmentPositionOffset:-1.19,position_x:11.85,position_z:-41.48,position_y:.5,rotation_y:-30,rotation_z:-90},{shape:"box",height:6*2,length:15*2,width:.1*2,position_y:26.7,position_x:22.01,position_z:-27},{shape:"loop",type:"compound",segmentCount:7,segmentWidth:12,segmentHeight:.2,segmentLength:2,segmentPositionOffset:0,position_x:13.95,position_z:-18,position_y:20.4,rotation_y:-90},{shape:"box",height:.1*2,length:6*2,width:15*2,position_y:12.4,position_x:-2,position_z:-18},{shape:"loop",type:"compound",segmentCount:8,segmentWidth:8,segmentHeight:.2,radius:10,segmentPositionOffset:-1,position_x:-19,position_y:22.4,position_z:-16,rotation_y:90},{shape:"loop",type:"compound",segmentCount:7,segmentWidth:8,segmentHeight:.2,segmentPositionOffset:-1,radius:8,position_x:-20.59,position_y:24.16,position_z:-2,rotation_y:-90},{shape:"box",height:.1*2,length:3*2,width:6*2,position_y:16.16,position_x:-28.6,position_z:-2},{shape:"box",height:.1*2,length:6*2,width:3*2,position_y:16.16,position_x:-31.6,position_z:-11},{type:"trigger",shape:"sphere",event:"setCameraMode",dataSet:"chase",radius:3,position_y:1,position_z:-11.4},{shape:"box",type:"trigger",position_y:15.5,position_z:-18,width:1*2,length:6*2,height:3*2,event:"setCameraMode",dataSet:"hood"},{shape:"box",type:"trigger",position_y:18.26,position_z:-2,width:1*2,length:3*2,height:2*2,position_x:-26.8,event:"setCameraMode",dataSet:"cinematic,-16,21,-2"},{shape:"box",height:2*2,length:1*2,width:3*2,position_y:18.26,position_x:-31.6,position_z:-6,type:"trigger",dataSet:"-26,26,13"}]},on={meta:{author:"",goals:{time:55e3,respawnCount:0}},elements:[{type:"vehicle",position_y:11,rotation_y:-90,position_x:-5,position_z:8},{shape:"box",position_y:12,width:4,height:.2,length:4,position_x:4},{shape:"box",position_y:11.01,width:4,height:.2,length:4,position_x:.32,rotation_z:30},{shape:"box",position_y:9.67,width:4.2,height:.2,length:4,position_x:-7.41,rotation_z:-10},{shape:"box",position_y:9.67,width:4.2,height:.2,length:4,position_x:-3.38,rotation_z:10},{shape:"box",position_y:11.01,width:4,height:.2,length:4,position_x:-11.1,rotation_z:-30},{shape:"box",position_y:13.51,width:4,height:.2,length:4,position_x:-14.1,rotation_z:-50},{shape:"box",position_y:18.47,width:8,height:.2,length:4,position_x:-17.36,rotation_z:-60},{shape:"box",position_y:23.44,width:4,height:.2,length:4,position_x:-20.63,rotation_z:-50},{shape:"box",position_y:26.24,width:4,height:.2,length:4,position_x:-23.43,rotation_z:-40},{shape:"box",position_y:28.19,width:4,height:.2,length:4,position_x:-26.81,rotation_z:-20},{shape:"box",position_y:28.87,width:10,height:.2,length:10,position_x:-33.65},{shape:"box",position_y:19,width:8,height:.2,length:4,position_x:36.53,rotation_z:10,position_z:0},{shape:"box",position_y:8.576,width:12,height:.2,length:12,position_x:10.858,position_z:4,rotation_z:-35},{shape:"box",position_y:10,width:8,height:8,length:4,position_x:4,position_z:4},{shape:"box",position_y:12,width:4,height:.2,length:4,position_x:4,position_z:8},{shape:"box",position_y:11.013,width:4,height:.2,length:4,position_x:.318,rotation_z:30,position_z:8},{shape:"box",position_y:10,width:6,height:.2,length:4,position_x:-4.35,position_z:8},{shape:"box",position_y:21.06,width:8,height:.2,length:4,position_x:44.18,position_z:0,rotation_z:20},{shape:"box",position_y:23.9,width:6,height:.2,length:12,position_x:50.48,position_z:4,rotation_z:30},{shape:"sphere",type:"trigger",event:"checkpoint",position_x:-34.15,position_y:30.14,rotation_y:-90},{shape:"sphere",type:"trigger",event:"finish",dataSet:"checkpointCount:1",position_x:50.18,position_y:24.88,position_z:8.54},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"cinematic,26,20,43",position_x:-5,position_y:11,position_z:8,radius:2},{shape:"sphere",type:"trigger",dataSet:"25,22,18",position_x:4,position_y:13,position_z:8,radius:2},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"chase",position_x:10.01,position_y:9.92,position_z:1.67,radius:3}]},nn={meta:{author:"",goals:{time:45e3,respawnCount:0}},elements:[{type:"vehicle",position_y:1},{shape:"box",width:7,height:.1,length:30,position_x:0,position_y:0,position_z:-11.5,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"chase",position_y:1},{shape:"box",position_x:-1.5,position_y:.6,position_z:-8,rotation_x:0,rotation_y:0,rotation_z:0,width:3,height:1},{shape:"box",position_x:1.5,position_y:.6,position_z:-18,rotation_x:0,rotation_y:0,rotation_z:0,width:3,height:1},{shape:"box",position_x:0,position_y:-2.62,position_z:-38.18,rotation_x:-10,rotation_y:0,rotation_z:0,width:7,length:6,height:.1},{shape:"box",position_x:0,position_y:-6,position_z:-57,rotation_x:0,rotation_y:0,rotation_z:0,width:6,length:10,height:.1},{shape:"slopeTransition",type:"compound",position_x:-3,position_y:-6.05,position_z:-65.66,rotation_x:0,rotation_y:0,rotation_z:0,angle:30,segmentHeight:.84,segmentLength:3.69,segmentCount:5,segmentWidth:6},{shape:"cantedCurve",type:"compound",position_x:20.33,position_y:-3.94,position_z:-78.94,rotation_x:0,rotation_y:-90,rotation_z:0,segmentCount:36,radius:20,segmentWidth:6,segmentLength:1.53,angle:40},{shape:"box",position_x:41.83,position_y:-2.69,position_z:-75.18,rotation_x:0,rotation_y:0,rotation_z:40,width:10,length:6,height:.1},{shape:"box",position_x:48.63,position_y:.51,position_z:-63.18,rotation_x:0,rotation_y:0,rotation_z:0,width:6,length:30,height:.1},{shape:"sphere",type:"trigger",event:"checkpoint",position_x:48.5,position_y:1.74,position_z:-74.9,rotation_y:180},{shape:"loop",type:"compound",position_x:52.63,position_y:8.5,position_z:-42,rotation_x:0,rotation_y:-90,rotation_z:0,segmentPositionOffset:0,segmentCount:7,segmentLength:2,segmentWidth:30},{shape:"loop",type:"compound",position_x:30.68,position_y:11.8,position_z:-25.54,rotation_x:180,rotation_y:0,rotation_z:90,segmentCount:16,segmentPositionOffset:0,radius:30,segmentWidth:8,segmentLength:3},{shape:"box",position_x:60.68,position_y:12.3,position_z:-34,rotation_x:0,rotation_y:0,rotation_z:90,width:7,length:14,height:.1},{shape:"box",position_x:23.17,position_y:11.77,position_z:4.49,rotation_x:0,rotation_y:0,rotation_z:0,width:17,length:.1,height:8},{shape:"loop",type:"compound",position_x:-14.87,position_y:8.5,position_z:-3.5,rotation_x:-180,rotation_y:0,rotation_z:-180,segmentPositionOffset:-1.2,segmentCount:32,segmentLength:2,segmentWidth:18},{shape:"box",position_x:-71.33,position_y:4.47,position_z:-76.56,rotation_x:0,rotation_y:-60,rotation_z:0,width:40,height:.1,length:20},{shape:"loop",type:"compound",position_x:-15.85,position_y:12.49,position_z:-5.46,rotation_x:0,rotation_y:0,rotation_z:0,segmentCount:4,radius:12,segmentLength:2,segmentWidth:16,segmentPositionOffset:0},{shape:"box",position_x:-83.67,position_y:5.33,position_z:-97.96,rotation_x:0,rotation_y:-60,rotation_z:-10,width:10,height:.1,length:20},{shape:"box",type:"trigger",event:"finish",dataSet:"checkpointCount:1",length:5,position_x:-83.28,position_y:6.75,position_z:-98.15,rotation_y:-60}]},sn={meta:{author:"",goals:{time:45e3,respawnCount:0}},elements:[{type:"vehicle",position_y:11.5},{shape:"box",width:5,length:5,height:1,position_y:10},{shape:"box",width:8,length:6,height:1,position_y:-8,position_z:2},{shape:"box",position_y:-18,position_z:-1,height:1,width:10,length:10},{shape:"box",position_y:-22,position_z:17,height:1,width:10,length:10},{shape:"sphere",type:"trigger",event:"checkpoint",position_y:-6.5,position_z:2},{shape:"box",color:10853513,height:.2,width:16,length:12,position_x:3,position_y:-12,position_z:17,rotation_x:-30},{shape:"box",position_x:8,position_y:-23,position_z:17,height:1,width:6,length:4},{shape:"box",position_x:14,position_y:-24,position_z:17,height:1,width:6,length:4},{shape:"sphere",type:"trigger",event:"checkpoint",position_x:8,position_y:-21,position_z:17,rotation_y:-90},{shape:"box",position_x:18,position_y:-25,position_z:13,height:1,width:4,length:6},{shape:"box",position_x:18,position_y:-26,position_z:7,height:1,width:4,length:6},{shape:"box",position_x:14,position_y:-27,position_z:3,height:1,width:6,length:4},{shape:"box",position_x:8,position_y:-28,position_z:3,height:1,width:6,length:4},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"32,-13,25",position_x:10,position_y:-21,position_z:17},{shape:"box",type:"trigger",dataSet:"-24,-13,20",height:2,length:1,width:6,position_x:0,position_y:-20,position_z:14},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"32,-13,-8",position_x:18,position_y:-24,position_z:9,rotation_y:-90},{shape:"box",position_x:-2,position_y:-31,position_z:4,height:1,width:6,length:6},{shape:"sphere",type:"trigger",event:"checkpoint",position_x:8,position_y:-26,position_z:3,rotation_y:90},{shape:"box",position_x:-2,position_y:-35,position_z:16,height:1,width:6,length:6},{shape:"box",position_x:-2,position_y:-39,position_z:27,height:1,width:6,length:6},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"cinematic,-24,25,0",position_y:12},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"-2,-20,-10",position_x:-2,position_y:-29,position_z:4},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"-35,-3,1",position_x:0,position_y:-6.5,position_z:2},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"6,-21,-20",position_x:10,position_y:-26,position_z:3},{type:"trigger",shape:"sphere",event:"finish",dataSet:"checkpointCount:3",radius:1,position_x:-2,position_y:-37,position_z:27}]},an={meta:{author:"",goals:{time:2e4}},elements:[{type:"vehicle",position_y:1.4},{shape:"box",width:8,length:16,height:.2,position_y:-.6},{shape:"cylinder",sides:4,radiusTop:3,radiusBottom:5.7,height:1,rotation_y:45},{shape:"box",width:8,length:16,height:.2,position_z:20,position_x:0,position_y:0,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"box",width:8,length:16,height:.2,position_z:-20},{shape:"box",width:16,length:10,height:.2,position_y:-.6,position_x:-12,position_z:-3,rotation_x:0,rotation_y:0,rotation_z:0},{type:"compound",shape:"loop",position_x:-20.89,position_y:9.9,position_z:-3,rotation_y:90,segmentPositionOffset:0,segmentCount:7,segmentLength:2.64,segmentWidth:10,segmentHeight:.2,radius:10.5},{type:"compound",shape:"loop",position_x:-20.89,position_y:10.5,position_z:20,rotation_y:90,segmentPositionOffset:0,segmentCount:7,segmentLength:2.64,segmentWidth:16,segmentHeight:.2,radius:10.5},{shape:"box",width:16,length:16,height:.2,position_z:20,position_x:-12},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_y:1,position_z:-25},{type:"trigger",shape:"box",position_x:-5,position_y:1,position_z:-3,width:1,length:8,dataSet:"-8,27,-33"},{type:"trigger",shape:"box",dataSet:"-27, 29, 47",position_x:-19,position_y:1,position_z:20,width:1,length:14},{type:"trigger",shape:"box",dataSet:"0,10,40",position_x:-10,position_y:1,position_z:20,width:1,length:14},{type:"trigger",shape:"box",event:"setCameraMode",dataSet:"cinematic,24,8,0",width:1,height:1,length:1,position_y:.5},{shape:"box",position_x:-29,position_y:9,position_z:6,type:"trigger",width:5,height:10,length:1,dataSet:"-34,23,3"},{shape:"box",position_y:1,position_z:10,type:"trigger",event:"setCameraMode",dataSet:"chase",width:5,height:2,length:1}]},rn={meta:{author:"",goals:{time:3e4,respawnCount:0}},elements:[{type:"vehicle",position_y:1,position_z:16},{shape:"box",width:6,length:38,height:.2,position_y:-.1,position_x:0,position_z:1,rotation_x:0,rotation_y:0,rotation_z:0},{type:"animated",shape:"box",width:6,height:4,length:6,position_y:2,position_z:7,dataSet:'{ "movement": { "x": 10 }, "speed": 10, "triggerStart": false }'},{type:"animated",shape:"box",width:6,height:4,length:6,position_y:2,position_z:-9,dataSet:'{ "movement": { "x": 10 }, "speed": 10, "triggerStart": false }'},{shape:"box",height:.2,width:6,length:10,position_x:10,position_y:3.9,position_z:-1},{shape:"box",height:.2,width:6,length:6,position_x:10,position_y:3.9,position_z:-15},{shape:"box",height:.2,width:6,length:10,position_x:10,position_y:3.033,position_z:-22.9,rotation_x:-10},{shape:"box",height:.2,width:6,length:10,position_y:.764,position_z:-22.92,rotation_x:10},{shape:"box",height:.2,width:6,length:6,position_y:1.63,position_z:-30.82},{shape:"box",height:.2,width:6,length:6,position_x:10,position_y:2.16,position_z:-30.82},{shape:"box",height:.2,width:4.05,length:6,position_x:5.01,position_y:1.895,position_z:-30.82,rotation_z:7.47},{shape:"box",height:.2,width:6,length:9,position_x:10,position_y:3.9,position_z:14.5,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"sphere",position_x:10,position_y:3.45,position_z:-30.82,rotation_y:180,type:"trigger",event:"checkpoint"},{type:"trigger",shape:"sphere",event:"finish",radius:2,dataSet:"checkpointCount:1",position_x:10,position_y:5,position_z:16,rotation_x:0,rotation_y:0,rotation_z:0},{type:"trigger",shape:"sphere",event:"setCameraMode",dataSet:"cinematic,-23.677403301734017 , 18.14983153689501 , 19.110973303515554",radius:3,position_y:1,position_z:16},{type:"trigger",shape:"sphere",radius:3,dataSet:"-30.215800024784016, 22.38223498976879, 8.370897885782714",position_y:1,position_z:2},{type:"trigger",shape:"sphere",radius:3,dataSet:"-13.569674761319714, 16.522559296321283, -50.07904465318648",position_y:1,position_z:-15},{shape:"sphere",position_x:10,position_y:3.45,position_z:-30.82,rotation_y:180,type:"trigger",event:"setCameraPosition",radius:3,dataSet:"18.770735429093357, 20.96953167533059, -46.35856186137107"}]},hn={meta:{author:"",goals:{time:2e4}},elements:[{type:"vehicle",position_y:11.4,position_x:1.5},{shape:"box",width:10,length:6,height:1,position_y:9.95,position_z:.3},{shape:"box",position_y:2.51,position_z:-15.44,rotation_x:-30,height:1,width:10,length:30},{shape:"box",position_x:-8,position_y:-25,position_z:-65,rotation_x:-30,height:1,width:10,length:60},{shape:"box",position_y:-56,position_z:-130,rotation_x:-20,height:1,width:10,length:60},{shape:"box",width:10,height:1,position_y:-5.18,position_z:-29.26,rotation_x:-15},{shape:"box",width:10,height:1,position_x:-8,position_y:-40.17,position_z:-91.78,rotation_x:-15},{shape:"box",position_y:-66.31,position_z:-159,rotation_x:-5,width:10,height:1},{shape:"box",position_x:8,position_y:-76,position_z:-200,rotation_x:-10,height:1,width:10,length:60},{shape:"box",position_y:-83,position_z:-271,height:1,width:10,length:60},{shape:"box",position_x:8,position_y:-81.08,position_z:-230.38,rotation_x:5,width:10,height:1},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:2,position_y:-81,position_z:-297},{type:"trigger",shape:"box",event:"setCameraMode",dataSet:"cinematic,-5,24,19",position_y:12},{type:"trigger",shape:"box",event:"setCameraMode",dataSet:"chase",height:2,width:8,length:1,position_y:11,position_x:0,position_z:-4}]},pn={meta:{author:"",goals:{time:45e3}},elements:[{type:"vehicle",position_x:0,position_y:1.6,position_z:-4},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_x:-16,position_y:5.5,position_z:-10},{shape:"box",color:11194623,fixedRotation:!0,width:5,height:3.79,length:5,position_x:-10,position_y:-1,position_z:-10,mass:90},{shape:"box",color:11194623,fixedRotation:!0,width:5,height:.17,length:5,position_x:10,position_y:0,position_z:-10,mass:30},{shape:"box",position_x:-.4,position_y:-1.76,position_z:-10.07,height:.2,length:1,width:24.9,color:9805311,mass:30},{shape:"triangularPrism",position_x:0,position_y:-2.6,position_z:-10,rotation_y:90,height:1,width:1,length:1},{shape:"box",lowFriction:!0,position_x:-7.45,position_y:0,position_z:-10,height:1,length:5,width:.1},{shape:"box",lowFriction:!0,position_x:7.45,position_y:0,position_z:-10,height:1,length:5,width:.1},{shape:"box",lowFriction:!0,position_x:12.55,position_y:-2,position_z:-10,height:5,length:5,width:.1},{shape:"box",lowFriction:!0,position_x:-12.55,position_y:-2,position_z:-10,height:5,length:5,width:.1},{shape:"box",lowFriction:!0,position_x:10,position_y:-2,position_z:-7.45,height:5,length:.1,width:5.2},{shape:"box",lowFriction:!0,position_x:10,position_y:-2,position_z:-12.55,height:5,length:.1,width:5.2},{shape:"box",lowFriction:!0,position_x:-10,position_y:-2,position_z:-12.55,height:5,length:.1,width:5.2},{shape:"box",lowFriction:!0,position_x:-10,position_y:-2,position_z:-7.45,height:5,length:.1,width:5.2},{shape:"box",height:.2,position_x:0,position_y:.4,position_z:-10,width:14.8,length:5.2},{shape:"box",lowFriction:!0,position_x:-7.45,position_y:-2.5,position_z:-8.5,height:4,length:2,width:.1},{shape:"box",lowFriction:!0,position_x:-7.45,position_y:-2.5,position_z:-11.5,height:4,length:2,width:.1},{shape:"box",lowFriction:!0,position_x:7.45,position_y:-2.5,position_z:-11.5,height:4,length:2,width:.1},{shape:"box",lowFriction:!0,position_x:7.45,position_y:-2.5,position_z:-8.5,height:4,length:2,width:.1},{shape:"box",height:.2,position_x:0,position_y:.4,position_z:-4,width:25.2,length:6.8},{shape:"box",position_x:-15.08,position_y:4.04,position_z:-10,length:5,width:5,height:.2},{shape:"triangularPrism",height:.1,length:.2,width:5.5,position_x:10.25,position_y:.55,position_z:-7.5},{shape:"triangularPrism",height:.1,length:.2,width:5.5,position_x:7.5,position_y:.55,position_z:-10.25,rotation_y:90},{shape:"triangularPrism",height:.24,length:1,width:12,position_x:13,position_y:.62,position_z:-7,rotation_y:90},{shape:"triangularPrism",height:.24,length:1,width:27,position_x:0,position_y:.62,position_z:-13.01},{shape:"triangularPrism",height:.24,length:1,width:12,position_x:-13.01,position_y:.62,position_z:-7,rotation_y:90},{shape:"box",lowFriction:!0,position_x:-12.55,position_y:4.04,position_z:-10,height:.2,length:5,width:.1},{shape:"triangularPrism",height:.24,length:1,width:27,position_x:0,position_y:.62,position_z:-1},{shape:"box",width:27,position_x:0,position_y:-1,position_z:-1,length:1,height:3},{shape:"box",height:.2,position_x:-16,position_y:.4,position_z:-7,width:5,length:13},{shape:"sphere",color:7841791,position_x:6.25,position_y:1.5,position_z:-10,mass:60},{shape:"sphere",color:7841791,position_x:-5.36,position_y:1.5,position_z:-10,mass:60},{shape:"box",type:"trigger",event:"setCameraMode",dataSet:"cinematic,0, 13, 17",width:1,length:10,height:1,position_x:0,position_y:2,position_z:-7},{shape:"box",type:"trigger",dataSet:"-22, 10, 5",width:1,length:10,height:1,position_x:-5,position_y:2,position_z:-7},{shape:"box",type:"trigger",dataSet:"8, 14, 6",width:1,length:10,height:1,position_x:5,position_y:2,position_z:-7}]},ln={meta:{author:"",goals:{time:11e3,respawnCount:0}},elements:[{type:"vehicle",position_y:1},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"chase",radius:3,position_y:1},{shape:"box",width:10,length:10,height:.2,position_y:-.1},{type:"trigger",shape:"sphere",event:"finish",dataSet:"checkpointCount:1",radius:1,position_x:30,position_y:1},{shape:"box",width:10,length:20,height:.2,position_y:-.1,position_z:-15},{shape:"box",width:20,length:10,height:.2,position_y:-.1,position_x:15},{shape:"box",width:20,length:10,height:.2,position_y:-.1,position_z:-30},{shape:"box",width:10,length:20,height:.2,position_y:-.1,position_x:30},{shape:"box",width:4,length:10,height:.2,position_y:-.1,position_x:37},{shape:"box",width:10,length:4,height:.2,position_y:-.1,position_z:-37},{type:"trigger",shape:"sphere",event:"checkpoint",dataSet:"",radius:1,position_y:1,position_z:-30,rotation_y:180}]},we={map11:ln,map01:Qo,map02:tn,map03:en,map04:on,map05:nn,map06:sn,map07:an,map08:rn,map09:hn,map10:pn,empty:Jo,test:{meta:{},elements:[{type:"vehicle",position_y:2,position_z:15},{shape:"box",width:24,height:.2,length:40,position_x:14,position_z:22},{shape:"triangularPrism",width:2,length:2,offset:-2,position_y:1},{shape:"box",width:24,height:.2,length:120,position_x:-10,position_z:-18},{shape:"box",size:2,position_x:15,position_y:2,position_z:10,mass:40,fixedRotation:!0,rotation_x:45,rotation_y:45},{shape:"box",size:2,position_x:20,position_y:5,position_z:10,rotation_x:45,rotation_y:45},{type:"compound",shape:"loop",segmentPositionOffset:.6,position_x:5,position_y:8.2,position_z:4,rotation_x:12},{type:"compound",shape:"slopeTransition",segmentWidth:6,segmentHeight:.6,segmentLength:12,segmentCount:10,position_x:-25.8,position_z:30},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-6,10,26",radius:3,position_x:10,position_y:1,position_z:15},{type:"trigger",shape:"sphere",event:"finish",radius:1,position_x:12,position_y:3,position_z:5},{type:"trigger",shape:"sphere",event:"setCameraMode",dataSet:"hood",radius:3,position_x:6,position_y:1.9,position_z:-.4},{shape:"box",position_y:12,width:4*2,height:.1*2,length:2*2,position_x:-20,position_z:8},{shape:"box",position_y:11.8,width:9*2,height:.1*2,length:.2*2,position_x:-7,position_z:6.2,lowFriction:!0},{shape:"box",position_y:11.8,width:9*2,height:.1*2,length:.2*2,position_x:-7,position_z:9.8,lowFriction:!0},{shape:"box",position_y:12,width:9*2,height:.1*2,length:.1*2,position_x:-7,position_z:9.9,lowFriction:!0},{shape:"box",position_y:12,width:9*2,height:.1*2,length:.1*2,position_x:-7,position_z:6.1,lowFriction:!0},{shape:"box",position_y:12,width:2*2,height:.1*2,length:1.8*2,position_x:-14,position_z:8,mass:10},{shape:"box",position_x:9.11,position_y:7.09,position_z:-15,rotation_z:45,height:.1*2,length:10*2,width:10*2},{shape:"box",position_x:10.21,position_y:5.74,position_z:-35,rotation_z:35,height:.1*2,length:10*2,width:10*2},{type:"compound",shape:"cantedCurve",position_x:8.94,position_y:-3.61,position_z:53.91,radius:11.65,rotation_x:0,rotation_y:-83.16,rotation_z:0,angle:60,segmentWidth:6,segmentCount:32,segmentLength:2},{type:"compound",shape:"cantedCurve",position_x:8.94,position_y:-7.71,position_z:53.91,radius:7.675,rotation_x:0,rotation_y:4.18,rotation_z:0,angle:30,segmentWidth:6,segmentCount:32,segmentLength:1},{shape:"box",position_x:9,position_y:-9.2,position_z:53.81,rotation_x:0,rotation_y:0,rotation_z:0,width:10,length:10,height:.1}]}},cn="Finished!",dn="Retry",gn="Next",mn="Select map";function _n(){const{goals:i,time:t}=_.useContext(Rt);return i?g.jsxs(g.Fragment,{children:[g.jsx("h4",{children:"Goals"}),!!i.time&&g.jsxs("p",{children:["Finis under: ",g.jsx("span",{className:"textHighlight_2",children:Qt(i.time)}),g.jsx("span",{className:"end_adornment",children:t<=i.time?"✅":"🟧"})]})]}):null}function un({closeModal:i}){const t=_.useContext(Rt),e=_.useRef();return _.useEffect(()=>{e.current&&e.current.focus()},[e.current]),g.jsxs(De,{children:[g.jsx("span",{className:"modal__header",children:cn}),g.jsxs("span",{className:"modal__body",children:[g.jsxs("p",{children:["Your time: ",g.jsx("span",{className:"textHighlight_1",children:Qt(t.time)}),g.jsx("span",{className:"end_adornment",children:"⏱"})]}),!!t.respawnCount&&g.jsxs("p",{children:["Respawn count: ",g.jsx("span",{className:"textHighlight_1",children:t.respawnCount})]}),g.jsx(_n,{})]}),g.jsxs("div",{className:"modal__footer",children:[g.jsx("button",{onClick:n,children:dn}),g.jsx("button",{onClick:s,children:mn}),g.jsx("button",{onClick:o,ref:e,children:gn})]})]});function o(){i(),t.loadNextMap()}function n(){i(),t.reset()}function s(){i(),t.listeners.dispatch(rt.openMapSelectorPanel)}}const It=document.createElement("aside");It.id="gameProgressModalControllerRoot";It.classList.add("hidden");document.body.appendChild(It);const Rt=_.createContext(void 0);function yn(i){ut.render(g.jsx(Rt.Provider,{value:i,children:g.jsx(xn,{})}),It)}function xn(){const i=_.useContext(Rt),[t,e]=_.useState(!0);return _.useEffect(()=>(i.listeners.add(rt.openModal,o),()=>{i.listeners.remove(rt.openModal,o)}),[]),t?null:g.jsx(un,{closeModal:n});function o(){e(!1)}function n(){e(!0)}}var rt=(i=>(i.openModal="openModal",i.openMapSelectorPanel="openMapSelectorPanel",i))(rt||{});let lt;const fn=5e3,Zt=document.createElement("aside"),St=document.createElement("span"),be="00:00.000";Zt.id="hud";const Mt=["map11","map01","map02","map03","map04","map05","map06","map07","map08","map09","map10"];class wn{constructor(t,e){r(this,"timer",new Xo);r(this,"listeners",new st);r(this,"started",!1);r(this,"checkpointsReached",0);r(this,"respawnCount",0);r(this,"time");r(this,"goals");r(this,"_mapBuilder");r(this,"checkpointHandler");r(this,"vehicle");r(this,"currentMap",Mt[0]);r(this,"checkpointReached",t=>{lt=t,this.checkpointsReached++});St.textContent=be,Zt.appendChild(St),document.getElementById("topLeftPanel").appendChild(Zt),this._mapBuilder=t,this.vehicle=e,yn(this)}initCheckpointHandler(t,e){this.checkpointHandler=new Go(t,e)}respawnAtLastCheckpoint(){lt?(this.vehicle.chassisBody.velocity.setZero(),this.vehicle.chassisBody.angularVelocity.setZero(),this.vehicle.chassisBody.position.copy(lt.position),this.vehicle.chassisBody.quaternion.copy(lt.quaternion),this.respawnCount++,this.timer.add(fn)):this.reset()}start(){this.started=!0,this.timer.start()}stop(){this.timer.stop(),this.time=this.timer.time}reset(){this.started=!1,this.checkpointsReached=0,this.respawnCount=0,this.time=void 0,St.textContent=be,this.timer.reset(),this._mapBuilder.resetDynamicMapElements(),this.checkpointHandler.init(this._mapBuilder,this),lt=void 0}loadMap(t=this.currentMap){if(!we.hasOwnProperty(t)){console.warn(`invalid map name ${t}`);return}const{meta:e,elements:o}=we[t],n=this._mapBuilder.selectedMapElementId;this.goals=e.goals,this._mapBuilder.importMap(o),t===this.currentMap&&this._mapBuilder.editMode&&n&&this._mapBuilder.selectMapElement(n),this.currentMap=t,this.reset()}loadNextMap(){const t=Mt.indexOf(this.currentMap);if(t<Mt.length-1){const e=Mt[t+1];this.loadMap(e)}else this.reset()}updateHUD(){!this.timer.started||this.timer.stopped||(St.textContent=Qt(this.timer.time))}openModal(){this.listeners.dispatch("openModal")}}class bn{constructor(t,e,o,n){r(this,"_enabled",!1);r(this,"scene");r(this,"camera");r(this,"domElement");r(this,"mapBuilder");r(this,"raycaster",new fi);r(this,"mousePosition",new Fe);r(this,"raycastResult",[]);r(this,"hoveredObject");r(this,"onSelect");r(this,"onClick",t=>{if(t.type==="click"&&!t.altKey)return;this.mousePosition.x=t.clientX/window.innerWidth*2-1,this.mousePosition.y=-(t.clientY/window.innerHeight)*2+1,this.raycaster.setFromCamera(this.mousePosition,this.camera),this.raycastResult.length=0,this.raycaster.intersectObjects(this.scene.children,!0,this.raycastResult);const{mapElementIdList:e}=this.mapBuilder;let o;for(let n=0;n<this.raycastResult.length;n++){const s=this.raycastResult[n].object;if(e.includes(s.name)){o=s;break}else if(e.includes(s.parent.name)){o=s.parent;break}}o&&this.mapBuilder.selectMapElement(o.name)});this.camera=e,this.scene=t,this.domElement=o,this.mapBuilder=n}get enabled(){return this._enabled}set enabled(t){this._enabled!==t&&(t?(this.domElement.addEventListener("click",this.onClick),this.domElement.addEventListener("dblclick",this.onClick)):(this.domElement.removeEventListener("click",this.onClick),this.domElement.removeEventListener("dblclick",this.onClick),this.hoveredObject=void 0),this._enabled=t)}}const{radToDeg:Nt}=Lt;function Cn(i,t){const e=new wi(i.camera,i.domElement);let o=!1,n=!1;function s(){const a=e.object,h=a.name;t.translate(h,{position_x:Q(a.position.x),position_y:Q(a.position.y),position_z:Q(a.position.z),rotation_x:Q(Nt(a.rotation.x)),rotation_y:Q(Nt(a.rotation.y)),rotation_z:Q(Nt(a.rotation.z))})}return e.addEventListener("objectChange",Ii(s,100)),e.addEventListener("dragging-changed",a=>{o?i.orbitControls.enabled=n:(n=i.orbitControls.enabled,i.orbitControls.enabled=!1),o=a.value}),R.addKeyPressListener("KeyG",()=>{e.mode==="translate"?e.setMode("rotate"):e.setMode("translate")}),R.addKeyDownChangeListener(a=>{a.has("ShiftLeft")?e.setTranslationSnap(1):e.setTranslationSnap(null)}),e}const Bt=document.createElement("aside");Bt.id="menuModalControllerRoot";Bt.classList.add("hidden");document.body.appendChild(Bt);const vn={gameProgressManager:void 0,renderer:void 0,menuOpen:!1,openMenu:N,closeMenu:N,selectedTabIndex:0,setSelectedTabIndex:N},Je=_.createContext(vn);function zn(i,t){ut.render(g.jsx(Sn,{gameProgressManager:i,renderer:t}),Bt)}function Sn({gameProgressManager:i,renderer:t}){const[e,o]=_.useState(!1),[n,s]=_.useState(0),a=_.useCallback(()=>{o(!0)},[]),h=_.useCallback(()=>{o(!1)},[]),l={gameProgressManager:i,renderer:t,menuOpen:e,openMenu:a,closeMenu:h,selectedTabIndex:n,setSelectedTabIndex:s};return g.jsx(Je.Provider,{value:l,children:g.jsx(Mn,{})})}function Mn(){const{menuOpen:i,openMenu:t,setSelectedTabIndex:e,gameProgressManager:o}=_.useContext(Je),n=_.useCallback(()=>{t()},[]),s=_.useCallback(()=>{e(0),t()},[]);_.useEffect(()=>(R.addKeyPressListener("Tab",n),o.listeners.add(rt.openMapSelectorPanel,s),()=>{R.removeKeyPressListener("Tab",n),o.listeners.remove(rt.openMapSelectorPanel,s)}),[]);const a=_.lazy(()=>$e(()=>import("./modules/MenuModal-e7c8a313.js"),["./modules\\MenuModal-e7c8a313.js","./vendor\\react-6a63c5cb.js","./vendor\\vendor-5e83183c.js","./modules\\Switch-0a92a31b.js","./vendor\\cannon-a7a89bfa.js","./vendor\\three-30fa292b.js"],import.meta.url));return _.useMemo(()=>i?g.jsx(_.Suspense,{fallback:g.jsx(Ke,{}),children:g.jsx(a,{})}):null,[i])}function Pn(i,t){const e={baseMaterial:new Te({color:7829367}),fenderMaterial:new Pt({color:328965}),grillMaterial:new Pt({color:2236962}),chromeMaterial:new gt({color:13421772}),glassMaterial:new gt({color:11324631}),tailLightMaterial:new gt({color:5570560}),headLightMaterial:new gt({color:16777147}),wheelMaterial:new Pt({alphaTest:.5})};return i.traverse(n=>{n.material&&(e.wheelMaterial.map=n.material.map,n.material=e.wheelMaterial,n.material.needsUpdate=!0),f.renderShadows&&(n.castShadow=!0)}),t.traverse(n=>{n.material&&(n.material=o(n.name)),f.renderShadows&&(n.castShadow=!0,n.receiveShadow=!0)}),e;function o(n){switch(n){case"front_bumper":case"rear_bumper":case"front_fender":case"rear_fender":return e.fenderMaterial;case"grill":return e.grillMaterial;case"brushGuard":return e.chromeMaterial;case"glass":return e.glassMaterial;case"tail_lights":return e.tailLightMaterial;case"head_lights":return e.headLightMaterial;default:return e.baseMaterial}}}const Ce={engineForceMin:-f.vehicle.maxEngineForce,engineForceMax:f.vehicle.maxEngineForce,brakeForceMin:0,brakeForceMax:f.vehicle.maxBrakeForce,steeringAngleMin:-f.vehicle.maxSteeringAngle,steeringAngleMax:f.vehicle.maxSteeringAngle},En={engineForce:0,brakeForce:0,steeringAngle:0};function Ln(i){return new Proxy(En,{set(t,e,o){const n=t[e],s=ji(o,Ce[`${e}Min`],Ce[`${e}Max`]);return n!==s&&(t[e]=s),!0}})}const kn=new E(0,0,1);let ct,dt;const{renderWireFrame:$t}=f,{torqueSplitRatio:Tn,maxEngineForce:Fn,maxBrakeForce:An,maxSteeringAngle:In,steeringSpeed:ve,wheelRadius:Rn,wheelSuspensionRestLength:Bn,wheelSuspensionStiffness:On,wheelMaxSuspensionTravel:jn,wheelMaxSuspensionForce:Dn,wheelDampingCompression:Wn,wheelDampingRelaxation:Hn,wheelFrictionSlip:Nn,wheelForwardAcceleration:$n,wheelSidedAcceleration:Kn,wheelRollInfluence:Vn}=f.vehicle,qn=.3,$=0,K=1,it=2,ot=3,Un=new Set([it,ot]),[ze,Se]=Tn,Yt=[ze/2,ze/2,Se/2,Se/2],M=[...Yt];class Gn{constructor(t,e){r(this,"base");r(this,"chassisBody");r(this,"chassisMesh");r(this,"wheelBodies");r(this,"wheelMeshes");r(this,"state");r(this,"initialPosition",new w);r(this,"initialRotation",new se);r(this,"currentSteeringAngle",0);r(this,"trackWidth",0);r(this,"wheelBase",0);r(this,"materials");r(this,"update",()=>{this.steerWheels(),this.applyWheelSlipReduction();for(let t=0;t<this.base.wheelInfos.length;t++)this.base.applyEngineForce(this.state.engineForce*M[t]*.01,t),this.base.updateWheelTransform(t),ct=this.base.wheelInfos[t].worldTransform,this.wheelMeshes[t].position.copy(ct.position),this.wheelMeshes[t].quaternion.copy(ct.quaternion),$t&&(dt=this.wheelBodies[t],dt.position.copy(ct.position),dt.quaternion.copy(ct.quaternion),this.wheelMeshes[t].position.copy(dt.position),this.wheelMeshes[t].quaternion.copy(dt.quaternion));this.chassisMesh.position.copy(this.chassisBody.position),this.chassisMesh.quaternion.copy(this.chassisBody.quaternion),this.chassisMesh.translateOnAxis(kn,.6)});r(this,"applyWheelSlipReduction",()=>{const t=this.wheelHasGrip(K),e=this.wheelHasGrip($),o=this.wheelHasGrip(ot),n=this.wheelHasGrip(it);if(t&&!o&&M[ot]>1)M[K]+=1,M[ot]-=1;else if(!t&&o&&M[K]>1)M[K]-=1,M[ot]+=1;else{const s=Math.sign(M[K]-Yt[K]);s&&(M[K]-=s*1,M[ot]+=s*1)}if(e&&!n&&M[it]>1)M[$]+=1,M[it]-=1;else if(!e&&n&&M[$]>1)M[$]-=1,M[it]+=1;else{const s=Math.sign(M[$]-Yt[$]);s&&(M[$]-=s*1,M[it]+=s*1)}});r(this,"brakeWheel",t=>{this.base.setBrake(this.state.brakeForce,t)});r(this,"steerWheels",()=>{const{currentSteeringAngle:t}=this,{steeringAngle:e}=this.state;let o=0;if(t<e)o=Math.min(e,t+ve);else if(t>e)o=Math.max(e,t-ve);else return;const{wheelBase:n,trackWidth:s}=this,a=n*2,h=Math.sin(o),l=Math.cos(o),d=Math.atan(a*h/(a*l-s*h)),p=Math.atan(a*h/(a*l+s*h));this.base.setSteeringValue(d,K),this.base.setSteeringValue(p,$),this.currentSteeringAngle=o});r(this,"wheelHasGrip",t=>this.base.wheelInfos[t].isInContact&&!this.base.wheelInfos[t].sliding);const o=new Vt(new w(.9,.4,2.1)),n=new Vt(new w(.9,.4,1.2));this.chassisBody=new q({mass:f.vehicle.mass}),this.chassisBody.addShape(o,new w(0,0,.1)).addShape(n,new w(0,.8,.8)),this.base=new oi({chassisBody:this.chassisBody,indexForwardAxis:2,indexRightAxis:0,indexUpAxis:1});const s={radius:Rn,suspensionRestLength:Bn,suspensionStiffness:On,maxSuspensionTravel:jn,maxSuspensionForce:Dn,dampingCompression:Wn,dampingRelaxation:Hn,frictionSlip:Nn,forwardAcceleration:$n,sideAcceleration:Kn,rollInfluence:Vn,axleLocal:new w(-1,0,0),directionLocal:new w(0,-1,0),chassisConnectionPointLocal:new w,customSlidingRotationalSpeed:-30,useCustomSlidingRotationalSpeed:!0},a=.3,h=.85;if(this.trackWidth=h*2,this.wheelBase=1.2+1.4,s.chassisConnectionPointLocal.set(h,-a,-1.2),this.base.addWheel(s),s.chassisConnectionPointLocal.set(-h,-a,-1.2),this.base.addWheel(s),s.chassisConnectionPointLocal.set(h,-a,1.4),this.base.addWheel(s),s.chassisConnectionPointLocal.set(-h,-a,1.4),this.base.addWheel(s),$t){const p=new se;p.setFromAxisAngle(w.UNIT_Z,Math.PI/2),this.wheelBodies=this.base.wheelInfos.map(c=>{const u=new Me(c.radius,c.radius,c.radius/2,8),x=new q({type:q.KINEMATIC,collisionFilterGroup:0});return x.addShape(u,w.ZERO,p),x})}this.materials=Pn(e,t);const l={front_r:e,front_l:e.clone(),rear_r:e.clone(),rear_l:e.clone()},d=["x","y","z"];Object.keys(l).forEach(p=>{p.endsWith("_r")&&d.forEach(c=>{l[p].scale[c]*=-1})}),this.wheelMeshes=[l.front_l,l.front_r,l.rear_l,l.rear_r],this.chassisMesh=t,this.state=Ln()}addToWorld(t){return this.base.addToWorld(t),$t&&this.wheelBodies.forEach(t.addBody,t),t.addEventListener("postStep",this.update),this}addToScene(t){return this.wheelMeshes.forEach(e=>{t.add(e)}),t.add(this.chassisMesh),this}setEngineForceDirection(t){this.state.engineForce=Fn*t,t===-1?(this.state.engineForce*=.9,this.materials.tailLightMaterial.emissive.setHSL(0,0,qn)):this.materials.tailLightMaterial.emissive.setHSL(0,0,0)}setBrakeForce(t){this.state.brakeForce=An*t,Un.forEach(this.brakeWheel)}setSteeringDirection(t){this.state.steeringAngle=In*t}resetPosition(){this.chassisBody.position.copy(this.initialPosition),this.chassisBody.quaternion.copy(this.initialRotation),this.chassisBody.velocity.setZero(),this.chassisBody.angularVelocity.setZero()}}const{degToRad:Kt}=Lt,Zn=1/f.physicsFrameRate,Xt=new Ee("general"),Yn=new Ee("lowFriction"),Xn=new Jt(Xt,Xt,{friction:.001}),Jn=new Jt(Xt,Yn,{friction:0,contactEquationStiffness:1e8});f.fullscreen&&ro("Allow fullscreen?").then(i=>{i?document.documentElement.requestFullscreen():f.fullscreen=!1});(async function(){let t=!1;const e=new Li,o=new bi,n=new Ci(16118995,.5);n.position.set(-30,50,-30),n.castShadow=f.renderShadows;const s=new vi(16777215,16777215,1);s.color.setHSL(.6,.2,.7),s.groundColor.setHSL(.095,1,.75),o.add(n,s),f.renderShadows&&(n.shadow.mapSize.set(16384,16384),n.shadow.camera.top=100/2,n.shadow.camera.right=100/2,n.shadow.camera.left=-100/2,n.shadow.camera.bottom=-100/2);const a=new ni,{x:h,y:l,z:d}=f.world.gravity;a.gravity.set(h,l,d),a.broadphase=new si(a),a.defaultContactMaterial.friction=.001,a.addContactMaterial(Xn),a.addContactMaterial(Jn);const p=ai(o,a,{onInit(m,S){Ie.add("renderWireFrame",L=>{S.visible=L})}}),c=new zi({antialias:f.antialias,powerPreference:f.powerPreference});c.setPixelRatio(window.devicePixelRatio),c.setSize(window.innerWidth,window.innerHeight),c.shadowMap.enabled=f.renderShadows;const u=new go(c.domElement);c.domElement.tabIndex=-1,c.domElement.focus();const x=new Si(c),F=new Mi(o,u.camera),v=new Fe(window.innerWidth,window.innerHeight),P=new Pi(v,o,u.camera);P.edgeStrength=2,P.visibleEdgeColor.setHex(15102720),P.hiddenEdgeColor.setHex(6697728),x.addPass(F),document.body.appendChild(c.domElement),window.onresize=Be(wt,500);const[O,Y,yt]=await jt(),z=new Gn(O,Y);z.addToWorld(a).addToScene(o),u.setCameraTarget(z),u.cameraMode=Ne.cinematic,u.camera.aspect=window.aspectRatio,u.camera.updateProjectionMatrix();const C=new No(o,a),b=new wn(C,z);b.initCheckpointHandler(o,{checkpoint:Zo(),finish:yt});const X=new bn(o,u.camera,c.domElement,C),j=Cn(u,C);o.add(j),zn(b,c),C.onPlaceVehicle=(m=0,S=0,L=0,D=0,B=0,J=0)=>{z.initialPosition.set(m,S,L),z.initialRotation.setFromEuler(Kt(D),Kt(B),Kt(J)),z.resetPosition()},C.eventTriggerListeners.add(Z.setCameraPosition,({relatedTarget:m,dataSet:S})=>{if(m===z.chassisBody){const[L,D,B]=S.split(",");u.cameraPosition.set(Number(L),Number(D),Number(B))}}),C.eventTriggerListeners.add(Z.setCameraMode,({relatedTarget:m,dataSet:S})=>{if(m===z.chassisBody){const[L,D,B,J]=S.split(",");u.cameraMode=L,(D||B||J)&&u.cameraPosition.set(Number(D),Number(B),Number(J))}}),C.eventTriggerListeners.add(Z.startAnimation,({relatedTarget:m,dataSet:S})=>{if(m===z.chassisBody){const L=S,D=C.getBodyFromStore(L),{velocity_x:B,velocity_y:J,velocity_z:Qe}=C.getAnimationPropsFromStore(L);D.velocity.set(B,J,Qe)}}),C.eventTriggerListeners.add(Z.reset,({relatedTarget:m})=>{m===z.chassisBody&&b.reset()}),C.listeners.add(V.mapElementSelect,m=>{if(P.selectedObjects.length=0,j.detach(),m===et)P.selectedObjects.push(z.chassisMesh,...z.wheelMeshes);else if(m){const S=C.getMeshFromStore(m);P.selectedObjects.push(S),j.attach(S)}}),R.addKeyPressListener("KeyP",()=>{xt()}),R.addKeyPressListener("KeyO",()=>{console.log(u.camera.position.x,",",u.camera.position.y,",",u.camera.position.z)}),R.addKeyPressListener("KeyR",m=>{m.altKey?b.loadMap():b.respawnAtLastCheckpoint()}),R.addKeyPressListener("KeyC",()=>{u.switchMode()}),R.addKeyPressListener("KeyM",()=>{Ot()}),R.addKeyPressListener("Delete",()=>{C.editMode&&C.selectedMapElementId&&C.destroy(C.selectedMapElementId)}),R.addKeyDownChangeListener(m=>{let S=0,L=0;m.has("KeyW")||m.has("ArrowUp")?S=1:(m.has("KeyS")||m.has("ArrowDown"))&&(S=-1),m.has("KeyA")||m.has("ArrowLeft")?L=1:(m.has("KeyD")||m.has("ArrowRight"))&&(L=-1),!b.started&&S&&b.start(),z.setEngineForceDirection(S),z.setSteeringDirection(L),z.setBrakeForce(Number(m.has("Space")))}),b.loadMap();function Ot(){C.toggleEditMode(),C.editMode?(x.addPass(P),j.enabled=!0,X.enabled=!0,C.selectedMapElementId&&j.attach(C.getMeshFromStore(C.selectedMapElementId))):(x.passes.splice(1,1),j.detach(),j.enabled=!1,X.enabled=!1)}function xt(){t=!t,t?(e.stop(),c.setAnimationLoop(null),mt("paused"),b.started&&b.stop()):(e.start(),c.setAnimationLoop(ft),b.started&&b.start())}c.setAnimationLoop(ft);function ft(){const m=e.getDelta();u.update(m),b.updateHUD(),b.checkpointHandler.updateVisuals(m),x.render(),a.step(Zn,m),f.renderWireFrame&&p.update()}function wt(){u.camera.aspect=window.aspectRatio,u.camera.updateProjectionMatrix(),c.setSize(window.innerWidth,window.innerHeight),x.setSize(window.innerWidth,window.innerHeight),P.setSize(window.innerWidth,window.innerHeight)}async function jt(){const[m,S,L,D]=await Promise.all([bt("img/skybox.jpg","398 kB"),bt("3D_objects/lowPoly_car_wheel.gltf","205 kB"),bt("3D_objects/mg.glb","98 kB"),bt("img/pin.svg","0.9 kB")]),B=new Ei(Ai(m));return B.needsUpdate=!0,o.background=B,[L.scene,S.scene,Fi(D,{x:-6,y:-3,scale:.07})]}})();Object.defineProperty(window,"aspectRatio",{get(){return window.innerWidth/window.innerHeight}});export{qt as C,Ve as E,Ti as I,Je as M,Z as T,De as a,T as b,f as c,Ho as d,Oi as e,Ro as f,$o as g,ns as h,Io as i,et as j,Ao as l,we as m,N as n,Q as r,Ht as s,Ii as t,he as u,ji as v};
