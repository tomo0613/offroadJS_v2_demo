var A=Object.defineProperty;var R=(s,n,e)=>n in s?A(s,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[n]=e;var a=(s,n,e)=>(R(s,typeof n!="symbol"?n+"":n,e),e);import{r,j as t}from"../vendor/react-6a63c5cb.js";import{n as M,I as L,v as H,r as B,t as O,E as v,b as C,u as o,a as W,d as j,T as U,g as k,e as $,C as K,s as z,h as Y,f as J,i as X,l as Z,j as G}from"../indexa711bd7e.js";import{S as q,L as Q}from"./Switch-0a92a31b.js";import"../vendor/vendor-5e83183c.js";import"../vendor/cannon-a7a89bfa.js";import"../vendor/three-30fa292b.js";const ee="^-?((?!0\\d)\\d+)(\\.\\d+)?$",te=200,y=100,ne="◄",se="►";class l extends r.Component{constructor(e){super(e);a(this,"inputRef",r.createRef());a(this,"stepIntervalId",0);a(this,"stepStartTimeoutId",0);a(this,"valueIncrementBuffer",0);a(this,"stepDirection");a(this,"onSetValue",()=>{this.props.onChange(this.numericValue,this.props.id)});a(this,"stepValue",()=>{this.setValue(B(this.numericValue+this.props.step*this.stepDirection))});a(this,"stepValueByBuffer",O(()=>{this.setValue(B(this.numericValue+this.valueIncrementBuffer*this.props.step*this.props.sensitivity)),this.valueIncrementBuffer=0},y));a(this,"stepValueContinuously",()=>{this.stepIntervalId=window.setInterval(this.stepValue,y)});a(this,"onStepButtonDown",({currentTarget:e})=>{const i=e;i.addEventListener("mouseup",this.onStepButtonRelease),i.addEventListener("mouseleave",this.onStepButtonRelease),this.stepDirection=Number(i.dataset.direction),this.stepStartTimeoutId=window.setTimeout(this.stepValueContinuously,te),this.stepValue()});a(this,"onStepButtonRelease",({currentTarget:e})=>{e.removeEventListener("mouseup",this.onStepButtonRelease),e.removeEventListener("mouseleave",this.onStepButtonRelease),window.clearTimeout(this.stepStartTimeoutId),window.clearInterval(this.stepIntervalId)});a(this,"onInputFieldChange",({currentTarget:e})=>{this.setValue(e.value,!0)});a(this,"onInputFieldKeyUp",({key:e})=>{(e==="Enter"||e==="Escape")&&this.inputElement.blur()});a(this,"onInputFieldBlur",()=>{this.state.value===this.props.value||this.state.value===this.props.value.toString()||(this.validNumericValue&&this.numericValue>=this.props.min&&this.numericValue<=this.props.max?this.onSetValue():this.setValue(this.numericValue))});a(this,"onInputFieldMouseDown",e=>{this.inputElement!==document.activeElement&&(e.preventDefault(),this.inputElement.addEventListener("mouseup",this.onInputFieldFocus),this.inputElement.addEventListener("mousemove",this.onInputFieldInitialMouseMove))});a(this,"onInputFieldFocus",()=>{this.inputElement.removeEventListener("mouseup",this.onInputFieldFocus),this.inputElement.removeEventListener("mousemove",this.onInputFieldInitialMouseMove),this.inputElement.focus()});a(this,"onInputFieldInitialMouseMove",e=>{this.inputElement.removeEventListener("mousemove",this.onInputFieldInitialMouseMove),this.inputElement.removeEventListener("mouseup",this.onInputFieldFocus),this.inputElement.parentElement.addEventListener("mouseup",this.onInputFieldMouseMoveFinish),this.inputElement.parentElement.addEventListener("mouseleave",this.onInputFieldMouseMoveFinish),this.inputElement.parentElement.addEventListener("mousemove",this.onInputFieldMouseMove),this.inputElement.parentElement.addEventListener("mousemove",this.stepValueByBuffer),this.onInputFieldMouseMove(e),this.stepValueByBuffer()});a(this,"onInputFieldMouseMoveFinish",()=>{this.inputElement.parentElement.removeEventListener("mousemove",this.onInputFieldMouseMove),this.inputElement.parentElement.removeEventListener("mousemove",this.stepValueByBuffer),this.inputElement.parentElement.removeEventListener("mouseup",this.onInputFieldMouseMoveFinish),this.inputElement.parentElement.removeEventListener("mouseleave",this.onInputFieldMouseMoveFinish)});a(this,"onInputFieldMouseMove",({movementX:e})=>{this.valueIncrementBuffer+=e});a(this,"onInputFieldScroll",e=>{this.valueIncrementBuffer-=e.deltaY,this.stepValueByBuffer()});this.state={value:e.value}}render(){const{label:e,id:i}=this.props,{value:u}=this.state;return t.jsx(L,{label:e,id:i,children:t.jsxs("div",{className:"numberInputControlGroup",children:[t.jsx("span",{className:"stepButton stepButton-left","data-direction":"-1",onMouseDown:this.onStepButtonDown,children:ne}),t.jsx("input",{id:i,name:i,value:u,pattern:ee,onChange:this.onInputFieldChange,onBlur:this.onInputFieldBlur,onKeyUp:this.onInputFieldKeyUp,onMouseDown:this.onInputFieldMouseDown,onWheel:this.onInputFieldScroll,ref:this.inputRef}),t.jsx("span",{className:"stepButton stepButton-right","data-direction":"1",onMouseDown:this.onStepButtonDown,children:se})]})})}componentDidUpdate(e){this.props.value!==e.value&&this.setState({value:this.props.value})}get inputElement(){return this.inputRef.current}get validNumericValue(){return this.inputElement.value&&!this.inputElement.validity.patternMismatch}get numericValue(){if(this.validNumericValue)return Number(this.state.value);const e=parseInt(this.state.value,10);return Number.isNaN(e)?0:e}setValue(e,i=!1){if(this.validNumericValue&&!i&&(e=H(e,this.props.min,this.props.max)),this.state.value===e)return;const u=i?M:this.onSetValue;this.setState({value:e},u)}}a(l,"defaultProps",{id:"",label:"",value:0,onChange:M,step:.01,sensitivity:1,min:-1/0,max:1/0});function S({optionList:s,id:n,label:e,value:i="",onChange:u=M}){return t.jsx(L,{label:e,id:n,children:t.jsx("select",{value:i,id:n,name:n,onChange:c,children:s.map(p=>t.jsx("option",{children:p},p))})});function c({currentTarget:p}){u(p.value,n)}}class F extends r.Component{constructor(e){super(e);a(this,"inputRef",r.createRef());a(this,"onInputFieldChange",({currentTarget:e})=>{this.setState({value:e.value})});a(this,"onInputFieldKeyUp",({key:e})=>{(e==="Enter"||e==="Escape")&&this.inputElement.blur()});a(this,"onInputFieldBlur",()=>{this.state.value!==this.props.value&&this.props.onChange(this.state.value,this.props.id)});this.state={value:e.value}}render(){const{id:e,label:i}=this.props,{value:u}=this.state;return t.jsx(L,{label:i,id:e,children:t.jsx("input",{value:u,id:e,name:e,onChange:this.onInputFieldChange,onBlur:this.onInputFieldBlur,onKeyUp:this.onInputFieldKeyUp,ref:this.inputRef})})}componentDidUpdate(e){this.props.value!==e.value&&this.setState({value:this.props.value})}get inputElement(){return this.inputRef.current}}a(F,"defaultProps",{id:"",label:"",value:"",onChange:M});const ie=["box","cylinder","sphere","tetrahedron","triangularPrism","loop","slopeTransition","cantedCurve"];function oe(){const{mapBuilder:s}=r.useContext(v),[n,e]=r.useState(C.box);return t.jsxs("div",{children:[t.jsx("button",{onClick:i,children:o.createButtonLabel}),t.jsx(S,{value:n,optionList:ie,onChange:u=>{e(u)}})]});function i(){s.build({shape:n})}}function ae(){const{mapBuilder:s}=r.useContext(v);return t.jsx("div",{className:"modal__body",children:t.jsx("textarea",{value:JSON.stringify(s.exportMap(),null,4),onChange:M})})}const le="import",ue=`{
    meta: {},
    elements: [
        {
            "type": "vehicle",
            "position_y": 2,
            "position_z": 10
        },
        {
            "shape": "box",
            "width": 20,
            "height": 0.1,
            "length": 20
        },
        {
            "shape": "triangularPrism",
            "width": 3,
            "height": 1,
            "length": 3,
            "position_x": -3,
            "position_y": 0.1
        }
    ]
}`;function re({closeModal:s}){const{mapBuilder:n}=r.useContext(v),e=r.useRef();return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"modal__body",children:t.jsx("textarea",{ref:e,placeholder:ue})}),t.jsx("button",{onClick:i,children:le})]});function i(){const u=e.current.value;let c;try{c=JSON.parse(u)}catch(p){console.warn(p);return}n.importMap(c.elements),s()}}function pe(){const[s,n]=r.useState();return t.jsxs("div",{children:[t.jsx("button",{onClick:e,children:o.importButtonLabel}),t.jsx("button",{onClick:i,children:o.exportButtonLabel}),s&&t.jsxs(W,{onClose:u,children:[s==="import"&&t.jsx(re,{closeModal:u}),s==="export"&&t.jsx(ae,{})]})]});function e(){n("import")}function i(){n("export")}function u(){n(void 0)}}function de(){const{mapBuilder:s}=r.useContext(v);return t.jsxs("div",{children:[t.jsx("button",{onClick:n,children:o.cloneButtonLabel}),t.jsx("button",{onClick:e,children:o.removeButtonLabel})]});function n(){s.clone(s.selectedMapElementId)}function e(){s.destroy(s.selectedMapElementId)}}const he="Attributes",me={default:["type","mass","color"],compound:["color"],animated:["dataSet"],trigger:["type","event","dataSet"],vehicle:[]},ce=["checkpoint","finish","reset","setCameraMode","setCameraPosition","startAnimation"];function ve({mapElementProps:s}){const{mapBuilder:n}=r.useContext(v),{type:e=j.default,mass:i=0,event:u=U.setCameraPosition,dataSet:c=""}=s,p=k(s),f=typeof p=="number"?$(p):String(p);return t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"label",children:he}),I(e,"type")&&t.jsx(q,{label:"isTrigger:",id:"type",on:e===j.trigger,onChange:x}),I(e,"mass")&&t.jsx(l,{label:"mass:",id:"mass",value:i,onChange:m,min:0,step:1}),I(e,"event")&&t.jsx(S,{label:"event:",id:"event",value:u,onChange:m,optionList:ce}),I(e,"dataSet")&&t.jsx(F,{label:"dataSet:",id:"dataSet",value:c,onChange:m}),I(e,"color")&&t.jsx(K,{label:"color:",id:"color",value:f,onChange:m,onInput:b})]});function m(g,E){n.setAttribute(n.selectedMapElementId,{[E]:g})}function x(g,E){n.setAttribute(n.selectedMapElementId,{[E]:g?j.trigger:j.default})}function b(g){z(n.getMeshFromStore(n.selectedMapElementId),Y(g))}}function I(s,n){return me[s].includes(n)}function ge(){const{mapBuilder:s}=r.useContext(v);return t.jsx(Q,{label:o.mapElementListLabel,contentList:s.mapElementIdList,selected:s.selectedMapElementId,onClick:n=>{s.selectMapElement(n)}})}const fe={box:["width","height","length"],cylinder:["height","radiusTop","radiusBottom","sides"],sphere:["radius"],tetrahedron:["width","height","length"],triangularPrism:["width","height","length","offset"],loop:["segmentWidth","segmentHeight","segmentLength","segmentCount","segmentPositionOffset","radius"],slopeTransition:["segmentWidth","segmentHeight","segmentLength","segmentCount","angle"],cantedCurve:["segmentWidth","segmentHeight","segmentLength","segmentCount","radius","angle"]};function xe({mapElementProps:s}){const{mapBuilder:n}=r.useContext(v),e=be(s.shape),{shape:i,width:u=2,height:c=2,length:p=2,offset:f=0,radius:m=e.radius||1,radiusTop:x=1,radiusBottom:b=1,sides:g=6,segmentCount:E=e.segmentCount,segmentWidth:V=e.segmentWidth,segmentHeight:w=e.segmentHeight,segmentLength:P=e.segmentLength,segmentPositionOffset:T=e.segmentPositionOffset,angle:D=e.angle}=s;return t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"label",children:o.transformPanelLabel}),h("width",i)&&t.jsx(l,{label:o.widthLabel,id:"width",value:u,onChange:d,min:0}),h("height",i)&&t.jsx(l,{label:o.heightLabel,id:"height",value:c,onChange:d,min:0}),h("length",i)&&t.jsx(l,{label:o.lengthLabel,id:"length",value:p,onChange:d,min:0}),h("offset",i)&&t.jsx(l,{label:o.offsetLabel,id:"offset",value:f,onChange:d}),h("radiusTop",i)&&t.jsx(l,{label:o.radiusTopLabel,id:"radiusTop",value:x,onChange:d,min:0}),h("radiusBottom",i)&&t.jsx(l,{label:o.radiusBottomLabel,id:"radiusBottom",value:b,onChange:d,min:0}),h("sides",i)&&t.jsx(l,{label:o.sidesLabel,id:"sides",value:g,onChange:d,min:3,step:1}),h("segmentCount",i)&&t.jsx(l,{label:o.segmentCountLabel,id:"segmentCount",value:E,onChange:d,min:1,step:1}),h("segmentWidth",i)&&t.jsx(l,{label:o.segmentWidthLabel,id:"segmentWidth",value:V,onChange:d,min:0}),h("segmentHeight",i)&&t.jsx(l,{label:o.segmentHeightLabel,id:"segmentHeight",value:w,onChange:d,min:0}),h("segmentLength",i)&&t.jsx(l,{label:o.segmentLengthLabel,id:"segmentLength",value:P,onChange:d,min:0}),h("segmentPositionOffset",i)&&t.jsx(l,{label:o.offsetLabel,id:"segmentPositionOffset",value:T,onChange:d}),h("radius",i)&&t.jsx(l,{label:o.radiusLabel,id:"radius",value:m,onChange:d,min:0}),h("angle",i)&&t.jsx(l,{label:o.angleLabel,id:"angle",value:D,onChange:d,min:0,max:180,step:1})]});function d(N,_){n.transform(n.selectedMapElementId,{[_]:N})}}function h(s,n){var e;return(e=fe[n])==null?void 0:e.includes(s)}function be(s){switch(s){case C.loop:return Z;case C.slopeTransition:return X;case C.cantedCurve:return J;default:return{}}}function Ee({mapElementProps:s}){const{mapBuilder:n}=r.useContext(v),{position_x:e=0,position_y:i=0,position_z:u=0,rotation_x:c=0,rotation_y:p=0,rotation_z:f=0}=s;return t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"label",children:o.translatePanelLabel}),t.jsx(l,{label:`${o.positionLabel}.X:`,id:"position_x",value:e,sensitivity:10,onChange:m}),t.jsx(l,{label:`${o.positionLabel}.Y:`,id:"position_y",value:i,sensitivity:10,onChange:m}),t.jsx(l,{label:`${o.positionLabel}.Z:`,id:"position_z",value:u,sensitivity:10,onChange:m}),t.jsx(l,{label:`${o.rotationLabel}.X:`,id:"rotation_x",value:c,sensitivity:10,onChange:m,min:-360,max:360}),t.jsx(l,{label:`${o.rotationLabel}.Y:`,id:"rotation_y",value:p,sensitivity:10,onChange:m,min:-360,max:360}),t.jsx(l,{label:`${o.rotationLabel}.Z:`,id:"rotation_z",value:f,sensitivity:10,onChange:m,min:-360,max:360})]});function m(x,b){n.translate(n.selectedMapElementId,{[b]:x})}}function Se(){const{mapBuilder:s,mapElementProps:n}=r.useContext(v);return t.jsxs(t.Fragment,{children:[t.jsx(pe,{}),t.jsx(ge,{}),s.selectedMapElementId&&n&&t.jsxs(t.Fragment,{children:[t.jsx(Ee,{mapElementProps:n}),s.selectedMapElementId!==G&&t.jsxs(t.Fragment,{children:[t.jsx(xe,{mapElementProps:n}),t.jsx(ve,{mapElementProps:n}),t.jsx(de,{})]})]}),t.jsx(oe,{})]})}export{Se as default};
