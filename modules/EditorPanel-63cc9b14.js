var k=Object.defineProperty;var O=(s,n,e)=>n in s?k(s,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[n]=e;var a=(s,n,e)=>(O(s,typeof n!="symbol"?n+"":n,e),e);import{r as h,j as t}from"../vendor/react-01fd2a3a.js";import{n as M,I as L,v as H,r as B,t as W,b as j,E as v,u as o,a as U,d as C,T as $,g as z,e as K,C as Y,s as J,h as X,f as Z,i as G,l as q,j as Q}from"../indexc5d348e0.js";import{S as ee,L as te}from"./Switch-9a6a2f6d.js";import"../vendor/vendor-8996eea6.js";import"../vendor/cannon-b9fe1075.js";import"../vendor/three-5c8f7b36.js";const ne="^-?((?!0\\d)\\d+)(\\.\\d+)?$",se=200,S=100,ie="◄",oe="►";class l extends h.Component{constructor(e){super(e);a(this,"inputRef",h.createRef());a(this,"stepIntervalId",0);a(this,"stepStartTimeoutId",0);a(this,"valueIncrementBuffer",0);a(this,"stepDirection");a(this,"onSetValue",()=>{this.props.onChange(this.numericValue,this.props.id)});a(this,"stepValue",()=>{this.setValue(B(this.numericValue+this.props.step*this.stepDirection))});a(this,"stepValueByBuffer",W(()=>{this.setValue(B(this.numericValue+this.valueIncrementBuffer*this.props.step*this.props.sensitivity)),this.valueIncrementBuffer=0},S));a(this,"stepValueContinuously",()=>{this.stepIntervalId=window.setInterval(this.stepValue,S)});a(this,"onStepButtonDown",({currentTarget:e})=>{const i=e;i.addEventListener("mouseup",this.onStepButtonRelease),i.addEventListener("mouseleave",this.onStepButtonRelease),this.stepDirection=Number(i.dataset.direction),this.stepStartTimeoutId=window.setTimeout(this.stepValueContinuously,se),this.stepValue()});a(this,"onStepButtonRelease",({currentTarget:e})=>{e.removeEventListener("mouseup",this.onStepButtonRelease),e.removeEventListener("mouseleave",this.onStepButtonRelease),window.clearTimeout(this.stepStartTimeoutId),window.clearInterval(this.stepIntervalId)});a(this,"onInputFieldChange",({currentTarget:e})=>{this.setValue(e.value,!0)});a(this,"onInputFieldKeyUp",({key:e})=>{(e==="Enter"||e==="Escape")&&this.inputElement.blur()});a(this,"onInputFieldBlur",()=>{this.state.value===this.props.value||this.state.value===this.props.value.toString()||(this.validNumericValue&&this.numericValue>=this.props.min&&this.numericValue<=this.props.max?this.onSetValue():this.setValue(this.numericValue))});a(this,"onInputFieldMouseDown",e=>{this.inputElement!==document.activeElement&&(e.preventDefault(),this.inputElement.addEventListener("mouseup",this.onInputFieldFocus),this.inputElement.addEventListener("mousemove",this.onInputFieldInitialMouseMove))});a(this,"onInputFieldFocus",()=>{this.inputElement.removeEventListener("mouseup",this.onInputFieldFocus),this.inputElement.removeEventListener("mousemove",this.onInputFieldInitialMouseMove),this.inputElement.focus()});a(this,"onInputFieldInitialMouseMove",e=>{this.inputElement.removeEventListener("mousemove",this.onInputFieldInitialMouseMove),this.inputElement.removeEventListener("mouseup",this.onInputFieldFocus),this.inputElement.parentElement.addEventListener("mouseup",this.onInputFieldMouseMoveFinish),this.inputElement.parentElement.addEventListener("mouseleave",this.onInputFieldMouseMoveFinish),this.inputElement.parentElement.addEventListener("mousemove",this.onInputFieldMouseMove),this.inputElement.parentElement.addEventListener("mousemove",this.stepValueByBuffer),this.onInputFieldMouseMove(e),this.stepValueByBuffer()});a(this,"onInputFieldMouseMoveFinish",()=>{this.inputElement.parentElement.removeEventListener("mousemove",this.onInputFieldMouseMove),this.inputElement.parentElement.removeEventListener("mousemove",this.stepValueByBuffer),this.inputElement.parentElement.removeEventListener("mouseup",this.onInputFieldMouseMoveFinish),this.inputElement.parentElement.removeEventListener("mouseleave",this.onInputFieldMouseMoveFinish)});a(this,"onInputFieldMouseMove",({movementX:e})=>{this.valueIncrementBuffer+=e});a(this,"onInputFieldScroll",e=>{this.valueIncrementBuffer-=e.deltaY,this.stepValueByBuffer()});this.state={value:e.value}}render(){const{label:e,id:i}=this.props,{value:u}=this.state;return t.jsx(L,{label:e,id:i,children:t.jsxs("div",{className:"numberInputControlGroup",children:[t.jsx("span",{className:"stepButton stepButton-left","data-direction":"-1",onMouseDown:this.onStepButtonDown,children:ie}),t.jsx("input",{id:i,name:i,value:u,pattern:ne,onChange:this.onInputFieldChange,onBlur:this.onInputFieldBlur,onKeyUp:this.onInputFieldKeyUp,onMouseDown:this.onInputFieldMouseDown,onWheel:this.onInputFieldScroll,ref:this.inputRef}),t.jsx("span",{className:"stepButton stepButton-right","data-direction":"1",onMouseDown:this.onStepButtonDown,children:oe})]})})}componentDidUpdate(e){this.props.value!==e.value&&this.setState({value:this.props.value})}get inputElement(){return this.inputRef.current}get validNumericValue(){return this.inputElement.value&&!this.inputElement.validity.patternMismatch}get numericValue(){if(this.validNumericValue)return Number(this.state.value);const e=parseInt(this.state.value,10);return Number.isNaN(e)?0:e}setValue(e,i=!1){if(this.validNumericValue&&!i&&(e=H(e,this.props.min,this.props.max)),this.state.value===e)return;const u=i?M:this.onSetValue;this.setState({value:e},u)}}a(l,"defaultProps",{id:"",label:"",value:0,onChange:M,step:.01,sensitivity:1,min:-1/0,max:1/0});function y({optionList:s,id:n,label:e,value:i="",onChange:u=M}){return t.jsx(L,{label:e,id:n,children:t.jsx("select",{value:i,id:n,name:n,onChange:c,children:s.map(d=>t.jsx("option",{children:d},d))})});function c({currentTarget:d}){u(d.value,n)}}class F extends h.Component{constructor(e){super(e);a(this,"inputRef",h.createRef());a(this,"onInputFieldChange",({currentTarget:e})=>{this.setState({value:e.value})});a(this,"onInputFieldKeyUp",({key:e})=>{(e==="Enter"||e==="Escape")&&this.inputElement.blur()});a(this,"onInputFieldBlur",()=>{this.state.value!==this.props.value&&this.props.onChange(this.state.value,this.props.id)});this.state={value:e.value}}render(){const{id:e,label:i}=this.props,{value:u}=this.state;return t.jsx(L,{label:i,id:e,children:t.jsx("input",{value:u,id:e,name:e,onChange:this.onInputFieldChange,onBlur:this.onInputFieldBlur,onKeyUp:this.onInputFieldKeyUp,ref:this.inputRef})})}componentDidUpdate(e){this.props.value!==e.value&&this.setState({value:this.props.value})}get inputElement(){return this.inputRef.current}}a(F,"defaultProps",{id:"",label:"",value:"",onChange:M});const ae=Object.values(j);function le(){const{mapBuilder:s}=h.useContext(v),[n,e]=h.useState(j.box);return t.jsxs("div",{children:[t.jsx("button",{onClick:i,children:o.createButtonLabel}),t.jsx(y,{value:n,optionList:ae,onChange:u=>{e(u)}})]});function i(){s.build({shape:n})}}function ue(){const{mapBuilder:s}=h.useContext(v);return t.jsx("div",{className:"modal__body",children:t.jsx("textarea",{value:JSON.stringify(s.exportMap(),null,4),onChange:M})})}const re="import",pe=`{
    meta: {},
    elements: [
        {
            "type": "vehicle",
            "position_y": 2,
            "position_z": 10
        },
        {
            "shape": "box",
            "width": 20,
            "height": 0.1,
            "length": 20
        },
        {
            "shape": "triangularPrism",
            "width": 3,
            "height": 1,
            "length": 3,
            "position_x": -3,
            "position_y": 0.1
        }
    ]
}`;function he({closeModal:s}){const{mapBuilder:n}=h.useContext(v),e=h.useRef();return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"modal__body",children:t.jsx("textarea",{ref:e,placeholder:pe})}),t.jsx("button",{onClick:i,children:re})]});function i(){const u=e.current.value;let c;try{c=JSON.parse(u)}catch(d){console.warn(d);return}n.importMap(c.elements),s()}}function de(){const[s,n]=h.useState();return t.jsxs("div",{children:[t.jsx("button",{onClick:e,children:o.importButtonLabel}),t.jsx("button",{onClick:i,children:o.exportButtonLabel}),s&&t.jsxs(U,{onClose:u,children:[s==="import"&&t.jsx(he,{closeModal:u}),s==="export"&&t.jsx(ue,{})]})]});function e(){n("import")}function i(){n("export")}function u(){n(void 0)}}function me(){const{mapBuilder:s}=h.useContext(v);return t.jsxs("div",{children:[t.jsx("button",{onClick:n,children:o.cloneButtonLabel}),t.jsx("button",{onClick:e,children:o.removeButtonLabel})]});function n(){s.clone(s.selectedMapElementId)}function e(){s.destroy(s.selectedMapElementId)}}const ce="Attributes",ve={default:["type","mass","color"],compound:["color"],animated:["dataSet"],trigger:["type","event","dataSet"],vehicle:[]},ge=["checkpoint","finish","reset","setCameraMode","setCameraPosition","startAnimation"];function fe({mapElementProps:s}){const{mapBuilder:n}=h.useContext(v),{type:e=C.default,mass:i=0,event:u=$.setCameraPosition,dataSet:c=""}=s,d=z(s),f=typeof d=="number"?K(d):String(d);return t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"label",children:ce}),I(e,"type")&&t.jsx(ee,{label:"isTrigger:",id:"type",on:e===C.trigger,onChange:x}),I(e,"mass")&&t.jsx(l,{label:"mass:",id:"mass",value:i,onChange:m,min:0,step:1}),I(e,"event")&&t.jsx(y,{label:"event:",id:"event",value:u,onChange:m,optionList:ge}),I(e,"dataSet")&&t.jsx(F,{label:"dataSet:",id:"dataSet",value:c,onChange:m}),I(e,"color")&&t.jsx(Y,{label:"color:",id:"color",value:f,onChange:m,onInput:b})]});function m(g,E){n.setAttribute(n.selectedMapElementId,{[E]:g})}function x(g,E){n.setAttribute(n.selectedMapElementId,{[E]:g?C.trigger:C.default})}function b(g){J(n.getMeshFromStore(n.selectedMapElementId),X(g))}}function I(s,n){return ve[s].includes(n)}function xe(){const{mapBuilder:s}=h.useContext(v);return t.jsx(te,{label:o.mapElementListLabel,contentList:s.mapElementIdList,selected:s.selectedMapElementId,onClick:n=>{s.selectMapElement(n)}})}const be={box:["width","height","length"],cylinder:["height","radiusTop","radiusBottom","sides"],sphere:["radius"],tetrahedron:["width","height","length"],triangularPrism:["width","height","length","offset"],trapezoidalPrism:["width","height","length","lengthTop","skew"],loop:["segmentWidth","segmentHeight","segmentLength","segmentCount","segmentPositionOffset","radius"],slopeTransition:["segmentWidth","segmentHeight","segmentLength","segmentCount","angle"],cantedCurve:["segmentWidth","segmentHeight","segmentLength","segmentCount","radius","angle"]};function Ee({mapElementProps:s}){const{mapBuilder:n}=h.useContext(v),e=Ie(s.shape),{shape:i,width:u=2,height:c=2,length:d=2,lengthTop:f=4,offset:m=0,skew:x=0,radius:b=e.radius||1,radiusTop:g=1,radiusBottom:E=1,sides:w=6,segmentCount:V=e.segmentCount,segmentWidth:T=e.segmentWidth,segmentHeight:P=e.segmentHeight,segmentLength:D=e.segmentLength,segmentPositionOffset:N=e.segmentPositionOffset,angle:_=e.angle}=s;return t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"label",children:o.transformPanelLabel}),p("width",i)&&t.jsx(l,{label:o.widthLabel,id:"width",value:u,onChange:r,min:0}),p("height",i)&&t.jsx(l,{label:o.heightLabel,id:"height",value:c,onChange:r,min:0}),p("length",i)&&t.jsx(l,{label:o.lengthLabel,id:"length",value:d,onChange:r,min:0}),p("lengthTop",i)&&t.jsx(l,{label:o.lengthTopLabel,id:"lengthTop",value:f,onChange:r,min:0}),p("offset",i)&&t.jsx(l,{label:o.offsetLabel,id:"offset",value:m,onChange:r}),p("skew",i)&&t.jsx(l,{label:o.skewLabel,id:"skew",value:x,onChange:r}),p("radiusTop",i)&&t.jsx(l,{label:o.radiusTopLabel,id:"radiusTop",value:g,onChange:r,min:0}),p("radiusBottom",i)&&t.jsx(l,{label:o.radiusBottomLabel,id:"radiusBottom",value:E,onChange:r,min:0}),p("sides",i)&&t.jsx(l,{label:o.sidesLabel,id:"sides",value:w,onChange:r,min:3,step:1}),p("segmentCount",i)&&t.jsx(l,{label:o.segmentCountLabel,id:"segmentCount",value:V,onChange:r,min:1,step:1}),p("segmentWidth",i)&&t.jsx(l,{label:o.segmentWidthLabel,id:"segmentWidth",value:T,onChange:r,min:0}),p("segmentHeight",i)&&t.jsx(l,{label:o.segmentHeightLabel,id:"segmentHeight",value:P,onChange:r,min:0}),p("segmentLength",i)&&t.jsx(l,{label:o.segmentLengthLabel,id:"segmentLength",value:D,onChange:r,min:0}),p("segmentPositionOffset",i)&&t.jsx(l,{label:o.offsetLabel,id:"segmentPositionOffset",value:N,onChange:r}),p("radius",i)&&t.jsx(l,{label:o.radiusLabel,id:"radius",value:b,onChange:r,min:0}),p("angle",i)&&t.jsx(l,{label:o.angleLabel,id:"angle",value:_,onChange:r,min:0,max:180,step:1})]});function r(A,R){n.transform(n.selectedMapElementId,{[R]:A})}}function p(s,n){var e;return(e=be[n])==null?void 0:e.includes(s)}function Ie(s){switch(s){case j.loop:return q;case j.slopeTransition:return G;case j.cantedCurve:return Z;default:return{}}}function je({mapElementProps:s}){const{mapBuilder:n}=h.useContext(v),{position_x:e=0,position_y:i=0,position_z:u=0,rotation_x:c=0,rotation_y:d=0,rotation_z:f=0}=s;return t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"label",children:o.translatePanelLabel}),t.jsx(l,{label:`${o.positionLabel}.X:`,id:"position_x",value:e,sensitivity:10,onChange:m}),t.jsx(l,{label:`${o.positionLabel}.Y:`,id:"position_y",value:i,sensitivity:10,onChange:m}),t.jsx(l,{label:`${o.positionLabel}.Z:`,id:"position_z",value:u,sensitivity:10,onChange:m}),t.jsx(l,{label:`${o.rotationLabel}.X:`,id:"rotation_x",value:c,sensitivity:10,onChange:m,min:-360,max:360}),t.jsx(l,{label:`${o.rotationLabel}.Y:`,id:"rotation_y",value:d,sensitivity:10,onChange:m,min:-360,max:360}),t.jsx(l,{label:`${o.rotationLabel}.Z:`,id:"rotation_z",value:f,sensitivity:10,onChange:m,min:-360,max:360})]});function m(x,b){n.translate(n.selectedMapElementId,{[b]:x})}}function we(){const{mapBuilder:s,mapElementProps:n}=h.useContext(v);return t.jsxs("div",{id:"editorPanelContent",children:[t.jsx(de,{}),t.jsx(xe,{}),s.selectedMapElementId&&n&&t.jsxs(t.Fragment,{children:[t.jsx(je,{mapElementProps:n}),s.selectedMapElementId!==Q&&t.jsxs(t.Fragment,{children:[t.jsx(Ee,{mapElementProps:n}),t.jsx(fe,{mapElementProps:n}),t.jsx(me,{})]})]}),t.jsx(le,{})]})}export{we as default};
