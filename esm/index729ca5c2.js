var so=Object.defineProperty;var _n=Object.getOwnPropertySymbols;var oo=Object.prototype.hasOwnProperty,ao=Object.prototype.propertyIsEnumerable;var Li=(a,e,t)=>e in a?so(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,Ne=(a,e)=>{for(var t in e||(e={}))oo.call(e,t)&&Li(a,t,e[t]);if(_n)for(var t of _n(e))ao.call(e,t)&&Li(a,t,e[t]);return a};var O=(a,e,t)=>(Li(a,typeof e!="symbol"?e+"":e,t),t);import{V as he,Q as zi,S as Ke,C as wn,a as ro,b as bn,B as Ri,c as Lt,d as Qe,R as lo,M as Ii,e as Mn,W as co,f as ho}from"./cannoncd468cdc.js";import{M as ke,S as ti,B as ge,P as ki,a as G,C as Me,b as je,F as Le,V as X,c as we,d as ii,L as Oi,e as po,s as ni,O as Fi,f as rt,U as vn,g as ee,W as $e,h as En,i as mt,R as Sn,D as zt,j as uo,k as fo,N as Tn,l as Rt,A as mo,E as go,m as gt,T as yt,Q as ze,n as Pn,o as Cn,p as It,q as Ni,r as yo,t as xo,u as An,v as kt,w as _o,I as wo,x as bo,y as Mo,z as Ln,G as zn,H as Bi,J as vo,K as Di,X as Rn,Y as Hi,Z as Eo,_ as So,$ as To,a0 as Po,a1 as Xe,a2 as Co,a3 as Ao,a4 as Ot,a5 as In,a6 as si,a7 as kn,a8 as Lo,a9 as zo,aa as xt,ab as Ro,ac as On,ad as Io,ae as ko,af as Oo,ag as Fo,ah as No,ai as Bo,aj as Do,ak as Ho,al as Uo,am as Fn,an as jo,ao as Go,ap as Nn,aq as Vo,ar as Bn,as as Wo,at as Ko,au as _t,av as Xo,aw as Yo,ax as qo,ay as Ui,az as lt,aA as Zo,aB as Qo,aC as $o,aD as Jo,aE as ea,aF as Dn,aG as Hn,aH as Ft,aI as Un,aJ as oi,aK as Nt,aL as ta,aM as ia,aN as na}from"./three895a3223.js";import{R as ne,r as ae,a as Bt}from"./react6742c151.js";const sa=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}};sa();function oa(a,e,{color:t=65280,scale:i=1,onInit:n,onUpdate:o,autoUpdate:s}={}){const r=[],l=new ke({color:t!=null?t:65280,wireframe:!0}),c=new he,u=new he,h=new he,f=new zi,y=new ti(1),A=new ge(1,1,1),P=new ki(10,10,10,10);function b(C){const z=new je,V=[];for(let R=0;R<C.vertices.length;R++){const L=C.vertices[R];V.push(L.x,L.y,L.z)}z.setAttribute("position",new Le(V,3));const W=[];for(let R=0;R<C.faces.length;R++){const L=C.faces[R],B=L[0];for(let j=1;j<L.length-1;j++){const Q=L[j],N=L[j+1];W.push(B,Q,N)}}return z.setIndex(W),z.computeBoundingSphere(),z.computeVertexNormals(),z}function E(C){const z=new je,V=[],W=c,R=u,L=h;for(let B=0;B<C.indices.length/3;B++)C.getTriangleVertices(B,W,R,L),V.push(W.x,W.y,W.z),V.push(R.x,R.y,R.z),V.push(L.x,L.y,L.z);return z.setAttribute("position",new Le(V,3)),z.computeBoundingSphere(),z.computeVertexNormals(),z}function F(C){const z=new je,V=C.elementSize||1,W=C.data.flatMap((L,B)=>L.flatMap((j,Q)=>[B*V,Q*V,j])),R=[];for(let L=0;L<C.data.length-1;L++)for(let B=0;B<C.data[L].length-1;B++){const j=C.data[L].length,Q=L*j+B;R.push(Q+1,Q+j,Q+j+1),R.push(Q+j,Q+1,Q)}return z.setIndex(R),z.setAttribute("position",new Le(W,3)),z.computeBoundingSphere(),z.computeVertexNormals(),z}function v(C){let z=new G;const{SPHERE:V,BOX:W,PLANE:R,CYLINDER:L,CONVEXPOLYHEDRON:B,TRIMESH:j,HEIGHTFIELD:Q}=Ke.types;switch(C.type){case V:{z=new G(y,l);break}case W:{z=new G(A,l);break}case R:{z=new G(P,l);break}case L:{const N=new Me(C.radiusTop,C.radiusBottom,C.height,C.numSegments);z=new G(N,l),C.geometryId=N.id;break}case B:{const N=b(C);z=new G(N,l),C.geometryId=N.id;break}case j:{const N=E(C);z=new G(N,l),C.geometryId=N.id;break}case Q:{const N=F(C);z=new G(N,l),C.geometryId=N.id;break}}return a.add(z),z}function T(C,z){const{SPHERE:V,BOX:W,PLANE:R,CYLINDER:L,CONVEXPOLYHEDRON:B,TRIMESH:j,HEIGHTFIELD:Q}=Ke.types;switch(z.type){case V:{const{radius:N}=z;C.scale.set(N*i,N*i,N*i);break}case W:{C.scale.copy(z.halfExtents),C.scale.multiplyScalar(2*i);break}case R:break;case L:{C.scale.set(1*i,1*i,1*i);break}case B:{C.scale.set(1*i,1*i,1*i);break}case j:{C.scale.copy(z.scale).multiplyScalar(i);break}case Q:{C.scale.set(1*i,1*i,1*i);break}}}function S(C,z){if(!C)return!1;const{geometry:V}=C;return V instanceof ti&&z.type===Ke.types.SPHERE||V instanceof ge&&z.type===Ke.types.BOX||V instanceof ki&&z.type===Ke.types.PLANE||V.id===z.geometryId&&z.type===Ke.types.CYLINDER||V.id===z.geometryId&&z.type===Ke.types.CONVEXPOLYHEDRON||V.id===z.geometryId&&z.type===Ke.types.TRIMESH||V.id===z.geometryId&&z.type===Ke.types.HEIGHTFIELD}function H(C,z){let V=r[C],W=!1;return S(V,z)||(V&&a.remove(V),r[C]=V=v(z),W=!0),T(V,z),W}function U(){const C=r,z=c,V=f;let W=0;for(const R of e)for(let L=0;L!==R.shapes.length;L++){const B=R.shapes[L],j=H(W,B),Q=C[W];Q&&(R.quaternion.vmult(R.shapeOffsets[L],z),R.position.vadd(z,z),R.quaternion.mult(R.shapeOrientations[L],V),Q.position.copy(z),Q.quaternion.copy(V),j&&n instanceof Function&&n(R,Q,B),!j&&o instanceof Function&&o(R,Q,B)),W++}for(let R=W;R<C.length;R++){const L=C[R];L&&a.remove(L)}C.length=W,s!==!1&&requestAnimationFrame(U)}return s!==!1&&requestAnimationFrame(U),{update:U}}class aa{static fromCubeTexture(e){let t=0;const i=new X,n=new X,o=new we,s=[0,0,0,0,0,0,0,0,0],r=new ii,l=r.coefficients;for(let u=0;u<6;u++){const h=e.image[u],f=h.width,y=h.height,A=document.createElement("canvas");A.width=f,A.height=y;const P=A.getContext("2d");P.drawImage(h,0,0,f,y);const b=P.getImageData(0,0,f,y),E=b.data,F=b.width,v=2/F;for(let T=0,S=E.length;T<S;T+=4){o.setRGB(E[T]/255,E[T+1]/255,E[T+2]/255),jn(o,e.encoding);const H=T/4,U=-1+(H%F+.5)*v,C=1-(Math.floor(H/F)+.5)*v;switch(u){case 0:i.set(-1,C,-U);break;case 1:i.set(1,C,U);break;case 2:i.set(-U,1,-C);break;case 3:i.set(-U,-1,C);break;case 4:i.set(-U,C,1);break;case 5:i.set(U,C,-1);break}const z=i.lengthSq(),V=4/(Math.sqrt(z)*z);t+=V,n.copy(i).normalize(),ii.getBasisAt(n,s);for(let W=0;W<9;W++)l[W].x+=s[W]*o.r*V,l[W].y+=s[W]*o.g*V,l[W].z+=s[W]*o.b*V}}const c=4*Math.PI/t;for(let u=0;u<9;u++)l[u].x*=c,l[u].y*=c,l[u].z*=c;return new Oi(r)}static fromCubeRenderTarget(e,t){let i=0;const n=new X,o=new X,s=new we,r=[0,0,0,0,0,0,0,0,0],l=new ii,c=l.coefficients;for(let h=0;h<6;h++){const f=t.width,y=new Uint8Array(f*f*4);e.readRenderTargetPixels(t,0,0,f,f,y,h);const A=2/f;for(let P=0,b=y.length;P<b;P+=4){s.setRGB(y[P]/255,y[P+1]/255,y[P+2]/255),jn(s,t.texture.encoding);const E=P/4,F=-1+(E%f+.5)*A,v=1-(Math.floor(E/f)+.5)*A;switch(h){case 0:n.set(1,v,-F);break;case 1:n.set(-1,v,F);break;case 2:n.set(F,1,-v);break;case 3:n.set(F,-1,v);break;case 4:n.set(F,v,1);break;case 5:n.set(-F,v,-1);break}const T=n.lengthSq(),S=4/(Math.sqrt(T)*T);i+=S,o.copy(n).normalize(),ii.getBasisAt(o,r);for(let H=0;H<9;H++)c[H].x+=r[H]*s.r*S,c[H].y+=r[H]*s.g*S,c[H].z+=r[H]*s.b*S}}const u=4*Math.PI/i;for(let h=0;h<9;h++)c[h].x*=u,c[h].y*=u,c[h].z*=u;return new Oi(l)}}function jn(a,e){switch(e){case ni:a.convertSRGBToLinear();break;case po:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported encoding.");break}return a}var ai={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;

		}`};class Dt{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const ra=new Fi(-1,1,1,-1,0,1),ji=new je;ji.setAttribute("position",new Le([-1,3,0,-1,-1,0,3,-1,0],3));ji.setAttribute("uv",new Le([0,2,0,0,2,0],2));class Gn{constructor(e){this._mesh=new G(ji,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,ra)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Vn extends Dt{constructor(e,t){super();this.textureID=t!==void 0?t:"tDiffuse",e instanceof rt?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=vn.clone(e.uniforms),this.material=new rt({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Gn(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class Wn extends Dt{constructor(e,t){super();this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const n=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0);let s,r;this.inverse?(s=0,r=1):(s=1,r=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),o.buffers.stencil.setFunc(n.ALWAYS,s,4294967295),o.buffers.stencil.setClear(r),o.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(n.EQUAL,1,4294967295),o.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),o.buffers.stencil.setLocked(!0)}}class la extends Dt{constructor(){super();this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class ca{constructor(e,t){if(this.renderer=e,t===void 0){const i={minFilter:mt,magFilter:mt,format:Sn},n=e.getSize(new ee);this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,t=new $e(this._width*this._pixelRatio,this._height*this._pixelRatio,i),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],ai===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),Vn===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new Vn(ai),this.clock=new En}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let n=0,o=this.passes.length;n<o;n++){const s=this.passes[n];if(s.enabled!==!1){if(s.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),s.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),s.needsSwap){if(i){const r=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(r.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(r.EQUAL,1,4294967295)}this.swapBuffers()}Wn!==void 0&&(s instanceof Wn?i=!0:s instanceof la&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new ee);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(i,n),this.renderTarget2.setSize(i,n);for(let o=0;o<this.passes.length;o++)this.passes[o].setSize(i,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}new Fi(-1,1,1,-1,0,1);const Kn=new je;Kn.setAttribute("position",new Le([-1,3,0,-1,-1,0,3,-1,0],3));Kn.setAttribute("uv",new Le([0,2,0,0,2,0],2));class Je extends Dt{constructor(e,t,i,n){super();this.renderScene=t,this.renderCamera=i,this.selectedObjects=n!==void 0?n:[],this.visibleEdgeColor=new we(1,1,1),this.hiddenEdgeColor=new we(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this.resolution=e!==void 0?new ee(e.x,e.y):new ee(256,256);const o={minFilter:mt,magFilter:mt,format:Sn},s=Math.round(this.resolution.x/this.downSampleRatio),r=Math.round(this.resolution.y/this.downSampleRatio);this.maskBufferMaterial=new ke({color:16777215}),this.maskBufferMaterial.side=zt,this.renderTargetMaskBuffer=new $e(this.resolution.x,this.resolution.y,o),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new uo,this.depthMaterial.side=zt,this.depthMaterial.depthPacking=fo,this.depthMaterial.blending=Tn,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=zt,this.prepareMaskMaterial.fragmentShader=h(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new $e(this.resolution.x,this.resolution.y,o),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new $e(s,r,o),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new $e(s,r,o),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new $e(Math.round(s/2),Math.round(r/2),o),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new $e(s,r,o),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new $e(Math.round(s/2),Math.round(r/2),o),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;const l=4,c=4;this.separableBlurMaterial1=this.getSeperableBlurMaterial(l),this.separableBlurMaterial1.uniforms.texSize.value.set(s,r),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(c),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(s/2),Math.round(r/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=c,this.overlayMaterial=this.getOverlayMaterial(),ai===void 0&&console.error("THREE.OutlinePass relies on CopyShader");const u=ai;this.copyUniforms=vn.clone(u.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new rt({uniforms:this.copyUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,blending:Tn,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new we,this.oldClearAlpha=1,this.fsQuad=new Gn(null),this.tempPulseColor1=new we,this.tempPulseColor2=new we,this.textureMatrix=new Rt;function h(f,y){var A=y.isPerspectiveCamera?"perspective":"orthographic";return f.replace(/DEPTH_TO_VIEW_Z/g,A+"DepthToViewZ")}}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()}setSize(e,t){this.renderTargetMaskBuffer.setSize(e,t),this.renderTargetDepthBuffer.setSize(e,t);let i=Math.round(e/this.downSampleRatio),n=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(i,n),this.renderTargetBlurBuffer1.setSize(i,n),this.renderTargetEdgeBuffer1.setSize(i,n),this.separableBlurMaterial1.uniforms.texSize.value.set(i,n),i=Math.round(i/2),n=Math.round(n/2),this.renderTargetBlurBuffer2.setSize(i,n),this.renderTargetEdgeBuffer2.setSize(i,n),this.separableBlurMaterial2.uniforms.texSize.value.set(i,n)}changeVisibilityOfSelectedObjects(e){const t=this._visibilityCache;function i(n){n.isMesh&&(e===!0?n.visible=t.get(n):(t.set(n,n.visible),n.visible=e))}for(let n=0;n<this.selectedObjects.length;n++)this.selectedObjects[n].traverse(i)}changeVisibilityOfNonSelectedObjects(e){const t=this._visibilityCache,i=[];function n(s){s.isMesh&&i.push(s)}for(let s=0;s<this.selectedObjects.length;s++)this.selectedObjects[s].traverse(n);function o(s){if(s.isMesh||s.isSprite){let r=!1;for(let l=0;l<i.length;l++)if(i[l].id===s.id){r=!0;break}if(r===!1){const l=s.visible;(e===!1||t.get(s)===!0)&&(s.visible=e),t.set(s,l)}}else(s.isPoints||s.isLine)&&(e===!0?s.visible=t.get(s):(t.set(s,s.visible),s.visible=e))}this.renderScene.traverse(o)}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(e,t,i,n,o){if(this.selectedObjects.length>0){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const s=e.autoClear;e.autoClear=!1,o&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);const r=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=r,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const l=(1+.25)/2+Math.cos(performance.now()*.01/this.pulsePeriod)*(1-.25)/2;this.tempPulseColor1.multiplyScalar(l),this.tempPulseColor2.multiplyScalar(l)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Je.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Je.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=Je.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=Je.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,o&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(i),this.fsQuad.render(e),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=s}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=i.texture,e.setRenderTarget(null),this.fsQuad.render(e))}getPrepareMaskMaterial(){return new rt({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new ee(.5,.5)},textureMatrix:{value:null}},vertexShader:`#include <morphtarget_pars_vertex>
				#include <skinning_pars_vertex>

				varying vec4 projTexCoord;
				varying vec4 vPosition;
				uniform mat4 textureMatrix;

				void main() {

					#include <skinbase_vertex>
					#include <begin_vertex>
					#include <morphtarget_vertex>
					#include <skinning_vertex>
					#include <project_vertex>

					vPosition = mvPosition;
					vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );
					projTexCoord = textureMatrix * worldPosition;

				}`,fragmentShader:`#include <packing>
				varying vec4 vPosition;
				varying vec4 projTexCoord;
				uniform sampler2D depthTexture;
				uniform vec2 cameraNearFar;

				void main() {

					float depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));
					float viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );
					float depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;
					gl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);

				}`})}getEdgeDetectionMaterial(){return new rt({uniforms:{maskTexture:{value:null},texSize:{value:new ee(.5,.5)},visibleEdgeColor:{value:new X(1,1,1)},hiddenEdgeColor:{value:new X(1,1,1)}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform vec2 texSize;
				uniform vec3 visibleEdgeColor;
				uniform vec3 hiddenEdgeColor;

				void main() {
					vec2 invSize = 1.0 / texSize;
					vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);
					vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);
					vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);
					vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);
					vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);
					float diff1 = (c1.r - c2.r)*0.5;
					float diff2 = (c3.r - c4.r)*0.5;
					float d = length( vec2(diff1, diff2) );
					float a1 = min(c1.g, c2.g);
					float a2 = min(c3.g, c4.g);
					float visibilityFactor = min(a1, a2);
					vec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;
					gl_FragColor = vec4(edgeColor, 1.0) * vec4(d);
				}`})}getSeperableBlurMaterial(e){return new rt({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new ee(.5,.5)},direction:{value:new ee(.5,.5)},kernelRadius:{value:1}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;
				uniform float kernelRadius;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}

				void main() {
					vec2 invSize = 1.0 / texSize;
					float weightSum = gaussianPdf(0.0, kernelRadius);
					vec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;
					vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);
					vec2 uvOffset = delta;
					for( int i = 1; i <= MAX_RADIUS; i ++ ) {
						float w = gaussianPdf(uvOffset.x, kernelRadius);
						vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);
						vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);
						diffuseSum += ((sample1 + sample2) * w);
						weightSum += (2.0 * w);
						uvOffset += delta;
					}
					gl_FragColor = diffuseSum/weightSum;
				}`})}getOverlayMaterial(){return new rt({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform sampler2D edgeTexture1;
				uniform sampler2D edgeTexture2;
				uniform sampler2D patternTexture;
				uniform float edgeStrength;
				uniform float edgeGlow;
				uniform bool usePatternTexture;

				void main() {
					vec4 edgeValue1 = texture2D(edgeTexture1, vUv);
					vec4 edgeValue2 = texture2D(edgeTexture2, vUv);
					vec4 maskColor = texture2D(maskTexture, vUv);
					vec4 patternColor = texture2D(patternTexture, 6.0 * vUv);
					float visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;
					vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;
					vec4 finalColor = edgeStrength * maskColor.r * edgeValue;
					if(usePatternTexture)
						finalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);
					gl_FragColor = finalColor;
				}`,blending:mo,depthTest:!1,depthWrite:!1,transparent:!0})}}Je.BlurDirectionX=new ee(1,0);Je.BlurDirectionY=new ee(0,1);class ha extends Dt{constructor(e,t,i,n,o){super();this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=n,this.clearAlpha=o!==void 0?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new we}render(e,t,i){const n=e.autoClear;e.autoClear=!1;let o,s;this.overrideMaterial!==void 0&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),o=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,o),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=s),e.autoClear=n}}const Xn={type:"change"},Gi={type:"start"},Vi={type:"end"};class pa extends go{constructor(e,t){super();t===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new X,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:gt.ROTATE,MIDDLE:gt.DOLLY,RIGHT:gt.PAN},this.touches={ONE:yt.ROTATE,TWO:yt.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return r.phi},this.getAzimuthalAngle=function(){return r.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(w){w.addEventListener("keydown",Ie),this._domElementKeyEvents=w},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(Xn),i.update(),o=n.NONE},this.update=function(){const w=new X,te=new ze().setFromUnitVectors(e.up,new X(0,1,0)),_e=te.clone().invert(),be=new X,He=new ze,ft=2*Math.PI;return function(){const xn=i.object.position;w.copy(xn).sub(i.target),w.applyQuaternion(te),r.setFromVector3(w),i.autoRotate&&o===n.NONE&&z(U()),i.enableDamping?(r.theta+=l.theta*i.dampingFactor,r.phi+=l.phi*i.dampingFactor):(r.theta+=l.theta,r.phi+=l.phi);let Ve=i.minAzimuthAngle,We=i.maxAzimuthAngle;return isFinite(Ve)&&isFinite(We)&&(Ve<-Math.PI?Ve+=ft:Ve>Math.PI&&(Ve-=ft),We<-Math.PI?We+=ft:We>Math.PI&&(We-=ft),Ve<=We?r.theta=Math.max(Ve,Math.min(We,r.theta)):r.theta=r.theta>(Ve+We)/2?Math.max(Ve,r.theta):Math.min(We,r.theta)),r.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,r.phi)),r.makeSafe(),r.radius*=c,r.radius=Math.max(i.minDistance,Math.min(i.maxDistance,r.radius)),i.enableDamping===!0?i.target.addScaledVector(u,i.dampingFactor):i.target.add(u),w.setFromSpherical(r),w.applyQuaternion(_e),xn.copy(i.target).add(w),i.object.lookAt(i.target),i.enableDamping===!0?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,u.multiplyScalar(1-i.dampingFactor)):(l.set(0,0,0),u.set(0,0,0)),c=1,h||be.distanceToSquared(i.object.position)>s||8*(1-He.dot(i.object.quaternion))>s?(i.dispatchEvent(Xn),be.copy(i.object.position),He.copy(i.object.quaternion),h=!1,!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",Ct),i.domElement.removeEventListener("pointerdown",K),i.domElement.removeEventListener("pointercancel",d),i.domElement.removeEventListener("wheel",xe),i.domElement.removeEventListener("pointermove",q),i.domElement.removeEventListener("pointerup",m),i._domElementKeyEvents!==null&&i._domElementKeyEvents.removeEventListener("keydown",Ie)};const i=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=n.NONE;const s=1e-6,r=new Pn,l=new Pn;let c=1;const u=new X;let h=!1;const f=new ee,y=new ee,A=new ee,P=new ee,b=new ee,E=new ee,F=new ee,v=new ee,T=new ee,S=[],H={};function U(){return 2*Math.PI/60/60*i.autoRotateSpeed}function C(){return Math.pow(.95,i.zoomSpeed)}function z(w){l.theta-=w}function V(w){l.phi-=w}const W=function(){const w=new X;return function(_e,be){w.setFromMatrixColumn(be,0),w.multiplyScalar(-_e),u.add(w)}}(),R=function(){const w=new X;return function(_e,be){i.screenSpacePanning===!0?w.setFromMatrixColumn(be,1):(w.setFromMatrixColumn(be,0),w.crossVectors(i.object.up,w)),w.multiplyScalar(_e),u.add(w)}}(),L=function(){const w=new X;return function(_e,be){const He=i.domElement;if(i.object.isPerspectiveCamera){const ft=i.object.position;w.copy(ft).sub(i.target);let ei=w.length();ei*=Math.tan(i.object.fov/2*Math.PI/180),W(2*_e*ei/He.clientHeight,i.object.matrix),R(2*be*ei/He.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(W(_e*(i.object.right-i.object.left)/i.object.zoom/He.clientWidth,i.object.matrix),R(be*(i.object.top-i.object.bottom)/i.object.zoom/He.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function B(w){i.object.isPerspectiveCamera?c/=w:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*w)),i.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function j(w){i.object.isPerspectiveCamera?c*=w:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/w)),i.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function Q(w){f.set(w.clientX,w.clientY)}function N(w){F.set(w.clientX,w.clientY)}function I(w){P.set(w.clientX,w.clientY)}function se(w){y.set(w.clientX,w.clientY),A.subVectors(y,f).multiplyScalar(i.rotateSpeed);const te=i.domElement;z(2*Math.PI*A.x/te.clientHeight),V(2*Math.PI*A.y/te.clientHeight),f.copy(y),i.update()}function pe(w){v.set(w.clientX,w.clientY),T.subVectors(v,F),T.y>0?B(C()):T.y<0&&j(C()),F.copy(v),i.update()}function Ae(w){b.set(w.clientX,w.clientY),E.subVectors(b,P).multiplyScalar(i.panSpeed),L(E.x,E.y),P.copy(b),i.update()}function M(w){w.deltaY<0?j(C()):w.deltaY>0&&B(C()),i.update()}function x(w){let te=!1;switch(w.code){case i.keys.UP:L(0,i.keyPanSpeed),te=!0;break;case i.keys.BOTTOM:L(0,-i.keyPanSpeed),te=!0;break;case i.keys.LEFT:L(i.keyPanSpeed,0),te=!0;break;case i.keys.RIGHT:L(-i.keyPanSpeed,0),te=!0;break}te&&(w.preventDefault(),i.update())}function p(){if(S.length===1)f.set(S[0].pageX,S[0].pageY);else{const w=.5*(S[0].pageX+S[1].pageX),te=.5*(S[0].pageY+S[1].pageY);f.set(w,te)}}function _(){if(S.length===1)P.set(S[0].pageX,S[0].pageY);else{const w=.5*(S[0].pageX+S[1].pageX),te=.5*(S[0].pageY+S[1].pageY);P.set(w,te)}}function k(){const w=S[0].pageX-S[1].pageX,te=S[0].pageY-S[1].pageY,_e=Math.sqrt(w*w+te*te);F.set(0,_e)}function g(){i.enableZoom&&k(),i.enablePan&&_()}function D(){i.enableZoom&&k(),i.enableRotate&&p()}function ie(w){if(S.length==1)y.set(w.pageX,w.pageY);else{const _e=Ai(w),be=.5*(w.pageX+_e.x),He=.5*(w.pageY+_e.y);y.set(be,He)}A.subVectors(y,f).multiplyScalar(i.rotateSpeed);const te=i.domElement;z(2*Math.PI*A.x/te.clientHeight),V(2*Math.PI*A.y/te.clientHeight),f.copy(y)}function $(w){if(S.length===1)b.set(w.pageX,w.pageY);else{const te=Ai(w),_e=.5*(w.pageX+te.x),be=.5*(w.pageY+te.y);b.set(_e,be)}E.subVectors(b,P).multiplyScalar(i.panSpeed),L(E.x,E.y),P.copy(b)}function J(w){const te=Ai(w),_e=w.pageX-te.x,be=w.pageY-te.y,He=Math.sqrt(_e*_e+be*be);v.set(0,He),T.set(0,Math.pow(v.y/F.y,i.zoomSpeed)),B(T.y),F.copy(v)}function Y(w){i.enableZoom&&J(w),i.enablePan&&$(w)}function ce(w){i.enableZoom&&J(w),i.enableRotate&&ie(w)}function K(w){i.enabled!==!1&&(S.length===0&&(i.domElement.setPointerCapture(w.pointerId),i.domElement.addEventListener("pointermove",q),i.domElement.addEventListener("pointerup",m)),Ci(w),w.pointerType==="touch"?at(w):Z(w))}function q(w){i.enabled!==!1&&(w.pointerType==="touch"?Ti(w):re(w))}function m(w){i.enabled!==!1&&(w.pointerType==="touch"?Pi():fe(),At(w),S.length===0&&(i.domElement.releasePointerCapture(w.pointerId),i.domElement.removeEventListener("pointermove",q),i.domElement.removeEventListener("pointerup",m)))}function d(w){At(w)}function Z(w){let te;switch(w.button){case 0:te=i.mouseButtons.LEFT;break;case 1:te=i.mouseButtons.MIDDLE;break;case 2:te=i.mouseButtons.RIGHT;break;default:te=-1}switch(te){case gt.DOLLY:if(i.enableZoom===!1)return;N(w),o=n.DOLLY;break;case gt.ROTATE:if(w.ctrlKey||w.metaKey||w.shiftKey){if(i.enablePan===!1)return;I(w),o=n.PAN}else{if(i.enableRotate===!1)return;Q(w),o=n.ROTATE}break;case gt.PAN:if(w.ctrlKey||w.metaKey||w.shiftKey){if(i.enableRotate===!1)return;Q(w),o=n.ROTATE}else{if(i.enablePan===!1)return;I(w),o=n.PAN}break;default:o=n.NONE}o!==n.NONE&&i.dispatchEvent(Gi)}function re(w){if(i.enabled!==!1)switch(o){case n.ROTATE:if(i.enableRotate===!1)return;se(w);break;case n.DOLLY:if(i.enableZoom===!1)return;pe(w);break;case n.PAN:if(i.enablePan===!1)return;Ae(w);break}}function fe(w){i.dispatchEvent(Vi),o=n.NONE}function xe(w){i.enabled===!1||i.enableZoom===!1||o!==n.NONE&&o!==n.ROTATE||(w.preventDefault(),i.dispatchEvent(Gi),M(w),i.dispatchEvent(Vi))}function Ie(w){i.enabled===!1||i.enablePan===!1||x(w)}function at(w){switch(yn(w),S.length){case 1:switch(i.touches.ONE){case yt.ROTATE:if(i.enableRotate===!1)return;p(),o=n.TOUCH_ROTATE;break;case yt.PAN:if(i.enablePan===!1)return;_(),o=n.TOUCH_PAN;break;default:o=n.NONE}break;case 2:switch(i.touches.TWO){case yt.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;g(),o=n.TOUCH_DOLLY_PAN;break;case yt.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;D(),o=n.TOUCH_DOLLY_ROTATE;break;default:o=n.NONE}break;default:o=n.NONE}o!==n.NONE&&i.dispatchEvent(Gi)}function Ti(w){switch(yn(w),o){case n.TOUCH_ROTATE:if(i.enableRotate===!1)return;ie(w),i.update();break;case n.TOUCH_PAN:if(i.enablePan===!1)return;$(w),i.update();break;case n.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;Y(w),i.update();break;case n.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;ce(w),i.update();break;default:o=n.NONE}}function Pi(w){i.dispatchEvent(Vi),o=n.NONE}function Ct(w){i.enabled!==!1&&w.preventDefault()}function Ci(w){S.push(w)}function At(w){delete H[w.pointerId];for(let te=0;te<S.length;te++)if(S[te].pointerId==w.pointerId){S.splice(te,1);return}}function yn(w){let te=H[w.pointerId];te===void 0&&(te=new ee,H[w.pointerId]=te),te.set(w.pageX,w.pageY)}function Ai(w){const te=w.pointerId===S[0].pointerId?S[1]:S[0];return H[te.pointerId]}i.domElement.addEventListener("contextmenu",Ct),i.domElement.addEventListener("pointerdown",K),i.domElement.addEventListener("pointercancel",d),i.domElement.addEventListener("wheel",xe,{passive:!1}),this.update()}}const Yn=["fullscreen","antialias","renderShadows","renderWireFrame","resolutionScale"],ua={fullscreen:!1,antialias:!1,renderShadows:!1,renderWireFrame:!1,resolutionScale:1,powerPreference:"high-performance",physicsFrameRate:120,world:{gravity:{x:0,y:-9.8,z:0}},camera:{fov:50,near:.1,far:1e3,initialPosition:{x:0,y:7,z:27}},vehicle:{mass:30,steeringSpeed:.05,maxSteeringAngle:.7,maxBrakeForce:22,maxEngineForce:220,torqueSplitRatio:[50,50],cameraMountPosition:{x:0,y:4,z:10},wheelRadius:.4,wheelSuspensionRestLength:.3,wheelSuspensionStiffness:25,wheelMaxSuspensionTravel:.3,wheelMaxSuspensionForce:Number.MAX_VALUE,wheelDampingCompression:2,wheelDampingRelaxation:2,wheelFrictionSlip:1.1,wheelForwardAcceleration:1/2,wheelSidedAcceleration:1,wheelRollInfluence:.6}},Wi=Yn.reduce((a,e)=>{const t=window.localStorage.getItem(e);if(t)try{a[e]=JSON.parse(t)}catch(i){console.warn(i)}return a},{});var de=new Proxy(ua,{get(a,e){return Wi.hasOwnProperty(e)?Wi[e]:a[e]},set(a,e,t){return Yn.includes(e)&&(Wi[e]=t,window.localStorage.setItem(e,String(t))),!0}});class qn{constructor(e,t){O(this,"items");O(this,"activeCount",0);O(this,"itemProvider");O(this,"itemActivator");O(this,"itemDeactivator");O(this,"itemActiveCheck");O(this,"obtain",()=>{this.activeCount>=this.items.length&&this.items.push(this.itemProvider(this.items.length));const e=this.items[this.activeCount++];return this.itemActivator(e),e});O(this,"release",e=>{if(!this.itemActiveCheck(e))throw new Error(`ObjectPool->release($item) Not active $item: ${JSON.stringify(e)}`);if(this.activeCount--,this.itemDeactivator(e),!this.activeCount)return;const t=this.items.indexOf(e),i=this.items[this.activeCount];if(t<0)throw new Error(`ObjectPool->release($item) Not valid $item: ${JSON.stringify(e)}`);e!==i&&(this.items[this.activeCount]=this.items[t],this.items[t]=i)});O(this,"releaseAll",()=>{this.forActive(this.release)});O(this,"forActive",e=>{for(let t=this.activeCount-1;t>=0;t--)e.call(this,this.items[t])});this.itemProvider=t.itemProvider,this.itemActivator=t.itemActivator,this.itemDeactivator=t.itemDeactivator,this.itemActiveCheck=t.itemActiveCheck,this.items=Array.from({length:e}).map(this.itemProvider)}}class Ht{constructor(){O(this,"listeners",new Map)}add(e,t){if(!t)throw new Error(`EventListener->add($listener) Invalid $listener: ${t}, with type ${e}`);if(this.listeners.has(e))this.listeners.get(e).add(t);else{const i=new Set([t]);this.listeners.set(e,i)}}remove(e,t){if(this.listeners.has(e)){const i=this.listeners.get(e);i.delete(t),i.size||this.listeners.delete(e)}}clear(){this.listeners.clear()}dispatch(e,...t){this.listeners.has(e)&&this.listeners.get(e).forEach(n=>n(...t))}}const da=function({label:a,id:e,children:t}){return a?ne.createElement("div",{className:"inputContainer"},ne.createElement("label",{htmlFor:e},a),t):ne.createElement(ne.Fragment,null,t)};class fa extends Cn{constructor(e){super(e);this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new xa(t)}),this.register(function(t){return new va(t)}),this.register(function(t){return new Ea(t)}),this.register(function(t){return new _a(t)}),this.register(function(t){return new wa(t)}),this.register(function(t){return new ba(t)}),this.register(function(t){return new Ma(t)}),this.register(function(t){return new ga(t)}),this.register(function(t){return new Sa(t)})}load(e,t,i,n){const o=this;let s;this.resourcePath!==""?s=this.resourcePath:this.path!==""?s=this.path:s=It.extractUrlBase(e),this.manager.itemStart(e);const r=function(c){n?n(c):console.error(c),o.manager.itemError(e),o.manager.itemEnd(e)},l=new Ni(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{o.parse(c,s,function(u){t(u),o.manager.itemEnd(e)},r)}catch(u){r(u)}},i,r)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){let o;const s={},r={};if(typeof e=="string")o=e;else if(It.decodeText(new Uint8Array(e,0,4))===Zn){try{s[le.KHR_BINARY_GLTF]=new Ta(e)}catch(h){n&&n(h);return}o=s[le.KHR_BINARY_GLTF].content}else o=It.decodeText(new Uint8Array(e));const l=JSON.parse(o);if(l.asset===void 0||l.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new Ba(l,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const h=this.pluginCallbacks[u](c);r[h.name]=h,s[h.name]=!0}if(l.extensionsUsed)for(let u=0;u<l.extensionsUsed.length;++u){const h=l.extensionsUsed[u],f=l.extensionsRequired||[];switch(h){case le.KHR_MATERIALS_UNLIT:s[h]=new ya;break;case le.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[h]=new Aa;break;case le.KHR_DRACO_MESH_COMPRESSION:s[h]=new Pa(l,this.dracoLoader);break;case le.KHR_TEXTURE_TRANSFORM:s[h]=new Ca;break;case le.KHR_MESH_QUANTIZATION:s[h]=new La;break;default:f.indexOf(h)>=0&&r[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}c.setExtensions(s),c.setPlugins(r),c.parse(i,n)}}function ma(){let a={};return{get:function(e){return a[e]},add:function(e,t){a[e]=t},remove:function(e){delete a[e]},removeAll:function(){a={}}}}const le={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class ga{constructor(e){this.parser=e,this.name=le.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){const o=t[i];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let n=t.cache.get(i);if(n)return n;const o=t.json,l=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let c;const u=new we(16777215);l.color!==void 0&&u.fromArray(l.color);const h=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new An(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new xo(u),c.distance=h;break;case"spot":c=new yo(u),c.distance=h,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),n=Promise.resolve(c),t.cache.add(i,n),n}createNodeAttachment(e){const t=this,i=this.parser,o=i.json.nodes[e],r=(o.extensions&&o.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(l){return i._getNodeRef(t.cache,r,l)})}}class ya{constructor(){this.name=le.KHR_MATERIALS_UNLIT}getMaterialType(){return ke}extendParams(e,t,i){const n=[];e.color=new we(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const s=o.baseColorFactor;e.color.fromArray(s),e.opacity=s[3]}o.baseColorTexture!==void 0&&n.push(i.assignTexture(e,"map",o.baseColorTexture))}return Promise.all(n)}}class xa{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:kt}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];if(s.clearcoatFactor!==void 0&&(t.clearcoat=s.clearcoatFactor),s.clearcoatTexture!==void 0&&o.push(i.assignTexture(t,"clearcoatMap",s.clearcoatTexture)),s.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=s.clearcoatRoughnessFactor),s.clearcoatRoughnessTexture!==void 0&&o.push(i.assignTexture(t,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture)),s.clearcoatNormalTexture!==void 0&&(o.push(i.assignTexture(t,"clearcoatNormalMap",s.clearcoatNormalTexture)),s.clearcoatNormalTexture.scale!==void 0)){const r=s.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ee(r,r)}return Promise.all(o)}}class _a{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:kt}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];return s.transmissionFactor!==void 0&&(t.transmission=s.transmissionFactor),s.transmissionTexture!==void 0&&o.push(i.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(o)}}class wa{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:kt}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];t.thickness=s.thicknessFactor!==void 0?s.thicknessFactor:0,s.thicknessTexture!==void 0&&o.push(i.assignTexture(t,"thicknessMap",s.thicknessTexture)),t.attenuationDistance=s.attenuationDistance||0;const r=s.attenuationColor||[1,1,1];return t.attenuationTint=new we(r[0],r[1],r[2]),Promise.all(o)}}class ba{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:kt}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=n.extensions[this.name];return t.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class Ma{constructor(e){this.parser=e,this.name=le.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:kt}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];t.specularIntensity=s.specularFactor!==void 0?s.specularFactor:1,s.specularTexture!==void 0&&o.push(i.assignTexture(t,"specularIntensityMap",s.specularTexture));const r=s.specularColorFactor||[1,1,1];return t.specularTint=new we(r[0],r[1],r[2]),s.specularColorTexture!==void 0&&o.push(i.assignTexture(t,"specularTintMap",s.specularColorTexture).then(function(l){l.encoding=ni})),Promise.all(o)}}class va{constructor(e){this.parser=e,this.name=le.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const o=n.extensions[this.name],s=i.images[o.source],r=t.options.ktx2Loader;if(!r){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s,r)}}class Ea{constructor(e){this.parser=e,this.name=le.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,o=n.textures[e];if(!o.extensions||!o.extensions[t])return null;const s=o.extensions[t],r=n.images[s.source];let l=i.textureLoader;if(r.uri){const c=i.options.manager.getHandler(r.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,r,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Sa{constructor(e){this.name=le.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const n=i.extensions[this.name],o=this.parser.getDependency("buffer",n.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([o,s.ready]).then(function(r){const l=n.byteOffset||0,c=n.byteLength||0,u=n.count,h=n.byteStride,f=new ArrayBuffer(u*h),y=new Uint8Array(r[0],l,c);return s.decodeGltfBuffer(new Uint8Array(f),u,h,y,n.mode,n.filter),f})}else return null}}const Zn="glTF",Ut=12,Qn={JSON:1313821514,BIN:5130562};class Ta{constructor(e){this.name=le.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Ut);if(this.header={magic:It.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Zn)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-Ut,n=new DataView(e,Ut);let o=0;for(;o<i;){const s=n.getUint32(o,!0);o+=4;const r=n.getUint32(o,!0);if(o+=4,r===Qn.JSON){const l=new Uint8Array(e,Ut+o,s);this.content=It.decodeText(l)}else if(r===Qn.BIN){const l=Ut+o;this.body=e.slice(l,l+s)}o+=s}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Pa{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=le.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,n=this.dracoLoader,o=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,r={},l={},c={};for(const u in s){const h=Xi[u]||u.toLowerCase();r[h]=s[u]}for(const u in e.attributes){const h=Xi[u]||u.toLowerCase();if(s[u]!==void 0){const f=i.accessors[e.attributes[u]],y=jt[f.componentType];c[h]=y,l[h]=f.normalized===!0}}return t.getDependency("bufferView",o).then(function(u){return new Promise(function(h){n.decodeDracoFile(u,function(f){for(const y in f.attributes){const A=f.attributes[y],P=l[y];P!==void 0&&(A.normalized=P)}h(f)},r,c)})})}}class Ca{constructor(){this.name=le.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Ki extends Hi{constructor(e){super();this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),i=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	texelSpecular = sRGBToLinear( texelSpecular );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),r={specular:{value:new we().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=r,this.onBeforeCompile=function(l){for(const c in r)l.uniforms[c]=r[c];l.fragmentShader=l.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",o).replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return r.specular.value},set:function(l){r.specular.value=l}},specularMap:{get:function(){return r.specularMap.value},set:function(l){r.specularMap.value=l,l?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return r.glossiness.value},set:function(l){r.glossiness.value=l}},glossinessMap:{get:function(){return r.glossinessMap.value},set:function(l){r.glossinessMap.value=l,l?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Aa{constructor(){this.name=le.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return Ki}extendParams(e,t,i){const n=t.extensions[this.name];e.color=new we(1,1,1),e.opacity=1;const o=[];if(Array.isArray(n.diffuseFactor)){const s=n.diffuseFactor;e.color.fromArray(s),e.opacity=s[3]}if(n.diffuseTexture!==void 0&&o.push(i.assignTexture(e,"map",n.diffuseTexture)),e.emissive=new we(0,0,0),e.glossiness=n.glossinessFactor!==void 0?n.glossinessFactor:1,e.specular=new we(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),n.specularGlossinessTexture!==void 0){const s=n.specularGlossinessTexture;o.push(i.assignTexture(e,"glossinessMap",s)),o.push(i.assignTexture(e,"specularMap",s))}return Promise.all(o)}createMaterial(e){const t=new Ki(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=_o,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class La{constructor(){this.name=le.KHR_MESH_QUANTIZATION}}class ct extends Ko{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,o=e*n*3+n;for(let s=0;s!==n;s++)t[s]=i[o+s];return t}}ct.prototype.beforeStart_=ct.prototype.copySampleValue_;ct.prototype.afterEnd_=ct.prototype.copySampleValue_;ct.prototype.interpolate_=function(a,e,t,i){const n=this.resultBuffer,o=this.sampleValues,s=this.valueSize,r=s*2,l=s*3,c=i-e,u=(t-e)/c,h=u*u,f=h*u,y=a*l,A=y-l,P=-2*f+3*h,b=f-h,E=1-P,F=b-h+u;for(let v=0;v!==s;v++){const T=o[A+v+s],S=o[A+v+r]*c,H=o[y+v+s],U=o[y+v]*c;n[v]=E*T+F*S+P*H+b*U}return n};const za=new ze;class Ra extends ct{interpolate_(e,t,i,n){const o=super.interpolate_(e,t,i,n);return za.fromArray(o).normalize().toArray(o),o}}const Ye={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},jt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},$n={9728:Io,9729:mt,9984:ko,9985:Oo,9986:Fo,9987:zn},Jn={33071:No,33648:Bo,10497:Bi},es={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Xi={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},et={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ia={CUBICSPLINE:void 0,LINEAR:kn,STEP:Do},Yi={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function ts(a,e){return typeof a!="string"||a===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(a)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:e+a)}function ka(a){return a.DefaultMaterial===void 0&&(a.DefaultMaterial=new Hi({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ho})),a.DefaultMaterial}function Gt(a,e,t){for(const i in t.extensions)a[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function ht(a,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(a.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Oa(a,e,t){let i=!1,n=!1;for(let r=0,l=e.length;r<l;r++){const c=e[r];if(c.POSITION!==void 0&&(i=!0),c.NORMAL!==void 0&&(n=!0),i&&n)break}if(!i&&!n)return Promise.resolve(a);const o=[],s=[];for(let r=0,l=e.length;r<l;r++){const c=e[r];if(i){const u=c.POSITION!==void 0?t.getDependency("accessor",c.POSITION):a.attributes.position;o.push(u)}if(n){const u=c.NORMAL!==void 0?t.getDependency("accessor",c.NORMAL):a.attributes.normal;s.push(u)}}return Promise.all([Promise.all(o),Promise.all(s)]).then(function(r){const l=r[0],c=r[1];return i&&(a.morphAttributes.position=l),n&&(a.morphAttributes.normal=c),a.morphTargetsRelative=!0,a})}function Fa(a,e){if(a.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)a.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(a.morphTargetInfluences.length===t.length){a.morphTargetDictionary={};for(let i=0,n=t.length;i<n;i++)a.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Na(a){const e=a.extensions&&a.extensions[le.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+is(e.attributes):t=a.indices+":"+is(a.attributes)+":"+a.mode,t}function is(a){let e="";const t=Object.keys(a).sort();for(let i=0,n=t.length;i<n;i++)e+=t[i]+":"+a[t[i]]+";";return e}function qi(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class Ba{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new ma,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap!="undefined"&&/Firefox/.test(navigator.userAgent)===!1?this.textureLoader=new wo(this.options.manager):this.textureLoader=new bo(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ni(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,n=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll(function(s){return s._markDefs&&s._markDefs()}),Promise.all(this._invokeAll(function(s){return s.beforeRoot&&s.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(s){const r={scene:s[0][n.scene||0],scenes:s[0],animations:s[1],cameras:s[2],asset:n.asset,parser:i,userData:{}};Gt(o,r,n),ht(r,n),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(r)})).then(function(){e(r)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let n=0,o=t.length;n<o;n++){const s=t[n].joints;for(let r=0,l=s.length;r<l;r++)e[s[r]].isBone=!0}for(let n=0,o=e.length;n<o;n++){const s=e[n];s.mesh!==void 0&&(this._addNodeRef(this.meshCache,s.mesh),s.skin!==void 0&&(i[s.mesh].isSkinnedMesh=!0)),s.camera!==void 0&&this._addNodeRef(this.cameraCache,s.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const n=i.clone(),o=(s,r)=>{const l=this.associations.get(s);l!=null&&this.associations.set(r,l);for(const[c,u]of s.children.entries())o(u,r.children[c])};return o(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let n=0;n<t.length;n++){const o=e(t[n]);o&&i.push(o)}return i}getDependency(e,t){const i=e+":"+t;let n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this.loadAnimation(t);break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(o,s){return i.getDependency(e,s)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[le.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(o,s){i.load(ts(t.uri,n.path),o,void 0,function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const n=t.byteLength||0,o=t.byteOffset||0;return i.slice(o,o+n)})}loadAccessor(e){const t=this,i=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0)return Promise.resolve(null);const o=[];return n.bufferView!==void 0?o.push(this.getDependency("bufferView",n.bufferView)):o.push(null),n.sparse!==void 0&&(o.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(o).then(function(s){const r=s[0],l=es[n.type],c=jt[n.componentType],u=c.BYTES_PER_ELEMENT,h=u*l,f=n.byteOffset||0,y=n.bufferView!==void 0?i.bufferViews[n.bufferView].byteStride:void 0,A=n.normalized===!0;let P,b;if(y&&y!==h){const E=Math.floor(f/y),F="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+E+":"+n.count;let v=t.cache.get(F);v||(P=new c(r,E*y,n.count*y/u),v=new Mo(P,y/u),t.cache.add(F,v)),b=new Uo(v,l,f%y/u,A)}else r===null?P=new c(n.count*l):P=new c(r,f,n.count*l),b=new Ln(P,l,A);if(n.sparse!==void 0){const E=es.SCALAR,F=jt[n.sparse.indices.componentType],v=n.sparse.indices.byteOffset||0,T=n.sparse.values.byteOffset||0,S=new F(s[1],v,n.sparse.count*E),H=new c(s[2],T,n.sparse.count*l);r!==null&&(b=new Ln(b.array.slice(),b.itemSize,b.normalized));for(let U=0,C=S.length;U<C;U++){const z=S[U];if(b.setX(z,H[U*l]),l>=2&&b.setY(z,H[U*l+1]),l>=3&&b.setZ(z,H[U*l+2]),l>=4&&b.setW(z,H[U*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return b})}loadTexture(e){const t=this.json,i=this.options,n=t.textures[e],o=t.images[n.source];let s=this.textureLoader;if(o.uri){const r=i.manager.getHandler(o.uri);r!==null&&(s=r)}return this.loadTextureImage(e,o,s)}loadTextureImage(e,t,i){const n=this,o=this.json,s=this.options,r=o.textures[e],l=(t.uri||t.bufferView)+":"+r.sampler;if(this.textureCache[l])return this.textureCache[l];const c=self.URL||self.webkitURL;let u=t.uri||"",h=!1;if(t.bufferView!==void 0)u=n.getDependency("bufferView",t.bufferView).then(function(y){h=!0;const A=new Blob([y],{type:t.mimeType});return u=c.createObjectURL(A),u});else if(t.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(u).then(function(y){return new Promise(function(A,P){let b=A;i.isImageBitmapLoader===!0&&(b=function(E){const F=new Fn(E);F.needsUpdate=!0,A(F)}),i.load(ts(y,s.path),b,void 0,P)})}).then(function(y){h===!0&&c.revokeObjectURL(u),y.flipY=!1,r.name&&(y.name=r.name);const P=(o.samplers||{})[r.sampler]||{};return y.magFilter=$n[P.magFilter]||mt,y.minFilter=$n[P.minFilter]||zn,y.wrapS=Jn[P.wrapS]||Bi,y.wrapT=Jn[P.wrapT]||Bi,n.associations.set(y,{textures:e}),y}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",u),null});return this.textureCache[l]=f,f}assignTexture(e,t,i){const n=this;return this.getDependency("texture",i.index).then(function(o){if(i.texCoord!==void 0&&i.texCoord!=0&&!(t==="aoMap"&&i.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+t+" not yet supported."),n.extensions[le.KHR_TEXTURE_TRANSFORM]){const s=i.extensions!==void 0?i.extensions[le.KHR_TEXTURE_TRANSFORM]:void 0;if(s){const r=n.associations.get(o);o=n.extensions[le.KHR_TEXTURE_TRANSFORM].extendTexture(o,s),n.associations.set(o,r)}}return e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const n=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,s=t.attributes.normal===void 0;if(e.isPoints){const r="PointsMaterial:"+i.uuid;let l=this.cache.get(r);l||(l=new vo,Di.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(r,l)),i=l}else if(e.isLine){const r="LineBasicMaterial:"+i.uuid;let l=this.cache.get(r);l||(l=new Rn,Di.prototype.copy.call(l,i),l.color.copy(i.color),this.cache.add(r,l)),i=l}if(n||o||s){let r="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(r+="specular-glossiness:"),n&&(r+="derivative-tangents:"),o&&(r+="vertex-colors:"),s&&(r+="flat-shading:");let l=this.cache.get(r);l||(l=i.clone(),o&&(l.vertexColors=!0),s&&(l.flatShading=!0),n&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(r,l),this.associations.set(l,this.associations.get(i))),i=l}i.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=i}getMaterialType(){return Hi}loadMaterial(e){const t=this,i=this.json,n=this.extensions,o=i.materials[e];let s;const r={},l=o.extensions||{},c=[];if(l[le.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const h=n[le.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=h.getMaterialType(),c.push(h.extendParams(r,o,t))}else if(l[le.KHR_MATERIALS_UNLIT]){const h=n[le.KHR_MATERIALS_UNLIT];s=h.getMaterialType(),c.push(h.extendParams(r,o,t))}else{const h=o.pbrMetallicRoughness||{};if(r.color=new we(1,1,1),r.opacity=1,Array.isArray(h.baseColorFactor)){const f=h.baseColorFactor;r.color.fromArray(f),r.opacity=f[3]}h.baseColorTexture!==void 0&&c.push(t.assignTexture(r,"map",h.baseColorTexture)),r.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,r.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(r,"metalnessMap",h.metallicRoughnessTexture)),c.push(t.assignTexture(r,"roughnessMap",h.metallicRoughnessTexture))),s=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,r)})))}o.doubleSided===!0&&(r.side=zt);const u=o.alphaMode||Yi.OPAQUE;if(u===Yi.BLEND?(r.transparent=!0,r.depthWrite=!1):(r.format=Eo,r.transparent=!1,u===Yi.MASK&&(r.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&s!==ke&&(c.push(t.assignTexture(r,"normalMap",o.normalTexture)),r.normalScale=new ee(1,1),o.normalTexture.scale!==void 0)){const h=o.normalTexture.scale;r.normalScale.set(h,h)}return o.occlusionTexture!==void 0&&s!==ke&&(c.push(t.assignTexture(r,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(r.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&s!==ke&&(r.emissive=new we().fromArray(o.emissiveFactor)),o.emissiveTexture!==void 0&&s!==ke&&c.push(t.assignTexture(r,"emissiveMap",o.emissiveTexture)),Promise.all(c).then(function(){let h;return s===Ki?h=n[le.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(r):h=new s(r),o.name&&(h.name=o.name),h.map&&(h.map.encoding=ni),h.emissiveMap&&(h.emissiveMap.encoding=ni),ht(h,o),t.associations.set(h,{materials:e}),o.extensions&&Gt(n,h,o),h})}createUniqueName(e){const t=So.sanitizeNodeName(e||"");let i=t;for(let n=1;this.nodeNamesUsed[i];++n)i=t+"_"+n;return this.nodeNamesUsed[i]=!0,i}loadGeometries(e){const t=this,i=this.extensions,n=this.primitiveCache;function o(r){return i[le.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,t).then(function(l){return ss(l,r,t)})}const s=[];for(let r=0,l=e.length;r<l;r++){const c=e[r],u=Na(c),h=n[u];if(h)s.push(h.promise);else{let f;c.extensions&&c.extensions[le.KHR_DRACO_MESH_COMPRESSION]?f=o(c):f=ss(new je,c,t),n[u]={primitive:c,promise:f},s.push(f)}}return Promise.all(s)}loadMesh(e){const t=this,i=this.json,n=this.extensions,o=i.meshes[e],s=o.primitives,r=[];for(let l=0,c=s.length;l<c;l++){const u=s[l].material===void 0?ka(this.cache):this.getDependency("material",s[l].material);r.push(u)}return r.push(t.loadGeometries(s)),Promise.all(r).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],h=[];for(let y=0,A=u.length;y<A;y++){const P=u[y],b=s[y];let E;const F=c[y];if(b.mode===Ye.TRIANGLES||b.mode===Ye.TRIANGLE_STRIP||b.mode===Ye.TRIANGLE_FAN||b.mode===void 0)E=o.isSkinnedMesh===!0?new To(P,F):new G(P,F),E.isSkinnedMesh===!0&&!E.geometry.attributes.skinWeight.normalized&&E.normalizeSkinWeights(),b.mode===Ye.TRIANGLE_STRIP?E.geometry=os(E.geometry,jo):b.mode===Ye.TRIANGLE_FAN&&(E.geometry=os(E.geometry,On));else if(b.mode===Ye.LINES)E=new Po(P,F);else if(b.mode===Ye.LINE_STRIP)E=new Xe(P,F);else if(b.mode===Ye.LINE_LOOP)E=new Co(P,F);else if(b.mode===Ye.POINTS)E=new Ao(P,F);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+b.mode);Object.keys(E.geometry.morphAttributes).length>0&&Fa(E,o),E.name=t.createUniqueName(o.name||"mesh_"+e),ht(E,o),b.extensions&&Gt(n,E,b),t.assignFinalMaterial(E),h.push(E)}for(let y=0,A=h.length;y<A;y++)t.associations.set(h[y],{meshes:e,primitives:y});if(h.length===1)return h[0];const f=new Ot;t.associations.set(f,{meshes:e});for(let y=0,A=h.length;y<A;y++)f.add(h[y]);return f})}loadCamera(e){let t;const i=this.json.cameras[e],n=i[i.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new In(si.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):i.type==="orthographic"&&(t=new Fi(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),ht(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then(function(n){return i.inverseBindMatrices=n,i})}loadAnimation(e){const i=this.json.animations[e],n=[],o=[],s=[],r=[],l=[];for(let c=0,u=i.channels.length;c<u;c++){const h=i.channels[c],f=i.samplers[h.sampler],y=h.target,A=y.node!==void 0?y.node:y.id,P=i.parameters!==void 0?i.parameters[f.input]:f.input,b=i.parameters!==void 0?i.parameters[f.output]:f.output;n.push(this.getDependency("node",A)),o.push(this.getDependency("accessor",P)),s.push(this.getDependency("accessor",b)),r.push(f),l.push(y)}return Promise.all([Promise.all(n),Promise.all(o),Promise.all(s),Promise.all(r),Promise.all(l)]).then(function(c){const u=c[0],h=c[1],f=c[2],y=c[3],A=c[4],P=[];for(let E=0,F=u.length;E<F;E++){const v=u[E],T=h[E],S=f[E],H=y[E],U=A[E];if(v===void 0)continue;v.updateMatrix(),v.matrixAutoUpdate=!0;let C;switch(et[U.path]){case et.weights:C=Vo;break;case et.rotation:C=Nn;break;case et.position:case et.scale:default:C=Go;break}const z=v.name?v.name:v.uuid,V=H.interpolation!==void 0?Ia[H.interpolation]:kn,W=[];et[U.path]===et.weights?v.traverse(function(L){L.isMesh===!0&&L.morphTargetInfluences&&W.push(L.name?L.name:L.uuid)}):W.push(z);let R=S.array;if(S.normalized){const L=qi(R.constructor),B=new Float32Array(R.length);for(let j=0,Q=R.length;j<Q;j++)B[j]=R[j]*L;R=B}for(let L=0,B=W.length;L<B;L++){const j=new C(W[L]+"."+et[U.path],T.array,R,V);H.interpolation==="CUBICSPLINE"&&(j.createInterpolant=function(N){const I=this instanceof Nn?Ra:ct;return new I(this.times,this.values,this.getValueSize()/3,N)},j.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),P.push(j)}}const b=i.name?i.name:"animation_"+e;return new Lo(b,void 0,P)})}createNodeMesh(e){const t=this.json,i=this,n=t.nodes[e];return n.mesh===void 0?null:i.getDependency("mesh",n.mesh).then(function(o){const s=i._getNodeRef(i.meshCache,n.mesh,o);return n.weights!==void 0&&s.traverse(function(r){if(!!r.isMesh)for(let l=0,c=n.weights.length;l<c;l++)r.morphTargetInfluences[l]=n.weights[l]}),s})}loadNode(e){const t=this.json,i=this.extensions,n=this,o=t.nodes[e],s=o.name?n.createUniqueName(o.name):"";return function(){const r=[],l=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&r.push(l),o.camera!==void 0&&r.push(n.getDependency("camera",o.camera).then(function(c){return n._getNodeRef(n.cameraCache,o.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){r.push(c)}),Promise.all(r)}().then(function(r){let l;if(o.isBone===!0?l=new zo:r.length>1?l=new Ot:r.length===1?l=r[0]:l=new xt,l!==r[0])for(let c=0,u=r.length;c<u;c++)l.add(r[c]);if(o.name&&(l.userData.name=o.name,l.name=s),ht(l,o),o.extensions&&Gt(i,l,o),o.matrix!==void 0){const c=new Rt;c.fromArray(o.matrix),l.applyMatrix4(c)}else o.translation!==void 0&&l.position.fromArray(o.translation),o.rotation!==void 0&&l.quaternion.fromArray(o.rotation),o.scale!==void 0&&l.scale.fromArray(o.scale);return n.associations.has(l)||n.associations.set(l,{}),n.associations.get(l).nodes=e,l})}loadScene(e){const t=this.json,i=this.extensions,n=this.json.scenes[e],o=this,s=new Ot;n.name&&(s.name=o.createUniqueName(n.name)),ht(s,n),n.extensions&&Gt(i,s,n);const r=n.nodes||[],l=[];for(let c=0,u=r.length;c<u;c++)l.push(ns(r[c],s,t,o));return Promise.all(l).then(function(){const c=u=>{const h=new Map;for(const[f,y]of o.associations)(f instanceof Di||f instanceof Fn)&&h.set(f,y);return u.traverse(f=>{const y=o.associations.get(f);y!=null&&h.set(f,y)}),h};return o.associations=c(s),s})}}function ns(a,e,t,i){const n=t.nodes[a];return i.getDependency("node",a).then(function(o){if(n.skin===void 0)return o;let s;return i.getDependency("skin",n.skin).then(function(r){s=r;const l=[];for(let c=0,u=s.joints.length;c<u;c++)l.push(i.getDependency("node",s.joints[c]));return Promise.all(l)}).then(function(r){return o.traverse(function(l){if(!l.isMesh)return;const c=[],u=[];for(let h=0,f=r.length;h<f;h++){const y=r[h];if(y){c.push(y);const A=new Rt;s.inverseBindMatrices!==void 0&&A.fromArray(s.inverseBindMatrices.array,h*16),u.push(A)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[h])}l.bind(new Ro(c,u),l.matrixWorld)}),o})}).then(function(o){e.add(o);const s=[];if(n.children){const r=n.children;for(let l=0,c=r.length;l<c;l++){const u=r[l];s.push(ns(u,o,t,i))}}return Promise.all(s)})}function Da(a,e,t){const i=e.attributes,n=new Bn;if(i.POSITION!==void 0){const r=t.json.accessors[i.POSITION],l=r.min,c=r.max;if(l!==void 0&&c!==void 0){if(n.set(new X(l[0],l[1],l[2]),new X(c[0],c[1],c[2])),r.normalized){const u=qi(jt[r.componentType]);n.min.multiplyScalar(u),n.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const r=new X,l=new X;for(let c=0,u=o.length;c<u;c++){const h=o[c];if(h.POSITION!==void 0){const f=t.json.accessors[h.POSITION],y=f.min,A=f.max;if(y!==void 0&&A!==void 0){if(l.setX(Math.max(Math.abs(y[0]),Math.abs(A[0]))),l.setY(Math.max(Math.abs(y[1]),Math.abs(A[1]))),l.setZ(Math.max(Math.abs(y[2]),Math.abs(A[2]))),f.normalized){const P=qi(jt[f.componentType]);l.multiplyScalar(P)}r.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(r)}a.boundingBox=n;const s=new Wo;n.getCenter(s.center),s.radius=n.min.distanceTo(n.max)/2,a.boundingSphere=s}function ss(a,e,t){const i=e.attributes,n=[];function o(s,r){return t.getDependency("accessor",s).then(function(l){a.setAttribute(r,l)})}for(const s in i){const r=Xi[s]||s.toLowerCase();r in a.attributes||n.push(o(i[s],r))}if(e.indices!==void 0&&!a.index){const s=t.getDependency("accessor",e.indices).then(function(r){a.setIndex(r)});n.push(s)}return ht(a,e),Da(a,e,t),Promise.all(n).then(function(){return e.targets!==void 0?Oa(a,e.targets,t):a})}function os(a,e){let t=a.getIndex();if(t===null){const s=[],r=a.getAttribute("position");if(r!==void 0){for(let l=0;l<r.count;l++)s.push(l);a.setIndex(s),t=a.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a}const i=t.count-2,n=[];if(e===On)for(let s=1;s<=i;s++)n.push(t.getX(0)),n.push(t.getX(s)),n.push(t.getX(s+1));else for(let s=0;s<i;s++)s%2==0?(n.push(t.getX(s)),n.push(t.getX(s+1)),n.push(t.getX(s+2))):(n.push(t.getX(s+2)),n.push(t.getX(s+1)),n.push(t.getX(s)));n.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=a.clone();return o.setIndex(n),o}class Zi extends Cn{constructor(e){super(e);this.defaultDPI=90,this.defaultUnit="px"}load(e,t,i,n){const o=this,s=new Ni(o.manager);s.setPath(o.path),s.setRequestHeader(o.requestHeader),s.setWithCredentials(o.withCredentials),s.load(e,function(r){try{t(o.parse(r))}catch(l){n?n(l):console.error(l),o.manager.itemError(e)}},i,n)}parse(e){const t=this;function i(M,x){if(M.nodeType!==1)return;const p=T(M);let _=!0,k=null;switch(M.nodeName){case"svg":break;case"style":o(M);break;case"g":x=A(M,x);break;case"path":x=A(M,x),M.hasAttribute("d")&&(k=n(M));break;case"rect":x=A(M,x),k=l(M);break;case"polygon":x=A(M,x),k=c(M);break;case"polyline":x=A(M,x),k=u(M);break;case"circle":x=A(M,x),k=h(M);break;case"ellipse":x=A(M,x),k=f(M);break;case"line":x=A(M,x),k=y(M);break;case"defs":_=!1;break;case"use":x=A(M,x);const g=M.href.baseVal.substring(1),D=M.viewportElement.getElementById(g);D?i(D,x):console.warn("SVGLoader: 'use node' references non-existent node id: "+g);break}if(k&&(x.fill!==void 0&&x.fill!=="none"&&k.color.setStyle(x.fill),H(k,se),V.push(k),k.userData={node:M,style:x}),_){const g=M.childNodes;for(let D=0;D<g.length;D++)i(g[D],x)}p&&(R.pop(),R.length>0?se.copy(R[R.length-1]):se.identity())}function n(M){const x=new lt,p=new ee,_=new ee,k=new ee;let g=!0,D=!1;const $=M.getAttribute("d").match(/[a-df-z][^a-df-z]*/ig);for(let J=0,Y=$.length;J<Y;J++){const ce=$[J],K=ce.charAt(0),q=ce.substr(1).trim();g===!0&&(D=!0,g=!1);let m;switch(K){case"M":m=b(q);for(let d=0,Z=m.length;d<Z;d+=2)p.x=m[d+0],p.y=m[d+1],_.x=p.x,_.y=p.y,d===0?x.moveTo(p.x,p.y):x.lineTo(p.x,p.y),d===0&&D===!0&&k.copy(p);break;case"H":m=b(q);for(let d=0,Z=m.length;d<Z;d++)p.x=m[d],_.x=p.x,_.y=p.y,x.lineTo(p.x,p.y),d===0&&D===!0&&k.copy(p);break;case"V":m=b(q);for(let d=0,Z=m.length;d<Z;d++)p.y=m[d],_.x=p.x,_.y=p.y,x.lineTo(p.x,p.y),d===0&&D===!0&&k.copy(p);break;case"L":m=b(q);for(let d=0,Z=m.length;d<Z;d+=2)p.x=m[d+0],p.y=m[d+1],_.x=p.x,_.y=p.y,x.lineTo(p.x,p.y),d===0&&D===!0&&k.copy(p);break;case"C":m=b(q);for(let d=0,Z=m.length;d<Z;d+=6)x.bezierCurveTo(m[d+0],m[d+1],m[d+2],m[d+3],m[d+4],m[d+5]),_.x=m[d+2],_.y=m[d+3],p.x=m[d+4],p.y=m[d+5],d===0&&D===!0&&k.copy(p);break;case"S":m=b(q);for(let d=0,Z=m.length;d<Z;d+=4)x.bezierCurveTo(P(p.x,_.x),P(p.y,_.y),m[d+0],m[d+1],m[d+2],m[d+3]),_.x=m[d+0],_.y=m[d+1],p.x=m[d+2],p.y=m[d+3],d===0&&D===!0&&k.copy(p);break;case"Q":m=b(q);for(let d=0,Z=m.length;d<Z;d+=4)x.quadraticCurveTo(m[d+0],m[d+1],m[d+2],m[d+3]),_.x=m[d+0],_.y=m[d+1],p.x=m[d+2],p.y=m[d+3],d===0&&D===!0&&k.copy(p);break;case"T":m=b(q);for(let d=0,Z=m.length;d<Z;d+=2){const re=P(p.x,_.x),fe=P(p.y,_.y);x.quadraticCurveTo(re,fe,m[d+0],m[d+1]),_.x=re,_.y=fe,p.x=m[d+0],p.y=m[d+1],d===0&&D===!0&&k.copy(p)}break;case"A":m=b(q,[3,4],7);for(let d=0,Z=m.length;d<Z;d+=7){if(m[d+5]==p.x&&m[d+6]==p.y)continue;const re=p.clone();p.x=m[d+5],p.y=m[d+6],_.x=p.x,_.y=p.y,s(x,m[d],m[d+1],m[d+2],m[d+3],m[d+4],re,p),d===0&&D===!0&&k.copy(p)}break;case"m":m=b(q);for(let d=0,Z=m.length;d<Z;d+=2)p.x+=m[d+0],p.y+=m[d+1],_.x=p.x,_.y=p.y,d===0?x.moveTo(p.x,p.y):x.lineTo(p.x,p.y),d===0&&D===!0&&k.copy(p);break;case"h":m=b(q);for(let d=0,Z=m.length;d<Z;d++)p.x+=m[d],_.x=p.x,_.y=p.y,x.lineTo(p.x,p.y),d===0&&D===!0&&k.copy(p);break;case"v":m=b(q);for(let d=0,Z=m.length;d<Z;d++)p.y+=m[d],_.x=p.x,_.y=p.y,x.lineTo(p.x,p.y),d===0&&D===!0&&k.copy(p);break;case"l":m=b(q);for(let d=0,Z=m.length;d<Z;d+=2)p.x+=m[d+0],p.y+=m[d+1],_.x=p.x,_.y=p.y,x.lineTo(p.x,p.y),d===0&&D===!0&&k.copy(p);break;case"c":m=b(q);for(let d=0,Z=m.length;d<Z;d+=6)x.bezierCurveTo(p.x+m[d+0],p.y+m[d+1],p.x+m[d+2],p.y+m[d+3],p.x+m[d+4],p.y+m[d+5]),_.x=p.x+m[d+2],_.y=p.y+m[d+3],p.x+=m[d+4],p.y+=m[d+5],d===0&&D===!0&&k.copy(p);break;case"s":m=b(q);for(let d=0,Z=m.length;d<Z;d+=4)x.bezierCurveTo(P(p.x,_.x),P(p.y,_.y),p.x+m[d+0],p.y+m[d+1],p.x+m[d+2],p.y+m[d+3]),_.x=p.x+m[d+0],_.y=p.y+m[d+1],p.x+=m[d+2],p.y+=m[d+3],d===0&&D===!0&&k.copy(p);break;case"q":m=b(q);for(let d=0,Z=m.length;d<Z;d+=4)x.quadraticCurveTo(p.x+m[d+0],p.y+m[d+1],p.x+m[d+2],p.y+m[d+3]),_.x=p.x+m[d+0],_.y=p.y+m[d+1],p.x+=m[d+2],p.y+=m[d+3],d===0&&D===!0&&k.copy(p);break;case"t":m=b(q);for(let d=0,Z=m.length;d<Z;d+=2){const re=P(p.x,_.x),fe=P(p.y,_.y);x.quadraticCurveTo(re,fe,p.x+m[d+0],p.y+m[d+1]),_.x=re,_.y=fe,p.x=p.x+m[d+0],p.y=p.y+m[d+1],d===0&&D===!0&&k.copy(p)}break;case"a":m=b(q,[3,4],7);for(let d=0,Z=m.length;d<Z;d+=7){if(m[d+5]==0&&m[d+6]==0)continue;const re=p.clone();p.x+=m[d+5],p.y+=m[d+6],_.x=p.x,_.y=p.y,s(x,m[d],m[d+1],m[d+2],m[d+3],m[d+4],re,p),d===0&&D===!0&&k.copy(p)}break;case"Z":case"z":x.currentPath.autoClose=!0,x.currentPath.curves.length>0&&(p.copy(k),x.currentPath.currentPoint.copy(p),g=!0);break;default:console.warn(ce)}D=!1}return x}function o(M){if(!(!M.sheet||!M.sheet.cssRules||!M.sheet.cssRules.length))for(let x=0;x<M.sheet.cssRules.length;x++){const p=M.sheet.cssRules[x];if(p.type!==1)continue;const _=p.selectorText.split(/,/gm).filter(Boolean).map(k=>k.trim());for(let k=0;k<_.length;k++)W[_[k]]=Object.assign(W[_[k]]||{},p.style)}}function s(M,x,p,_,k,g,D,ie){if(x==0||p==0){M.lineTo(ie.x,ie.y);return}_=_*Math.PI/180,x=Math.abs(x),p=Math.abs(p);const $=(D.x-ie.x)/2,J=(D.y-ie.y)/2,Y=Math.cos(_)*$+Math.sin(_)*J,ce=-Math.sin(_)*$+Math.cos(_)*J;let K=x*x,q=p*p;const m=Y*Y,d=ce*ce,Z=m/K+d/q;if(Z>1){const At=Math.sqrt(Z);x=At*x,p=At*p,K=x*x,q=p*p}const re=K*d+q*m,fe=(K*q-re)/re;let xe=Math.sqrt(Math.max(0,fe));k===g&&(xe=-xe);const Ie=xe*x*ce/p,at=-xe*p*Y/x,Ti=Math.cos(_)*Ie-Math.sin(_)*at+(D.x+ie.x)/2,Pi=Math.sin(_)*Ie+Math.cos(_)*at+(D.y+ie.y)/2,Ct=r(1,0,(Y-Ie)/x,(ce-at)/p),Ci=r((Y-Ie)/x,(ce-at)/p,(-Y-Ie)/x,(-ce-at)/p)%(Math.PI*2);M.currentPath.absellipse(Ti,Pi,x,p,Ct,Ct+Ci,g===0,_)}function r(M,x,p,_){const k=M*p+x*_,g=Math.sqrt(M*M+x*x)*Math.sqrt(p*p+_*_);let D=Math.acos(Math.max(-1,Math.min(1,k/g)));return M*_-x*p<0&&(D=-D),D}function l(M){const x=v(M.getAttribute("x")||0),p=v(M.getAttribute("y")||0),_=v(M.getAttribute("rx")||M.getAttribute("ry")||0),k=v(M.getAttribute("ry")||M.getAttribute("rx")||0),g=v(M.getAttribute("width")),D=v(M.getAttribute("height")),ie=1-.551915024494,$=new lt;return $.moveTo(x+_,p),$.lineTo(x+g-_,p),(_!==0||k!==0)&&$.bezierCurveTo(x+g-_*ie,p,x+g,p+k*ie,x+g,p+k),$.lineTo(x+g,p+D-k),(_!==0||k!==0)&&$.bezierCurveTo(x+g,p+D-k*ie,x+g-_*ie,p+D,x+g-_,p+D),$.lineTo(x+_,p+D),(_!==0||k!==0)&&$.bezierCurveTo(x+_*ie,p+D,x,p+D-k*ie,x,p+D-k),$.lineTo(x,p+k),(_!==0||k!==0)&&$.bezierCurveTo(x,p+k*ie,x+_*ie,p,x+_,p),$}function c(M){function x(g,D,ie){const $=v(D),J=v(ie);k===0?_.moveTo($,J):_.lineTo($,J),k++}const p=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,_=new lt;let k=0;return M.getAttribute("points").replace(p,x),_.currentPath.autoClose=!0,_}function u(M){function x(g,D,ie){const $=v(D),J=v(ie);k===0?_.moveTo($,J):_.lineTo($,J),k++}const p=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,_=new lt;let k=0;return M.getAttribute("points").replace(p,x),_.currentPath.autoClose=!1,_}function h(M){const x=v(M.getAttribute("cx")||0),p=v(M.getAttribute("cy")||0),_=v(M.getAttribute("r")||0),k=new Ui;k.absarc(x,p,_,0,Math.PI*2);const g=new lt;return g.subPaths.push(k),g}function f(M){const x=v(M.getAttribute("cx")||0),p=v(M.getAttribute("cy")||0),_=v(M.getAttribute("rx")||0),k=v(M.getAttribute("ry")||0),g=new Ui;g.absellipse(x,p,_,k,0,Math.PI*2);const D=new lt;return D.subPaths.push(g),D}function y(M){const x=v(M.getAttribute("x1")||0),p=v(M.getAttribute("y1")||0),_=v(M.getAttribute("x2")||0),k=v(M.getAttribute("y2")||0),g=new lt;return g.moveTo(x,p),g.lineTo(_,k),g.currentPath.autoClose=!1,g}function A(M,x){x=Object.assign({},x);let p={};if(M.hasAttribute("class")){const D=M.getAttribute("class").split(/\s/).filter(Boolean).map(ie=>ie.trim());for(let ie=0;ie<D.length;ie++)p=Object.assign(p,W["."+D[ie]])}M.hasAttribute("id")&&(p=Object.assign(p,W["#"+M.getAttribute("id")]));function _(D,ie,$){$===void 0&&($=function(Y){return Y.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),Y}),M.hasAttribute(D)&&(x[ie]=$(M.getAttribute(D))),p[D]&&(x[ie]=$(p[D])),M.style&&M.style[D]!==""&&(x[ie]=$(M.style[D]))}function k(D){return Math.max(0,Math.min(1,v(D)))}function g(D){return Math.max(0,v(D))}return _("fill","fill"),_("fill-opacity","fillOpacity",k),_("fill-rule","fillRule"),_("opacity","opacity",k),_("stroke","stroke"),_("stroke-opacity","strokeOpacity",k),_("stroke-width","strokeWidth",g),_("stroke-linejoin","strokeLineJoin"),_("stroke-linecap","strokeLineCap"),_("stroke-miterlimit","strokeMiterLimit",g),_("visibility","visibility"),x}function P(M,x){return M-(x-M)}function b(M,x,p){if(typeof M!="string")throw new TypeError("Invalid input: "+typeof M);const _={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},k=0,g=1,D=2,ie=3;let $=k,J=!0,Y="",ce="";const K=[];function q(re,fe,xe){const Ie=new SyntaxError('Unexpected character "'+re+'" at index '+fe+".");throw Ie.partial=xe,Ie}function m(){Y!==""&&(ce===""?K.push(Number(Y)):K.push(Number(Y)*Math.pow(10,Number(ce)))),Y="",ce=""}let d;const Z=M.length;for(let re=0;re<Z;re++){if(d=M[re],Array.isArray(x)&&x.includes(K.length%p)&&_.FLAGS.test(d)){$=g,Y=d,m();continue}if($===k){if(_.WHITESPACE.test(d))continue;if(_.DIGIT.test(d)||_.SIGN.test(d)){$=g,Y=d;continue}if(_.POINT.test(d)){$=D,Y=d;continue}_.COMMA.test(d)&&(J&&q(d,re,K),J=!0)}if($===g){if(_.DIGIT.test(d)){Y+=d;continue}if(_.POINT.test(d)){Y+=d,$=D;continue}if(_.EXP.test(d)){$=ie;continue}_.SIGN.test(d)&&Y.length===1&&_.SIGN.test(Y[0])&&q(d,re,K)}if($===D){if(_.DIGIT.test(d)){Y+=d;continue}if(_.EXP.test(d)){$=ie;continue}_.POINT.test(d)&&Y[Y.length-1]==="."&&q(d,re,K)}if($===ie){if(_.DIGIT.test(d)){ce+=d;continue}if(_.SIGN.test(d)){if(ce===""){ce+=d;continue}ce.length===1&&_.SIGN.test(ce)&&q(d,re,K)}}_.WHITESPACE.test(d)?(m(),$=k,J=!1):_.COMMA.test(d)?(m(),$=k,J=!0):_.SIGN.test(d)?(m(),$=g,Y=d):_.POINT.test(d)?(m(),$=D,Y=d):q(d,re,K)}return m(),K}const E=["mm","cm","in","pt","pc","px"],F={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{px:1}};function v(M){let x="px";if(typeof M=="string"||M instanceof String)for(let _=0,k=E.length;_<k;_++){const g=E[_];if(M.endsWith(g)){x=g,M=M.substring(0,M.length-g.length);break}}let p;return x==="px"&&t.defaultUnit!=="px"?p=F.in[t.defaultUnit]/t.defaultDPI:(p=F[x][t.defaultUnit],p<0&&(p=F[x].in*t.defaultDPI)),p*parseFloat(M)}function T(M){if(!(M.hasAttribute("transform")||M.nodeName==="use"&&(M.hasAttribute("x")||M.hasAttribute("y"))))return null;const x=S(M);return R.length>0&&x.premultiply(R[R.length-1]),se.copy(x),R.push(x),x}function S(M){const x=new _t,p=L;if(M.nodeName==="use"&&(M.hasAttribute("x")||M.hasAttribute("y"))){const _=v(M.getAttribute("x")),k=v(M.getAttribute("y"));x.translate(_,k)}if(M.hasAttribute("transform")){const _=M.getAttribute("transform").split(")");for(let k=_.length-1;k>=0;k--){const g=_[k].trim();if(g==="")continue;const D=g.indexOf("("),ie=g.length;if(D>0&&D<ie){const $=g.substr(0,D),J=b(g.substr(D+1,ie-D-1));switch(p.identity(),$){case"translate":if(J.length>=1){const Y=J[0];let ce=Y;J.length>=2&&(ce=J[1]),p.translate(Y,ce)}break;case"rotate":if(J.length>=1){let Y=0,ce=0,K=0;Y=-J[0]*Math.PI/180,J.length>=3&&(ce=J[1],K=J[2]),B.identity().translate(-ce,-K),j.identity().rotate(Y),Q.multiplyMatrices(j,B),B.identity().translate(ce,K),p.multiplyMatrices(B,Q)}break;case"scale":if(J.length>=1){const Y=J[0];let ce=Y;J.length>=2&&(ce=J[1]),p.scale(Y,ce)}break;case"skewX":J.length===1&&p.set(1,Math.tan(J[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":J.length===1&&p.set(1,0,0,Math.tan(J[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":J.length===6&&p.set(J[0],J[2],J[4],J[1],J[3],J[5],0,0,1);break}}x.premultiply(p)}}return x}function H(M,x){function p(g){I.set(g.x,g.y,1).applyMatrix3(x),g.set(I.x,I.y)}const _=U(x),k=M.subPaths;for(let g=0,D=k.length;g<D;g++){const $=k[g].curves;for(let J=0;J<$.length;J++){const Y=$[J];Y.isLineCurve?(p(Y.v1),p(Y.v2)):Y.isCubicBezierCurve?(p(Y.v0),p(Y.v1),p(Y.v2),p(Y.v3)):Y.isQuadraticBezierCurve?(p(Y.v0),p(Y.v1),p(Y.v2)):Y.isEllipseCurve&&(_&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),N.set(Y.aX,Y.aY),p(N),Y.aX=N.x,Y.aY=N.y,Y.xRadius*=C(x),Y.yRadius*=z(x))}}}function U(M){return M.elements[1]!==0||M.elements[3]!==0}function C(M){const x=M.elements;return Math.sqrt(x[0]*x[0]+x[1]*x[1])}function z(M){const x=M.elements;return Math.sqrt(x[3]*x[3]+x[4]*x[4])}const V=[],W={},R=[],L=new _t,B=new _t,j=new _t,Q=new _t,N=new ee,I=new X,se=new _t,pe=new DOMParser().parseFromString(e,"image/svg+xml");return i(pe.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:V,xml:pe.documentElement}}static createShapes(e){const t=999999999,i={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},n={loc:i.ORIGIN,t:0};function o(b,E,F,v){const T=b.x,S=E.x,H=F.x,U=v.x,C=b.y,z=E.y,V=F.y,W=v.y,R=(U-H)*(C-V)-(W-V)*(T-H),L=(S-T)*(C-V)-(z-C)*(T-H),B=(W-V)*(S-T)-(U-H)*(z-C),j=R/B,Q=L/B;if(B===0&&R!==0||j<=0||j>=1||Q<0||Q>1)return null;if(R===0&&B===0){for(let N=0;N<2;N++)if(s(N===0?F:v,b,E),n.loc==i.ORIGIN){const I=N===0?F:v;return{x:I.x,y:I.y,t:n.t}}else if(n.loc==i.BETWEEN){const I=+(T+n.t*(S-T)).toPrecision(10),se=+(C+n.t*(z-C)).toPrecision(10);return{x:I,y:se,t:n.t}}return null}else{for(let se=0;se<2;se++)if(s(se===0?F:v,b,E),n.loc==i.ORIGIN){const pe=se===0?F:v;return{x:pe.x,y:pe.y,t:n.t}}const N=+(T+j*(S-T)).toPrecision(10),I=+(C+j*(z-C)).toPrecision(10);return{x:N,y:I,t:j}}}function s(b,E,F){const v=F.x-E.x,T=F.y-E.y,S=b.x-E.x,H=b.y-E.y,U=v*H-S*T;if(b.x===E.x&&b.y===E.y){n.loc=i.ORIGIN,n.t=0;return}if(b.x===F.x&&b.y===F.y){n.loc=i.DESTINATION,n.t=1;return}if(U<-Number.EPSILON){n.loc=i.LEFT;return}if(U>Number.EPSILON){n.loc=i.RIGHT;return}if(v*S<0||T*H<0){n.loc=i.BEHIND;return}if(Math.sqrt(v*v+T*T)<Math.sqrt(S*S+H*H)){n.loc=i.BEYOND;return}let C;v!==0?C=S/v:C=H/T,n.loc=i.BETWEEN,n.t=C}function r(b,E){const F=[],v=[];for(let T=1;T<b.length;T++){const S=b[T-1],H=b[T];for(let U=1;U<E.length;U++){const C=E[U-1],z=E[U],V=o(S,H,C,z);V!==null&&F.find(W=>W.t<=V.t+Number.EPSILON&&W.t>=V.t-Number.EPSILON)===void 0&&(F.push(V),v.push(new ee(V.x,V.y)))}}return v}function l(b,E,F){const v=new ee;E.getCenter(v);const T=[];return F.forEach(S=>{S.boundingBox.containsPoint(v)&&r(b,S.points).forEach(U=>{T.push({identifier:S.identifier,isCW:S.isCW,point:U})})}),T.sort((S,H)=>S.point.x-H.point.x),T}function c(b,E,F,v,T){(T==null||T==="")&&(T="nonzero");const S=new ee;b.boundingBox.getCenter(S);const H=[new ee(F,S.y),new ee(v,S.y)],U=l(H,b.boundingBox,E);U.sort((L,B)=>L.point.x-B.point.x);const C=[],z=[];U.forEach(L=>{L.identifier===b.identifier?C.push(L):z.push(L)});const V=C[0].point.x,W=[];let R=0;for(;R<z.length&&z[R].point.x<V;)W.length>0&&W[W.length-1]===z[R].identifier?W.pop():W.push(z[R].identifier),R++;if(W.push(b.identifier),T==="evenodd"){const L=W.length%2==0,B=W[W.length-2];return{identifier:b.identifier,isHole:L,for:B}}else if(T==="nonzero"){let L=!0,B=null,j=null;for(let Q=0;Q<W.length;Q++){const N=W[Q];L?(j=E[N].isCW,L=!1,B=N):j!==E[N].isCW&&(j=E[N].isCW,L=!0)}return{identifier:b.identifier,isHole:L,for:B}}else console.warn('fill-rule: "'+T+'" is currently not implemented.')}let u=0,h=t,f=-t,y=e.subPaths.map(b=>{const E=b.getPoints();let F=-t,v=t,T=-t,S=t;for(let H=0;H<E.length;H++){const U=E[H];U.y>F&&(F=U.y),U.y<v&&(v=U.y),U.x>T&&(T=U.x),U.x<S&&(S=U.x)}return f<=T&&(f=T+1),h>=S&&(h=S-1),{points:E,isCW:Xo.isClockWise(E),identifier:u++,boundingBox:new Yo(new ee(S,v),new ee(T,F))}});y=y.filter(b=>b.points.length>1);const A=y.map(b=>c(b,y,h,f,e.userData.style.fillRule)),P=[];return y.forEach(b=>{if(!A[b.identifier].isHole){const F=new qo(b.points);A.filter(T=>T.isHole&&T.for===b.identifier).forEach(T=>{const S=y[T.identifier];F.holes.push(new Ui(S.points))}),P.push(F)}}),P}static getStrokeStyle(e,t,i,n,o){return e=e!==void 0?e:1,t=t!==void 0?t:"#000",i=i!==void 0?i:"miter",n=n!==void 0?n:"butt",o=o!==void 0?o:4,{strokeColor:t,strokeWidth:e,strokeLineJoin:i,strokeLineCap:n,strokeMiterLimit:o}}static pointsToStroke(e,t,i,n){const o=[],s=[],r=[];if(Zi.pointsToStrokeWithBuffers(e,t,i,n,o,s,r)===0)return null;const l=new je;return l.setAttribute("position",new Le(o,3)),l.setAttribute("normal",new Le(s,3)),l.setAttribute("uv",new Le(r,2)),l}static pointsToStrokeWithBuffers(e,t,i,n,o,s,r,l){const c=new ee,u=new ee,h=new ee,f=new ee,y=new ee,A=new ee,P=new ee,b=new ee,E=new ee,F=new ee,v=new ee,T=new ee,S=new ee,H=new ee,U=new ee,C=new ee,z=new ee;i=i!==void 0?i:12,n=n!==void 0?n:.001,l=l!==void 0?l:0,e=ce(e);const V=e.length;if(V<2)return 0;const W=e[0].equals(e[V-1]);let R,L=e[0],B;const j=t.strokeWidth/2,Q=1/(V-1);let N=0,I,se,pe,Ae,M=!1,x=0,p=l*3,_=l*2;k(e[0],e[1],c).multiplyScalar(j),b.copy(e[0]).sub(c),E.copy(e[0]).add(c),F.copy(b),v.copy(E);for(let K=1;K<V;K++){R=e[K],K===V-1?W?B=e[1]:B=void 0:B=e[K+1];const q=c;if(k(L,R,q),h.copy(q).multiplyScalar(j),T.copy(R).sub(h),S.copy(R).add(h),I=N+Q,se=!1,B!==void 0){k(R,B,u),h.copy(u).multiplyScalar(j),H.copy(R).sub(h),U.copy(R).add(h),pe=!0,h.subVectors(B,L),q.dot(h)<0&&(pe=!1),K===1&&(M=pe),h.subVectors(B,R),h.normalize();const m=Math.abs(q.dot(h));if(m!==0){const d=j/m;h.multiplyScalar(-d),f.subVectors(R,L),y.copy(f).setLength(d).add(h),C.copy(y).negate();const Z=y.length(),re=f.length();f.divideScalar(re),A.subVectors(B,R);const fe=A.length();switch(A.divideScalar(fe),f.dot(C)<re&&A.dot(C)<fe&&(se=!0),z.copy(y).add(R),C.add(R),Ae=!1,se?pe?(U.copy(C),S.copy(C)):(H.copy(C),T.copy(C)):ie(),t.strokeLineJoin){case"bevel":$(pe,se,I);break;case"round":J(pe,se),pe?D(R,T,H,I,0):D(R,U,S,I,1);break;case"miter":case"miter-clip":default:const xe=j*t.strokeMiterLimit/Z;if(xe<1)if(t.strokeLineJoin!=="miter-clip"){$(pe,se,I);break}else J(pe,se),pe?(A.subVectors(z,T).multiplyScalar(xe).add(T),P.subVectors(z,H).multiplyScalar(xe).add(H),g(T,I,0),g(A,I,0),g(R,I,.5),g(R,I,.5),g(A,I,0),g(P,I,0),g(R,I,.5),g(P,I,0),g(H,I,0)):(A.subVectors(z,S).multiplyScalar(xe).add(S),P.subVectors(z,U).multiplyScalar(xe).add(U),g(S,I,1),g(A,I,1),g(R,I,.5),g(R,I,.5),g(A,I,1),g(P,I,1),g(R,I,.5),g(P,I,1),g(U,I,1));else se?(pe?(g(E,N,1),g(b,N,0),g(z,I,0),g(E,N,1),g(z,I,0),g(C,I,1)):(g(E,N,1),g(b,N,0),g(z,I,1),g(b,N,0),g(C,I,0),g(z,I,1)),pe?H.copy(z):U.copy(z)):pe?(g(T,I,0),g(z,I,0),g(R,I,.5),g(R,I,.5),g(z,I,0),g(H,I,0)):(g(S,I,1),g(z,I,1),g(R,I,.5),g(R,I,.5),g(z,I,1),g(U,I,1)),Ae=!0;break}}else ie()}else ie();!W&&K===V-1&&Y(e[0],F,v,pe,!0,N),N=I,L=R,b.copy(H),E.copy(U)}if(!W)Y(R,T,S,pe,!1,I);else if(se&&o){let K=z,q=C;M!==pe&&(K=C,q=z),pe?(Ae||M)&&(q.toArray(o,0*3),q.toArray(o,3*3),Ae&&K.toArray(o,1*3)):(Ae||!M)&&(q.toArray(o,1*3),q.toArray(o,3*3),Ae&&K.toArray(o,0*3))}return x;function k(K,q,m){return m.subVectors(q,K),m.set(-m.y,m.x).normalize()}function g(K,q,m){o&&(o[p]=K.x,o[p+1]=K.y,o[p+2]=0,s&&(s[p]=0,s[p+1]=0,s[p+2]=1),p+=3,r&&(r[_]=q,r[_+1]=m,_+=2)),x+=3}function D(K,q,m,d,Z){c.copy(q).sub(K).normalize(),u.copy(m).sub(K).normalize();let re=Math.PI;const fe=c.dot(u);Math.abs(fe)<1&&(re=Math.abs(Math.acos(fe))),re/=i,h.copy(q);for(let xe=0,Ie=i-1;xe<Ie;xe++)f.copy(h).rotateAround(K,re),g(h,d,Z),g(f,d,Z),g(K,d,.5),h.copy(f);g(f,d,Z),g(m,d,Z),g(K,d,.5)}function ie(){g(E,N,1),g(b,N,0),g(T,I,0),g(E,N,1),g(T,I,1),g(S,I,0)}function $(K,q,m){q?K?(g(E,N,1),g(b,N,0),g(T,I,0),g(E,N,1),g(T,I,0),g(C,I,1),g(T,m,0),g(H,m,0),g(C,m,.5)):(g(E,N,1),g(b,N,0),g(S,I,1),g(b,N,0),g(C,I,0),g(S,I,1),g(S,m,1),g(U,m,0),g(C,m,.5)):K?(g(T,m,0),g(H,m,0),g(R,m,.5)):(g(S,m,1),g(U,m,0),g(R,m,.5))}function J(K,q){q&&(K?(g(E,N,1),g(b,N,0),g(T,I,0),g(E,N,1),g(T,I,0),g(C,I,1),g(T,N,0),g(R,I,.5),g(C,I,1),g(R,I,.5),g(H,N,0),g(C,I,1)):(g(E,N,1),g(b,N,0),g(S,I,1),g(b,N,0),g(C,I,0),g(S,I,1),g(S,N,1),g(C,I,0),g(R,I,.5),g(R,I,.5),g(C,I,0),g(U,N,1)))}function Y(K,q,m,d,Z,re){switch(t.strokeLineCap){case"round":Z?D(K,m,q,re,.5):D(K,q,m,re,.5);break;case"square":if(Z)c.subVectors(q,K),u.set(c.y,-c.x),h.addVectors(c,u).add(K),f.subVectors(u,c).add(K),d?(h.toArray(o,1*3),f.toArray(o,0*3),f.toArray(o,3*3)):(h.toArray(o,1*3),h.toArray(o,3*3),f.toArray(o,0*3));else{c.subVectors(m,K),u.set(c.y,-c.x),h.addVectors(c,u).add(K),f.subVectors(u,c).add(K);const fe=o.length;d?(h.toArray(o,fe-1*3),f.toArray(o,fe-2*3),f.toArray(o,fe-4*3)):(h.toArray(o,fe-2*3),f.toArray(o,fe-1*3),f.toArray(o,fe-4*3))}break}}function ce(K){let q=!1;for(let d=1,Z=K.length-1;d<Z;d++)if(K[d].distanceTo(K[d+1])<n){q=!0;break}if(!q)return K;const m=[];m.push(K[0]);for(let d=1,Z=K.length-1;d<Z;d++)K[d].distanceTo(K[d+1])>=n&&m.push(K[d]);return m.push(K[K.length-1]),m}}}function qe(){}function ri(a,e="?"){const t=a.split(".").pop(),i=yr(`Loading resource: ${a}`);let n;switch(t){case"jpg":n=new Zo;break;case"svg":n=new Zi;break;case"glb":case"gltf":n=new fa;break;default:return Promise.reject(new Error(`unknown resource type [${t}]`))}return new Promise((s,r)=>{const l=u=>{s(u),gs(i)},c=u=>{console.error(`Failed to load resource: ${a}`),r(u)};n.load(a,l,o,c)});function o({loaded:s,total:r,lengthComputable:l}){const c=l?`${as(r,"k")} kB`:e;i.setContent(`Loading resource: ${a} (${as(s,"k")} / ${c})`)}}function as(a,e){let t=a;const i=["k","M","G","T"].indexOf(e)+1;for(let n=0;n<i;n++)t/=1024;return t.toFixed(2)}function Ha({paths:a},e={}){const t=new Ot,i={bevelEnabled:!1,depth:1};for(let h=0;h<a.length;h++){const f=a[h],y=new ke({color:f.color}),A=f.toShapes(!1);for(let P=0;P<A.length;P++){const b=A[P],E=new Qo(b,i),F=new G(E,y);t.add(F)}}const{x:n,y:o,z:s}=new Bn().setFromObject(t).getSize(new X),{x:r=0,y:l=0,z:c=0,scale:u=1}=e;return t.traverse(h=>{h.translateX(-n/2+r),h.translateY(-o/2+l),h.translateZ(-s/2+c)}),t.rotateY(Math.PI),t.rotateZ(Math.PI),t.scale.set(u,u,u),t}function Ua(a,e=1024){return[{x:2,y:1},{x:0,y:1},{x:1,y:0},{x:1,y:2},{x:1,y:1},{x:3,y:1}].map(i);function i({x:n,y:o}){const s=document.createElement("canvas");return s.width=e,s.height=e,s.getContext("2d").drawImage(a,-n*e,-o*e),s}}function rs(a,e=200,t=!1){let i;return(...n)=>{t&&!i&&a(...n),clearTimeout(i),i=window.setTimeout(()=>{t?i=void 0:a(...n)},e)}}function ja(a,e=200){let t,i,n,o;return(...s)=>{o=i+e,n=performance.now(),!i||n>o?(a(...s),i=n):(window.clearTimeout(t),t=window.setTimeout(()=>{a(...s),i=n},e-(n-i)))}}const Ga=/Android|iPhone|iPad/i;function Va(){return Ga.test(window.navigator.userAgent)}function ls(a){const e=Math.floor(a%1e3),t=Math.floor(a/1e3%60),i=Math.floor(a/6e4%60);return`${cs(i)}:${cs(t)}.${e}`}function cs(a){const e=a.toString();return e.length<2?`0${a}`:e}function Wa(a){return`#${a.toString(16).toUpperCase()}`}function ve(a){return a/180*Math.PI}function Be(a){return a*180/Math.PI}function wt(a){return Math.round((a+Number.EPSILON)*100)/100}function hs(a,e,t){return Math.max(e,Math.min(a,t))}function Ka(a,...e){return Object.keys(a).reduce((t,i)=>(e.includes(i)||(t[i]=a[i]),t),{})}function Xa(a,...e){return e.reduce((t,i)=>(a.hasOwnProperty(i)&&(t[i]=a[i]),t),{})}Object.defineProperties(Object,{omit:{value:Ka},pick:{value:Xa}});const li=document.createElement("datalist");li.id="colorValueList";document.documentElement.appendChild(li);function Ya(a){const e=document.createElement("option");e.textContent=Wa(a),li.appendChild(e)}class Qi extends ae.exports.Component{constructor(e){super(e);O(this,"inputRef",ae.exports.createRef());O(this,"onInputFieldChange",({currentTarget:e})=>{this.props.onInput&&this.props.onInput(e.value),this.setState({value:e.value})});O(this,"onInputFieldKeyUp",({key:e})=>{(e==="Enter"||e==="Escape")&&this.inputElement.blur()});O(this,"onInputFieldBlur",()=>{this.state.value!==this.props.value.toLowerCase()&&this.props.onChange(this.state.value,this.props.id)});this.state={value:e.value.toLowerCase()}}render(){const{id:e,label:t}=this.props,{value:i}=this.state;return ne.createElement(da,{label:t,id:e},ne.createElement("input",{type:"color",list:li.id,value:i,id:e,name:e,onChange:this.onInputFieldChange,onBlur:this.onInputFieldBlur,onKeyUp:this.onInputFieldKeyUp,ref:this.inputRef}))}componentDidUpdate(e){this.props.value!==e.value&&this.setState({value:this.props.value})}get inputElement(){return this.inputRef.current}}O(Qi,"defaultProps",{id:"",label:"",value:"",onChange:qe}),O(Qi,"addColorValues",(...e)=>{e.forEach(Ya)});const qa=new Set(["Space","PageUp","PageDown","End","Home","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Escape","Tab"]),Za=new Set(["KeyF","KeyH","KeyJ","KeyO","KeyP","KeyS"]),bt=new Set;let Mt;const ci=new Set,hi=new Ht;var De={addKeyPressListener:Ja,removeKeyPressListener:er,addKeyDownChangeListener:Qa,removeKeyDownChangeListener:$a,clearKeysDown:tr};function Qa(a){ci.add(a)}function $a(a){ci.delete(a)}function Ja(a,e){hi.add(a,e)}function er(a,e){hi.remove(a,e)}function tr(){bt.clear(),ci.forEach(us)}window.onkeydown=window.onkeyup=a=>{a.target.tagName==="INPUT"||a.target.tabIndex>-1||((qa.has(a.code)||a.ctrlKey&&Za.has(a.code))&&a.preventDefault(),!(a.type==="keydown"&&a.repeat)&&(Mt=a.code,a.type==="keyup"?(bt.delete(Mt),hi.dispatch(Mt,a)):bt.add(Mt),$i()))};pi("topLeftPanel","Tab","\u22EE");Va()&&(ui("bottomLeftPanel","ArrowUp","\u25B2"),ui("bottomLeftPanel","ArrowDown","\u25BC"),ui("bottomRightPanel","ArrowLeft","\u25C4"),ui("bottomRightPanel","ArrowRight","\u25BA"),pi("topRightPanel","KeyP","p"),pi("topRightPanel","KeyC","c"),pi("topRightPanel","KeyR","\u27F2"));function ps(a,e,t){const i=document.createElement("button");i.addEventListener("mousedown",e),i.addEventListener("touchstart",e),i.addEventListener("mouseup",t),i.addEventListener("mouseleave",t),i.addEventListener("touchcancel",t),i.addEventListener("touchend",t);const n=document.getElementById(a);return n.classList.remove("hidden"),n.appendChild(i)}function pi(a,e,t){const i=rs(o=>{Mt=e,hi.dispatch(Mt,o)},200,!0),n=ps(a,i,qe);n.textContent=t,n.id=e,n.classList.add("screenButton")}function ui(a,e,t){const o=ps(a,()=>{bt.add(e),$i()},()=>{bt.delete(e),$i()});o.textContent=t,o.id=e,o.classList.add("screenKey")}function $i(){ci.forEach(us)}function us(a){a(bt)}const ir=`
    input:not([disabled]),
    textarea:not([disabled]),
    button:not([disabled]),
    select,
    [tabindex]
`,nr="\u2A2F",Oe=document.createElement("aside");Oe.classList.add("hidden");Oe.id="modal__root";Oe.tabIndex=-1;document.body.appendChild(Oe);const sr=function({onClose:a,children:e}){return ne.createElement("div",{className:"modal__container"},a&&ne.createElement("span",{className:"modal__closeButton",onClick:a},nr),e)},ds=function({onClose:a,children:e}){const t=document.activeElement;return ae.exports.useEffect(()=>(De.clearKeysDown(),Oe.classList.remove("hidden"),Oe.addEventListener("keydown",i),Oe.addEventListener("keyup",n),Oe.focus(),()=>{Oe.removeEventListener("keydown",i),Oe.removeEventListener("keyup",n),Oe.classList.add("hidden"),t.focus()}),[]),Bt.exports.createPortal(ne.createElement(sr,{onClose:a},e),Oe);function i(s){s.stopPropagation(),s.key==="Tab"&&s.preventDefault()}function n(s){s.stopPropagation(),s.preventDefault(),a&&s.key==="Escape"?a():s.key==="Tab"&&o(s.shiftKey?-1:1)}function o(s){const r=or(Oe);if(!r.length)return;const l=document.activeElement,c=r.indexOf(l),u=r.length-1;let h=c+s;h<0?h=u:h>u&&(h=0),r[h].focus()}};function or(a){return[...a.querySelectorAll(ir)].filter(ar)}function ar(a){return a.tabIndex!==-1&&window.getComputedStyle(a).visibility!=="hidden"}var Vt;(function(a){a.en="en",a.hu="hu"})(Vt||(Vt={}));let fs=Vt.en;const rr={okButtonLabel:"Ok",cancelButtonLabel:"Cancel",importButtonLabel:"Import",exportButtonLabel:"Export",mapElementListLabel:"Map elements:",translatePanelLabel:"Translate",positionLabel:"position",rotationLabel:"rotation",transformPanelLabel:"Transform",widthLabel:"width:",heightLabel:"height:",lengthLabel:"length:",radiusTopLabel:"radiusTop:",radiusBottomLabel:"radiusBottom:",sidesLabel:"sides:",segmentWidthLabel:"segmentWidth:",segmentHeightLabel:"segmentHeight:",segmentLengthLabel:"segmentLength:",segmentCountLabel:"segmentCount:",offsetLabel:"offset:",radiusLabel:"radius:",angleLabel:"angle:",cloneButtonLabel:"clone",removeButtonLabel:"remove",createButtonLabel:"create"},lr={[Vt.hu]:{mapElementListLabel:"P\xE1lya elemek:",translatePanelLabel:"Elhelyez\xE9s"}};var cr=new Proxy(rr,{get(a,e){return fs!==Vt.en&&lr[fs][e]||a[e]}}),Se;(function(a){a.open="open",a.confirm="confirm",a.didMount="didMount",a.willUnmount="willUnmount"})(Se||(Se={}));const Fe=new Ht,{okButtonLabel:hr,cancelButtonLabel:pr}=cr,di=document.createElement("aside");di.id="menuModalControllerRoot";di.classList.add("hidden");document.body.appendChild(di);function ur(){Bt.exports.render(ne.createElement(ae.exports.StrictMode,null,ne.createElement(dr,null)),di)}function dr(){const[a,e]=ae.exports.useState(!0),t=ae.exports.useRef("");return ae.exports.useEffect(()=>(Fe.add(Se.open,n),Fe.dispatch(Se.didMount),()=>{Fe.dispatch(Se.willUnmount),Fe.remove(Se.open,n)}),[]),a?null:ne.createElement(fr,{message:t.current,closeModal:i});function i(){e(!0)}function n(o=""){t.current=o,e(!1)}}function fr({message:a,closeModal:e}){const t=ae.exports.useRef();return ae.exports.useEffect(()=>{t.current.focus()},[]),ne.createElement(ds,null,ne.createElement("span",{className:"modal__body dialog__message"},a),ne.createElement("div",{className:"modal__footer dialog__buttonBar"},ne.createElement("button",{className:"dialog__button",onClick:i,"data-confirm":"false"},pr),ne.createElement("button",{className:"dialog__button",onClick:i,"data-confirm":"true",ref:t},hr)));function i(n){const o=JSON.parse(n.currentTarget.dataset.confirm);Fe.dispatch(Se.confirm,o),e()}}class mr{constructor(){O(this,"notificationElement",document.createElement("div"));O(this,"notificationElementBody",document.createElement("span"));this.notificationElement.classList.add("notificationElement","hidden"),this.notificationElement.appendChild(this.notificationElementBody)}get hidden(){return this.notificationElement.classList.contains("hidden")}show(){this.notificationElement.classList.remove("hidden")}fadeOut(){this.notificationElement.classList.add("fade-out")}hide(){this.notificationElement.classList.remove("fade-out"),this.notificationElement.classList.add("hidden")}setContent(e){this.notificationElementBody.textContent=e}}const gr=1500,ms=1e3,Ji=document.createElement("div");Ji.id="notificationElementContainer";document.body.appendChild(Ji);document.documentElement.style.setProperty("--fade-out-duration",`${ms/1e3}s`);const en=new qn(1,{itemProvider(){return new mr},itemActiveCheck(a){return!a.hidden},itemActivator(a){a.show(),Ji.appendChild(a.notificationElement)},itemDeactivator(a){a.hide()}});function yr(a){const e=en.obtain();return e.setContent(a),e}function gs(a){a.fadeOut(),window.setTimeout(()=>{en.release(a)},ms)}function Wt(a){const e=en.obtain();e.setContent(a),window.setTimeout(()=>{gs(e)},gr)}let tn=!1;Fe.add(Se.didMount,()=>{tn=!0});Fe.add(Se.willUnmount,()=>{tn=!1});ur();function xr(a){if(tn)Fe.dispatch(Se.open,a);else{const e=()=>{Fe.remove(Se.didMount,e),Fe.dispatch(Se.open,a)};Fe.add(Se.didMount,e)}return new Promise(e=>{Fe.add(Se.confirm,t);function t(i){Fe.remove(Se.confirm,t),e(i)}})}var Te;(function(a){a.dynamic="dynamic",a.free="free",a.chase="chase",a.hood="hood"})(Te||(Te={}));const nn=[Te.dynamic,Te.free,Te.chase,Te.hood],pt=new X,sn=new X;class _r{constructor(e){O(this,"domElement");O(this,"camera");O(this,"orbitControls");O(this,"cameraTarget");O(this,"cameraPosition",new X);O(this,"cameraSpeed",.2);O(this,"currentCameraMode");O(this,"chaseCameraMountPositionHelper",new xt);O(this,"update",qe);this.domElement=e,this.camera=new In(de.camera.fov,window.aspectRatio,de.camera.near,de.camera.far),this.camera.position.set(de.camera.initialPosition.x,de.camera.initialPosition.y,de.camera.initialPosition.z),this.cameraPosition.copy(this.camera.position),this.orbitControls=new pa(this.camera,e),this.orbitControls.minDistance=1,this.orbitControls.enabled=!1}set cameraMode(e){if(this.currentCameraMode!==e){switch(this.currentCameraMode){case Te.dynamic:case Te.chase:this.update=qe;break;case Te.hood:this.chaseCameraMountPositionHelper.getWorldPosition(pt),this.camera.position.copy(pt),this.cameraPosition.copy(pt),this.cameraTarget.chassisMesh.remove(this.camera),this.camera.fov=de.camera.fov,this.camera.updateProjectionMatrix();break;case Te.free:this.orbitControls.enabled=!1;break}switch(e){case Te.dynamic:this.update=this.updateDynamicCamera,Wt('Camera mode is set to: "dynamic"');break;case Te.chase:this.update=this.updateChaseCamera,Wt('Camera mode is set to: "chase"');break;case Te.hood:this.cameraTarget.chassisMesh.add(this.camera),this.camera.position.set(0,1.1,-.47),this.camera.rotation.set(0,0,0),this.camera.fov=60,this.camera.updateProjectionMatrix(),this.update=qe,Wt('Camera mode is set to: "hood"');break;case Te.free:this.orbitControls.enabled=!0,Wt('Camera mode is set to: "free" (use mouse to look around)');break}this.currentCameraMode=e}}updateDynamicCamera(e){if(!this.camera.position.equals(this.cameraPosition)){const t=1-this.cameraSpeed**e;this.camera.position.lerp(this.cameraPosition,t)}this.cameraTarget&&this.camera.lookAt(this.cameraTarget.chassisMesh.position)}updateChaseCamera(e){var o;const t=(o=this.cameraTarget)==null?void 0:o.chassisMesh,{currentVehicleSpeedKmHour:i}=this.cameraTarget.base;if(!t)return;this.chaseCameraMountPositionHelper.getWorldPosition(pt),pt.y<t.position.y&&pt.setY(t.position.y);const n=1-this.cameraSpeed**e;this.camera.position.lerp(pt,n),sn.copy(t.position),sn.y+=hs(i*-.01,-4,4),this.camera.lookAt(sn)}switchMode(){const e=nn.indexOf(this.currentCameraMode),t=e<nn.length-1?e+1:0,i=nn[t];this.cameraMode=i}setCameraTarget(e){const t=e.chassisMesh;if(e!==this.cameraTarget){if(e){const{x:i,y:n,z:o}=de.vehicle.cameraMountPosition;t.add(this.chaseCameraMountPositionHelper),this.chaseCameraMountPositionHelper.position.set(i,n,o)}else!e&&this.cameraTarget&&t.remove(this.chaseCameraMountPositionHelper);this.cameraTarget=e,this.cameraMode=Te.dynamic}}}const wr="modulepreload",ys={},br="/",xs=function(e,t){return!t||t.length===0?e():Promise.all(t.map(i=>{if(i=`${br}${i}`,i in ys)return;ys[i]=!0;const n=i.endsWith(".css"),o=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${o}`))return;const s=document.createElement("link");if(s.rel=n?"stylesheet":wr,n||(s.as="script",s.crossOrigin=""),s.href=i,document.head.appendChild(s),n)return new Promise((r,l)=>{s.addEventListener("load",r),s.addEventListener("error",l)})})).then(()=>e())};function _s(){return ne.createElement("div",null,"Loading...")}const vt=document.createElement("aside");vt.id="editorPanel";vt.classList.add("floatingPanel","hidden");document.body.appendChild(vt);const Mr={mapBuilder:void 0,mapElementProps:void 0,editorPanelVisible:!1},ws=ae.exports.createContext(Mr);function vr(a){Bt.exports.render(ne.createElement(Er,{mapBuilder:a}),vt)}function Er({mapBuilder:a}){const[e,t]=ae.exports.useState(a.editMode),[i,n]=ae.exports.useState(a.selectedMapElementId),[o,s]=ae.exports.useState();ae.exports.useEffect(()=>(a.listeners.add(Pe.mapElementSelect,n),a.listeners.add(Pe.mapElementChange,s),a.listeners.add(Pe.editModeChange,t),()=>{a.listeners.remove(Pe.mapElementSelect,n),a.listeners.remove(Pe.mapElementChange,s),a.listeners.remove(Pe.editModeChange,t)}),[]),ae.exports.useEffect(()=>{s(Ne({},a.getPropsFromStore(i)))},[i]),ae.exports.useEffect(()=>{e?vt.classList.remove("hidden"):vt.classList.add("hidden")},[e]);const r={mapBuilder:a,mapElementProps:o,editorPanelVisible:e};return ne.createElement(ws.Provider,{value:r},ne.createElement(Sr,null))}function Sr(){const{editorPanelVisible:a}=ae.exports.useContext(ws),e=ae.exports.lazy(()=>xs(()=>import("./EditorPanel700bcb89.js"),["esm/EditorPanel700bcb89.js","esm/react6742c151.js","esm/Switche9f51982.js","esm/cannoncd468cdc.js","esm/three895a3223.js"]));return ae.exports.useMemo(()=>a?ne.createElement(ae.exports.Suspense,{fallback:ne.createElement(_s,null)},ne.createElement(e,null)):null,[a])}const Kt=new he;function Tr(a,e){const t=new he,i=new he,n=new he,o=new he,{movement:{x:s=0,y:r=0,z:l=0},speed:c=1,triggerStart:u=!0,alternate:h=!0,alternateDelay:f=0}=JSON.parse(e),y=c*.05;return n.copy(a.position),o.set(s,r,l),o.vadd(a.position,o),o.vsub(n,Kt),Kt.normalize(),Kt.scale(c,t),t.negate(i),{triggerStart:u,movementHandler:A,velocity_x:t.x,velocity_y:t.y,velocity_z:t.z};function A(){a.position.almostEquals(o,y)&&E(o)?(h?f?(a.velocity.setZero(),window.setTimeout(P,f*1e3)):P():a.velocity.setZero(),a.position.copy(o)):a.position.almostEquals(n,y)&&E(n)&&(f?(a.velocity.setZero(),window.setTimeout(b,f*1e3)):b(),a.position.copy(n))}function P(){a.velocity.copy(i)}function b(){a.velocity.copy(t)}function E(F){return F.vsub(a.position,Kt),Kt.dot(a.velocity)>0}}const fi=0,Pr=1,Cr=new X,bs=new $o,on=new Jo,Ms=new X,mi=new ea;class vs{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new Es,this.unassigned=new Es,this.vertices=[]}setFromPoints(e){Array.isArray(e)!==!0&&console.error("THREE.ConvexHull: Points parameter is not an array."),e.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.vertices.push(new Ar(e[t]));return this.compute(),this}setFromObject(e){const t=[];return e.updateMatrixWorld(!0),e.traverse(function(i){const n=i.geometry;if(n!==void 0){if(n.isGeometry){console.error("THREE.ConvexHull no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else if(n.isBufferGeometry){const o=n.attributes.position;if(o!==void 0)for(let s=0,r=o.count;s<r;s++){const l=new X;l.fromBufferAttribute(o,s).applyMatrix4(i.matrixWorld),t.push(l)}}}}),this.setFromPoints(t)}containsPoint(e){const t=this.faces;for(let i=0,n=t.length;i<n;i++)if(t[i].distanceToPoint(e)>this.tolerance)return!1;return!0}intersectRay(e,t){const i=this.faces;let n=-1/0,o=1/0;for(let s=0,r=i.length;s<r;s++){const l=i[s],c=l.distanceToPoint(e.origin),u=l.normal.dot(e.direction);if(c>0&&u>=0)return null;const h=u!==0?-c/u:0;if(!(h<=0)&&(u>0?o=Math.min(h,o):n=Math.max(h,n),n>o))return null}return n!==-1/0?e.at(n,t):e.at(o,t),t}intersectsRay(e){return this.intersectRay(e,Cr)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,t){return e.face=t,t.outside===null?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}removeVertexFromFace(e,t){return e===t.outside&&(e.next!==null&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(e){if(e.outside!==null){const t=e.outside;let i=e.outside;for(;i.next!==null&&i.next.face===e;)i=i.next;return this.assigned.removeSubList(t,i),t.prev=i.next=null,e.outside=null,t}}deleteFaceVertices(e,t){const i=this.removeAllVerticesFromFace(e);if(i!==void 0)if(t===void 0)this.unassigned.appendChain(i);else{let n=i;do{const o=n.next;t.distanceToPoint(n.point)>this.tolerance?this.addVertexToFace(n,t):this.unassigned.append(n),n=o}while(n!==null)}return this}resolveUnassignedPoints(e){if(this.unassigned.isEmpty()===!1){let t=this.unassigned.first();do{const i=t.next;let n=this.tolerance,o=null;for(let s=0;s<e.length;s++){const r=e[s];if(r.mark===fi){const l=r.distanceToPoint(t.point);if(l>n&&(n=l,o=r),n>1e3*this.tolerance)break}}o!==null&&this.addVertexToFace(t,o),t=i}while(t!==null)}return this}computeExtremes(){const e=new X,t=new X,i=[],n=[];for(let o=0;o<3;o++)i[o]=n[o]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let o=0,s=this.vertices.length;o<s;o++){const r=this.vertices[o],l=r.point;for(let c=0;c<3;c++)l.getComponent(c)<e.getComponent(c)&&(e.setComponent(c,l.getComponent(c)),i[c]=r);for(let c=0;c<3;c++)l.getComponent(c)>t.getComponent(c)&&(t.setComponent(c,l.getComponent(c)),n[c]=r)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:i,max:n}}computeInitialHull(){const e=this.vertices,t=this.computeExtremes(),i=t.min,n=t.max;let o=0,s=0;for(let f=0;f<3;f++){const y=n[f].point.getComponent(f)-i[f].point.getComponent(f);y>o&&(o=y,s=f)}const r=i[s],l=n[s];let c,u;o=0,bs.set(r.point,l.point);for(let f=0,y=this.vertices.length;f<y;f++){const A=e[f];if(A!==r&&A!==l){bs.closestPointToPoint(A.point,!0,Ms);const P=Ms.distanceToSquared(A.point);P>o&&(o=P,c=A)}}o=-1,on.setFromCoplanarPoints(r.point,l.point,c.point);for(let f=0,y=this.vertices.length;f<y;f++){const A=e[f];if(A!==r&&A!==l&&A!==c){const P=Math.abs(on.distanceToPoint(A.point));P>o&&(o=P,u=A)}}const h=[];if(on.distanceToPoint(u.point)<0){h.push(Ue.create(r,l,c),Ue.create(u,l,r),Ue.create(u,c,l),Ue.create(u,r,c));for(let f=0;f<3;f++){const y=(f+1)%3;h[f+1].getEdge(2).setTwin(h[0].getEdge(y)),h[f+1].getEdge(1).setTwin(h[y+1].getEdge(0))}}else{h.push(Ue.create(r,c,l),Ue.create(u,r,l),Ue.create(u,l,c),Ue.create(u,c,r));for(let f=0;f<3;f++){const y=(f+1)%3;h[f+1].getEdge(2).setTwin(h[0].getEdge((3-f)%3)),h[f+1].getEdge(0).setTwin(h[y+1].getEdge(1))}}for(let f=0;f<4;f++)this.faces.push(h[f]);for(let f=0,y=e.length;f<y;f++){const A=e[f];if(A!==r&&A!==l&&A!==c&&A!==u){o=this.tolerance;let P=null;for(let b=0;b<4;b++){const E=this.faces[b].distanceToPoint(A.point);E>o&&(o=E,P=this.faces[b])}P!==null&&this.addVertexToFace(A,P)}}return this}reindexFaces(){const e=[];for(let t=0;t<this.faces.length;t++){const i=this.faces[t];i.mark===fi&&e.push(i)}return this.faces=e,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let e,t=0;const i=this.assigned.first().face;let n=i.outside;do{const o=i.distanceToPoint(n.point);o>t&&(t=o,e=n),n=n.next}while(n!==null&&n.face===i);return e}}computeHorizon(e,t,i,n){this.deleteFaceVertices(i),i.mark=Pr;let o;t===null?o=t=i.getEdge(0):o=t.next;do{const s=o.twin,r=s.face;r.mark===fi&&(r.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,s,r,n):n.push(o)),o=o.next}while(o!==t);return this}addAdjoiningFace(e,t){const i=Ue.create(e,t.tail(),t.head());return this.faces.push(i),i.getEdge(-1).setTwin(t.twin),i.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let i=null,n=null;for(let o=0;o<t.length;o++){const s=t[o],r=this.addAdjoiningFace(e,s);i===null?i=r:r.next.setTwin(n),this.newFaces.push(r.face),n=r}return i.next.setTwin(n),this}addVertexToHull(e){const t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let e;for(this.computeInitialHull();(e=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}class Ue{constructor(){this.normal=new X,this.midpoint=new X,this.area=0,this.constant=0,this.outside=null,this.mark=fi,this.edge=null}static create(e,t,i){const n=new Ue,o=new an(e,n),s=new an(t,n),r=new an(i,n);return o.next=r.prev=s,s.next=o.prev=r,r.next=s.prev=o,n.edge=o,n.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){const e=this.edge.tail(),t=this.edge.head(),i=this.edge.next.head();return mi.set(e.point,t.point,i.point),mi.getNormal(this.normal),mi.getMidpoint(this.midpoint),this.area=mi.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}class an{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceTo(e.point):-1}lengthSquared(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}}class Ar{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}}class Es{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,t.prev===null?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,t.next===null?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail;e.next!==null;)e=e.next;return this.tail=e,this}remove(e){return e.prev===null?this.head=e.next:e.prev.next=e.next,e.next===null?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return e.prev===null?this.head=t.next:e.prev.next=t.next,t.next===null?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return this.head===null}}class Lr extends je{constructor(e){super();const t=[],i=[];vs===void 0&&console.error("THREE.ConvexBufferGeometry: ConvexBufferGeometry relies on ConvexHull");const o=new vs().setFromPoints(e).faces;for(let s=0;s<o.length;s++){const r=o[s];let l=r.edge;do{const c=l.head().point;t.push(c.x,c.y,c.z),i.push(r.normal.x,r.normal.y,r.normal.z),l=l.next}while(l!==r.edge)}this.setAttribute("position",new Le(t,3)),this.setAttribute("normal",new Le(i,3))}}function gi(a){const{width:e,height:t,length:i,radius:n,radiusTop:o,radiusBottom:s,sides:r,offset:l}=a;let c,u;switch(a.shape){case Ce.box:c=Rr(e,t,i),u=zr(e,t,i);break;case Ce.cylinder:c=kr(o,s,t,r),u=Ir(o,s,t,r);break;case Ce.sphere:c=Fr(n),u=Or(n);break;case Ce.tetrahedron:c=Nr(e,t,i),u=Ss(c);break;case Ce.triangularPrism:c=Br(e,t,i,l),u=Ss(c);break;default:return[]}return[c,u]}function zr(a=2,e=2,t=2){return new ge(a,e,t)}function Rr(a=2,e=2,t=2){return new Ri(new he(a/2,e/2,t/2))}function Ir(a=1,e=1,t=2,i=6){return new Me(a,e,t,Math.max(3,i))}function kr(a=1,e=1,t=2,i=6){return new bn(a,e,t,Math.max(3,i))}function Or(a=1){return new ti(a)}function Fr(a=1){return new ro(a)}function Ss(a){return new Lr(a.vertices.map(({x:e,y:t,z:i})=>new X(e,t,i)))}function Nr(a=1,e=1,t=1){const i=[new he(0,0,0),new he(a*2,0,0),new he(0,e*2,0),new he(0,0,t*2)],n=[[0,2,1],[1,2,3],[0,1,3],[3,2,0]];return new wn({vertices:i,faces:n})}function Br(a=2,e=2,t=2,i=0){const n=a/2,o=e/2,s=t/2,r=[new he(n,o,i),new he(n,-o,-s),new he(n,-o,s),new he(-n,o,i),new he(-n,-o,-s),new he(-n,-o,s)],l=[[2,1,0],[4,5,3],[4,1,2,5],[3,0,1,4],[5,2,0,3]],c=Hr(r,l);return new wn({vertices:r,faces:l,normals:c})}const Ts=new he,Dr=new he,Et=new he;new X;new ze;new X(0,0,1);function Hr(a,e){return Ur(a),e.map(t=>{const i=a[t[0]],n=Ts.copy(a[t[1]]),o=Dr.copy(a[t[2]]);n.vsub(i,n),o.vsub(i,o);const s=new he().copy(n);s.cross(o,s).normalize();const r=Ts.copy(i);return i.vsub(Et,r),s.dot(r)<0&&s.negate(),s})}function Ur(a){const{length:e}=a;Et.set(0,0,0);for(let t=0;t<e;t++)Et.vadd(a[t],Et);Et.scale(1/e,Et)}const jr={segmentCount:13,segmentWidth:4,segmentHeight:.1,segmentLength:4,segmentPositionOffset:.4,radius:8},Gr={segmentCount:2,segmentWidth:2,segmentHeight:.4,segmentLength:4,angle:30},Vr={segmentCount:10,segmentWidth:4,segmentHeight:.1,segmentLength:2,angle:30,radius:8},Wr=["loop","slopeTransition","cantedCurve"],Ps=new X,tt=new X,Kr=new X,Cs=new X,oe=new xt;function As(a){switch(a.shape){case Ce.loop:return Xr(a);case Ce.slopeTransition:return qr(a);case Ce.cantedCurve:return Yr(a);default:return[]}}function Xr(a){const{segmentCount:e,segmentWidth:t,segmentHeight:i,segmentLength:n,segmentPositionOffset:o,radius:s}=rn(a,jr),r=[],l=Math.atan(s/(n/2)),c=Math.PI-2*l,u=Ps.set(1,0,0);for(let h=0;h<e;h++)tt.set(o*h,-s,0).applyAxisAngle(u,c*h),r.push({shape:Ce.box,width:t,height:i,length:n,position_x:tt.x,position_y:tt.y,position_z:tt.z,rotation_x:Be(c*h)});return r}function Yr(a){const{segmentCount:e,segmentWidth:t,segmentHeight:i,segmentLength:n,angle:o,radius:s}=rn(a,Vr),r=[],l=Ps;l.set(0,1,0);const c=ve(o),u=t/2,h=u*Math.cos(c),f=Math.sqrt(u**2-h**2),y=n/2,A=Math.atan((s-h)/y),P=Math.PI-2*A,b=Math.sqrt(n**2+t**2),E=Kr.set(y,f,-s+-h),v=Cs.copy(E).applyAxisAngle(l,P).sub(E).length(),T=(t+b+v)/2,S=Math.sqrt(T*(T-t)*(T-b)*(T-v)),H=2*S/t,U=t/2-(t-Math.sqrt(b**2-H**2)),C=U*Math.cos(c),z=Math.sqrt(U**2-C**2),V=Cs.set(y+H,z,-s+-C);V.applyAxisAngle(l,P);const W=V.sub(E).length(),R=Math.acos((H**2+H**2-W**2)/(2*H*H)),L=H/2*Math.sin(R);for(let B=0;B<e+1;B++)l.set(0,1,0),tt.set(0,0,-s).applyAxisAngle(l,P*B),oe.position.copy(tt),oe.rotation.set(0,P*B,Math.PI/2),oe.rotateOnAxis(l,-c),oe.translateZ(i/2),B<e&&r.push({shape:Ce.triangularPrism,width:i,height:n,length:t,offset:t/2,position_x:oe.position.x,position_y:oe.position.y,position_z:oe.position.z,rotation_x:Be(oe.rotation.x),rotation_y:Be(oe.rotation.y),rotation_z:Be(oe.rotation.z)}),B&&(l.set(1,0,0),oe.rotateOnAxis(l,Math.PI),oe.translateY(n/2+H/2),l.set(0,0,1),oe.rotateOnAxis(l,-R),oe.translateX(L),oe.translateY(0),r.push({shape:Ce.triangularPrism,width:i,height:H,length:t,offset:U,position_x:oe.position.x,position_y:oe.position.y,position_z:oe.position.z,rotation_x:Be(oe.rotation.x),rotation_y:Be(oe.rotation.y),rotation_z:Be(oe.rotation.z)}));return r}function qr(a){const{segmentCount:e,segmentWidth:t,segmentHeight:i,segmentLength:n}=rn(a,Gr),o=[],s=.1,r=Math.atan(i/t);oe.position.set(0,s,0),oe.rotation.set(0,0,0);for(let l=0;l<e;l++)l&&(oe.translateY(i),oe.translateZ(-n)),oe.rotation.set(0,0,-r*l),o.push({shape:Ce.tetrahedron,width:t/2,height:i/2,length:n/2,position_x:oe.position.x,position_y:oe.position.y,position_z:oe.position.z,rotation_z:Be(oe.rotation.z)}),tt.copy(oe.position),oe.translateX(t/2),oe.translateY(-s/2),oe.translateZ(n/2),o.push({shape:Ce.box,width:t,height:s,length:n,position_x:oe.position.x,position_y:oe.position.y,position_z:oe.position.z,rotation_z:Be(oe.rotation.z)}),oe.position.copy(tt);return o}function rn(a,e){return Ne(Ne({},e),a)}var Pe;(function(a){a.mapElementChange="mapElementChange",a.mapElementSelect="mapElementSelect",a.editModeChange="editModeChange"})(Pe||(Pe={}));var Ze;(function(a){a.checkpoint="checkpoint",a.finish="finish",a.reset="reset",a.setCameraMode="setCameraMode",a.setCameraPosition="setCameraPosition",a.startAnimation="startAnimation"})(Ze||(Ze={}));var Ee;(function(a){a.default="default",a.compound="compound",a.animated="animated",a.trigger="trigger",a.vehicle="vehicle"})(Ee||(Ee={}));var Ce;(function(a){a.box="box",a.cylinder="cylinder",a.sphere="sphere",a.tetrahedron="tetrahedron",a.triangularPrism="triangularPrism",a.loop="loop",a.slopeTransition="slopeTransition",a.cantedCurve="cantedCurve"})(Ce||(Ce={}));const St="vehicle_0",ln=12303291,Ls=9814245,zs=10463419,Rs=13464275,yi=new Dn;let Is,ks,Os=0;Qi.addColorValues(ln,Ls,zs);class Zr{constructor(e,t){O(this,"scene");O(this,"world");O(this,"selectedMapElementId");O(this,"perviousSelectedMapElementId");O(this,"mapElementComponentStore",new Map);O(this,"mapElementIdStore",new Set);O(this,"listeners",new Ht);O(this,"eventTriggerListeners",new Ht);O(this,"editMode",!1);O(this,"onPlaceVehicle",qe);O(this,"destroy",e=>{if(e===St)return;const t=this.getBodyFromStore(e),i=this.getMeshFromStore(e),{type:n}=this.getPropsFromStore(e);if(this.scene.remove(i),this.world.removeBody(t),this.world.removeEventListener("postStep",this.getUpdateMethodFromStore(e)),hn(i)?i.children.forEach(Fs):Fs(i),n===Ee.trigger){const o=this.mapElementComponentStore.get(`${e}_listener`);t.removeEventListener(Qe.COLLIDE_EVENT_NAME,o),this.mapElementComponentStore.delete(`${e}_listener`)}this.mapElementIdStore.delete(e),this.mapElementComponentStore.delete(`${e}_mesh`),this.mapElementComponentStore.delete(`${e}_body`),this.mapElementComponentStore.delete(`${e}_updateMethod`),this.mapElementComponentStore.delete(`${e}_props`),this.selectedMapElementId===e&&(this.selectedMapElementId=void 0,this.listeners.dispatch(Pe.mapElementSelect,this.selectedMapElementId)),this.perviousSelectedMapElementId===e&&(this.perviousSelectedMapElementId=void 0)});O(this,"selectMapElement",e=>{this.selectedMapElementId&&(this.perviousSelectedMapElementId=this.selectedMapElementId),this.selectedMapElementId=e,this.listeners.dispatch(Pe.mapElementSelect,this.selectedMapElementId)});O(this,"resetElementIfDynamic",e=>{const{type:t,mass:i,position_x:n=0,position_y:o=0,position_z:s=0,rotation_x:r=0,rotation_y:l=0,rotation_z:c=0}=this.getPropsFromStore(e);if(t===Ee.vehicle){this.onPlaceVehicle(n,o,s,r,l,c);return}if(!i&&t!==Ee.animated)return;const u=this.getBodyFromStore(e);if(t===Ee.animated){const{triggerStart:h,velocity_x:f,velocity_y:y,velocity_z:A}=this.getAnimationPropsFromStore(e);h?u.velocity.setZero():u.velocity.set(f,y,A)}else u.velocity.setZero(),u.angularVelocity.setZero();u.position.set(n,o,s),u.quaternion.setFromEuler(ve(r),ve(l),ve(c))});O(this,"importMap",e=>{this.mapElementIdStore.forEach(this.destroy),Os=0,e.forEach(t=>{t.type===Ee.vehicle?this.placeVehicle(t):this.build(t)})});O(this,"exportMap",()=>Array.from(this.mapElementComponentStore.entries()).filter(([e])=>e.endsWith("props")).map(([,e])=>e));this.scene=e,this.world=t,ks=t.materials.find(i=>i.name==="general"),Is=t.materials.find(i=>i.name==="lowFriction"),vr(this)}get mapElementIdList(){return Array.from(this.mapElementIdStore)}getBodyFromStore(e){return this.mapElementComponentStore.get(`${e}_body`)}getMeshFromStore(e){return this.mapElementComponentStore.get(`${e}_mesh`)}getPropsFromStore(e){return this.mapElementComponentStore.get(`${e}_props`)}getUpdateMethodFromStore(e){return this.mapElementComponentStore.get(`${e}_updateMethod`)}getAnimationPropsFromStore(e){return this.mapElementComponentStore.get(`${e}_animationProps`)}addToWorld(e,t,i){const n=`${i.type||i.shape}_${Os++}`,{type:o,mass:s=0,position_x:r=0,position_y:l=0,position_z:c=0,rotation_x:u=0,rotation_y:h=0,rotation_z:f=0,fixedRotation:y=!1}=i,A=()=>{t.position.copy(e.position),t.quaternion.copy(e.quaternion)};if(e.position.set(r,l,c),t.position.copy(e.position),t.name=n,(u||h||f)&&(e.quaternion.setFromEuler(ve(u),ve(h),ve(f)),t.quaternion.copy(e.quaternion)),y&&(e.fixedRotation=!0,e.updateMassProperties()),de.renderShadows&&(t.castShadow=!0,t.receiveShadow=!0),this.world.addBody(e),this.scene.add(t),o===Ee.animated){const P=Tr(e,i.dataSet);e.type=Lt.KINEMATIC,e.preStep=P.movementHandler,P.triggerStart||e.velocity.set(P.velocity_x,P.velocity_y,P.velocity_z),this.mapElementComponentStore.set(`${n}_animationProps`,P)}return(s||o===Ee.animated)&&this.world.addEventListener("postStep",A),e.aabbNeedsUpdate=!0,this.mapElementIdStore.add(n),this.mapElementComponentStore.set(`${n}_mesh`,t),this.mapElementComponentStore.set(`${n}_body`,e),this.mapElementComponentStore.set(`${n}_props`,i),this.mapElementComponentStore.set(`${n}_updateMethod`,A),this.editMode&&this.selectMapElement(n),n}toggleEditMode(){this.editMode=!this.editMode,this.editMode?this.mapElementIdList.forEach(e=>{this.setEventTriggerVisibility(e,!0)}):this.mapElementIdList.forEach(e=>{this.setEventTriggerVisibility(e,!1)}),this.listeners.dispatch(Pe.editModeChange,this.editMode)}clone(e){return this.build(Ne({},this.getPropsFromStore(e)))}build(e){const t=new Hn({color:Qr(e)}),i=e.lowFriction?Is:ks,n=new Qe({mass:e.mass,material:i});let o;if(Wr.includes(e.shape)&&!e.type&&(e.type=Ee.compound),e.type===Ee.compound)o=new Ot,As(e).forEach(r=>{const[l,c]=gi(r),u=new G(c,t);yi.set(ve(r.rotation_x||0),ve(r.rotation_y||0),ve(r.rotation_z||0)),u.quaternion.setFromEuler(yi),u.position.set(r.position_x,r.position_y,r.position_z),o.add(u),n.addShape(l,u.position,u.quaternion)});else{const[r,l]=gi(e);n.addShape(r),o=new G(l,t)}const s=this.addToWorld(n,o,e);return e.type===Ee.trigger&&this.setUpEventTrigger(s,e),s}setUpEventTrigger(e,t){const{event:i=Ze.setCameraPosition,dataSet:n="0,0,0"}=t,o=this.getBodyFromStore(e),s=this.getMeshFromStore(e),r=this.mapElementComponentStore.get(`${e}_listener`),l=({target:c,body:u})=>{this.eventTriggerListeners.dispatch(i,{target:c,dataSet:n,relatedTarget:u})};r&&o.removeEventListener(Qe.COLLIDE_EVENT_NAME,r),this.mapElementComponentStore.set(`${e}_listener`,l),o.collisionResponse=!1,o.addEventListener(Qe.COLLIDE_EVENT_NAME,l),cn(s,Rs,.3),this.editMode||(s.visible=!1)}convertEventTriggerToDefaultElement(e){const t=this.getBodyFromStore(e),i=this.getMeshFromStore(e),n=this.mapElementComponentStore.get(`${e}_listener`);t.removeEventListener(Qe.COLLIDE_EVENT_NAME,n),this.mapElementComponentStore.delete(`${e}_listener`),t.collisionResponse=!0,cn(i,ln,1)}placeVehicle(e){const{position_x:t,position_y:i,position_z:n,rotation_x:o,rotation_y:s,rotation_z:r}=e;this.mapElementIdStore.add(St),this.mapElementComponentStore.set(`${St}_props`,Ne({},e)),this.mapElementComponentStore.set(`${St}_updateMethod`,()=>{const{position_x:l,position_y:c,position_z:u,rotation_x:h,rotation_y:f,rotation_z:y}=this.getPropsFromStore(St);this.onPlaceVehicle(l,c,u,h,f,y)}),this.onPlaceVehicle(t,i,n,o,s,r)}setEventTriggerVisibility(e,t=!1){if(e.startsWith("trigger")){const i=this.getMeshFromStore(e);i.visible=t}}resetDynamicMapElements(){this.mapElementIdList.forEach(this.resetElementIfDynamic)}translate(e,t){const i=this.getBodyFromStore(e),n=this.getPropsFromStore(e),o=this.getUpdateMethodFromStore(e);if(Object.assign(n,Ne({},t)),i){const{position_x:s=0,position_y:r=0,position_z:l=0,rotation_x:c=0,rotation_y:u=0,rotation_z:h=0}=n;i.position.set(s,r,l),i.quaternion.setFromEuler(ve(c),ve(u),ve(h)),i.aabbNeedsUpdate=!0}o(),this.listeners.dispatch(Pe.mapElementChange,Ne({},n))}transform(e,t){const i=this.getMeshFromStore(e),n=this.getBodyFromStore(e),o=this.getPropsFromStore(e);if(Object.assign(o,Ne({},t)),n.shapes.length=0,n.shapeOffsets.length=0,n.shapeOrientations.length=0,hn(i)){const s=As(o),r=s.length,l=Math.max(0,i.children.length-r);for(let c=0;c<l;c++){const u=i.children.length-1,h=i.children[u];h.geometry.dispose(),i.remove(h)}for(let c=0;c<r;c++){const u=s[c],[h,f]=gi(u);let y=i.children[c];y?y.geometry.dispose():(y=new G,y.material=i.children[0].material,i.add(y)),yi.set(ve(u.rotation_x||0),ve(u.rotation_y||0),ve(u.rotation_z||0)),y.quaternion.setFromEuler(yi),y.position.set(u.position_x,u.position_y,u.position_z),y.geometry=f,n.addShape(h,y.position,y.quaternion)}}else{const[s,r]=gi(o);n.addShape(s),i.geometry.dispose(),i.geometry=r}this.listeners.dispatch(Pe.mapElementChange,Ne({},o))}setAttribute(e,t){const i=this.getPropsFromStore(e),n=this.getBodyFromStore(e),o=i.type;if(Object.assign(i,Ne({},t)),"color"in t&&cn(this.getMeshFromStore(e),t.color),o===Ee.trigger&&t.type===Ee.default?this.convertEventTriggerToDefaultElement(e):("type"in t||"event"in t||"dataSet"in t)&&(this.setUpEventTrigger(e,i),i.mass&&(t.mass=0)),"mass"in t){const s=this.getUpdateMethodFromStore(e);n.mass=t.mass,n.updateMassProperties(),n.velocity.set(0,0,0),n.angularVelocity.set(0,0,0),t.mass>0&&n.type===Lt.STATIC?(n.type=Lt.DYNAMIC,this.world.addEventListener("postStep",s)):!t.mass&&n.type===Lt.DYNAMIC&&(n.type=Lt.STATIC,this.world.removeEventListener("postStep",s))}this.listeners.dispatch(Pe.mapElementChange,Ne({},i))}}function Fs(a){a.geometry.dispose(),a.material.dispose()}function cn(a,e,t){const i=hn(a)?a.children[0].material:a.material;e&&i.color.set(e),t&&(i.transparent=t<1,i.opacity=t)}function Qr(a){return a.type===Ee.trigger?Rs:a.type===Ee.animated?zs:a.color?a.color:a.mass?Ls:ln}function hn(a){return!!a.children.length}const $r=/checkpointCount:\w*(\d+)/i,Jr=Math.PI*2,el=.02;let Ns=0,Bs=0;class tl{constructor(e,t){O(this,"activeCheckpoints",new Set);O(this,"checkpointIconToElementLinks",new Map);O(this,"checkpointIcon3dPool");O(this,"finishIcon3d");O(this,"gameProgress");O(this,"scene");O(this,"checkpointEventHandler",({target:e,relatedTarget:t})=>{if(t===this.gameProgress.vehicle.chassisBody&&this.activeCheckpoints.has(e)){this.gameProgress.checkpointReached(e);const i=this.checkpointIconToElementLinks.get(e);this.checkpointIcon3dPool.release(i),this.activeCheckpoints.delete(e)}});O(this,"finishEventHandler",({target:e,relatedTarget:t,dataSet:i})=>{t===this.gameProgress.vehicle.chassisBody&&nl(i)===this.gameProgress.checkpointsReached&&(this.gameProgress.stop(),this.gameProgress.openModal())});this.scene=e,this.finishIcon3d=t.finish,this.checkpointIcon3dPool=new qn(1,{itemProvider(){return t.checkpoint.clone()},itemActiveCheck(i){return i.visible},itemActivator(i){i.visible=!0},itemDeactivator(i){i.visible=!1}}),this.scene.add(this.finishIcon3d)}init(e,t){this.gameProgress=t,e.eventTriggerListeners.add(Ze.checkpoint,this.checkpointEventHandler),e.eventTriggerListeners.add(Ze.finish,this.finishEventHandler),this.checkpointIcon3dPool.activeCount&&this.checkpointIcon3dPool.releaseAll(),this.activeCheckpoints.size&&this.activeCheckpoints.clear(),e.mapElementIdList.forEach(i=>{if(i.startsWith("trigger")){const{event:n}=e.getPropsFromStore(i);n==="checkpoint"?this.setActiveCheckpoint(e.getBodyFromStore(i)):n==="finish"&&this.setFinish(e.getBodyFromStore(i))}})}setActiveCheckpoint(e){const t=this.checkpointIcon3dPool.obtain();t.position.copy(e.position),this.activeCheckpoints.add(e),this.checkpointIconToElementLinks.set(e,t),this.scene.add(t)}setFinish(e){this.finishIcon3d.position.copy(e.position)}updateVisuals(e){Ns=Math.sin(e/1e3)/500,Bs=.5*Math.sin(e/500)*.005,this.checkpointIcon3dPool.forActive(Ds),Ds(this.finishIcon3d)}}function il(){const a=new G(new ge(.8,.8,.8),new Ft({color:0,specular:6710886,emissive:43520,shininess:10,transparent:!0,opacity:.6}));return a.rotation.set(Math.PI/4,0,Math.PI/4),a}function Ds(a){const e=a.rotation.y+el;a.rotation.y=e>=Jr?0:e,a.position.y+=Ns,a.material&&a.material.emissive.offsetHSL(0,0,Bs)}function nl(a){const[,e]=a.match($r)||[];return e?Number(e):0}class sl{constructor(){O(this,"started",!1);O(this,"stopped",!1);O(this,"startTime",0);O(this,"stopTime",0);O(this,"relativeStopTime",0)}get time(){return this.stopped?this.relativeStopTime:performance.now()-this.startTime}start(){this.started=!0,this.stopped?this.startTime+=performance.now()-this.stopTime:this.startTime=performance.now(),this.stopped=!1}stop(){this.relativeStopTime=this.time,this.stopTime=performance.now(),this.stopped=!0}reset(){this.started=!1,this.stopped=!1,this.startTime=0}}var ol=[{type:"vehicle",position_y:1},{shape:"box",width:5,length:5,height:.2,position_y:-.1},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_x:3,position_y:1}],al=[{type:"vehicle",position_x:10,position_y:1,position_z:10,rotation_y:90},{shape:"box",width:30,height:.2,length:34,position_x:6,position_z:2},{shape:"triangularPrism",position_x:-3,position_y:1.1,position_z:-3,rotation_x:0,rotation_y:0,rotation_z:0,length:4,width:4,offset:-2},{shape:"triangularPrism",position_x:-3,position_y:4.1,position_z:-7,rotation_x:0,rotation_y:0,rotation_z:0,length:4,width:4,offset:-2,height:4},{shape:"box",width:4,height:.2,length:6,position_x:-3,position_y:10,position_z:-18},{shape:"box",width:4,height:.2,length:30,position_x:-3,position_y:5,position_z:-25,rotation_x:15},{shape:"box",width:4,height:5.4,length:2,position_x:-7,position_y:2.6,position_z:-9},{shape:"box",width:4,height:11.8,length:2,position_x:1,position_y:5.9,position_z:-9},{shape:"box",mass:40,position_x:11,position_y:3,position_z:-6,width:4,height:4,length:4},{shape:"cylinder",sides:4,radiusBottom:13,height:1,position_x:9,position_y:.6,position_z:-4,rotation_y:45,radiusTop:10},{shape:"cylinder",radiusTop:2,radiusBottom:2,height:4,mass:20,sides:20,position_x:-3,position_y:15,position_z:-27,rotation_z:90},{shape:"box",width:.2,height:1,length:10,position_x:-5.1,position_y:11.3,position_z:-33,lowFriction:!0},{shape:"box",width:.2,height:1,length:14,position_x:-.9,position_y:11.3,position_z:-31,lowFriction:!0},{shape:"box",width:.2,height:1,length:30,position_x:-.9,position_y:5.5,position_z:-25,rotation_x:15,lowFriction:!0},{shape:"box",width:.2,height:1,length:30,position_x:-5.1,position_y:5.5,position_z:-25,rotation_x:15,lowFriction:!0},{shape:"box",width:8.2,height:.2,length:4,position_x:-8.92,position_y:9.65,position_z:-26,rotation_z:14.8},{shape:"box",width:4,height:.2,length:2.4,position_x:-7,position_y:5.2,position_z:-11.2},{shape:"triangularPrism",position_x:-7,position_y:8.6,position_z:-9,rotation_x:-90,rotation_y:-90,rotation_z:0,length:4,width:6.6,offset:-2,height:2},{shape:"box",width:4,height:.2,length:4.4,position_x:-10.95,position_y:5.55,position_z:-10.2,rotation_z:-10},{shape:"box",width:4,height:.2,length:4,position_x:-14.9,position_y:5.9,position_z:-10},{shape:"box",width:4,height:.2,length:12.4,position_x:-14.9,position_y:7.25,position_z:-17.98,rotation_x:12.55},{shape:"box",width:4.1,height:.2,length:4,position_x:-14.85,position_y:8.6,position_z:-26},{shape:"box",width:4,height:.2,length:2.4,position_x:1,position_y:5.2,position_z:-11.2},{shape:"box",width:4,height:.2,length:3.3,position_x:-3,position_y:10.35,position_z:-22.33,rotation_x:12.5},{shape:"box",width:4,height:.2,length:5,position_x:-3,position_y:10.7,position_z:-26.4},{shape:"box",width:.2,height:2,length:14,position_x:-.9,position_y:10.8,position_z:-17},{shape:"box",width:4,height:.2,length:4.4,position_x:5,position_y:5.2,position_z:-10.2},{shape:"box",width:4,height:4,length:3.8,position_x:5,position_y:3.1,position_z:-1.9},{shape:"box",width:4,height:.2,length:.2,position_x:9,position_z:-3.9,position_y:1.2,lowFriction:!0},{shape:"box",width:4,height:4,length:.2,position_x:5,position_z:-3.9,position_y:3.1,lowFriction:!0},{shape:"box",width:8,height:.2,length:.2,position_x:7,position_z:-8.1,position_y:1.2,lowFriction:!0},{shape:"box",width:.2,height:.2,length:4,position_x:2.9,position_z:-6,position_y:1.2},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"34,11,4.5",radius:7,position_x:14,position_y:1},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-3,9,29",radius:7,position_x:-2,position_y:1,position_z:8},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-30,16,-3",radius:3,position_x:-3,position_y:12,position_z:-21},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-30,22,-29",radius:3,position_x:-15,position_y:9,position_z:-22,rotation_x:0,rotation_y:0,rotation_z:0},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-27,14,-13",radius:2,position_x:-9,position_y:6,position_z:-10},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"9.5,10,-25",radius:2,position_x:1,position_y:6,position_z:-11},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"25,11,25",radius:3,position_x:10,position_y:1,position_z:10},{type:"trigger",shape:"sphere",event:"checkpoint",dataSet:"-30,22,-29",radius:1,position_x:-15,position_y:9.7,position_z:-26.19,rotation_x:0,rotation_y:180,rotation_z:0},{type:"trigger",shape:"sphere",event:"finish",dataSet:"checkpointCount:1",radius:1,position_x:5,position_y:6,position_z:-2}],rl=[{type:"vehicle",position_x:10,position_y:1,position_z:10,rotation_y:90},{shape:"box",width:12,height:.2,length:10,position_x:8,position_z:10},{shape:"triangularPrism",width:4,length:4,offset:-2,position_x:8,position_y:1,position_z:7},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"39,13,-6",radius:3,position_x:13,position_y:1,position_z:10},{type:"animated",shape:"box",width:6,height:.2,length:6,position_x:-1,position_z:10,dataSet:'{ "movement": { "y": -17 }, "alternateDelay": 3, "triggerStart": true }'},{shape:"box",width:1,height:18,length:.2,position_x:-3,position_y:-8.1,position_z:6.9},{shape:"box",width:1,height:18,length:.2,position_x:1,position_y:-8.1,position_z:6.9},{shape:"box",width:1,height:18,length:.2,position_x:1,position_y:-8.1,position_z:13.1},{shape:"box",width:1,height:18,length:.2,position_x:-3,position_y:-8.1,position_z:13.1},{shape:"box",width:.2,height:18,length:.6,position_x:-4.1,position_y:-8.1,position_z:12},{shape:"box",width:.2,height:18,length:.6,position_x:-4.1,position_y:-8.1,position_z:8},{shape:"box",width:12,height:.2,length:10,position_x:8,position_z:10,position_y:-17},{shape:"box",width:.2,height:14,length:6,position_x:2.1,position_y:-7.1,position_z:10,color:"#c4c4c4"},{shape:"box",width:12,height:.2,length:10,position_x:8,position_z:21},{shape:"box",width:4,height:10,length:.6,position_x:8,position_z:15.5,position_y:-1,mass:40,lowFriction:!0,fixedRotation:!0},{shape:"box",width:4,height:14,length:1,position_x:4,position_z:15.5,position_y:-3},{shape:"box",width:4,height:14,length:1,position_x:12,position_z:15.5,position_y:-3},{shape:"box",width:1,height:1,length:2,position_x:8,position_z:15.5,position_y:-6.5,mass:10,lowFriction:!0,fixedRotation:!0},{shape:"box",width:2,height:1,length:3,position_x:8,position_z:13.5,position_y:-7.5},{shape:"box",width:2,height:1,length:2,position_x:8,position_z:17,position_y:-7.5},{shape:"box",width:2,height:1,length:2,position_x:8,position_z:17,position_y:-5.5},{shape:"box",width:.5,height:1,length:2,position_x:7.25,position_z:17,position_y:-6.5},{shape:"box",width:.5,height:1,length:2,position_x:8.75,position_z:17,position_y:-6.5},{shape:"box",width:10,height:.2,length:8,position_x:9,position_z:9,position_y:-8},{shape:"box",width:4,height:6,length:.2,position_x:8,position_z:15.1,position_y:-3},{shape:"box",width:4,height:6,length:.2,position_x:8,position_z:15.9,position_y:-3},{shape:"box",width:.5,height:1,length:3,position_x:8.75,position_z:13.5,position_y:-6.5},{shape:"box",width:.5,height:1,length:3,position_x:7.25,position_z:13.5,position_y:-6.5},{shape:"box",width:5,height:2,length:1,position_x:4.5,position_z:15.5,position_y:-11},{shape:"box",width:5,height:2,length:1,position_x:11.5,position_z:15.5,position_y:-11},{shape:"box",width:12,height:5,length:1,position_x:8,position_z:15.5,position_y:-14.5},{shape:"sphere",radius:.5,position_x:8,position_z:14,position_y:-6.5,mass:1},{shape:"box",width:2,height:1,length:3,position_x:8,position_y:-5.5,position_z:13.5},{shape:"box",width:1,height:1,length:3,position_x:8,position_z:11.75,position_y:-6.5,mass:10,fixedRotation:!0},{shape:"box",width:4,height:.2,length:4,position_x:16,position_z:7,position_y:-17},{shape:"box",width:8,height:.2,length:4,position_x:18,position_z:7,position_y:-8},{shape:"box",width:4,height:.2,length:26,position_x:20,position_z:21.75,position_y:-10.25,rotation_x:10},{shape:"box",width:4,height:.2,length:26,position_x:16,position_z:21.6,position_y:-14.75,rotation_x:-10},{shape:"box",width:8,height:.2,length:4,position_x:18,position_z:36.35,position_y:-12.5},{shape:"box",width:4,height:.2,length:26,position_x:16,position_z:21.6,position_y:-5.76,rotation_x:-10},{shape:"box",width:4,height:.2,length:4,position_x:16,position_z:36.35,position_y:-3.5},{shape:"box",width:2,height:3,length:1,position_x:8,position_y:-6.5,position_z:18.5},{shape:"box",width:4,height:.2,length:4,position_x:4,position_z:36.35,position_y:-2},{shape:"box",width:4,height:.2,length:8.8,position_x:4,position_z:30.2,position_y:-1,rotation_x:13.4},{shape:"box",width:8.2,height:.2,length:4,position_x:10,position_z:36.35,position_y:-2.75,rotation_z:-10.5},{shape:"box",width:.2,height:4,length:.2,position_x:6.1,position_z:15.1,position_y:2},{shape:"box",width:.2,height:4,length:.2,position_x:9.9,position_z:15.1,position_y:2},{shape:"box",width:.2,height:4,length:.2,position_x:9.9,position_z:15.9,position_y:2},{shape:"box",width:.2,height:4,length:.2,position_x:6.1,position_z:15.9,position_y:2},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-13,4,1",radius:3,position_x:-1,position_y:1,position_z:10},{shape:"box",width:4,height:.2,length:12,position_x:8,position_z:-17,position_y:2},{type:"trigger",shape:"sphere",event:"finish",dataSet:"checkpointCount:1",position_x:8,position_y:3,position_z:-21},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-21,-9,8",radius:3,position_x:-1,position_y:-9,position_z:10},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"19,-10,-11",radius:3,position_x:6,position_y:-16,position_z:10},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"30,-3,52",radius:3,position_x:16,position_y:-13,position_z:23},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"43,2,0",radius:3,position_x:16,position_y:-14,position_z:17},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"32,8,-11",radius:3,position_x:20,position_y:-9,position_z:20},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"27,7,43",radius:3,position_x:16,position_y:-4,position_z:26},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"8,12,52",radius:3,position_x:9,position_y:-2,position_z:36},{shape:"box",width:.2,height:.4,length:1.9,position_y:1.1,position_z:11.35,position_x:-4.1},{shape:"box",width:.8,height:.2,length:.8,position_y:1.4,position_z:10,position_x:-4.4},{shape:"box",width:.6,height:.4,length:.2,position_y:1.1,position_z:10.3,position_x:-4.3},{shape:"box",width:.6,height:.4,length:.2,position_y:1.1,position_z:9.7,position_x:-4.3},{shape:"box",width:.8,height:.2,length:.8,position_y:.8,position_z:10,position_x:-4.4},{shape:"box",width:.2,height:.4,length:.8,position_y:1.1,position_z:10,position_x:-4.7},{shape:"box",width:.6,height:.4,length:.4,position_y:1.1,position_z:10,position_x:-4.1,mass:10},{shape:"box",width:.2,height:.4,length:.4,position_y:1.1,position_z:10,position_x:-3.9,type:"trigger",event:"startAnimation",dataSet:"animated_3"},{type:"trigger",shape:"sphere",event:"checkpoint",position_x:10.75,position_y:-7,position_z:7.5,rotation_y:-90},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"32,8,-11",radius:3,position_x:14.09,position_y:-7,position_z:10.04},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"38,15,11",radius:3,position_x:8,position_y:3,position_z:1}],ll=[{type:"vehicle",position_y:1,rotation_y:-1},{shape:"box",width:3*2,height:.1*2,length:20.01*2,position_z:-.02,position_y:.07},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-6,10,26",radius:3,position_y:1},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_x:-31.5,position_y:17.5,position_z:-13.5},{shape:"slopeTransition",type:"compound",segmentWidth:6,position_y:0,position_z:-20.6,position_x:-3,segmentCount:43,segmentHeight:.22,segmentLength:.6,rotation_x:-6},{shape:"loop",type:"compound",segmentCount:23,segmentWidth:12,segmentHeight:.2,radius:10,segmentPositionOffset:-1.19,position_x:11.85,position_z:-41.48,position_y:.5,rotation_y:-30,rotation_z:-90},{shape:"box",height:6*2,length:15*2,width:.1*2,position_y:26.7,position_x:22.01,position_z:-27},{shape:"loop",type:"compound",segmentCount:7,segmentWidth:12,segmentHeight:.2,segmentLength:2,segmentPositionOffset:0,position_x:13.95,position_z:-18,position_y:20.4,rotation_y:-90},{shape:"box",height:.1*2,length:6*2,width:15*2,position_y:12.4,position_x:-2,position_z:-18},{shape:"loop",type:"compound",segmentCount:8,segmentWidth:8,segmentHeight:.2,radius:10,segmentPositionOffset:-1,position_x:-19,position_y:22.4,position_z:-16,rotation_y:90},{shape:"loop",type:"compound",segmentCount:7,segmentWidth:8,segmentHeight:.2,segmentPositionOffset:-1,radius:8,position_x:-20.59,position_y:24.16,position_z:-2,rotation_y:-90},{shape:"box",height:.1*2,length:3*2,width:6*2,position_y:16.16,position_x:-28.6,position_z:-2},{shape:"box",height:.1*2,length:6*2,width:3*2,position_y:16.16,position_x:-31.6,position_z:-11},{type:"trigger",shape:"sphere",event:"setCameraMode",dataSet:"chase",radius:3,position_y:1,position_z:-11.4},{shape:"box",type:"trigger",position_y:15.5,position_z:-18,width:1*2,length:6*2,height:3*2,event:"setCameraMode",dataSet:"hood"},{shape:"box",type:"trigger",position_y:18.26,position_z:-2,width:1*2,length:3*2,height:2*2,position_x:-26.8,event:"setCameraMode",dataSet:"dynamic,-16,21,-2"},{shape:"box",height:2*2,length:1*2,width:3*2,position_y:18.26,position_x:-31.6,position_z:-6,type:"trigger",dataSet:"-26,26,13"}],cl=[{type:"vehicle",position_y:11,rotation_y:-90,position_x:-5,position_z:8},{shape:"box",position_y:12,width:4,height:.2,length:4,position_x:4},{shape:"box",position_y:11.01,width:4,height:.2,length:4,position_x:.32,rotation_z:30},{shape:"box",position_y:9.67,width:4.2,height:.2,length:4,position_x:-7.41,rotation_z:-10},{shape:"box",position_y:9.67,width:4.2,height:.2,length:4,position_x:-3.38,rotation_z:10},{shape:"box",position_y:11.01,width:4,height:.2,length:4,position_x:-11.1,rotation_z:-30},{shape:"box",position_y:13.51,width:4,height:.2,length:4,position_x:-14.1,rotation_z:-50},{shape:"box",position_y:18.47,width:8,height:.2,length:4,position_x:-17.36,rotation_z:-60},{shape:"box",position_y:23.44,width:4,height:.2,length:4,position_x:-20.63,rotation_z:-50},{shape:"box",position_y:26.24,width:4,height:.2,length:4,position_x:-23.43,rotation_z:-40},{shape:"box",position_y:28.19,width:4,height:.2,length:4,position_x:-26.81,rotation_z:-20},{shape:"box",position_y:28.87,width:10,height:.2,length:10,position_x:-33.65},{shape:"box",position_y:19,width:8,height:.2,length:4,position_x:36.53,rotation_z:10,position_z:0},{shape:"box",position_y:8.576,width:12,height:.2,length:12,position_x:10.858,position_z:4,rotation_z:-35},{shape:"box",position_y:10,width:8,height:8,length:4,position_x:4,position_z:4},{shape:"box",position_y:12,width:4,height:.2,length:4,position_x:4,position_z:8},{shape:"box",position_y:11.013,width:4,height:.2,length:4,position_x:.318,rotation_z:30,position_z:8},{shape:"box",position_y:10,width:6,height:.2,length:4,position_x:-4.35,position_z:8},{shape:"box",position_y:21.06,width:8,height:.2,length:4,position_x:44.18,position_z:0,rotation_z:20},{shape:"box",position_y:23.9,width:6,height:.2,length:12,position_x:50.48,position_z:4,rotation_z:30},{shape:"sphere",type:"trigger",event:"checkpoint",position_x:-34.15,position_y:30.14,rotation_y:-90},{shape:"sphere",type:"trigger",event:"finish",dataSet:"checkpointCount:1",position_x:50.18,position_y:24.88,position_z:8.54},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"dynamic,26,20,43",position_x:-5,position_y:11,position_z:8,radius:2},{shape:"sphere",type:"trigger",dataSet:"25,22,18",position_x:4,position_y:13,position_z:8,radius:2},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"chase",position_x:10.01,position_y:9.92,position_z:1.67,radius:3}],hl=[{type:"vehicle",position_y:1},{shape:"box",width:7,height:.1,length:30,position_x:0,position_y:0,position_z:-11.5,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"chase",position_y:1},{shape:"box",position_x:-1.5,position_y:.6,position_z:-8,rotation_x:0,rotation_y:0,rotation_z:0,width:3,height:1},{shape:"box",position_x:1.5,position_y:.6,position_z:-18,rotation_x:0,rotation_y:0,rotation_z:0,width:3,height:1},{shape:"box",position_x:0,position_y:-2.62,position_z:-38.18,rotation_x:-10,rotation_y:0,rotation_z:0,width:7,length:6,height:.1},{shape:"box",position_x:0,position_y:-6,position_z:-57,rotation_x:0,rotation_y:0,rotation_z:0,width:6,length:10,height:.1},{shape:"slopeTransition",type:"compound",position_x:-3,position_y:-6.05,position_z:-65.66,rotation_x:0,rotation_y:0,rotation_z:0,angle:30,segmentHeight:.84,segmentLength:3.69,segmentCount:5,segmentWidth:6},{shape:"cantedCurve",type:"compound",position_x:20.33,position_y:-3.94,position_z:-78.94,rotation_x:0,rotation_y:-90,rotation_z:0,segmentCount:36,radius:20,segmentWidth:6,segmentLength:1.53,angle:40},{shape:"box",position_x:41.83,position_y:-2.69,position_z:-75.18,rotation_x:0,rotation_y:0,rotation_z:40,width:10,length:6,height:.1},{shape:"box",position_x:48.63,position_y:.51,position_z:-63.18,rotation_x:0,rotation_y:0,rotation_z:0,width:6,length:30,height:.1},{shape:"sphere",type:"trigger",event:"checkpoint",position_x:48.5,position_y:1.74,position_z:-74.9,rotation_y:180},{shape:"loop",type:"compound",position_x:52.63,position_y:8.5,position_z:-42,rotation_x:0,rotation_y:-90,rotation_z:0,segmentPositionOffset:0,segmentCount:7,segmentLength:2,segmentWidth:30},{shape:"loop",type:"compound",position_x:30.68,position_y:11.8,position_z:-25.54,rotation_x:180,rotation_y:0,rotation_z:90,segmentCount:16,segmentPositionOffset:0,radius:30,segmentWidth:8,segmentLength:3},{shape:"box",position_x:60.68,position_y:12.3,position_z:-34,rotation_x:0,rotation_y:0,rotation_z:90,width:7,length:14,height:.1},{shape:"box",position_x:23.17,position_y:11.77,position_z:4.49,rotation_x:0,rotation_y:0,rotation_z:0,width:17,length:.1,height:8},{shape:"loop",type:"compound",position_x:-14.87,position_y:8.5,position_z:-3.5,rotation_x:-180,rotation_y:0,rotation_z:-180,segmentPositionOffset:-1.2,segmentCount:32,segmentLength:2,segmentWidth:18},{shape:"box",position_x:-71.33,position_y:4.47,position_z:-76.56,rotation_x:0,rotation_y:-60,rotation_z:0,width:40,height:.1,length:20},{shape:"loop",type:"compound",position_x:-15.85,position_y:12.49,position_z:-5.46,rotation_x:0,rotation_y:0,rotation_z:0,segmentCount:4,radius:12,segmentLength:2,segmentWidth:16,segmentPositionOffset:0},{shape:"box",position_x:-83.67,position_y:5.33,position_z:-97.96,rotation_x:0,rotation_y:-60,rotation_z:-10,width:10,height:.1,length:20},{shape:"box",type:"trigger",event:"finish",dataSet:"checkpointCount:1",length:5,position_x:-83.28,position_y:6.75,position_z:-98.15,rotation_y:-60}],pl=[{type:"vehicle",position_y:11.5},{shape:"box",width:5,length:5,height:1,position_y:10},{shape:"box",width:8,length:6,height:1,position_y:-8,position_z:2},{shape:"box",position_y:-18,position_z:-1,height:1,width:10,length:10},{shape:"box",position_y:-22,position_z:17,height:1,width:10,length:10},{shape:"sphere",type:"trigger",event:"checkpoint",position_y:-6.5,position_z:2},{shape:"box",color:"#a59c89",height:.2,width:16,length:12,position_x:3,position_y:-12,position_z:17,rotation_x:-30},{shape:"box",position_x:8,position_y:-23,position_z:17,height:1,width:6,length:4},{shape:"box",position_x:14,position_y:-24,position_z:17,height:1,width:6,length:4},{shape:"sphere",type:"trigger",event:"checkpoint",position_x:8,position_y:-21,position_z:17,rotation_y:-90},{shape:"box",position_x:18,position_y:-25,position_z:13,height:1,width:4,length:6},{shape:"box",position_x:18,position_y:-26,position_z:7,height:1,width:4,length:6},{shape:"box",position_x:14,position_y:-27,position_z:3,height:1,width:6,length:4},{shape:"box",position_x:8,position_y:-28,position_z:3,height:1,width:6,length:4},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"32,-13,25",position_x:10,position_y:-21,position_z:17},{shape:"box",type:"trigger",dataSet:"-24,-13,20",height:2,length:1,width:6,position_x:0,position_y:-20,position_z:14},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"32,-13,-8",position_x:18,position_y:-24,position_z:9,rotation_y:-90},{shape:"box",position_x:-2,position_y:-31,position_z:4,height:1,width:6,length:6},{shape:"sphere",type:"trigger",event:"checkpoint",position_x:8,position_y:-26,position_z:3,rotation_y:90},{shape:"box",position_x:-2,position_y:-35,position_z:16,height:1,width:6,length:6},{shape:"box",position_x:-2,position_y:-39,position_z:27,height:1,width:6,length:6},{shape:"sphere",type:"trigger",event:"setCameraMode",dataSet:"dynamic,-24,25,0",position_y:12},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"-2,-20,-10",position_x:-2,position_y:-29,position_z:4},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"-35,-3,1",position_x:0,position_y:-6.5,position_z:2},{shape:"sphere",type:"trigger",event:"setCameraPosition",dataSet:"6,-21,-20",position_x:10,position_y:-26,position_z:3},{type:"trigger",shape:"sphere",event:"finish",dataSet:"checkpointCount:3",radius:1,position_x:-2,position_y:-37,position_z:27}],ul=[{type:"vehicle",position_y:1.4},{shape:"box",width:8,length:16,height:.2,position_y:-.6},{shape:"cylinder",sides:4,radiusTop:3,radiusBottom:5.7,height:1,rotation_y:45},{shape:"box",width:8,length:16,height:.2,position_z:20,position_x:0,position_y:0,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"box",width:8,length:16,height:.2,position_z:-20},{shape:"box",width:16,length:10,height:.2,position_y:-.6,position_x:-12,position_z:-3,rotation_x:0,rotation_y:0,rotation_z:0},{type:"compound",shape:"loop",position_x:-20.89,position_y:9.9,position_z:-3,rotation_y:90,segmentPositionOffset:0,segmentCount:7,segmentLength:2.64,segmentWidth:10,segmentHeight:.2,radius:10.5},{type:"compound",shape:"loop",position_x:-20.89,position_y:10.5,position_z:20,rotation_y:90,segmentPositionOffset:0,segmentCount:7,segmentLength:2.64,segmentWidth:16,segmentHeight:.2,radius:10.5},{shape:"box",width:16,length:16,height:.2,position_z:20,position_x:-12},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_y:1,position_z:-25},{type:"trigger",shape:"box",position_x:-5,position_y:1,position_z:-3,width:1,length:8,dataSet:"-8,27,-33"},{type:"trigger",shape:"box",dataSet:"-27, 29, 47",position_x:-19,position_y:1,position_z:20,width:1,length:14},{type:"trigger",shape:"box",dataSet:"0,10,40",position_x:-10,position_y:1,position_z:20,width:1,length:14},{type:"trigger",shape:"box",event:"setCameraMode",dataSet:"dynamic,24,8,0",width:1,height:1,length:1,position_y:.5},{shape:"box",position_x:-29,position_y:9,position_z:6,type:"trigger",width:5,height:10,length:1,dataSet:"-34,23,3"},{shape:"box",position_y:1,position_z:10,type:"trigger",event:"setCameraMode",dataSet:"chase",width:5,height:2,length:1}],dl=[{type:"vehicle",position_y:1,position_z:16},{shape:"box",width:6,length:38,height:.2,position_y:-.1,position_x:0,position_z:1,rotation_x:0,rotation_y:0,rotation_z:0},{type:"animated",shape:"box",width:6,height:4,length:6,position_y:2,position_z:7,dataSet:'{ "movement": { "x": 10 }, "speed": 10, "triggerStart": false }'},{type:"animated",shape:"box",width:6,height:4,length:6,position_y:2,position_z:-9,dataSet:'{ "movement": { "x": 10 }, "speed": 10, "triggerStart": false }'},{shape:"box",height:.2,width:6,length:10,position_x:10,position_y:3.9,position_z:-1},{shape:"box",height:.2,width:6,length:6,position_x:10,position_y:3.9,position_z:-15},{shape:"box",height:.2,width:6,length:10,position_x:10,position_y:3.033,position_z:-22.9,rotation_x:-10},{shape:"box",height:.2,width:6,length:10,position_y:.764,position_z:-22.92,rotation_x:10},{shape:"box",height:.2,width:6,length:6,position_y:1.63,position_z:-30.82},{shape:"box",height:.2,width:6,length:6,position_x:10,position_y:2.16,position_z:-30.82},{shape:"box",height:.2,width:4.05,length:6,position_x:5.01,position_y:1.895,position_z:-30.82,rotation_z:7.47},{shape:"box",height:.2,width:6,length:9,position_x:10,position_y:3.9,position_z:14.5,rotation_x:0,rotation_y:0,rotation_z:0},{shape:"sphere",position_x:10,position_y:3.45,position_z:-30.82,rotation_y:180,type:"trigger",event:"checkpoint"},{type:"trigger",shape:"sphere",event:"finish",radius:2,dataSet:"checkpointCount:1",position_x:10,position_y:5,position_z:16,rotation_x:0,rotation_y:0,rotation_z:0},{type:"trigger",shape:"sphere",event:"setCameraMode",dataSet:"dynamic,-23.677403301734017 , 18.14983153689501 , 19.110973303515554",radius:3,position_y:1,position_z:16},{type:"trigger",shape:"sphere",radius:3,dataSet:"-30.215800024784016, 22.38223498976879, 8.370897885782714",position_y:1,position_z:2},{type:"trigger",shape:"sphere",radius:3,dataSet:"-13.569674761319714, 16.522559296321283, -50.07904465318648",position_y:1,position_z:-15},{shape:"sphere",position_x:10,position_y:3.45,position_z:-30.82,rotation_y:180,type:"trigger",event:"setCameraPosition",radius:3,dataSet:"18.770735429093357, 20.96953167533059, -46.35856186137107"}],fl=[{type:"vehicle",position_y:11.4,position_x:1.5},{shape:"box",width:10,length:6,height:1,position_y:9.95,position_z:.3},{shape:"box",position_y:2.51,position_z:-15.44,rotation_x:-30,height:1,width:10,length:30},{shape:"box",position_x:-8,position_y:-25,position_z:-65,rotation_x:-30,height:1,width:10,length:60},{shape:"box",position_y:-56,position_z:-130,rotation_x:-20,height:1,width:10,length:60},{shape:"box",width:10,height:1,position_y:-5.18,position_z:-29.26,rotation_x:-15},{shape:"box",width:10,height:1,position_x:-8,position_y:-40.17,position_z:-91.78,rotation_x:-15},{shape:"box",position_y:-66.31,position_z:-159,rotation_x:-5,width:10,height:1},{shape:"box",position_x:8,position_y:-76,position_z:-200,rotation_x:-10,height:1,width:10,length:60},{shape:"box",position_y:-83,position_z:-271,height:1,width:10,length:60},{shape:"box",position_x:8,position_y:-81.08,position_z:-230.38,rotation_x:5,width:10,height:1},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:2,position_y:-81,position_z:-297},{type:"trigger",shape:"box",event:"setCameraMode",dataSet:"dynamic,-5,24,19",position_y:12},{type:"trigger",shape:"box",event:"setCameraMode",dataSet:"chase",height:2,width:8,length:1,position_y:11,position_x:0,position_z:-4}],ml=[{type:"vehicle",position_x:0,position_y:1.6,position_z:-4},{type:"trigger",shape:"sphere",event:"finish",dataSet:"",radius:1,position_x:-16,position_y:5.5,position_z:-10},{shape:"box",color:"#aad0ff",fixedRotation:!0,width:5,height:3.79,length:5,position_x:-10,position_y:-1,position_z:-10,mass:90},{shape:"box",color:"#aad0ff",fixedRotation:!0,width:5,height:.17,length:5,position_x:10,position_y:0,position_z:-10,mass:30},{shape:"box",position_x:-.4,position_y:-1.76,position_z:-10.07,height:.2,length:1,width:24.9,color:"#959dff",mass:30},{shape:"triangularPrism",position_x:0,position_y:-2.6,position_z:-10,rotation_y:90,height:1,width:1,length:1},{shape:"box",lowFriction:!0,position_x:-7.45,position_y:0,position_z:-10,height:1,length:5,width:.1},{shape:"box",lowFriction:!0,position_x:7.45,position_y:0,position_z:-10,height:1,length:5,width:.1},{shape:"box",lowFriction:!0,position_x:12.55,position_y:-2,position_z:-10,height:5,length:5,width:.1},{shape:"box",lowFriction:!0,position_x:-12.55,position_y:-2,position_z:-10,height:5,length:5,width:.1},{shape:"box",lowFriction:!0,position_x:10,position_y:-2,position_z:-7.45,height:5,length:.1,width:5.2},{shape:"box",lowFriction:!0,position_x:10,position_y:-2,position_z:-12.55,height:5,length:.1,width:5.2},{shape:"box",lowFriction:!0,position_x:-10,position_y:-2,position_z:-12.55,height:5,length:.1,width:5.2},{shape:"box",lowFriction:!0,position_x:-10,position_y:-2,position_z:-7.45,height:5,length:.1,width:5.2},{shape:"box",height:.2,position_x:0,position_y:.4,position_z:-10,width:14.8,length:5.2},{shape:"box",lowFriction:!0,position_x:-7.45,position_y:-2.5,position_z:-8.5,height:4,length:2,width:.1},{shape:"box",lowFriction:!0,position_x:-7.45,position_y:-2.5,position_z:-11.5,height:4,length:2,width:.1},{shape:"box",lowFriction:!0,position_x:7.45,position_y:-2.5,position_z:-11.5,height:4,length:2,width:.1},{shape:"box",lowFriction:!0,position_x:7.45,position_y:-2.5,position_z:-8.5,height:4,length:2,width:.1},{shape:"box",height:.2,position_x:0,position_y:.4,position_z:-4,width:25.2,length:6.8},{shape:"box",position_x:-15.08,position_y:4.04,position_z:-10,length:5,width:5,height:.2},{shape:"triangularPrism",height:.1,length:.2,width:5.5,position_x:10.25,position_y:.55,position_z:-7.5},{shape:"triangularPrism",height:.1,length:.2,width:5.5,position_x:7.5,position_y:.55,position_z:-10.25,rotation_y:90},{shape:"triangularPrism",height:.24,length:1,width:12,position_x:13,position_y:.62,position_z:-7,rotation_y:90},{shape:"triangularPrism",height:.24,length:1,width:27,position_x:0,position_y:.62,position_z:-13.01},{shape:"triangularPrism",height:.24,length:1,width:12,position_x:-13.01,position_y:.62,position_z:-7,rotation_y:90},{shape:"box",lowFriction:!0,position_x:-12.55,position_y:4.04,position_z:-10,height:.2,length:5,width:.1},{shape:"triangularPrism",height:.24,length:1,width:27,position_x:0,position_y:.62,position_z:-1},{shape:"box",width:27,position_x:0,position_y:-1,position_z:-1,length:1,height:3},{shape:"box",height:.2,position_x:-16,position_y:.4,position_z:-7,width:5,length:13},{shape:"sphere",color:"#77a7ff",position_x:6.25,position_y:1.5,position_z:-10,mass:60},{shape:"sphere",color:"#77a7ff",position_x:-5.36,position_y:1.5,position_z:-10,mass:60},{shape:"box",type:"trigger",event:"setCameraMode",dataSet:"dynamic,0, 13, 17",width:1,length:10,height:1,position_x:0,position_y:2,position_z:-7},{shape:"box",type:"trigger",dataSet:"-22, 10, 5",width:1,length:10,height:1,position_x:-5,position_y:2,position_z:-7},{shape:"box",type:"trigger",dataSet:"8, 14, 6",width:1,length:10,height:1,position_x:5,position_y:2,position_z:-7}];const Hs={map01:al,map02:rl,map03:ll,map04:cl,map05:hl,map06:pl,map07:ul,map08:dl,map09:fl,map10:ml,empty:ol,test:[{type:"vehicle",position_y:2,position_z:15},{shape:"box",width:24,height:.2,length:40,position_x:14,position_z:22},{shape:"triangularPrism",width:2,length:2,offset:-2,position_y:1},{shape:"box",width:24,height:.2,length:120,position_x:-10,position_z:-18},{shape:"box",size:2,position_x:15,position_y:2,position_z:10,mass:40,fixedRotation:!0,rotation_x:45,rotation_y:45},{shape:"box",size:2,position_x:20,position_y:5,position_z:10,rotation_x:45,rotation_y:45},{type:"compound",shape:"loop",segmentPositionOffset:.6,position_x:5,position_y:8.2,position_z:4,rotation_x:12},{type:"compound",shape:"slopeTransition",segmentWidth:6,segmentHeight:.6,segmentLength:12,segmentCount:10,position_x:-25.8,position_z:30},{type:"trigger",shape:"sphere",event:"setCameraPosition",dataSet:"-6,10,26",radius:3,position_x:10,position_y:1,position_z:15},{type:"trigger",shape:"sphere",event:"finish",radius:1,position_x:12,position_y:3,position_z:5},{type:"trigger",shape:"sphere",event:"setCameraMode",dataSet:"hood",radius:3,position_x:6,position_y:1.9,position_z:-.4},{shape:"box",position_y:12,width:4*2,height:.1*2,length:2*2,position_x:-20,position_z:8},{shape:"box",position_y:11.8,width:9*2,height:.1*2,length:.2*2,position_x:-7,position_z:6.2,lowFriction:!0},{shape:"box",position_y:11.8,width:9*2,height:.1*2,length:.2*2,position_x:-7,position_z:9.8,lowFriction:!0},{shape:"box",position_y:12,width:9*2,height:.1*2,length:.1*2,position_x:-7,position_z:9.9,lowFriction:!0},{shape:"box",position_y:12,width:9*2,height:.1*2,length:.1*2,position_x:-7,position_z:6.1,lowFriction:!0},{shape:"box",position_y:12,width:2*2,height:.1*2,length:1.8*2,position_x:-14,position_z:8,mass:10},{shape:"box",position_x:9.11,position_y:7.09,position_z:-15,rotation_z:45,height:.1*2,length:10*2,width:10*2},{shape:"box",position_x:10.21,position_y:5.74,position_z:-35,rotation_z:35,height:.1*2,length:10*2,width:10*2},{type:"compound",shape:"cantedCurve",position_x:8.94,position_y:-3.61,position_z:53.91,radius:11.65,rotation_x:0,rotation_y:-83.16,rotation_z:0,angle:60,segmentWidth:6,segmentCount:32,segmentLength:2},{type:"compound",shape:"cantedCurve",position_x:8.94,position_y:-7.71,position_z:53.91,radius:7.675,rotation_x:0,rotation_y:4.18,rotation_z:0,angle:30,segmentWidth:6,segmentCount:32,segmentLength:1},{shape:"box",position_x:9,position_y:-9.2,position_z:53.81,rotation_x:0,rotation_y:0,rotation_z:0,width:10,length:10,height:.1}]},gl="Finished!",yl=a=>`Your time: ${a}`,xl="retry",_l="next",wl="select map";function bl({closeModal:a}){const e=ae.exports.useContext(pn);return ne.createElement(ds,null,ne.createElement("span",{className:"modal__header"},gl),ne.createElement("span",{className:"modal__body"},yl(e.result)),ne.createElement("div",{className:"modal__footer"},ne.createElement("button",{onClick:i},xl),ne.createElement("button",{onClick:n},wl),ne.createElement("button",{onClick:t},_l)));function t(){a(),e.loadNextMap()}function i(){a(),e.reset()}function n(){a(),e.listeners.dispatch(it.openMapSelectorPanel)}}const xi=document.createElement("aside");xi.id="gameProgressModalControllerRoot";xi.classList.add("hidden");document.body.appendChild(xi);const pn=ae.exports.createContext(void 0);function Ml(a){Bt.exports.render(ne.createElement(ae.exports.StrictMode,null,ne.createElement(pn.Provider,{value:a},ne.createElement(vl,null))),xi)}function vl(){const a=ae.exports.useContext(pn),[e,t]=ae.exports.useState(!0);return ae.exports.useEffect(()=>(a.listeners.add(it.openModal,i),()=>{a.listeners.remove(it.openModal,i)}),[]),e?null:ne.createElement(bl,{closeModal:n});function i(){t(!1)}function n(){t(!0)}}var it;(function(a){a.openModal="openModal",a.openMapSelectorPanel="openMapSelectorPanel"})(it||(it={}));let Xt;const un=document.createElement("aside"),_i=document.createElement("span"),Us="00:00.000";un.id="hud";const dn=["map01","map02","map03","map04","map05","map06","map07","map08","map09","map10"];class El{constructor(e,t){O(this,"timer",new sl);O(this,"listeners",new Ht);O(this,"started",!1);O(this,"result","");O(this,"checkpointsReached",0);O(this,"respawnCount",0);O(this,"_mapBuilder");O(this,"checkpointHandler");O(this,"vehicle");O(this,"currentMap","map01");O(this,"checkpointReached",e=>{Xt=e,this.checkpointsReached++});_i.textContent=Us,un.appendChild(_i),document.getElementById("topLeftPanel").appendChild(un),this._mapBuilder=e,this.vehicle=t,Ml(this)}initCheckpointHandler(e,t){this.checkpointHandler=new tl(e,t)}respawnAtLastCheckpoint(){Xt?(this.vehicle.chassisBody.velocity.setZero(),this.vehicle.chassisBody.angularVelocity.setZero(),this.vehicle.chassisBody.position.copy(Xt.position),this.vehicle.chassisBody.quaternion.copy(Xt.quaternion),this.respawnCount++):this.reset()}start(){this.started=!0,this.timer.start()}stop(){this.timer.stop(),this.result=ls(this.timer.time)}reset(){this.started=!1,this.checkpointsReached=0,this.respawnCount=0,this.result="",_i.textContent=Us,this.timer.reset(),this._mapBuilder.resetDynamicMapElements(),this.checkpointHandler.init(this._mapBuilder,this),Xt=void 0}loadMap(e=this.currentMap){if(!Hs.hasOwnProperty(e)){console.warn(`invalid map name ${e}`);return}this._mapBuilder.importMap(Hs[e]),this.currentMap=e,this.reset()}loadNextMap(){const e=dn.indexOf(this.currentMap);if(e<dn.length-1){const t=dn[e+1];this.loadMap(t)}else this.reset()}updateHUD(){!this.timer.started||this.timer.stopped||(_i.textContent=ls(this.timer.time))}openModal(){this.listeners.dispatch(it.openModal)}}class Sl{constructor(e,t,i,n){O(this,"_enabled",!1);O(this,"scene");O(this,"camera");O(this,"domElement");O(this,"mapBuilder");O(this,"raycaster",new Un);O(this,"mousePosition",new ee);O(this,"raycastResult",[]);O(this,"hoveredObject");O(this,"onSelect");O(this,"onClick",e=>{if(e.type==="click"&&!e.altKey)return;this.mousePosition.x=e.clientX/window.innerWidth*2-1,this.mousePosition.y=-(e.clientY/window.innerHeight)*2+1,this.raycaster.setFromCamera(this.mousePosition,this.camera),this.raycastResult.length=0,this.raycaster.intersectObjects(this.scene.children,!0,this.raycastResult);const{mapElementIdList:t}=this.mapBuilder;let i;for(let n=0;n<this.raycastResult.length;n++){const o=this.raycastResult[n].object;if(t.includes(o.name)){i=o;break}else if(t.includes(o.parent.name)){i=o.parent;break}}i&&this.mapBuilder.selectMapElement(i.name)});this.camera=t,this.scene=e,this.domElement=i,this.mapBuilder=n}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(e?(this.domElement.addEventListener("click",this.onClick),this.domElement.addEventListener("dblclick",this.onClick)):(this.domElement.removeEventListener("click",this.onClick),this.domElement.removeEventListener("dblclick",this.onClick),this.hoveredObject=void 0),this._enabled=e)}}const ut=new Un,Re=new X,nt=new X,me=new ze,js={X:new X(1,0,0),Y:new X(0,1,0),Z:new X(0,0,1)},Gs={type:"change"},Vs={type:"mouseDown"},Ws={type:"mouseUp",mode:null},Tl={type:"objectChange"};class Ks extends xt{constructor(e,t){super();t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const i=new Zs;this._gizmo=i,this.add(i);const n=new Qs;this._plane=n,this.add(n);const o=this;function s(F,v){let T=v;Object.defineProperty(o,F,{get:function(){return T!==void 0?T:v},set:function(S){T!==S&&(T=S,n[F]=S,i[F]=S,o.dispatchEvent({type:F+"-changed",value:S}),o.dispatchEvent(Gs))}}),o[F]=v,n[F]=v,i[F]=v}s("camera",e),s("object",void 0),s("enabled",!0),s("axis",null),s("mode","translate"),s("translationSnap",null),s("rotationSnap",null),s("scaleSnap",null),s("space","world"),s("size",1),s("dragging",!1),s("showX",!0),s("showY",!0),s("showZ",!0);const r=new X,l=new X,c=new ze,u=new ze,h=new X,f=new ze,y=new X,A=new X,P=new X,b=0,E=new X;s("worldPosition",r),s("worldPositionStart",l),s("worldQuaternion",c),s("worldQuaternionStart",u),s("cameraPosition",h),s("cameraQuaternion",f),s("pointStart",y),s("pointEnd",A),s("rotationAxis",P),s("rotationAngle",b),s("eye",E),this._offset=new X,this._startNorm=new X,this._endNorm=new X,this._cameraScale=new X,this._parentPosition=new X,this._parentQuaternion=new ze,this._parentQuaternionInv=new ze,this._parentScale=new X,this._worldScaleStart=new X,this._worldQuaternionInv=new ze,this._worldScale=new X,this._positionStart=new X,this._quaternionStart=new ze,this._scaleStart=new X,this._getPointer=Pl.bind(this),this._onPointerDown=Al.bind(this),this._onPointerHover=Cl.bind(this),this._onPointerMove=Ll.bind(this),this._onPointerUp=zl.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;ut.setFromCamera(e,this.camera);const t=fn(this._gizmo.picker[this.mode],ut);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){ut.setFromCamera(e,this.camera);const t=fn(this._plane,ut,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Vs.mode=this.mode,this.dispatchEvent(Vs)}}pointerMove(e){const t=this.axis,i=this.mode,n=this.object;let o=this.space;if(i==="scale"?o="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(o="world"),n===void 0||t===null||this.dragging===!1||e.button!==-1)return;ut.setFromCamera(e,this.camera);const s=fn(this._plane,ut,!0);if(!!s){if(this.pointEnd.copy(s.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),o==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),o==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(o==="local"&&(n.position.applyQuaternion(me.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),o==="world"&&(n.parent&&n.position.add(Re.setFromMatrixPosition(n.parent.matrixWorld)),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(Re.setFromMatrixPosition(n.parent.matrixWorld))));else if(i==="scale"){if(t.search("XYZ")!==-1){let r=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(r*=-1),nt.set(r,r,r)}else Re.copy(this.pointStart),nt.copy(this.pointEnd),Re.applyQuaternion(this._worldQuaternionInv),nt.applyQuaternion(this._worldQuaternionInv),nt.divide(Re),t.search("X")===-1&&(nt.x=1),t.search("Y")===-1&&(nt.y=1),t.search("Z")===-1&&(nt.z=1);n.scale.copy(this._scaleStart).multiply(nt),this.scaleSnap&&(t.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const r=20/this.worldPosition.distanceTo(Re.setFromMatrixPosition(this.camera.matrixWorld));t==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Re.copy(this.rotationAxis).cross(this.eye))*r):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(js[t]),Re.copy(js[t]),o==="local"&&Re.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(Re.cross(this.eye).normalize())*r),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),o==="local"&&t!=="E"&&t!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(me.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(me.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Gs),this.dispatchEvent(Tl)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(Ws.mode=this.mode,this.dispatchEvent(Ws)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}getRaycaster(){return ut}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}update(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}}Ks.prototype.isTransformControls=!0;function Pl(a){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:a.button};{const e=this.domElement.getBoundingClientRect();return{x:(a.clientX-e.left)/e.width*2-1,y:-(a.clientY-e.top)/e.height*2+1,button:a.button}}}function Cl(a){if(!!this.enabled)switch(a.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(a));break}}function Al(a){!this.enabled||(this.domElement.setPointerCapture(a.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(a)),this.pointerDown(this._getPointer(a)))}function Ll(a){!this.enabled||this.pointerMove(this._getPointer(a))}function zl(a){!this.enabled||(this.domElement.releasePointerCapture(a.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(a)))}function fn(a,e,t){const i=e.intersectObject(a,!0);for(let n=0;n<i.length;n++)if(i[n].object.visible||t)return i[n];return!1}const wi=new Dn,ue=new X(0,1,0),Xs=new X(0,0,0),Ys=new Rt,bi=new ze,Mi=new ze,Ge=new X,qs=new Rt,Yt=new X(1,0,0),dt=new X(0,1,0),qt=new X(0,0,1),vi=new X,Zt=new X,Qt=new X;class Zs extends xt{constructor(){super();this.type="TransformControlsGizmo";const e=new ke({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Rn({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const n=t.clone();n.opacity=.5;const o=e.clone();o.color.setHex(16711680);const s=e.clone();s.color.setHex(65280);const r=e.clone();r.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const u=e.clone();u.color.setHex(255),u.opacity=.5;const h=e.clone();h.opacity=.25;const f=e.clone();f.color.setHex(16776960),f.opacity=.25,e.clone().color.setHex(16776960);const A=e.clone();A.color.setHex(7895160);const P=new Me(0,.04,.1,12);P.translate(0,.05,0);const b=new ge(.08,.08,.08);b.translate(0,.04,0);const E=new je;E.setAttribute("position",new Le([0,0,0,1,0,0],3));const F=new Me(.0075,.0075,.5,3);F.translate(0,.25,0);function v(j,Q){const N=new Nt(j,.0075,3,64,Q*Math.PI*2);return N.rotateY(Math.PI/2),N.rotateX(Math.PI/2),N}function T(){const j=new je;return j.setAttribute("position",new Le([0,0,0,1,1,1],3)),j}const S={X:[[new G(P,o),[.5,0,0],[0,0,-Math.PI/2]],[new G(P,o),[-.5,0,0],[0,0,Math.PI/2]],[new G(F,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new G(P,s),[0,.5,0]],[new G(P,s),[0,-.5,0],[Math.PI,0,0]],[new G(F,s)]],Z:[[new G(P,r),[0,0,.5],[Math.PI/2,0,0]],[new G(P,r),[0,0,-.5],[-Math.PI/2,0,0]],[new G(F,r),null,[Math.PI/2,0,0]]],XYZ:[[new G(new oi(.1,0),h.clone()),[0,0,0]]],XY:[[new G(new ge(.15,.15,.01),u.clone()),[.15,.15,0]]],YZ:[[new G(new ge(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new G(new ge(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},H={X:[[new G(new Me(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new G(new Me(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new G(new Me(.2,0,.6,4),i),[0,.3,0]],[new G(new Me(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new G(new Me(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new G(new Me(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new G(new oi(.2,0),i)]],XY:[[new G(new ge(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new G(new ge(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new G(new ge(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},U={START:[[new G(new oi(.01,2),n),null,null,null,"helper"]],END:[[new G(new oi(.01,2),n),null,null,null,"helper"]],DELTA:[[new Xe(T(),n),null,null,null,"helper"]],X:[[new Xe(E,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Xe(E,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Xe(E,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},C={XYZE:[[new G(v(.5,1),A),null,[0,Math.PI/2,0]]],X:[[new G(v(.5,.5),o)]],Y:[[new G(v(.5,.5),s),null,[0,0,-Math.PI/2]]],Z:[[new G(v(.5,.5),r),null,[0,Math.PI/2,0]]],E:[[new G(v(.75,1),f),null,[0,Math.PI/2,0]]]},z={AXIS:[[new Xe(E,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},V={XYZE:[[new G(new ti(.25,10,8),i)]],X:[[new G(new Nt(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new G(new Nt(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new G(new Nt(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new G(new Nt(.75,.1,2,24),i)]]},W={X:[[new G(b,o),[.5,0,0],[0,0,-Math.PI/2]],[new G(F,o),[0,0,0],[0,0,-Math.PI/2]],[new G(b,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new G(b,s),[0,.5,0]],[new G(F,s)],[new G(b,s),[0,-.5,0],[0,0,Math.PI]]],Z:[[new G(b,r),[0,0,.5],[Math.PI/2,0,0]],[new G(F,r),[0,0,0],[Math.PI/2,0,0]],[new G(b,r),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new G(new ge(.15,.15,.01),u),[.15,.15,0]]],YZ:[[new G(new ge(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new G(new ge(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new G(new ge(.1,.1,.1),h.clone())]]},R={X:[[new G(new Me(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new G(new Me(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new G(new Me(.2,0,.6,4),i),[0,.3,0]],[new G(new Me(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new G(new Me(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new G(new Me(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new G(new ge(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new G(new ge(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new G(new ge(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new G(new ge(.2,.2,.2),i),[0,0,0]]]},L={X:[[new Xe(E,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Xe(E,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Xe(E,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function B(j){const Q=new xt;for(const N in j)for(let I=j[N].length;I--;){const se=j[N][I][0].clone(),pe=j[N][I][1],Ae=j[N][I][2],M=j[N][I][3],x=j[N][I][4];se.name=N,se.tag=x,pe&&se.position.set(pe[0],pe[1],pe[2]),Ae&&se.rotation.set(Ae[0],Ae[1],Ae[2]),M&&se.scale.set(M[0],M[1],M[2]),se.updateMatrix();const p=se.geometry.clone();p.applyMatrix4(se.matrix),se.geometry=p,se.renderOrder=1/0,se.position.set(0,0,0),se.rotation.set(0,0,0),se.scale.set(1,1,1),Q.add(se)}return Q}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=B(S)),this.add(this.gizmo.rotate=B(C)),this.add(this.gizmo.scale=B(W)),this.add(this.picker.translate=B(H)),this.add(this.picker.rotate=B(V)),this.add(this.picker.scale=B(R)),this.add(this.helper.translate=B(U)),this.add(this.helper.rotate=B(z)),this.add(this.helper.scale=B(L)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Mi;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let o=0;o<n.length;o++){const s=n[o];s.visible=!0,s.rotation.set(0,0,0),s.position.copy(this.worldPosition);let r;if(this.camera.isOrthographicCamera?r=(this.camera.top-this.camera.bottom)/this.camera.zoom:r=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),s.scale.set(1,1,1).multiplyScalar(r*this.size/4),s.tag==="helper"){s.visible=!1,s.name==="AXIS"?(s.position.copy(this.worldPositionStart),s.visible=!!this.axis,this.axis==="X"&&(me.setFromEuler(wi.set(0,0,0)),s.quaternion.copy(i).multiply(me),Math.abs(ue.copy(Yt).applyQuaternion(i).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Y"&&(me.setFromEuler(wi.set(0,0,Math.PI/2)),s.quaternion.copy(i).multiply(me),Math.abs(ue.copy(dt).applyQuaternion(i).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="Z"&&(me.setFromEuler(wi.set(0,Math.PI/2,0)),s.quaternion.copy(i).multiply(me),Math.abs(ue.copy(qt).applyQuaternion(i).dot(this.eye))>.9&&(s.visible=!1)),this.axis==="XYZE"&&(me.setFromEuler(wi.set(0,Math.PI/2,0)),ue.copy(this.rotationAxis),s.quaternion.setFromRotationMatrix(Ys.lookAt(Xs,ue,dt)),s.quaternion.multiply(me),s.visible=this.dragging),this.axis==="E"&&(s.visible=!1)):s.name==="START"?(s.position.copy(this.worldPositionStart),s.visible=this.dragging):s.name==="END"?(s.position.copy(this.worldPosition),s.visible=this.dragging):s.name==="DELTA"?(s.position.copy(this.worldPositionStart),s.quaternion.copy(this.worldQuaternionStart),Re.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Re.applyQuaternion(this.worldQuaternionStart.clone().invert()),s.scale.copy(Re),s.visible=this.dragging):(s.quaternion.copy(i),this.dragging?s.position.copy(this.worldPositionStart):s.position.copy(this.worldPosition),this.axis&&(s.visible=this.axis.search(s.name)!==-1));continue}if(s.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"){const l=.99,c=.2;s.name==="X"&&Math.abs(ue.copy(Yt).applyQuaternion(i).dot(this.eye))>l&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Y"&&Math.abs(ue.copy(dt).applyQuaternion(i).dot(this.eye))>l&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="Z"&&Math.abs(ue.copy(qt).applyQuaternion(i).dot(this.eye))>l&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XY"&&Math.abs(ue.copy(qt).applyQuaternion(i).dot(this.eye))<c&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="YZ"&&Math.abs(ue.copy(Yt).applyQuaternion(i).dot(this.eye))<c&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),s.name==="XZ"&&Math.abs(ue.copy(dt).applyQuaternion(i).dot(this.eye))<c&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1)}else this.mode==="rotate"&&(bi.copy(i),ue.copy(this.eye).applyQuaternion(me.copy(i).invert()),s.name.search("E")!==-1&&s.quaternion.setFromRotationMatrix(Ys.lookAt(this.eye,Xs,dt)),s.name==="X"&&(me.setFromAxisAngle(Yt,Math.atan2(-ue.y,ue.z)),me.multiplyQuaternions(bi,me),s.quaternion.copy(me)),s.name==="Y"&&(me.setFromAxisAngle(dt,Math.atan2(ue.x,ue.z)),me.multiplyQuaternions(bi,me),s.quaternion.copy(me)),s.name==="Z"&&(me.setFromAxisAngle(qt,Math.atan2(ue.y,ue.x)),me.multiplyQuaternions(bi,me),s.quaternion.copy(me)));s.visible=s.visible&&(s.name.indexOf("X")===-1||this.showX),s.visible=s.visible&&(s.name.indexOf("Y")===-1||this.showY),s.visible=s.visible&&(s.name.indexOf("Z")===-1||this.showZ),s.visible=s.visible&&(s.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),s.material._color=s.material._color||s.material.color.clone(),s.material._opacity=s.material._opacity||s.material.opacity,s.material.color.copy(s.material._color),s.material.opacity=s.material._opacity,this.enabled&&this.axis&&(s.name===this.axis||this.axis.split("").some(function(l){return s.name===l}))&&(s.material.color.setHex(16776960),s.material.opacity=1)}super.updateMatrixWorld(e)}}Zs.prototype.isTransformControlsGizmo=!0;class Qs extends G{constructor(){super(new ki(1e5,1e5,2,2),new ke({visible:!1,wireframe:!0,side:zt,transparent:!0,opacity:.1,toneMapped:!1}));this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),vi.copy(Yt).applyQuaternion(t==="local"?this.worldQuaternion:Mi),Zt.copy(dt).applyQuaternion(t==="local"?this.worldQuaternion:Mi),Qt.copy(qt).applyQuaternion(t==="local"?this.worldQuaternion:Mi),ue.copy(Zt),this.mode){case"translate":case"scale":switch(this.axis){case"X":ue.copy(this.eye).cross(vi),Ge.copy(vi).cross(ue);break;case"Y":ue.copy(this.eye).cross(Zt),Ge.copy(Zt).cross(ue);break;case"Z":ue.copy(this.eye).cross(Qt),Ge.copy(Qt).cross(ue);break;case"XY":Ge.copy(Qt);break;case"YZ":Ge.copy(vi);break;case"XZ":ue.copy(Qt),Ge.copy(Zt);break;case"XYZ":case"E":Ge.set(0,0,0);break}break;case"rotate":default:Ge.set(0,0,0)}Ge.length()===0?this.quaternion.copy(this.cameraQuaternion):(qs.lookAt(Re.set(0,0,0),Ge,ue),this.quaternion.setFromRotationMatrix(qs)),super.updateMatrixWorld(e)}}Qs.prototype.isTransformControlsPlane=!0;function Rl(a,e){const t=new Ks(a.camera,a.domElement);let i=!1,n=!1;function o(){const s=t.object,r=s.name;e.translate(r,{position_x:wt(s.position.x),position_y:wt(s.position.y),position_z:wt(s.position.z),rotation_x:wt(Be(s.rotation.x)),rotation_y:wt(Be(s.rotation.y)),rotation_z:wt(Be(s.rotation.z))})}return t.addEventListener("objectChange",ja(o,100)),t.addEventListener("dragging-changed",s=>{i?a.orbitControls.enabled=n:(n=a.orbitControls.enabled,a.orbitControls.enabled=!1),i=s.value}),De.addKeyPressListener("KeyG",()=>{t.mode==="translate"?t.setMode("rotate"):t.setMode("translate")}),De.addKeyDownChangeListener(s=>{s.has("ShiftLeft")?t.setTranslationSnap(1):t.setTranslationSnap(null)}),t}const Ei=document.createElement("aside");Ei.id="menuModalControllerRoot";Ei.classList.add("hidden");document.body.appendChild(Ei);const Il={gameProgressManager:void 0,renderer:void 0,menuOpen:!1,openMenu:qe,closeMenu:qe,selectedTabIndex:0,setSelectedTabIndex:qe},$s=ae.exports.createContext(Il);function kl(a,e){Bt.exports.render(ne.createElement(Ol,{gameProgressManager:a,renderer:e}),Ei)}function Ol({gameProgressManager:a,renderer:e}){const[t,i]=ae.exports.useState(!1),[n,o]=ae.exports.useState(0),s=ae.exports.useCallback(()=>{i(!0)},[]),r=ae.exports.useCallback(()=>{i(!1)},[]),l={gameProgressManager:a,renderer:e,menuOpen:t,openMenu:s,closeMenu:r,selectedTabIndex:n,setSelectedTabIndex:o};return ne.createElement($s.Provider,{value:l},ne.createElement(Fl,null))}function Fl(){const{menuOpen:a,openMenu:e,setSelectedTabIndex:t,gameProgressManager:i}=ae.exports.useContext($s),n=ae.exports.useCallback(()=>{e()},[]),o=ae.exports.useCallback(()=>{t(0),e()},[]);ae.exports.useEffect(()=>(De.addKeyPressListener("Tab",n),i.listeners.add(it.openMapSelectorPanel,o),()=>{De.removeKeyPressListener("Tab",n),i.listeners.remove(it.openMapSelectorPanel,o)}),[]);const s=ae.exports.lazy(()=>xs(()=>import("./MenuModalf9968e4f.js"),["esm/MenuModalf9968e4f.js","esm/react6742c151.js","esm/Switche9f51982.js","esm/cannoncd468cdc.js","esm/three895a3223.js"]));return ae.exports.useMemo(()=>a?ne.createElement(ae.exports.Suspense,{fallback:ne.createElement(_s,null)},ne.createElement(s,null)):null,[a])}function Nl(a,e){const t={baseMaterial:new Hn({color:7829367}),fenderMaterial:new ke({color:328965}),grillMaterial:new ke({color:2236962}),chromeMaterial:new Ft({color:13421772}),glassMaterial:new Ft({color:11324631}),tailLightMaterial:new Ft({color:5570560}),headLightMaterial:new Ft({color:16777147}),wheelMaterial:new ke({alphaTest:.5,skinning:!0})};return a.traverse(n=>{n.material&&(t.wheelMaterial.map=n.material.map,n.material=t.wheelMaterial,n.material.needsUpdate=!0)}),e.traverse(n=>{n.material&&(n.material=i(n.name))}),t;function i(n){switch(n){case"front_bumper":case"rear_bumper":case"front_fender":case"rear_fender":return t.fenderMaterial;case"grill":return t.grillMaterial;case"brushGuard":return t.chromeMaterial;case"glass":return t.glassMaterial;case"tail_lights":return t.tailLightMaterial;case"head_lights":return t.headLightMaterial;default:return t.baseMaterial}}}const Js={engineForceMin:-de.vehicle.maxEngineForce,engineForceMax:de.vehicle.maxEngineForce,brakeForceMin:0,brakeForceMax:de.vehicle.maxBrakeForce,steeringAngleMin:-de.vehicle.maxSteeringAngle,steeringAngleMax:de.vehicle.maxSteeringAngle},Bl={engineForce:0,brakeForce:0,steeringAngle:0};function Dl(a){return new Proxy(Bl,{set(e,t,i){const n=e[t],o=hs(i,Js[`${t}Min`],Js[`${t}Max`]);return n!==o&&(e[t]=o),!0}})}const Hl=new X(0,0,1);let $t,Jt;const{renderWireFrame:mn}=de,{torqueSplitRatio:Ul,maxEngineForce:jl,maxBrakeForce:Gl,maxSteeringAngle:Vl,steeringSpeed:eo,wheelRadius:Wl,wheelSuspensionRestLength:Kl,wheelSuspensionStiffness:Xl,wheelMaxSuspensionTravel:Yl,wheelMaxSuspensionForce:ql,wheelDampingCompression:Zl,wheelDampingRelaxation:Ql,wheelFrictionSlip:$l,wheelForwardAcceleration:Jl,wheelSidedAcceleration:ec,wheelRollInfluence:tc}=de.vehicle,ic=.3,st=0,ot=1,Tt=2,Pt=3,nc=new Set([Tt,Pt]),[to,io]=Ul,gn=[to/2,to/2,io/2,io/2],ye=[...gn];class sc{constructor(e,t){O(this,"base");O(this,"chassisBody");O(this,"chassisMesh");O(this,"wheelBodies");O(this,"wheelMeshes");O(this,"state");O(this,"initialPosition",new he);O(this,"initialRotation",new zi);O(this,"currentSteeringAngle",0);O(this,"trackWidth",0);O(this,"wheelBase",0);O(this,"materials");O(this,"update",()=>{this.steerWheels(),this.applyWheelSlipReduction();for(let e=0;e<this.base.wheelInfos.length;e++)this.base.applyEngineForce(this.state.engineForce*ye[e]*.01,e),this.base.updateWheelTransform(e),$t=this.base.wheelInfos[e].worldTransform,this.wheelMeshes[e].position.copy($t.position),this.wheelMeshes[e].quaternion.copy($t.quaternion),mn&&(Jt=this.wheelBodies[e],Jt.position.copy($t.position),Jt.quaternion.copy($t.quaternion),this.wheelMeshes[e].position.copy(Jt.position),this.wheelMeshes[e].quaternion.copy(Jt.quaternion));this.chassisMesh.position.copy(this.chassisBody.position),this.chassisMesh.quaternion.copy(this.chassisBody.quaternion),this.chassisMesh.translateOnAxis(Hl,.6)});O(this,"applyWheelSlipReduction",()=>{const e=this.wheelHasGrip(ot),t=this.wheelHasGrip(st),i=this.wheelHasGrip(Pt),n=this.wheelHasGrip(Tt);if(e&&!i&&ye[Pt]>1)ye[ot]+=1,ye[Pt]-=1;else if(!e&&i&&ye[ot]>1)ye[ot]-=1,ye[Pt]+=1;else{const o=Math.sign(ye[ot]-gn[ot]);o&&(ye[ot]-=o*1,ye[Pt]+=o*1)}if(t&&!n&&ye[Tt]>1)ye[st]+=1,ye[Tt]-=1;else if(!t&&n&&ye[st]>1)ye[st]-=1,ye[Tt]+=1;else{const o=Math.sign(ye[st]-gn[st]);o&&(ye[st]-=o*1,ye[Tt]+=o*1)}});O(this,"brakeWheel",e=>{this.base.setBrake(this.state.brakeForce,e)});O(this,"steerWheels",()=>{const{currentSteeringAngle:e}=this,{steeringAngle:t}=this.state;let i=0;if(e<t)i=Math.min(t,e+eo);else if(e>t)i=Math.max(t,e-eo);else return;const{wheelBase:n,trackWidth:o}=this,s=n*2,r=Math.sin(i),l=Math.cos(i),c=Math.atan(s*r/(s*l-o*r)),u=Math.atan(s*r/(s*l+o*r));this.base.setSteeringValue(c,ot),this.base.setSteeringValue(u,st),this.currentSteeringAngle=i});O(this,"wheelHasGrip",e=>this.base.wheelInfos[e].isInContact&&!this.base.wheelInfos[e].sliding);const i=new Ri(new he(.9,.4,2.1)),n=new Ri(new he(.9,.4,1.2));this.chassisBody=new Qe({mass:de.vehicle.mass}),this.chassisBody.addShape(i,new he(0,0,.1)).addShape(n,new he(0,.8,.8)),this.base=new lo({chassisBody:this.chassisBody,indexForwardAxis:2,indexRightAxis:0,indexUpAxis:1});const o={radius:Wl,suspensionRestLength:Kl,suspensionStiffness:Xl,maxSuspensionTravel:Yl,maxSuspensionForce:ql,dampingCompression:Zl,dampingRelaxation:Ql,frictionSlip:$l,forwardAcceleration:Jl,sideAcceleration:ec,rollInfluence:tc,axleLocal:new he(-1,0,0),directionLocal:new he(0,-1,0),chassisConnectionPointLocal:new he,customSlidingRotationalSpeed:-30,useCustomSlidingRotationalSpeed:!0},s=.3,r=.85;if(this.trackWidth=r*2,this.wheelBase=1.2+1.4,o.chassisConnectionPointLocal.set(r,-s,-1.2),this.base.addWheel(o),o.chassisConnectionPointLocal.set(-r,-s,-1.2),this.base.addWheel(o),o.chassisConnectionPointLocal.set(r,-s,1.4),this.base.addWheel(o),o.chassisConnectionPointLocal.set(-r,-s,1.4),this.base.addWheel(o),mn){const u=new zi;u.setFromAxisAngle(he.UNIT_Z,Math.PI/2),this.wheelBodies=this.base.wheelInfos.map(h=>{const f=new bn(h.radius,h.radius,h.radius/2,8),y=new Qe({type:Qe.KINEMATIC,collisionFilterGroup:0});return y.addShape(f,he.ZERO,u),y})}this.materials=Nl(t,e);const l={front_r:t,front_l:t.clone(),rear_r:t.clone(),rear_l:t.clone()},c=["x","y","z"];Object.keys(l).forEach(u=>{u.endsWith("_r")&&c.forEach(h=>{l[u].scale[h]*=-1})}),this.wheelMeshes=[l.front_l,l.front_r,l.rear_l,l.rear_r],this.chassisMesh=e,this.state=Dl()}addToWorld(e){return this.base.addToWorld(e),mn&&this.wheelBodies.forEach(e.addBody,e),e.addEventListener("postStep",this.update),this}addToScene(e){return this.wheelMeshes.forEach(t=>{e.add(t)}),e.add(this.chassisMesh),this}setEngineForceDirection(e){this.state.engineForce=jl*e,e===-1?(this.state.engineForce*=.9,this.materials.tailLightMaterial.emissive.setHSL(0,0,ic)):this.materials.tailLightMaterial.emissive.setHSL(0,0,0)}setBrakeForce(e){this.state.brakeForce=Gl*e,nc.forEach(this.brakeWheel)}setSteeringDirection(e){this.state.steeringAngle=Vl*e}resetPosition(){this.chassisBody.position.copy(this.initialPosition),this.chassisBody.quaternion.copy(this.initialRotation),this.chassisBody.velocity.setZero(),this.chassisBody.angularVelocity.setZero()}}const oc=1/de.physicsFrameRate,Si=new Ii("general"),no=new Ii("lowFriction"),ac=new Ii("vehicleTire"),rc=new Mn(Si,Si,{friction:.001}),lc=new Mn(Si,no,{friction:0,contactEquationStiffness:1e8});de.fullscreen&&xr("Allow fullscreen?").then(a=>{a?document.documentElement.requestFullscreen():de.fullscreen=!1});(async function(){let e=!1;const t=new En,i=new ta,n=new Oi,o=new An(16118995,.5);o.position.set(-30,50,-30),o.castShadow=de.renderShadows,i.add(n,o);const s=new co,{x:r,y:l,z:c}=de.world.gravity;s.gravity.set(r,l,c),s.broadphase=new ho(s),s.materials.push(Si,no,ac),s.defaultContactMaterial.friction=.001,s.addContactMaterial(rc),s.addContactMaterial(lc);const u=new ia({antialias:de.antialias,powerPreference:de.powerPreference});u.setPixelRatio(window.devicePixelRatio),u.setSize(window.innerWidth,window.innerHeight),u.shadowMap.enabled=de.renderShadows;const h=new _r(u.domElement);u.domElement.tabIndex=-1,u.domElement.focus();const f=new ca(u),y=new ha(i,h.camera),A=new ee(window.innerWidth,window.innerHeight),P=new Je(A,i,h.camera);P.edgeStrength=2,P.visibleEdgeColor.setHex(15102720),P.hiddenEdgeColor.setHex(6697728),f.addPass(y),document.body.appendChild(u.domElement),window.onresize=rs(W,500);const[b,E,F]=await R(),v=new sc(b,E);v.addToWorld(s).addToScene(i),h.setCameraTarget(v),h.camera.aspect=window.aspectRatio,h.camera.updateProjectionMatrix();const T=new Zr(i,s),S=new El(T,v);S.initCheckpointHandler(i,{checkpoint:il(),finish:F});const H=new Sl(i,h.camera,u.domElement,T),U=Rl(h,T);i.add(U),kl(S,u),T.onPlaceVehicle=(L=0,B=0,j=0,Q=0,N=0,I=0)=>{v.initialPosition.set(L,B,j),v.initialRotation.setFromEuler(si.degToRad(Q),si.degToRad(N),si.degToRad(I)),v.resetPosition()},T.eventTriggerListeners.add(Ze.setCameraPosition,({relatedTarget:L,dataSet:B})=>{if(L===v.chassisBody){const[j,Q,N]=B.split(",");h.cameraPosition.set(Number(j),Number(Q),Number(N))}}),T.eventTriggerListeners.add(Ze.setCameraMode,({relatedTarget:L,dataSet:B})=>{if(L===v.chassisBody){const[j,Q,N,I]=B.split(",");h.cameraMode=j,(Q||N||I)&&h.cameraPosition.set(Number(Q),Number(N),Number(I))}}),T.eventTriggerListeners.add(Ze.startAnimation,({relatedTarget:L,dataSet:B})=>{if(L===v.chassisBody){const j=B,Q=T.getBodyFromStore(j),{velocity_x:N,velocity_y:I,velocity_z:se}=T.getAnimationPropsFromStore(j);Q.velocity.set(N,I,se)}}),T.eventTriggerListeners.add(Ze.reset,({relatedTarget:L})=>{L===v.chassisBody&&S.reset()}),T.listeners.add(Pe.mapElementSelect,L=>{if(P.selectedObjects.length=0,U.detach(),L===St)P.selectedObjects.push(v.chassisMesh,...v.wheelMeshes);else if(L){const B=T.getMeshFromStore(L);P.selectedObjects.push(B),U.attach(B)}}),De.addKeyPressListener("KeyP",()=>{z()}),De.addKeyPressListener("KeyO",()=>{console.log(h.camera.position.x,",",h.camera.position.y,",",h.camera.position.z)}),De.addKeyPressListener("KeyR",L=>{L.altKey?S.loadMap():S.respawnAtLastCheckpoint()}),De.addKeyPressListener("KeyC",()=>{h.switchMode()}),De.addKeyPressListener("KeyM",()=>{C()}),De.addKeyPressListener("Delete",()=>{T.editMode&&T.selectedMapElementId&&T.destroy(T.selectedMapElementId)}),De.addKeyDownChangeListener(L=>{let B=0,j=0;L.has("KeyW")||L.has("ArrowUp")?B=1:(L.has("KeyS")||L.has("ArrowDown"))&&(B=-1),L.has("KeyA")||L.has("ArrowLeft")?j=1:(L.has("KeyD")||L.has("ArrowRight"))&&(j=-1),!S.started&&B&&S.start(),v.setEngineForceDirection(B),v.setSteeringDirection(j),v.setBrakeForce(Number(L.has("Space")))}),S.loadMap();function C(){T.toggleEditMode(),T.editMode?(f.addPass(P),U.enabled=!0,H.enabled=!0,T.selectedMapElementId&&U.attach(T.getMeshFromStore(T.selectedMapElementId))):(f.passes.splice(1,1),U.detach(),U.enabled=!1,H.enabled=!1)}function z(){e=!e,e?(t.stop(),u.setAnimationLoop(null),Wt("paused"),S.started&&S.stop()):(t.start(),u.setAnimationLoop(V),S.started&&S.start())}de.renderWireFrame&&oa(i,s.bodies),u.setAnimationLoop(V);function V(){const L=t.getDelta();h.update(L),S.updateHUD(),S.checkpointHandler.updateVisuals(L),f.render(),s.step(oc,L)}function W(){h.camera.aspect=window.aspectRatio,h.camera.updateProjectionMatrix(),u.setSize(window.innerWidth,window.innerHeight),f.setSize(window.innerWidth,window.innerHeight),P.setSize(window.innerWidth,window.innerHeight)}async function R(){const[L,B,j,Q]=await Promise.all([ri("img/skybox.jpg","398 kB"),ri("3D_objects/lowPoly_car_wheel.gltf","205 kB"),ri("3D_objects/mg.glb","98 kB"),ri("img/pin.svg","0.9 kB")]),N=new na(Ua(L));return N.needsUpdate=!0,i.background=N,n.copy(aa.fromCubeTexture(N)),[j.scene,B.scene,Ha(Q,{x:-6,y:-3,scale:.07})]}})();Object.defineProperty(window,"aspectRatio",{get(){return window.innerWidth/window.innerHeight}});export{Qi as C,ws as E,da as I,$s as M,Ze as T,ds as a,Ce as b,de as c,Ee as d,Wa as e,Vr as f,Qr as g,Gr as h,St as i,jr as l,Hs as m,qe as n,wt as r,cn as s,ja as t,cr as u,hs as v};
