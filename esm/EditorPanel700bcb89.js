var W=Object.defineProperty;var k=(s,e,n)=>e in s?W(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var a=(s,e,n)=>(k(s,typeof e!="symbol"?e+"":e,n),n);import{r as l,R as t}from"./react6742c151.js";import{n as M,I as L,v as U,r as S,t as $,E as h,b as B,u as v,a as K,d as x,T as j,g as z,e as Y,C as J,s as X,f as Z,h as G,l as q,i as Q}from"./index729ca5c2.js";import{S as ee,L as te}from"./Switche9f51982.js";import"./cannoncd468cdc.js";import"./three895a3223.js";const ne="^-?((?!0\\d)\\d+)(\\.\\d+)?$",se=200,V=100,ie="\u25C4",ae="\u25BA";class o extends l.exports.Component{constructor(e){super(e);a(this,"inputRef",l.exports.createRef());a(this,"stepIntervalId",0);a(this,"stepStartTimeoutId",0);a(this,"valueIncrementBuffer",0);a(this,"stepDirection");a(this,"onSetValue",()=>{this.props.onChange(this.numericValue,this.props.id)});a(this,"stepValue",()=>{this.setValue(S(this.numericValue+this.props.step*this.stepDirection))});a(this,"stepValueByBuffer",$(()=>{this.setValue(S(this.numericValue+this.valueIncrementBuffer*this.props.step*this.props.sensitivity)),this.valueIncrementBuffer=0},V));a(this,"stepValueContinuously",()=>{this.stepIntervalId=window.setInterval(this.stepValue,V)});a(this,"onStepButtonDown",({currentTarget:e})=>{const n=e;n.addEventListener("mouseup",this.onStepButtonRelease),n.addEventListener("mouseleave",this.onStepButtonRelease),this.stepDirection=Number(n.dataset.direction),this.stepStartTimeoutId=window.setTimeout(this.stepValueContinuously,se),this.stepValue()});a(this,"onStepButtonRelease",({currentTarget:e})=>{e.removeEventListener("mouseup",this.onStepButtonRelease),e.removeEventListener("mouseleave",this.onStepButtonRelease),window.clearTimeout(this.stepStartTimeoutId),window.clearInterval(this.stepIntervalId)});a(this,"onInputFieldChange",({currentTarget:e})=>{this.setValue(e.value,!0)});a(this,"onInputFieldKeyUp",({key:e})=>{(e==="Enter"||e==="Escape")&&this.inputElement.blur()});a(this,"onInputFieldBlur",()=>{this.state.value===this.props.value||this.state.value===this.props.value.toString()||(this.validNumericValue&&this.numericValue>=this.props.min&&this.numericValue<=this.props.max?this.onSetValue():this.setValue(this.numericValue))});a(this,"onInputFieldMouseDown",e=>{this.inputElement!==document.activeElement&&(e.preventDefault(),this.inputElement.addEventListener("mouseup",this.onInputFieldFocus),this.inputElement.addEventListener("mousemove",this.onInputFieldInitialMouseMove))});a(this,"onInputFieldFocus",()=>{this.inputElement.removeEventListener("mouseup",this.onInputFieldFocus),this.inputElement.removeEventListener("mousemove",this.onInputFieldInitialMouseMove),this.inputElement.focus()});a(this,"onInputFieldInitialMouseMove",e=>{this.inputElement.removeEventListener("mousemove",this.onInputFieldInitialMouseMove),this.inputElement.removeEventListener("mouseup",this.onInputFieldFocus),this.inputElement.parentElement.addEventListener("mouseup",this.onInputFieldMouseMoveFinish),this.inputElement.parentElement.addEventListener("mouseleave",this.onInputFieldMouseMoveFinish),this.inputElement.parentElement.addEventListener("mousemove",this.onInputFieldMouseMove),this.inputElement.parentElement.addEventListener("mousemove",this.stepValueByBuffer),this.onInputFieldMouseMove(e),this.stepValueByBuffer()});a(this,"onInputFieldMouseMoveFinish",()=>{this.inputElement.parentElement.removeEventListener("mousemove",this.onInputFieldMouseMove),this.inputElement.parentElement.removeEventListener("mousemove",this.stepValueByBuffer),this.inputElement.parentElement.removeEventListener("mouseup",this.onInputFieldMouseMoveFinish),this.inputElement.parentElement.removeEventListener("mouseleave",this.onInputFieldMouseMoveFinish)});a(this,"onInputFieldMouseMove",({movementX:e})=>{this.valueIncrementBuffer+=e});a(this,"onInputFieldScroll",e=>{this.valueIncrementBuffer-=e.deltaY,this.stepValueByBuffer()});this.state={value:e.value}}render(){const{label:e,id:n}=this.props,{value:i}=this.state;return t.createElement(L,{label:e,id:n},t.createElement("div",{className:"numberInputControlGroup"},t.createElement("span",{className:"stepButton stepButton-left","data-direction":"-1",onMouseDown:this.onStepButtonDown},ie),t.createElement("input",{id:n,name:n,value:i,pattern:ne,onChange:this.onInputFieldChange,onBlur:this.onInputFieldBlur,onKeyUp:this.onInputFieldKeyUp,onMouseDown:this.onInputFieldMouseDown,onWheel:this.onInputFieldScroll,ref:this.inputRef}),t.createElement("span",{className:"stepButton stepButton-right","data-direction":"1",onMouseDown:this.onStepButtonDown},ae)))}componentDidUpdate(e){this.props.value!==e.value&&this.setState({value:this.props.value})}get inputElement(){return this.inputRef.current}get validNumericValue(){return this.inputElement.value&&!this.inputElement.validity.patternMismatch}get numericValue(){if(this.validNumericValue)return Number(this.state.value);const e=parseInt(this.state.value,10);return Number.isNaN(e)?0:e}setValue(e,n=!1){if(this.validNumericValue&&!n&&(e=U(e,this.props.min,this.props.max)),this.state.value===e)return;const i=n?M:this.onSetValue;this.setState({value:e},i)}}a(o,"defaultProps",{id:"",label:"",value:0,onChange:M,step:.01,sensitivity:1,min:-1/0,max:1/0});function w({optionList:s,id:e,label:n,value:i="",onChange:r=M}){return t.createElement(L,{label:n,id:e},t.createElement("select",{value:i,id:e,name:e,onChange:d},s.map(u=>t.createElement("option",{key:u},u))));function d({currentTarget:u}){r(u.value,e)}}class P extends l.exports.Component{constructor(e){super(e);a(this,"inputRef",l.exports.createRef());a(this,"onInputFieldChange",({currentTarget:e})=>{this.setState({value:e.value})});a(this,"onInputFieldKeyUp",({key:e})=>{(e==="Enter"||e==="Escape")&&this.inputElement.blur()});a(this,"onInputFieldBlur",()=>{this.state.value!==this.props.value&&this.props.onChange(this.state.value,this.props.id)});this.state={value:e.value}}render(){const{id:e,label:n}=this.props,{value:i}=this.state;return t.createElement(L,{label:n,id:e},t.createElement("input",{value:i,id:e,name:e,onChange:this.onInputFieldChange,onBlur:this.onInputFieldBlur,onKeyUp:this.onInputFieldKeyUp,ref:this.inputRef}))}componentDidUpdate(e){this.props.value!==e.value&&this.setState({value:this.props.value})}get inputElement(){return this.inputRef.current}}a(P,"defaultProps",{id:"",label:"",value:"",onChange:M});const{createButtonLabel:oe}=v,le=["box","cylinder","sphere","tetrahedron","triangularPrism","loop","slopeTransition","cantedCurve"];function re(){const{mapBuilder:s}=l.exports.useContext(h),[e,n]=l.exports.useState(B.box);return t.createElement("div",null,t.createElement("button",{onClick:i},oe),t.createElement(w,{value:e,optionList:le,onChange:r=>{n(r)}}));function i(){s.build({shape:e})}}function ue(){const{mapBuilder:s}=l.exports.useContext(h);return t.createElement("div",{className:"modal__body"},t.createElement("textarea",{value:JSON.stringify(s.exportMap(),null,4),onChange:M}))}const me="import",pe=`[
    {
        "type": "vehicle",
        "position_y": 2,
        "position_z": 10
    },
    {
        "shape": "box",
        "width": 20,
        "height": 0.1,
        "length": 20
    },
    {
        "shape": "triangularPrism",
        "width": 3,
        "height": 1,
        "length": 3,
        "position_x": -3,
        "position_y": 0.1
    }
]`;function ce({closeModal:s}){const{mapBuilder:e}=l.exports.useContext(h),n=l.exports.useRef();return t.createElement(t.Fragment,null,t.createElement("div",{className:"modal__body"},t.createElement("textarea",{ref:n,placeholder:pe})),t.createElement("button",{onClick:i},me));function i(){const r=n.current.value;let d;try{d=JSON.parse(r)}catch(u){console.warn(u);return}e.importMap(d),s()}}const{importButtonLabel:de,exportButtonLabel:he}=v;function Ee(){const[s,e]=l.exports.useState();return t.createElement("div",null,t.createElement("button",{onClick:n},de),t.createElement("button",{onClick:i},he),s&&t.createElement(K,{onClose:r},s==="import"&&t.createElement(ce,{closeModal:r}),s==="export"&&t.createElement(ue,null)));function n(){e("import")}function i(){e("export")}function r(){e(void 0)}}const{cloneButtonLabel:ve,removeButtonLabel:ge}=v;function fe(){const{mapBuilder:s}=l.exports.useContext(h);return t.createElement("div",null,t.createElement("button",{onClick:e},ve),t.createElement("button",{onClick:n},ge));function e(){s.clone(s.selectedMapElementId)}function n(){s.destroy(s.selectedMapElementId)}}const be="Attributes",Ie={default:["type","mass","color"],compound:["color"],animated:["dataSet"],trigger:["type","event","dataSet"],vehicle:[]},Me=["checkpoint","finish","reset","setCameraMode","setCameraPosition","startAnimation"];function Ce({mapElementProps:s}){const{mapBuilder:e}=l.exports.useContext(h),{type:n=x.default,mass:i=0,event:r=j.setCameraPosition,dataSet:d=""}=s,u=z(s),g=typeof u=="number"?Y(u):u;return t.createElement(t.Fragment,null,t.createElement("span",{className:"label"},be),C(n,"type")&&t.createElement(ee,{label:"isTrigger:",id:"type",on:n===x.trigger,onChange:f}),C(n,"mass")&&t.createElement(o,{label:"mass:",id:"mass",value:i,onChange:c,min:0,step:1}),C(n,"event")&&t.createElement(w,{label:"event:",id:"event",value:r,onChange:c,optionList:Me}),C(n,"dataSet")&&t.createElement(P,{label:"dataSet:",id:"dataSet",value:d,onChange:c}),C(n,"color")&&t.createElement(J,{label:"color:",id:"color",value:g,onChange:c,onInput:b}));function c(E,I){e.setAttribute(e.selectedMapElementId,{[I]:E})}function f(E,I){e.setAttribute(e.selectedMapElementId,{[I]:E?x.trigger:x.default})}function b(E){X(e.getMeshFromStore(e.selectedMapElementId),E)}}function C(s,e){return Ie[s].includes(e)}const{mapElementListLabel:Be}=v;function xe(){const{mapBuilder:s}=l.exports.useContext(h);return t.createElement(te,{label:Be,contentList:s.mapElementIdList,selected:s.selectedMapElementId,onClick:e=>{s.selectMapElement(e)}})}const{transformPanelLabel:Le,widthLabel:ye,heightLabel:Fe,lengthLabel:Se,radiusTopLabel:Ve,radiusBottomLabel:we,sidesLabel:Pe,segmentWidthLabel:Te,segmentHeightLabel:De,segmentLengthLabel:Ae,segmentCountLabel:Ne,offsetLabel:T,radiusLabel:_e,angleLabel:Re}=v,He={box:["width","height","length"],cylinder:["height","radiusTop","radiusBottom","sides"],sphere:["radius"],tetrahedron:["width","height","length"],triangularPrism:["width","height","length","offset"],loop:["segmentWidth","segmentHeight","segmentLength","segmentCount","segmentPositionOffset","radius"],slopeTransition:["segmentWidth","segmentHeight","segmentLength","segmentCount","angle"],cantedCurve:["segmentWidth","segmentHeight","segmentLength","segmentCount","radius","angle"]};function Oe({mapElementProps:s}){const{mapBuilder:e}=l.exports.useContext(h),n=We(s.shape),{shape:i,width:r=2,height:d=2,length:u=2,offset:g=0,radius:c=n.radius||1,radiusTop:f=1,radiusBottom:b=1,sides:E=6,segmentCount:I=n.segmentCount,segmentWidth:D=n.segmentWidth,segmentHeight:A=n.segmentHeight,segmentLength:N=n.segmentLength,segmentPositionOffset:_=n.segmentPositionOffset,angle:R=n.angle}=s;return t.createElement(t.Fragment,null,t.createElement("span",{className:"label"},Le),p("width",i)&&t.createElement(o,{label:ye,id:"width",value:r,onChange:m,min:0}),p("height",i)&&t.createElement(o,{label:Fe,id:"height",value:d,onChange:m,min:0}),p("length",i)&&t.createElement(o,{label:Se,id:"length",value:u,onChange:m,min:0}),p("offset",i)&&t.createElement(o,{label:T,id:"offset",value:g,onChange:m}),p("radiusTop",i)&&t.createElement(o,{label:Ve,id:"radiusTop",value:f,onChange:m,min:0}),p("radiusBottom",i)&&t.createElement(o,{label:we,id:"radiusBottom",value:b,onChange:m,min:0}),p("sides",i)&&t.createElement(o,{label:Pe,id:"sides",value:E,onChange:m,min:3,step:1}),p("segmentCount",i)&&t.createElement(o,{label:Ne,id:"segmentCount",value:I,onChange:m,min:1,step:1}),p("segmentWidth",i)&&t.createElement(o,{label:Te,id:"segmentWidth",value:D,onChange:m,min:0}),p("segmentHeight",i)&&t.createElement(o,{label:De,id:"segmentHeight",value:A,onChange:m,min:0}),p("segmentLength",i)&&t.createElement(o,{label:Ae,id:"segmentLength",value:N,onChange:m,min:0}),p("segmentPositionOffset",i)&&t.createElement(o,{label:T,id:"segmentPositionOffset",value:_,onChange:m}),p("radius",i)&&t.createElement(o,{label:_e,id:"radius",value:c,onChange:m,min:0}),p("angle",i)&&t.createElement(o,{label:Re,id:"angle",value:R,onChange:m,min:0,max:180,step:1}));function m(H,O){e.transform(e.selectedMapElementId,{[O]:H})}}function p(s,e){var n;return(n=He[e])==null?void 0:n.includes(s)}function We(s){switch(s){case B.loop:return q;case B.slopeTransition:return G;case B.cantedCurve:return Z;default:return{}}}const{translatePanelLabel:ke,positionLabel:y,rotationLabel:F}=v;function Ue({mapElementProps:s}){const{mapBuilder:e}=l.exports.useContext(h),{position_x:n=0,position_y:i=0,position_z:r=0,rotation_x:d=0,rotation_y:u=0,rotation_z:g=0}=s;return t.createElement(t.Fragment,null,t.createElement("span",{className:"label"},ke),t.createElement(o,{label:`${y}.X:`,id:"position_x",value:n,sensitivity:10,onChange:c}),t.createElement(o,{label:`${y}.Y:`,id:"position_y",value:i,sensitivity:10,onChange:c}),t.createElement(o,{label:`${y}.Z:`,id:"position_z",value:r,sensitivity:10,onChange:c}),t.createElement(o,{label:`${F}.X:`,id:"rotation_x",value:d,sensitivity:10,onChange:c,min:-360,max:360}),t.createElement(o,{label:`${F}.Y:`,id:"rotation_y",value:u,sensitivity:10,onChange:c,min:-360,max:360}),t.createElement(o,{label:`${F}.Z:`,id:"rotation_z",value:g,sensitivity:10,onChange:c,min:-360,max:360}));function c(f,b){e.translate(e.selectedMapElementId,{[b]:f})}}function Xe(){const{mapBuilder:s,mapElementProps:e}=l.exports.useContext(h);return t.createElement(t.Fragment,null,t.createElement(Ee,null),t.createElement(xe,null),s.selectedMapElementId&&e&&t.createElement(t.Fragment,null,t.createElement(Ue,{mapElementProps:e}),s.selectedMapElementId!==Q&&t.createElement(t.Fragment,null,t.createElement(Oe,{mapElementProps:e}),t.createElement(Ce,{mapElementProps:e}),t.createElement(fe,null))),t.createElement(re,null))}export{Xe as default};
